import{c as ue,a as he,u as ge,b as pe,j as e,r as a,d as w,C as D,f as K,g as V,h as R,i as P,X as be,e as M}from"./index-DFO2lo2s.js";import{u as fe}from"./useMutation-BIXw1p8a.js";import{B as d}from"./button-6IH7luFD.js";import{I as je}from"./input-DGvqAMIq.js";import{L as Q}from"./label-ByXqB0vV.js";import{S as J,a as X,b as _,c as G,d as h}from"./select-KhIWU-DA.js";import{D as ye,a as ve,b as Ne,c as we,e as Se}from"./dialog-eRBlhqVz.js";import{P as Ce}from"./provider-layout-Ct1Anak8.js";import{A as ke}from"./arrow-left-DxjewkX7.js";import{S as Te}from"./sparkles-B780Ik13.js";import{S}from"./search-CMPUhstB.js";import{F as Ee}from"./filter-CW77cLze.js";import{F as Fe}from"./file-text-BGlUqYEM.js";import{C as Ae}from"./clock-BQ1l0DXv.js";import{P as De}from"./plus-CUNQfl1u.js";import"./index-BdQq_4o_.js";import"./index-BZw1vT_C.js";import"./index-BEl4sio8.js";import"./index-zokK3oQV.js";import"./index-r8gFfIDH.js";import"./index-heHCkeO_.js";import"./index-BGiioUCj.js";import"./chevron-down-Cj8L_1vh.js";import"./check-C4mt73Rm.js";import"./index-O3IU6Cgx.js";function vs(){const{toast:y}=ue(),[Pe,L]=he(),{user:v}=ge(),U=pe();if(!v)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Carregando..."})]})});const[Le,Ie]=a.useState(""),[qe,$e]=a.useState(""),[g,Oe]=a.useState(""),[ze,Be]=a.useState(""),[He,Ke]=a.useState(""),[Ve,Re]=a.useState("30"),[Me,Qe]=a.useState("25"),[Je,Xe]=a.useState("5"),[m,I]=a.useState(""),[W,Y]=a.useState(!1),[i,q]=a.useState(""),[n,p]=a.useState(""),[$,Z]=a.useState(!1),[t,ee]=a.useState(null),[u,O]=a.useState(""),[x,z]=a.useState(""),[se,C]=a.useState(!1),[l,k]=a.useState(1),{data:T=[],isLoading:re,error:E}=w({queryKey:["/api/niches"],queryFn:async()=>{try{const s=await fetch("/api/niches");if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const r=await s.json();return Array.isArray(r)?r:[]}catch(s){return console.error("Erro ao carregar nichos:",s),[]}},retry:2,retryDelay:1e3,staleTime:5*60*1e3}),{data:ae=[],isLoading:_e,error:Ge}=w({queryKey:["/api/categories",g],queryFn:async()=>{try{if(!g||g==="teste")return[];const s=await fetch(`/api/categories?nicheId=${g}`);if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const r=await s.json();return Array.isArray(r)?r:[]}catch(s){return console.error("Erro ao carregar categorias:",s),[]}},enabled:!!g&&g!=="teste",retry:2,retryDelay:1e3,staleTime:5*60*1e3}),{data:c=[],isLoading:te}=w({queryKey:["/api/categories"],queryFn:async()=>{try{const s=await fetch("/api/categories");if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const r=await s.json();return Array.isArray(r)?r:[]}catch(s){return console.error("Erro ao carregar todas as categorias:",s),[]}},retry:2,retryDelay:1e3,staleTime:5*60*1e3}),{data:B=[],isLoading:ie,error:oe}=w({queryKey:["/api/service-templates"],queryFn:async()=>{const s=await fetch("/api/service-templates");if(!s.ok)throw new Error("Falha ao carregar templates de serviço");return s.json()}}),b=a.useMemo(()=>B.filter(s=>{var N,j;const r=!m||s.name.toLowerCase().includes(m.toLowerCase())||(((N=s.description)==null?void 0:N.toLowerCase())||"").includes(m.toLowerCase()),o=!n||((j=s.categoryId)==null?void 0:j.toString())===n,F=!i||(()=>{var H;const A=c.find(xe=>xe.id===s.categoryId);return((H=A==null?void 0:A.nicheId)==null?void 0:H.toString())===i})();return r&&o&&F}),[B,m,i,n,c]),ne=()=>{I(""),q(""),p("")},le=s=>{ee(s),O(""),z(s.duration?String(s.duration):""),C(!0)},ce=async()=>{if(!t||!u||!x){y({title:"Preencha todos os campos",variant:"destructive"});return}try{const s=await fetch("/api/services",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:t.name,description:t.description,categoryId:t.categoryId,price:parseFloat(u),duration:parseInt(x)})});if(!s.ok)throw new Error("Erro ao criar serviço a partir do template");const r=await s.json();f.mutate({serviceId:r.id,executionTime:parseInt(x),price:parseFloat(u),breakTime:0,duration:parseInt(x)}),C(!1)}catch(s){y({title:"Erro ao adicionar serviço",description:s.message,variant:"destructive"})}},f=fe({mutationFn:async({serviceId:s,executionTime:r,price:o,breakTime:F,duration:N})=>{const j=await fetch("/api/provider-services",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({providerId:v==null?void 0:v.id,serviceId:s,executionTime:r,price:o,breakTime:F,duration:N})});if(!j.ok)throw new Error("Erro ao adicionar serviço");return j.json()},onSuccess:()=>{y({title:"Serviço adicionado!",description:"O serviço foi adicionado ao seu catálogo."}),U.invalidateQueries({queryKey:["/api/provider-services"]}),L("/provider/services")},onError:s=>{y({title:"Erro ao adicionar serviço",description:s.message,variant:"destructive"})}}),de=()=>re?e.jsx(h,{value:"loading",disabled:!0,children:"Carregando nichos..."}):E?e.jsx(h,{value:"error",disabled:!0,children:"Erro ao carregar nichos"}):!Array.isArray(T)||T.length===0?e.jsx(h,{value:"empty",disabled:!0,children:"Nenhum nicho disponível"}):T.map(s=>e.jsx(h,{value:((s==null?void 0:s.id)||"unknown").toString(),children:(s==null?void 0:s.name)||"Nicho sem nome"},(s==null?void 0:s.id)||"unknown")),me=()=>te?e.jsx(h,{value:"loading",disabled:!0,children:"Carregando categorias..."}):!Array.isArray(c)||c.length===0?e.jsx(h,{value:"empty",disabled:!0,children:"Nenhuma categoria disponível"}):(i?c.filter(r=>{var o;return((o=r.nicheId)==null?void 0:o.toString())===i}):c).map(r=>e.jsx(h,{value:((r==null?void 0:r.id)||"unknown").toString(),children:(r==null?void 0:r.name)||"Categoria sem nome"},(r==null?void 0:r.id)||"unknown"));return a.useEffect(()=>{const s=i?c.filter(r=>{var o;return((o=r.nicheId)==null?void 0:o.toString())===i}):c;n&&!s.some(r=>{var o;return((o=r.id)==null?void 0:o.toString())===n})&&p("")},[i,c,n,p]),e.jsx(Ce,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100",children:e.jsxs("div",{className:"container mx-auto py-8 px-4 max-w-6xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>L("/provider/services"),className:"hover:bg-gray-200 transition-colors",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Voltar"]}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsx("h1",{className:"text-4xl font-bold text-gray-900",children:"Adicionar Novo Serviço"})]}),e.jsx("p",{className:"text-gray-600 text-lg max-w-2xl",children:"Crie um serviço personalizado para seu catálogo ou encontre templates prontos para adicionar."})]}),E&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("p",{className:"text-red-600 font-medium",children:["Erro ao carregar nichos: ",E.message]}),e.jsx(d,{variant:"outline",size:"sm",className:"mt-3",onClick:()=>window.location.reload(),children:"Tentar novamente"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(D,{className:"sticky top-8 shadow-lg border-0 bg-white/80 backdrop-blur-sm",children:[e.jsxs(K,{className:"pb-4",children:[e.jsxs(V,{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-gray-700"}),"Opções"]}),e.jsx(R,{className:"text-gray-600",children:"Escolha como adicionar seu serviço"})]}),e.jsx(P,{className:"space-y-3",children:e.jsxs(d,{className:"w-full justify-start h-12 transition-all duration-200 bg-gray-900 text-white hover:bg-gray-800 shadow-lg",variant:"default",onClick:()=>Y(!0),children:[e.jsx(S,{className:"mr-3 h-4 w-4"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Buscar Templates"}),e.jsx("div",{className:"text-xs opacity-80",children:"Serviços prontos"})]})]})})]})}),e.jsx("div",{className:"lg:col-span-3",children:W&&e.jsxs(D,{className:"shadow-xl border-0 bg-white/90 backdrop-blur-sm",children:[e.jsxs(K,{className:"pb-6",children:[e.jsxs(V,{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(S,{className:"h-6 w-6 text-gray-700"}),"Buscar Templates"]}),e.jsx(R,{className:"text-gray-600 text-base",children:"Encontre serviços prontos para adicionar ao seu catálogo"})]}),e.jsxs(P,{className:"py-6",children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(je,{placeholder:"Buscar templates...",value:m,onChange:s=>I(s.target.value),className:"pl-10 h-12 bg-white border-gray-200 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>Z(!$),className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Filtros",(i||n)&&e.jsx("span",{className:"bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded-full",children:(i?1:0)+(n?1:0)})]}),(i||n||m)&&e.jsxs(d,{variant:"ghost",size:"sm",onClick:ne,className:"flex items-center gap-2 text-gray-500 hover:text-gray-700",children:[e.jsx(be,{className:"h-4 w-4"}),"Limpar"]})]}),$&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Q,{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Nicho"}),e.jsxs(J,{value:i,onValueChange:s=>{q(s),p("")},children:[e.jsx(X,{className:"h-10 bg-white rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 shadow-sm text-base font-medium transition-all duration-150",children:e.jsx(_,{placeholder:"Selecione um nicho"})}),e.jsx(G,{className:"bg-white rounded-lg shadow-lg border border-gray-200 py-1 text-base",children:de()})]})]}),e.jsxs("div",{children:[e.jsx(Q,{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Categoria"}),e.jsxs(J,{value:n,onValueChange:p,children:[e.jsx(X,{className:"h-10 bg-white rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 shadow-sm text-base font-medium transition-all duration-150",children:e.jsx(_,{placeholder:"Selecione uma categoria"})}),e.jsx(G,{className:"bg-white rounded-lg shadow-lg border border-gray-200 py-1 text-base",children:me()})]})]})]})})]}),ie?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(M,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"Carregando templates..."})]}):oe?e.jsx("div",{className:"text-center py-8 text-red-500",children:"Erro ao carregar templates"}):b.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(S,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500 text-lg font-medium mb-2",children:m||i||n?"Nenhum template encontrado":"Nenhum template disponível"}),e.jsx("p",{className:"text-gray-400 text-sm",children:m||i||n?"Tente ajustar os filtros ou termos de busca":"Templates serão adicionados em breve"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 text-sm text-gray-600",children:[b.length," template",b.length!==1?"s":""," encontrado",b.length!==1?"s":""]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map(s=>{var r;return e.jsx(D,{className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 border border-gray-100",children:e.jsxs(P,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm leading-tight line-clamp-2",children:s.name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ml-2 flex-shrink-0 ${s.isActive?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:s.isActive?"Ativo":"Inativo"})]}),e.jsx("p",{className:"text-gray-600 text-xs mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-500 text-xs mb-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Fe,{className:"h-3 w-3"}),((r=ae.find(o=>o.id===s.categoryId))==null?void 0:r.name)||"-"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ae,{className:"h-3 w-3"}),s.duration," min"]})]}),e.jsxs(d,{className:"w-full h-8 bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium",onClick:()=>le(s),disabled:f.isPending,children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),"Adicionar"]})]})},s.id)})})]})]})]})})]}),e.jsx(ye,{open:se,onOpenChange:s=>{C(s),s||k(1)},children:e.jsxs(ve,{className:"bg-white rounded-xl shadow-lg p-8 max-w-md w-full",children:[e.jsx(Ne,{children:e.jsx(we,{className:"text-xl font-bold text-gray-900 text-center",children:"Adicionar Serviço"})}),e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[220px] gap-6",children:[l===1&&e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-4 text-center",children:[e.jsx("span",{className:"block font-semibold text-gray-900 text-lg mb-1",children:t==null?void 0:t.name}),e.jsx("span",{className:"block text-gray-600 text-sm mb-2",children:t==null?void 0:t.description})]}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Defina o preço do serviço (R$)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 transition",value:u,onChange:s=>O(s.target.value),placeholder:"Ex: 99.90"})]}),l===2&&e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"mb-4 text-center",children:e.jsx("span",{className:"block font-semibold text-gray-900 text-lg mb-1",children:t==null?void 0:t.name})}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Defina o tempo de execução (min)"}),e.jsx("input",{type:"number",min:"1",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900 transition",value:x,onChange:s=>z(s.target.value),placeholder:"Ex: 60"})]}),l===3&&e.jsxs("div",{className:"w-full text-center",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"block font-semibold text-gray-900 text-lg mb-1",children:t==null?void 0:t.name}),e.jsx("span",{className:"block text-gray-600 text-sm mb-2",children:t==null?void 0:t.description})]}),e.jsxs("div",{className:"mb-2 text-gray-700",children:["Preço: ",e.jsxs("span",{className:"font-semibold",children:["R$ ",u]})]}),e.jsxs("div",{className:"mb-2 text-gray-700",children:["Tempo de Execução: ",e.jsxs("span",{className:"font-semibold",children:[x," min"]})]}),e.jsx("div",{className:"mt-4 text-gray-500 text-sm",children:"Confirme os dados antes de adicionar ao seu catálogo."})]})]}),e.jsxs(Se,{className:"flex-row justify-center gap-4 mt-8",children:[l>1?e.jsx(d,{variant:"outline",onClick:()=>k(l-1),className:"rounded-lg px-6 border-blue-700 text-blue-700 hover:bg-blue-50 font-semibold",children:"Voltar"}):null,l<3?e.jsx(d,{onClick:()=>{l===1&&!u||l===2&&!x||k(l+1)},className:"bg-blue-700 hover:bg-blue-800 text-white font-semibold rounded-lg px-6",disabled:l===1&&!u||l===2&&!x||f.isPending,children:"Próximo"}):e.jsxs(d,{onClick:ce,className:"bg-blue-700 hover:bg-blue-800 text-white font-semibold rounded-lg px-6",disabled:f.isPending,children:[f.isPending?e.jsx(M,{className:"animate-spin h-4 w-4 mr-2 inline"}):null,"Finalizar"]})]})]})})]})})})}export{vs as default};
