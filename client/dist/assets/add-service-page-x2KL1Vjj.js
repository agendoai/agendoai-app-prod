import{j as e}from"./ui-UIpCtT3r.js";import{r as l}from"./vendor-vA4cx1mx.js";import{b as oe,u as ne,a as le,c as T,C as z,d as ce,e as de,f as me,g as V,X as xe,L as B,n as he}from"./index-BJ9Cw0LR.js";import{u as ge}from"./useMutation-CDdW0pzE.js";import{B as x}from"./button-BvsVcTDx.js";import{I as ue}from"./input-CNw_l4dQ.js";import{L as H}from"./label-qfvszZNj.js";import{S as K,a as R,b as M,c as Q,d as g}from"./select-hCrJFe1P.js";import{u as pe}from"./router-CxXythJb.js";import{D as be,a as fe,b as je,c as ve,e as ye}from"./dialog-BlryVO8p.js";import{P as Ne}from"./provider-layout-apcwZY_p.js";import{A as we}from"./arrow-left-EWHBe2nW.js";import{S as F}from"./search-ByWcnwgm.js";import{F as Ce}from"./filter-DD6WvVwF.js";import{F as Se}from"./file-text-Dcjpqiow.js";import{C as ke}from"./clock-BoQP0pJL.js";import{P as Ee}from"./plus-C7D4Nhz_.js";import"./index-BdQq_4o_.js";import"./index-BH3L9zMK.js";import"./chevron-down-Dg2l6tfZ.js";import"./check-ZbxB06uW.js";function Ue(){const{toast:j}=oe(),[Te,A]=pe(),{user:v}=ne(),J=le();if(!v)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Carregando..."})]})});const[d,L]=l.useState(""),[t,P]=l.useState(""),[o,u]=l.useState(""),[I,X]=l.useState(!1),[a,_]=l.useState(null),[h,D]=l.useState(""),[m,q]=l.useState(""),[G,N]=l.useState(!1),[n,w]=l.useState(1),{data:C=[],isLoading:U,error:S}=T({queryKey:["/api/niches"],queryFn:async()=>{try{const s=await fetch("/api/niches");if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const r=await s.json();return Array.isArray(r)?r:[]}catch(s){return console.error("Erro ao carregar nichos:",s),[]}},retry:2,retryDelay:1e3,staleTime:5*60*1e3}),{data:c=[],isLoading:W}=T({queryKey:["/api/categories"],queryFn:async()=>{try{const s=await fetch("/api/categories");if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const r=await s.json();return Array.isArray(r)?r:[]}catch(s){return console.error("Erro ao carregar todas as categorias:",s),[]}},retry:2,retryDelay:1e3,staleTime:5*60*1e3}),{data:O=[],isLoading:Y,error:Z}=T({queryKey:["/api/service-templates"],queryFn:async()=>{const s=await fetch("/api/service-templates");if(!s.ok)throw new Error("Falha ao carregar templates de serviço");return s.json()}}),p=l.useMemo(()=>O.filter(s=>{var y,f;const r=!d||s.name.toLowerCase().includes(d.toLowerCase())||(((y=s.description)==null?void 0:y.toLowerCase())||"").includes(d.toLowerCase()),i=!o||((f=s.categoryId)==null?void 0:f.toString())===o,k=!t||(()=>{var $;const E=c.find(ie=>ie.id===s.categoryId);return(($=E==null?void 0:E.nicheId)==null?void 0:$.toString())===t})();return r&&i&&k}),[O,d,t,o,c]),ee=()=>{L(""),P(""),u("")},se=s=>{_(s),D(""),q(s.duration?String(s.duration):""),N(!0)},re=async()=>{if(!a||!h||!m){j({title:"Preencha todos os campos",variant:"destructive"});return}try{const s=await fetch("/api/services",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a.name,description:a.description,categoryId:a.categoryId,price:parseFloat(h),duration:parseInt(m)})});if(!s.ok)throw new Error("Erro ao criar serviço a partir do template");const r=await s.json();b.mutate({serviceId:r.id,executionTime:parseInt(m),price:parseFloat(h),breakTime:0,duration:parseInt(m)}),N(!1)}catch(s){j({title:"Erro ao adicionar serviço",description:s.message,variant:"destructive"})}},b=ge({mutationFn:async({serviceId:s,executionTime:r,price:i,breakTime:k,duration:y})=>{const f=await he("/provider-services",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({providerId:v==null?void 0:v.id,serviceId:s,executionTime:r,price:i,breakTime:k,duration:y})});if(!f.ok)throw new Error("Erro ao adicionar serviço");return f.json()},onSuccess:()=>{j({title:"Serviço adicionado!",description:"O serviço foi adicionado ao seu catálogo."}),J.invalidateQueries({queryKey:["/api/provider-services"]}),A("/provider/services")},onError:s=>{j({title:"Erro ao adicionar serviço",description:s.message,variant:"destructive"})}}),ae=()=>U?e.jsx(g,{value:"loading",disabled:!0,children:"Carregando nichos..."}):S?e.jsx(g,{value:"error",disabled:!0,children:"Erro ao carregar nichos"}):!Array.isArray(C)||C.length===0?e.jsx(g,{value:"empty",disabled:!0,children:"Nenhum nicho disponível"}):C.map(s=>e.jsx(g,{value:((s==null?void 0:s.id)||"unknown").toString(),children:(s==null?void 0:s.name)||"Nicho sem nome"},(s==null?void 0:s.id)||"unknown")),te=()=>W?e.jsx(g,{value:"loading",disabled:!0,children:"Carregando categorias..."}):!Array.isArray(c)||c.length===0?e.jsx(g,{value:"empty",disabled:!0,children:"Nenhuma categoria disponível"}):(t?c.filter(r=>{var i;return((i=r.nicheId)==null?void 0:i.toString())===t}):c).map(r=>e.jsx(g,{value:((r==null?void 0:r.id)||"unknown").toString(),children:(r==null?void 0:r.name)||"Categoria sem nome"},(r==null?void 0:r.id)||"unknown"));return l.useEffect(()=>{const s=t?c.filter(r=>{var i;return((i=r.nicheId)==null?void 0:i.toString())===t}):c;o&&!s.some(r=>{var i;return((i=r.id)==null?void 0:i.toString())===o})&&u("")},[t,c,o,u]),e.jsx(Ne,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100",children:e.jsxs("div",{className:"container mx-auto py-8 px-4 max-w-6xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>A("/provider/services"),className:"hover:bg-gray-200 transition-colors",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Voltar"]}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Adicionar Novo Serviço"})]}),e.jsx("p",{className:"text-gray-600 text-lg max-w-2xl",children:"Encontre templates de serviços prontos para adicionar ao seu catálogo."})]}),S&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("p",{className:"text-red-600 font-medium",children:["Erro ao carregar nichos: ",S.message]}),e.jsx(x,{variant:"outline",size:"sm",className:"mt-3",onClick:()=>window.location.reload(),children:"Tentar novamente"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-8",children:e.jsx("div",{className:"col-span-1",children:e.jsxs(z,{className:"shadow-xl border-0 bg-white/90 backdrop-blur-sm",children:[e.jsxs(ce,{className:"pb-6",children:[e.jsxs(de,{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(F,{className:"h-6 w-6 text-[#58c9d1]"}),"Buscar Templates"]}),e.jsx(me,{className:"text-gray-600 text-base",children:"Encontre serviços prontos para adicionar ao seu catálogo"})]}),e.jsxs(V,{className:"py-6",children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(ue,{placeholder:"Buscar templates...",value:d,onChange:s=>L(s.target.value),className:"pl-10 h-12 bg-white border-gray-200 focus:border-[#58c9d1] focus:ring-[#58c9d1]"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>X(!I),className:"flex items-center gap-2 border-[#58c9d1] text-[#58c9d1] hover:bg-[#58c9d1] hover:text-white",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Filtros",(t||o)&&e.jsx("span",{className:"bg-[#58c9d1] text-white text-xs px-2 py-1 rounded-full",children:(t?1:0)+(o?1:0)})]}),(t||o||d)&&e.jsxs(x,{variant:"ghost",size:"sm",onClick:ee,className:"flex items-center gap-2 text-gray-500 hover:text-gray-700",children:[e.jsx(xe,{className:"h-4 w-4"}),"Limpar"]})]}),I&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(H,{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Nicho"}),e.jsxs(K,{value:t,onValueChange:s=>{P(s),u("")},children:[e.jsx(R,{className:"h-10 bg-white rounded-lg border border-gray-300 focus:border-[#58c9d1] focus:ring-2 focus:ring-[#58c9d1]/20 shadow-sm text-base font-medium transition-all duration-150",children:e.jsx(M,{placeholder:"Selecione um nicho"})}),e.jsx(Q,{className:"bg-white rounded-lg shadow-lg border border-gray-200 py-1 text-base",children:ae()})]})]}),e.jsxs("div",{children:[e.jsx(H,{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Categoria"}),e.jsxs(K,{value:o,onValueChange:u,children:[e.jsx(R,{className:"h-10 bg-white rounded-lg border border-gray-300 focus:border-[#58c9d1] focus:ring-2 focus:ring-[#58c9d1]/20 shadow-sm text-base font-medium transition-all duration-150",children:e.jsx(M,{placeholder:"Selecione uma categoria"})}),e.jsx(Q,{className:"bg-white rounded-lg shadow-lg border border-gray-200 py-1 text-base",children:te()})]})]})]})})]}),Y?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(B,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"Carregando templates..."})]}):Z?e.jsx("div",{className:"text-center py-8 text-red-500",children:"Erro ao carregar templates"}):p.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(F,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500 text-lg font-medium mb-2",children:d||t||o?"Nenhum template encontrado":"Nenhum template disponível"}),e.jsx("p",{className:"text-gray-400 text-sm",children:d||t||o?"Tente ajustar os filtros ou termos de busca":"Templates serão adicionados em breve"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 text-sm text-gray-600",children:[p.length," template",p.length!==1?"s":""," encontrado",p.length!==1?"s":""]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 max-h-[400px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:p.map(s=>{var r;return e.jsx(z,{className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-200 border border-gray-100",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm leading-tight line-clamp-2",children:s.name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ml-2 flex-shrink-0 ${s.isActive?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:s.isActive?"Ativo":"Inativo"})]}),e.jsx("p",{className:"text-gray-600 text-xs mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-500 text-xs mb-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"h-3 w-3"}),((r=c.find(i=>i.id===s.categoryId))==null?void 0:r.name)||"-"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"h-3 w-3"}),s.duration," min"]})]}),e.jsxs(x,{className:"w-full h-8 bg-[#58c9d1] hover:bg-[#4bb8c0] text-white text-xs font-medium",onClick:()=>se(s),disabled:b.isPending,children:[e.jsx(Ee,{className:"h-3 w-3 mr-1"}),"Adicionar"]})]})},s.id)})})]})]})]})})}),e.jsx(be,{open:G,onOpenChange:s=>{N(s),s||w(1)},children:e.jsxs(fe,{className:"bg-white rounded-xl shadow-lg p-8 max-w-md w-full",children:[e.jsx(je,{children:e.jsx(ve,{className:"text-xl font-bold text-gray-900 text-center",children:"Adicionar Serviço"})}),e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[220px] gap-6",children:[n===1&&e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-4 text-center",children:[e.jsx("span",{className:"block font-semibold text-gray-900 text-lg mb-1",children:a==null?void 0:a.name}),e.jsx("span",{className:"block text-gray-600 text-sm mb-2",children:a==null?void 0:a.description})]}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Defina o preço do serviço (R$)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-[#58c9d1] focus:border-[#58c9d1] bg-white text-gray-900 transition",value:h,onChange:s=>D(s.target.value),placeholder:"Ex: 99.90"})]}),n===2&&e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"mb-4 text-center",children:e.jsx("span",{className:"block font-semibold text-gray-900 text-lg mb-1",children:a==null?void 0:a.name})}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Defina o tempo de execução (min)"}),e.jsx("input",{type:"number",min:"1",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-[#58c9d1] focus:border-[#58c9d1] bg-white text-gray-900 transition",value:m,onChange:s=>q(s.target.value),placeholder:"Ex: 60"})]}),n===3&&e.jsxs("div",{className:"w-full text-center",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"block font-semibold text-gray-900 text-lg mb-1",children:a==null?void 0:a.name}),e.jsx("span",{className:"block text-gray-600 text-sm mb-2",children:a==null?void 0:a.description})]}),e.jsxs("div",{className:"mb-2 text-gray-700",children:["Preço: ",e.jsxs("span",{className:"font-semibold",children:["R$ ",h]})]}),e.jsxs("div",{className:"mb-2 text-gray-700",children:["Tempo de Execução: ",e.jsxs("span",{className:"font-semibold",children:[m," min"]})]}),e.jsx("div",{className:"mt-4 text-gray-500 text-sm",children:"Confirme os dados antes de adicionar ao seu catálogo."})]})]}),e.jsxs(ye,{className:"flex-row justify-center gap-4 mt-8",children:[n>1?e.jsx(x,{variant:"outline",onClick:()=>w(n-1),className:"rounded-lg px-6 border-[#58c9d1] text-[#58c9d1] hover:bg-[#58c9d1]/10 font-semibold",children:"Voltar"}):null,n<3?e.jsx(x,{onClick:()=>{n===1&&!h||n===2&&!m||w(n+1)},className:"bg-[#58c9d1] hover:bg-[#4bb8c0] text-white font-semibold rounded-lg px-6",disabled:n===1&&!h||n===2&&!m||b.isPending,children:"Próximo"}):e.jsxs(x,{onClick:re,className:"bg-[#58c9d1] hover:bg-[#4bb8c0] text-white font-semibold rounded-lg px-6",disabled:b.isPending,children:[b.isPending?e.jsx(B,{className:"animate-spin h-4 w-4 mr-2 inline"}):null,"Finalizar"]})]})]})})]})})})}export{Ue as default};
