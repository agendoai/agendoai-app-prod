import{j as e}from"./ui-UIpCtT3r.js";import{r as h}from"./vendor-vA4cx1mx.js";import{u as X}from"./router-CxXythJb.js";import{b as Y,a as Z,c as _,L as E,C as ee,g as se,B as n,i as u,H as ae}from"./index-_oaftgoR.js";import{D,a as P,b as k,c as S,d as T,e as q}from"./dialog-BvsjuwHe.js";import{I as d}from"./input-BDDyNkir.js";import{L as t}from"./label-C1VFYQZZ.js";import{R as re,a as A}from"./radio-group-DelasJYM.js";import{u as C}from"./useMutation-CeSY69nI.js";import{C as te}from"./client-layout-BNgRJjMi.js";import{C as oe}from"./chevron-left-CZwLS4sm.js";import{M as L}from"./map-pin-CjpBQ8iz.js";import{S as ie}from"./square-pen-BgjOg-3N.js";import{T as ne}from"./trash-2-CFTARSkj.js";import{P as de}from"./plus-4IxsuhoR.js";import{C as le}from"./check-BMyHMEgN.js";import{B as ce}from"./briefcase-CgWLEGgh.js";import"./index-BH3L9zMK.js";import"./circle-C4JZ1W_T.js";import"./navbar-CvZDQ5sA.js";import"./proxy-CRvIgb3X.js";import"./search-DOY73Z0K.js";import"./calendar-check-Du1HZAvo.js";import"./user-DI_JL3j7.js";function Le(){const[,R]=X(),{toast:o}=Y(),p=Z(),[B,x]=h.useState(!1),[M,j]=h.useState(!1),[f,l]=h.useState(null),[c,b]=h.useState(!1),[a,m]=h.useState({type:"home",name:"",street:"",number:"",complement:"",neighborhood:"",city:"",state:"",zipCode:""}),{data:F=[],isLoading:O}=_({queryKey:["/api/user/addresses"],queryFn:async()=>{try{const s=await u("GET","/api/user/addresses");if(!s.ok)throw new Error("Falha ao carregar endereços");return await s.json()}catch(s){return console.error("Erro ao buscar endereços:",s),[]}}}),g=C({mutationFn:async s=>{const r=await u("POST","/api/user/addresses",s);if(!r.ok)throw new Error("Falha ao adicionar endereço");return await r.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/user/addresses"]}),o({title:"Endereço adicionado",description:"Seu novo endereço foi adicionado com sucesso."}),w()},onError:s=>{o({title:"Erro",description:s.message,variant:"destructive"})}}),v=C({mutationFn:async({id:s,data:r})=>{const N=await u("PUT",`/api/user/addresses/${s}`,r);if(!N.ok)throw new Error("Falha ao atualizar endereço");return await N.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/user/addresses"]}),o({title:"Endereço atualizado",description:"Seu endereço foi atualizado com sucesso."}),w()},onError:s=>{o({title:"Erro",description:s.message,variant:"destructive"})}}),y=C({mutationFn:async s=>{const r=await u("DELETE",`/api/user/addresses/${s}`);if(!r.ok)throw new Error("Falha ao remover endereço");return await r.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/user/addresses"]}),o({title:"Endereço removido",description:"Seu endereço foi removido com sucesso."}),j(!1),l(null)},onError:s=>{o({title:"Erro",description:s.message,variant:"destructive"})}}),z=C({mutationFn:async s=>{const r=await u("PUT",`/api/user/addresses/${s}/default`);if(!r.ok)throw new Error("Falha ao definir endereço padrão");return await r.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/user/addresses"]}),o({title:"Endereço padrão atualizado",description:"Seu endereço padrão foi atualizado com sucesso."})},onError:s=>{o({title:"Erro",description:s.message,variant:"destructive"})}}),i=s=>{const{name:r,value:N}=s.target;m(W=>({...W,[r]:N}))},I=s=>{m(r=>({...r,type:s}))},Q=()=>{if(!a.name||!a.street||!a.number||!a.neighborhood||!a.city||!a.state||!a.zipCode){o({title:"Campos obrigatórios",description:"Por favor, preencha todos os campos obrigatórios.",variant:"destructive"});return}c&&f?v.mutate({id:f,data:a}):g.mutate(a)},K=s=>{b(!0),l(s.id),m({type:s.type,name:s.name,street:s.street,number:s.number,complement:s.complement||"",neighborhood:s.neighborhood,city:s.city,state:s.state,zipCode:s.zipCode}),x(!0)},G=()=>{f&&y.mutate(f)},$=s=>{l(s),j(!0)},H=s=>{z.mutate(s)},w=()=>{x(!1),b(!1),l(null),m({type:"home",name:"",street:"",number:"",complement:"",neighborhood:"",city:"",state:"",zipCode:""})},U=()=>{b(!1),l(null),m({type:"home",name:"",street:"",number:"",complement:"",neighborhood:"",city:"",state:"",zipCode:""}),x(!0)},V=()=>{R("/client/profile")},J=s=>{switch(s){case"home":return e.jsx(ae,{className:"h-5 w-5 text-primary"});case"work":return e.jsx(ce,{className:"h-5 w-5 text-primary"});default:return e.jsx(L,{className:"h-5 w-5 text-primary"})}};return e.jsxs(te,{children:[e.jsx("header",{className:"bg-[#58c9d1] text-white py-6 flex items-center justify-center shadow-md",children:e.jsxs("div",{className:"flex items-center w-full max-w-md mx-auto px-4",children:[e.jsx("button",{onClick:V,className:"mr-3",children:e.jsx(oe,{className:"h-6 w-6"})}),e.jsx("h1",{className:"text-xl font-semibold text-center flex-1",children:"Meus Endereços"})]})}),e.jsxs("main",{className:"flex-1 p-4",children:[e.jsx("p",{className:"text-neutral-600 mb-6",children:"Gerencie seus endereços para facilitar seus agendamentos."}),O?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(E,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4 mb-6",children:F.length===0?e.jsxs("div",{className:"text-center py-6 border rounded-lg border-dashed border-neutral-300",children:[e.jsx(L,{className:"h-10 w-10 mx-auto text-neutral-400 mb-2"}),e.jsx("p",{className:"text-neutral-600",children:"Você ainda não tem endereços cadastrados."}),e.jsx("p",{className:"text-sm text-neutral-500 mb-4",children:"Adicione um endereço para facilitar seus agendamentos."})]}):F.map(s=>e.jsx(ee,{className:"border border-neutral-200",children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-3 mt-1",children:J(s.type)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-medium",children:s.name}),s.isDefault&&e.jsx("span",{className:"ml-2 bg-primary/10 text-primary text-xs px-2 py-0.5 rounded-full",children:"Padrão"})]}),e.jsxs("p",{className:"text-sm text-neutral-500",children:[s.street,", ",s.number,s.complement&&` - ${s.complement}`]}),e.jsxs("p",{className:"text-sm text-neutral-500",children:[s.neighborhood,", ",s.city," - ",s.state]}),e.jsxs("p",{className:"text-sm text-neutral-500",children:["CEP: ",s.zipCode]}),e.jsxs("div",{className:"flex mt-2 gap-2",children:[!s.isDefault&&e.jsx(n,{variant:"outline",size:"sm",onClick:()=>H(s.id),disabled:z.isPending,className:"h-7 px-2 text-xs",children:"Definir como padrão"}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>K(s),className:"h-7 px-2 text-xs",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),"Editar"]})]})]})]}),e.jsx(n,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500",onClick:()=>$(s.id),children:e.jsx(ne,{className:"h-4 w-4"})})]})})},s.id))}),e.jsxs(n,{variant:"outline",className:"w-full",onClick:U,children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Adicionar novo endereço"]})]})]}),e.jsx(D,{open:B,onOpenChange:x,children:e.jsxs(P,{className:"max-h-[90vh] overflow-y-auto",children:[e.jsxs(k,{children:[e.jsx(S,{children:c?"Editar endereço":"Adicionar endereço"}),e.jsx(T,{children:c?"Edite as informações do seu endereço.":"Adicione um novo endereço para facilitar seus agendamentos."})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Tipo de endereço"}),e.jsxs(re,{value:a.type,onValueChange:s=>I(s),className:"flex space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"home",id:"home"}),e.jsx(t,{htmlFor:"home",className:"cursor-pointer",children:"Casa"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"work",id:"work"}),e.jsx(t,{htmlFor:"work",className:"cursor-pointer",children:"Trabalho"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"other",id:"other"}),e.jsx(t,{htmlFor:"other",className:"cursor-pointer",children:"Outro"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"name",children:"Nome do endereço"}),e.jsx(d,{id:"name",name:"name",value:a.name,onChange:i,placeholder:"Ex: Casa, Trabalho, Casa dos pais"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"zipCode",children:"CEP"}),e.jsx(d,{id:"zipCode",name:"zipCode",value:a.zipCode,onChange:i,placeholder:"00000-000"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"street",children:"Rua"}),e.jsx(d,{id:"street",name:"street",value:a.street,onChange:i,placeholder:"Nome da rua"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"number",children:"Número"}),e.jsx(d,{id:"number",name:"number",value:a.number,onChange:i,placeholder:"Número"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"complement",children:"Complemento (opcional)"}),e.jsx(d,{id:"complement",name:"complement",value:a.complement,onChange:i,placeholder:"Apto, Bloco, Sala, etc."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"neighborhood",children:"Bairro"}),e.jsx(d,{id:"neighborhood",name:"neighborhood",value:a.neighborhood,onChange:i,placeholder:"Bairro"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"city",children:"Cidade"}),e.jsx(d,{id:"city",name:"city",value:a.city,onChange:i,placeholder:"Cidade"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"state",children:"Estado"}),e.jsx(d,{id:"state",name:"state",value:a.state,onChange:i,placeholder:"Estado"})]})]})]}),e.jsxs(q,{children:[e.jsx(n,{variant:"outline",onClick:w,disabled:g.isPending||v.isPending,children:"Cancelar"}),e.jsx(n,{onClick:Q,disabled:g.isPending||v.isPending,children:g.isPending||v.isPending?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),c?"Atualizando...":"Adicionando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),c?"Atualizar endereço":"Adicionar endereço"]})})]})]})}),e.jsx(D,{open:M,onOpenChange:j,children:e.jsxs(P,{children:[e.jsxs(k,{children:[e.jsx(S,{children:"Remover endereço"}),e.jsx(T,{children:"Tem certeza que deseja remover este endereço? Esta ação não pode ser desfeita."})]}),e.jsxs(q,{children:[e.jsx(n,{variant:"outline",onClick:()=>j(!1),disabled:y.isPending,children:"Cancelar"}),e.jsx(n,{variant:"destructive",onClick:G,disabled:y.isPending,children:y.isPending?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),"Removendo..."]}):"Remover endereço"})]})]})})]})}export{Le as default};
