import{a as $,u as M,r as E,d as H,j as e,C as r,i as l,f as n,y as x,g as i}from"./index-BdrEJuYD.js";import{S as O,a as V,b as _,c as z,d as m}from"./select-CN2dG1AP.js";import{T as I,a as Q,b as j,c as p}from"./tabs-Dh7LOHW3.js";import{B as U}from"./button-CynjWJoH.js";import{S as g}from"./skeleton-DyFVqEqB.js";import{P as Y}from"./provider-layout-Dp8zUOE5.js";import{C as q}from"./chevron-left-3E0puwn_.js";import{C as W}from"./calendar-CiGw-_KP.js";import{D as B}from"./dollar-sign-BavbSGb6.js";import{U as X}from"./users--EJM8Ox4.js";import{T as G}from"./trending-up-1wc0HeSK.js";import{C as J}from"./chart-column-increasing-DV70Ipib.js";import{C as Z}from"./chart-pie-DeYMhbBM.js";import{C as ee}from"./clock-BTnG-tJG.js";import{R as d,C as u,T as o,a as N,X as f,Y as b,B as w,L as se,b as ae}from"./LineChart-DZUYWApx.js";import{P,a as R,B as A}from"./PieChart-Bb67Idnz.js";import"./index-BdQq_4o_.js";import"./index-YY5r1pln.js";import"./index-DTy3TPQv.js";import"./index-BYdWi_2u.js";import"./index-Bg9Ro7l2.js";import"./index-CeeqZ7YQ.js";import"./index-C91vKSn-.js";import"./chevron-down-BZqgkKgk.js";import"./check-WTIUe9ha.js";import"./index-BoRtQnRr.js";import"./arrow-left-nRi6-7bo.js";import"./index-BcAyG2lq.js";const v=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8"],S={completed:"#16a34a",pending:"#3b82f6",canceled:"#ef4444"},te=["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"],C=y=>{const[T,h]=y.split("-");return new Date(parseInt(T),parseInt(h)-1).toLocaleDateString("pt-BR",{month:"short",year:"numeric"})};function Re(){const[,y]=$(),{user:T}=M(),[h,D]=E.useState("month"),{data:s,isLoading:F}=H({queryKey:["/api/provider/analytics",h],queryFn:async({queryKey:a})=>{const[t,k]=a,c=await fetch(`/api/providers/analytics?period=${k}`,{credentials:"include"});if(!c.ok)throw new Error("Falha ao carregar dados de análise");return c.json()}}),L=a=>{D(a)};return e.jsx(Y,{children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{variant:"ghost",size:"icon",onClick:()=>y("/provider/dashboard"),className:"mr-2",children:e.jsx(q,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Análise de Desempenho"})]}),e.jsxs(O,{value:h,onValueChange:L,children:[e.jsx(V,{className:"w-32",children:e.jsx(_,{placeholder:"Período"})}),e.jsxs(z,{children:[e.jsx(m,{value:"week",children:"Semana"}),e.jsx(m,{value:"month",children:"Mês"}),e.jsx(m,{value:"year",children:"Ano"}),e.jsx(m,{value:"all",children:"Tudo"})]})]})]}),F?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[...Array(4)].map((a,t)=>e.jsx(r,{children:e.jsxs(l,{className:"p-4",children:[e.jsx(g,{className:"h-4 w-1/2 mb-2"}),e.jsx(g,{className:"h-8 w-3/4"})]})},t))}),e.jsxs(r,{children:[e.jsx(n,{children:e.jsx(g,{className:"h-6 w-48"})}),e.jsx(l,{children:e.jsx(g,{className:"h-64 w-full"})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(r,{className:"bg-blue-50",children:e.jsxs(l,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(W,{className:"h-8 w-8 text-blue-500 mb-2"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Total de agendamentos"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalAppointments)||0})]})}),e.jsx(r,{className:"bg-green-50",children:e.jsxs(l,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(B,{className:"h-8 w-8 text-green-500 mb-2"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Faturamento"}),e.jsx("p",{className:"text-2xl font-bold",children:x(s==null?void 0:s.totalRevenue)})]})}),e.jsx(r,{className:"bg-purple-50",children:e.jsxs(l,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(X,{className:"h-8 w-8 text-purple-500 mb-2"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Avaliações"}),e.jsxs("p",{className:"text-2xl font-bold flex items-center",children:[(s==null?void 0:s.averageRating)||0,e.jsxs("span",{className:"text-sm ml-1",children:["(",(s==null?void 0:s.totalReviews)||0,")"]})]})]})}),e.jsx(r,{className:"bg-amber-50",children:e.jsxs(l,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(G,{className:"h-8 w-8 text-amber-500 mb-2"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Taxa de conclusão"}),e.jsx("p",{className:"text-2xl font-bold",children:s&&s.totalAppointments>0?`${Math.round(s.completedAppointments/s.totalAppointments*100)}%`:"0%"})]})})]}),e.jsxs(I,{defaultValue:"appointments",className:"w-full",children:[e.jsxs(Q,{className:"w-full justify-start mb-4 overflow-x-auto whitespace-nowrap",children:[e.jsxs(j,{value:"appointments",className:"flex items-center",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Agendamentos"})]}),e.jsxs(j,{value:"revenue",className:"flex items-center",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Faturamento"})]}),e.jsxs(j,{value:"services",className:"flex items-center",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Serviços"})]}),e.jsxs(j,{value:"timing",className:"flex items-center",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Horários"})]})]}),e.jsx(p,{value:"appointments",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(r,{className:"md:col-span-1",children:[e.jsx(n,{children:e.jsx(i,{className:"text-lg",children:"Status dos agendamentos"})}),e.jsxs(l,{children:[s&&e.jsx(d,{width:"100%",height:200,children:e.jsxs(P,{children:[e.jsxs(R,{data:[{name:"Concluídos",value:s.completedAppointments},{name:"Pendentes",value:s.pendingAppointments},{name:"Cancelados",value:s.canceledAppointments}],cx:"50%",cy:"50%",innerRadius:40,outerRadius:80,fill:"#8884d8",paddingAngle:5,dataKey:"value",label:({name:a,percent:t})=>`${a} ${(t*100).toFixed(0)}%`,labelLine:!1,children:[e.jsx(u,{fill:S.completed},"completed"),e.jsx(u,{fill:S.pending},"pending"),e.jsx(u,{fill:S.canceled},"canceled")]}),e.jsx(o,{formatter:a=>[a,"Quantidade"]})]})}),e.jsxs("div",{className:"grid grid-cols-3 text-center mt-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full inline-block mr-1"}),e.jsx("p",{className:"text-xs",children:"Concluídos"}),e.jsx("p",{className:"font-bold",children:(s==null?void 0:s.completedAppointments)||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full inline-block mr-1"}),e.jsx("p",{className:"text-xs",children:"Pendentes"}),e.jsx("p",{className:"font-bold",children:(s==null?void 0:s.pendingAppointments)||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full inline-block mr-1"}),e.jsx("p",{className:"text-xs",children:"Cancelados"}),e.jsx("p",{className:"font-bold",children:(s==null?void 0:s.canceledAppointments)||0})]})]})]})]}),e.jsxs(r,{className:"md:col-span-2",children:[e.jsx(n,{children:e.jsx(i,{className:"text-lg",children:"Agendamentos por mês"})}),e.jsx(l,{children:s!=null&&s.appointmentsByMonth&&s.appointmentsByMonth.length>0?e.jsx(d,{width:"100%",height:250,children:e.jsxs(A,{data:s.appointmentsByMonth.map(a=>({...a,month:C(a.month)})),margin:{top:10,right:30,left:0,bottom:30},children:[e.jsx(N,{strokeDasharray:"3 3"}),e.jsx(f,{dataKey:"month",angle:-45,textAnchor:"end",height:70,interval:0}),e.jsx(b,{}),e.jsx(o,{formatter:a=>[a,"Agendamentos"]}),e.jsx(w,{dataKey:"count",fill:"#3b82f6",barSize:30})]})}):e.jsx("div",{className:"h-[250px] flex items-center justify-center",children:e.jsx("p",{className:"text-neutral-500",children:"Dados insuficientes para exibir o gráfico"})})})]}),(s==null?void 0:s.appointmentTrends)&&s.appointmentTrends.length>0&&e.jsxs(r,{className:"md:col-span-3",children:[e.jsx(n,{children:e.jsx(i,{className:"text-lg",children:"Tendências de agendamentos"})}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Período"}),e.jsx("th",{className:"text-right p-2",children:"Atual"}),e.jsx("th",{className:"text-right p-2",children:"Anterior"}),e.jsx("th",{className:"text-right p-2",children:"Variação"})]})}),e.jsx("tbody",{children:s.appointmentTrends.map((a,t)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2",children:C(a.month)}),e.jsx("td",{className:"text-right p-2",children:a.count}),e.jsx("td",{className:"text-right p-2",children:a.previousCount}),e.jsxs("td",{className:`text-right p-2 ${a.percentChange>0?"text-green-500":a.percentChange<0?"text-red-500":""}`,children:[a.percentChange>0?"+":"",a.percentChange,"%"]})]},t))})]})})})]})]})}),e.jsx(p,{value:"revenue",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(r,{className:"md:col-span-3",children:[e.jsx(n,{children:e.jsx(i,{className:"text-lg",children:"Receita por mês"})}),e.jsx(l,{children:s!=null&&s.revenueByMonth&&s.revenueByMonth.length>0?e.jsx(d,{width:"100%",height:300,children:e.jsxs(se,{data:s.revenueByMonth.map(a=>({...a,month:C(a.month),formattedTotal:a.total/100})),margin:{top:10,right:30,left:0,bottom:30},children:[e.jsx(N,{strokeDasharray:"3 3"}),e.jsx(f,{dataKey:"month",angle:-45,textAnchor:"end",height:70,interval:0}),e.jsx(b,{}),e.jsx(o,{formatter:(a,t)=>t==="total"?[x(a),"Receita"]:[a,t]}),e.jsx(ae,{type:"monotone",dataKey:"total",stroke:"#16a34a",strokeWidth:2,dot:{r:4},activeDot:{r:6}})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("p",{className:"text-neutral-500",children:"Dados insuficientes para exibir o gráfico"})})})]}),(s==null?void 0:s.revenueTrends)&&s.revenueTrends.length>0&&e.jsxs(r,{className:"md:col-span-3",children:[e.jsx(n,{children:e.jsx(i,{className:"text-lg",children:"Tendências de receita"})}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Período"}),e.jsx("th",{className:"text-right p-2",children:"Atual"}),e.jsx("th",{className:"text-right p-2",children:"Anterior"}),e.jsx("th",{className:"text-right p-2",children:"Variação"})]})}),e.jsx("tbody",{children:s.revenueTrends.map((a,t)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2",children:C(a.month)}),e.jsx("td",{className:"text-right p-2",children:x(a.total)}),e.jsx("td",{className:"text-right p-2",children:x(a.previousTotal)}),e.jsxs("td",{className:`text-right p-2 ${a.percentChange>0?"text-green-500":a.percentChange<0?"text-red-500":""}`,children:[a.percentChange>0?"+":"",a.percentChange,"%"]})]},t))})]})})})]})]})}),e.jsx(p,{value:"services",children:e.jsxs(r,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-lg",children:"Serviços mais populares"})}),e.jsx(l,{children:s!=null&&s.topServices&&s.topServices.length>0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(d,{width:"100%",height:300,children:e.jsxs(P,{children:[e.jsx(R,{data:s.topServices,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:t})=>`${a} (${(t*100).toFixed(0)}%)`,outerRadius:80,fill:"#8884d8",dataKey:"count",children:s.topServices.map((a,t)=>e.jsx(u,{fill:v[t%v.length]},`cell-${t}`))}),e.jsx(o,{formatter:(a,t,k)=>{const c=s.topServices.find(K=>K.count===a);return[a,(c==null?void 0:c.name)||""]}})]})})}),e.jsx("div",{children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Serviço"}),e.jsx("th",{className:"text-right p-2",children:"Agendamentos"}),e.jsx("th",{className:"text-right p-2",children:"Receita"})]})}),e.jsx("tbody",{children:s.topServices.map((a,t)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:v[t%v.length]}}),a.name]})}),e.jsx("td",{className:"text-right p-2",children:a.count}),e.jsx("td",{className:"text-right p-2",children:x(a.revenue)})]},t))})]})})]}):e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("p",{className:"text-neutral-500",children:"Dados insuficientes para exibir o gráfico"})})})]})}),e.jsx(p,{value:"timing",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(r,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-lg",children:"Horários mais ocupados"})}),e.jsx(l,{children:s!=null&&s.busyHours&&s.busyHours.length>0?e.jsx(d,{width:"100%",height:300,children:e.jsxs(A,{data:s.busyHours.map(a=>({...a,hour:`${a.hour}h`})),margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(N,{strokeDasharray:"3 3"}),e.jsx(f,{dataKey:"hour"}),e.jsx(b,{}),e.jsx(o,{formatter:a=>[a,"Agendamentos"]}),e.jsx(w,{dataKey:"count",fill:"#8884d8",barSize:30})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("p",{className:"text-neutral-500",children:"Dados insuficientes para exibir o gráfico"})})})]}),e.jsxs(r,{children:[e.jsx(n,{children:e.jsx(i,{className:"text-lg",children:"Dias mais ocupados"})}),e.jsx(l,{children:s!=null&&s.busyDays&&s.busyDays.length>0?e.jsx(d,{width:"100%",height:300,children:e.jsxs(A,{data:s.busyDays.map(a=>({...a,day:te[a.day]})),margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(N,{strokeDasharray:"3 3"}),e.jsx(f,{dataKey:"day"}),e.jsx(b,{}),e.jsx(o,{formatter:a=>[a,"Agendamentos"]}),e.jsx(w,{dataKey:"count",fill:"#82ca9d",barSize:30})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("p",{className:"text-neutral-500",children:"Dados insuficientes para exibir o gráfico"})})})]})]})})]})]})]})})}export{Re as default};
