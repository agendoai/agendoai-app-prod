import{j as e}from"./ui-UIpCtT3r.js";import{r as l}from"./vendor-vA4cx1mx.js";import{b as G,u as X}from"./router-CxXythJb.js";import{u as J,b as W,a as Y,c as Z,B as r,C as ee,d as se,e as ae,g as te,h as re,T as i,i as C}from"./index-DMVSlINz.js";import{u as oe}from"./useMutation-mYWno7MC.js";import{P as m}from"./provider-layout-C7yvh2N_.js";import{S as b}from"./separator-D_RfrPgK.js";import{A as D,a as A,b as M,c as P,d as T,e as E,f as S,g as O,h as k}from"./alert-dialog-DGhL5t4S.js";import{T as ne}from"./textarea-C4WahNzO.js";import{D as le,f as ie,a as ce,b as de,c as me,d as xe,e as he}from"./dialog-Ct2TP9w5.js";import{A as q}from"./arrow-left-3dZ_zEs-.js";import{C as ue}from"./calendar-CYlMr0qt.js";import{C as pe}from"./clock-DluLCsci.js";import{U as ge}from"./user-DxXpbN3a.js";import{P as je}from"./phone-CDpJ8Rux.js";import{P as fe}from"./package-CP3Dtp7P.js";import{B as Ne}from"./banknote-B7RGdfb5.js";import{F as ve}from"./file-text-CgPtDB9Y.js";import{C as c}from"./circle-x-DeTx4Uam.js";import{C as x}from"./circle-check-big-CXpzSzX6.js";import{f as R}from"./format-CGvBu07F.js";import{p as ye}from"./parseISO-C4T3oArM.js";import{p as we}from"./pt-BR-Cxqo7XV3.js";import"./en-US-xSPtgCq_.js";function Ge(){const{id:z}=G(),{user:Ce}=J(),[,h]=X(),{toast:u}=W(),p=Y(),[B,d]=l.useState(!1),[F,g]=l.useState(!1),[I,j]=l.useState(!1),[f,N]=l.useState(""),o=parseInt(z||"0"),{data:s,isLoading:_,error:$}=Z({queryKey:["/api/appointments",o],queryFn:async()=>{try{const a=await C("GET",`/api/appointments/${o}`);if(!a.ok)throw console.error("Erro na resposta do servidor:",a.status,a.statusText),new Error(`Erro ao carregar dados do agendamento: ${a.statusText}`);const t=await a.json();return console.log("Dados do agendamento recebidos:",t),t}catch(a){throw console.error("Exceção ao carregar agendamento:",a),a}},enabled:!!o&&!isNaN(o),retry:1}),n=oe({mutationFn:async({status:a,reason:t})=>{const y={status:a};t&&(y.cancellationReason=t);const w=await C("PUT",`/api/appointments/${o}/status`,y);if(!w.ok)throw new Error("Não foi possível atualizar o status do agendamento");return w.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/appointments",o]}),p.invalidateQueries({queryKey:["/api/appointments"]}),u({title:"Status atualizado",description:"O status do agendamento foi atualizado com sucesso"}),d(!1),g(!1),j(!1),N("")},onError:a=>{u({variant:"destructive",title:"Erro",description:`Ocorreu um erro: ${a instanceof Error?a.message:"Erro desconhecido"}`})}}),H=()=>{n.mutate({status:"canceled",reason:f||"Cancelado pelo prestador"})},V=()=>{n.mutate({status:"completed"})},L=()=>{n.mutate({status:"no_show"})},Q=a=>{try{return R(ye(a),"dd 'de' MMMM 'de' yyyy",{locale:we})}catch{return a}},K=a=>({pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",canceled:"bg-red-100 text-red-800",no_show:"bg-gray-100 text-gray-800"})[a]||"bg-gray-100 text-gray-800",U=a=>({pending:"Pendente",confirmed:"Confirmado",completed:"Concluído",canceled:"Cancelado",no_show:"Não compareceu"})[a]||a,v=a=>{switch(a){case"completed":return e.jsx(x,{className:"h-5 w-5 text-green-500"});case"canceled":return e.jsx(c,{className:"h-5 w-5 text-red-500"});case"no_show":return e.jsx(i,{className:"h-5 w-5 text-amber-500"});default:return null}};return _?e.jsx(m,{children:e.jsx("div",{className:"flex justify-center items-center min-h-[70vh]",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-12 bg-gray-200 rounded w-3/4 mb-4"}),e.jsx("div",{className:"h-40 bg-gray-200 rounded w-full"}),e.jsx("div",{className:"h-40 bg-gray-200 rounded w-full"})]})})}):$||!s?e.jsx(m,{children:e.jsx("div",{className:"max-w-3xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-10",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Erro ao carregar agendamento"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Não foi possível carregar os detalhes deste agendamento. Verifique se o ID está correto ou tente novamente mais tarde."}),e.jsxs(r,{onClick:()=>h("/provider/appointments"),children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Voltar para agendamentos"]})]})})}):e.jsx(m,{children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs(r,{variant:"ghost",onClick:()=>h("/provider/appointments"),className:"mr-4",children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Voltar"]}),e.jsx("h1",{className:"text-2xl font-bold",children:"Detalhes do Agendamento"})]}),e.jsxs(ee,{className:"mb-6",children:[e.jsx(se,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(ae,{className:"text-xl",children:s.serviceName}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium inline-flex items-center ${K(s.status)}`,children:[v(s.status),e.jsx("span",{className:v(s.status)?"ml-1":"",children:U(s.status)})]})]})}),e.jsxs(te,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:"h-5 w-5 text-gray-500 mr-3"}),e.jsx("span",{children:Q(s.date)})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(pe,{className:"h-5 w-5 text-gray-500 mr-3"}),e.jsx("span",{children:`${s.startTime} às ${s.endTime}`})]}),e.jsx(b,{}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ge,{className:"h-5 w-5 text-gray-500 mr-3"}),e.jsx("span",{children:s.clientName||"Cliente"})]}),s.clientPhone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(je,{className:"h-5 w-5 text-gray-500 mr-3"}),e.jsx("span",{children:s.clientPhone})]}),e.jsx(b,{}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"h-5 w-5 text-gray-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.serviceName}),s.serviceDescription&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.serviceDescription})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ne,{className:"h-5 w-5 text-gray-500 mr-3"}),e.jsxs("span",{children:["R$ ",((s.totalPrice||s.servicePrice||0)/100).toFixed(2)]})]}),s.notes&&e.jsx("div",{className:"pt-2",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(ve,{className:"h-5 w-5 text-gray-500 mr-3 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-1",children:"Observações"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.notes})]})]})}),s.status==="canceled"&&s.cancellationReason&&e.jsx("div",{className:"pt-2",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(c,{className:"h-5 w-5 text-red-500 mr-3 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-1",children:"Motivo do cancelamento"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.cancellationReason}),s.cancellationDate&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Cancelado em ",R(new Date(s.cancellationDate),"dd/MM/yyyy 'às' HH:mm"),s.cancellationBy==="provider"?" por você":" pelo cliente"]})]})]})})]}),e.jsxs(re,{className:"pt-6",children:[s.status!=="completed"&&s.status!=="canceled"&&s.status!=="no_show"&&e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Ações do Agendamento"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Escolha uma ação para atualizar o status do agendamento"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(D,{open:F,onOpenChange:g,children:[e.jsx(A,{asChild:!0,children:e.jsxs(r,{variant:"default",className:"w-full h-12 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-medium shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105",children:[e.jsx(x,{className:"h-5 w-5 mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold",children:"Concluir"}),e.jsx("div",{className:"text-xs opacity-90",children:"Marcar como finalizado"})]})]})}),e.jsxs(M,{children:[e.jsxs(P,{children:[e.jsx(T,{children:"Confirmar conclusão"}),e.jsx(E,{children:"Tem certeza que deseja marcar este agendamento como concluído?"})]}),e.jsxs(S,{children:[e.jsx(O,{children:"Cancelar"}),e.jsx(k,{onClick:V,className:"bg-green-600 hover:bg-green-700",children:"Confirmar"})]})]})]}),e.jsxs(D,{open:I,onOpenChange:j,children:[e.jsx(A,{asChild:!0,children:e.jsxs(r,{variant:"outline",className:"w-full h-12 border-orange-300 text-orange-700 hover:bg-orange-50 hover:border-orange-400 font-medium shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105",children:[e.jsx(i,{className:"h-5 w-5 mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold",children:"Não Compareceu"}),e.jsx("div",{className:"text-xs opacity-90",children:"Cliente ausente"})]})]})}),e.jsxs(M,{children:[e.jsxs(P,{children:[e.jsx(T,{children:"Marcar como não comparecimento"}),e.jsx(E,{children:"Confirma que o cliente não compareceu a este agendamento?"})]}),e.jsxs(S,{children:[e.jsx(O,{children:"Voltar"}),e.jsx(k,{onClick:L,children:"Confirmar"})]})]})]}),e.jsxs(le,{open:B,onOpenChange:d,children:[e.jsx(ie,{asChild:!0,children:e.jsxs(r,{variant:"destructive",className:"w-full h-12 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-medium shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105",children:[e.jsx(c,{className:"h-5 w-5 mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold",children:"Cancelar"}),e.jsx("div",{className:"text-xs opacity-90",children:"Cancelar agendamento"})]})]})}),e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:"Cancelar agendamento"}),e.jsx(xe,{children:"Por favor, informe o motivo do cancelamento."})]}),e.jsx(ne,{value:f,onChange:a=>N(a.target.value),placeholder:"Motivo do cancelamento",className:"min-h-[100px]"}),e.jsxs(he,{className:"mt-4",children:[e.jsx(r,{variant:"outline",onClick:()=>d(!1),children:"Voltar"}),e.jsx(r,{variant:"destructive",onClick:H,disabled:n.isPending,children:n.isPending?"Processando...":"Confirmar cancelamento"})]})]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-blue-200",children:e.jsxs("div",{className:"flex items-center text-sm text-blue-700",children:[e.jsx(i,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Essas ações atualizarão permanentemente o status do agendamento"})]})})]})]}),(s.status==="completed"||s.status==="canceled"||s.status==="no_show")&&e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-6 text-center",children:[e.jsxs("div",{className:"text-gray-600 mb-2",children:[s.status==="completed"&&e.jsx(x,{className:"h-8 w-8 mx-auto text-green-600 mb-2"}),s.status==="canceled"&&e.jsx(c,{className:"h-8 w-8 mx-auto text-red-600 mb-2"}),s.status==="no_show"&&e.jsx(i,{className:"h-8 w-8 mx-auto text-orange-600 mb-2"})]}),e.jsxs("h3",{className:"font-semibold text-gray-900 mb-1",children:[s.status==="completed"&&"Agendamento Concluído",s.status==="canceled"&&"Agendamento Cancelado",s.status==="no_show"&&"Cliente Não Compareceu"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Este agendamento já foi finalizado e não pode ser alterado"})]})})]})]})]})})}export{Ge as default};
