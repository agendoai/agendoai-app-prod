import{j as e}from"./ui-UIpCtT3r.js";import{r as j}from"./vendor-vA4cx1mx.js";import{b as se,u as ae}from"./router-CxXythJb.js";import{u as te,b as re,a as ie,c as w,L as f,F as ne,C,d as F,e as D,f as oe,G as le,g as E,h as ce,i as m}from"./index-DEm1NP11.js";import{u as T}from"./useMutation-CZu5JiEY.js";import{C as de}from"./client-layout-CcG18RG7.js";import{A as me}from"./app-header-DXLOiKG5.js";import{B as i}from"./button-j6LGAhsQ.js";import{D as P,a as S,b as k,c as A,d as M,e as I}from"./dialog-7q2nDW2H.js";import{F as xe,a as R,b as V,c as q,d as O,e as L,f as pe}from"./form-DXn0OMom.js";import{T as he}from"./textarea-Cncp_VYG.js";import{R as ue,a as $}from"./radio-group-BjJh2tsU.js";import{L as B}from"./label-BEQPN1sl.js";import{B as je}from"./badge-B2JTkC27.js";import{u as fe,t as ge,o as ve,b as Ne,s as be,n as ye}from"./zod-BPPSwYm9.js";import{A as K}from"./arrow-left-BNqHqGt7.js";import{C as Q}from"./calendar-eMUANn8Q.js";import{U as g}from"./user-DI19obd1.js";import{C as we}from"./clock-CLU1zMjH.js";import{C as Ce}from"./credit-card-C2LZP3Yi.js";import{F as Fe}from"./file-text-54IN5u51.js";import{P as De}from"./phone-CGR7ixWb.js";import{B as Ee}from"./building-C8xoC6C-.js";import{S as Te}from"./star-CDSNpheT.js";import{f as Pe}from"./format-CGvBu07F.js";import{p as Se}from"./pt-BR-Cxqo7XV3.js";import"./navbar-hjdp4XdK.js";import"./proxy-B8DL77xD.js";import"./house-CfLQCnfM.js";import"./search-C7LrDLVs.js";import"./calendar-check-6xqeojHy.js";import"./avatar-CPD-kDAN.js";import"./dropdown-menu-Ctl7CAWq.js";import"./chevron-right-C68Zab6b.js";import"./check-BuvXqBRH.js";import"./circle-D47_QxzJ.js";import"./bell-DVVHxsNh.js";import"./ellipsis-vertical-CrOw0oSf.js";import"./settings-CsNNlMhC.js";import"./circle-help-JrPfi8Lq.js";import"./message-square-E0Uk8Sg9.js";import"./log-out-Da473VaU.js";import"./index-BH3L9zMK.js";import"./en-US-xSPtgCq_.js";const ke=ve({rating:ye().min(1).max(5),comment:be().optional(),isPublic:Ne().default(!0)});function ws(){const v=se(),x=v.id||v.appointmentId,{user:Ae}=te(),[,N]=ae(),{toast:o}=re(),l=ie(),[G,p]=j.useState(!1),[H,c]=j.useState(!1),[b,U]=j.useState(5),t=x?parseInt(x):0;console.log("Acessando detalhes do agendamento ID:",x,"parsed:",t);const{data:a,isLoading:z,error:d}=w({queryKey:["/api/booking",t],queryFn:async()=>{try{const s=await m("GET",`/api/booking/${t}`);if(!s.ok)throw console.error("Erro na resposta do servidor:",s.status,s.statusText),new Error(`Erro ao carregar dados do agendamento: ${s.statusText}`);const r=await s.json();return console.log("Dados do agendamento recebidos:",r),{...r,totalPrice:r.totalPrice||r.price||0,paymentMethod:r.paymentMethod||"credit_card",notes:r.notes||r.observations||""}}catch(s){throw console.error("Exceção ao carregar agendamento:",s),s}},enabled:!!t&&!isNaN(t),retry:1,staleTime:0}),{data:y}=w({queryKey:["/api/appointments",t,"review"],queryFn:async()=>{const s=await m("GET",`/api/appointments/${t}/review`);return s.status===404?null:await s.json()},enabled:!!t&&!isNaN(t)}),n=fe({resolver:ge(ke),defaultValues:{rating:5,comment:"",isPublic:!0}}),h=T({mutationFn:async s=>await(await m("POST",`/api/appointments/${t}/review`,s)).json(),onSuccess:()=>{o({title:"Avaliação enviada",description:"Obrigado por avaliar o serviço!"}),p(!1),l.invalidateQueries({queryKey:["/api/appointments",t,"review"]}),l.invalidateQueries({queryKey:["/api/appointments",t]})},onError:s=>{o({title:"Erro ao enviar avaliação",description:s.message||"Tente novamente mais tarde",variant:"destructive"})}}),u=T({mutationFn:async()=>await(await m("POST",`/api/appointments/${t}/cancel`)).json(),onSuccess:()=>{o({title:"Agendamento cancelado",description:"Seu agendamento foi cancelado com sucesso"}),c(!1),l.invalidateQueries({queryKey:["/api/appointments",t]}),l.invalidateQueries({queryKey:["/api/appointments"]})},onError:s=>{o({title:"Erro ao cancelar agendamento",description:s.message||"Tente novamente mais tarde",variant:"destructive"})}}),_=s=>{h.mutate({...s,rating:b})};if(z)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(f,{className:"h-8 w-8 animate-spin text-primary"})});if(d||!a)return console.log("Detalhes do erro:",d),console.log("ID do agendamento:",t),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh] text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Agendamento não encontrado"}),e.jsx("p",{className:"mb-6",children:"Não foi possível encontrar os detalhes deste agendamento."}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["ID do agendamento: ",t,e.jsx("br",{}),"Erro: ",d?d.message:"Dados não disponíveis"]}),e.jsxs(i,{onClick:()=>N("/client/dashboard"),children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Voltar para o Dashboard"]})]})});const{bg:J,text:W}=ne(a.status),X=Pe(new Date(a.date),"EEEE, dd 'de' MMMM 'de' yyyy",{locale:Se}),Y=["pending","confirmed"].includes(a.status),Z=a.status==="completed"&&!y;a.status;const ee=a.status==="canceled";return e.jsxs(de,{children:[e.jsx(me,{title:"Detalhes do Agendamento"}),e.jsxs("div",{className:"container mx-auto px-4 py-4",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(i,{variant:"ghost",onClick:()=>N("/client/dashboard"),children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Voltar para o Dashboard"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs(C,{className:"rounded-2xl shadow-lg border-0 bg-gradient-to-br from-white to-green-50 p-1",children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(D,{className:"text-2xl text-primary flex items-center gap-2",children:[e.jsx(Q,{className:"h-7 w-7 text-primary"})," ",a.serviceName]}),e.jsxs(oe,{className:"mt-1 text-lg text-neutral-700 font-semibold flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5 text-primary"})," ",a.providerName]})]}),e.jsx(je,{className:`text-base px-4 py-2 rounded-full ${J} ${W} shadow-md`,children:le(a.status)})]})}),e.jsxs(E,{className:"space-y-6 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-green-50 rounded-xl p-3 shadow-sm",children:[e.jsx(Q,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-primary",children:"Data"}),e.jsx("p",{className:"text-base font-semibold text-neutral-800",children:X})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-green-50 rounded-xl p-3 shadow-sm",children:[e.jsx(we,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-primary",children:"Horário"}),e.jsxs("p",{className:"text-base font-semibold text-neutral-800",children:[a.startTime," - ",a.endTime]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-green-50 rounded-xl p-3 shadow-sm col-span-1 md:col-span-2",children:[e.jsx(Ce,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-primary",children:"Valor"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["R$ ",(a.totalPrice?a.totalPrice/100:0).toFixed(2).replace(".",",")]})]})]})]}),a.notes&&e.jsx("div",{className:"pt-4 border-t mt-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Fe,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-primary",children:"Observações"}),e.jsx("p",{className:"text-base text-neutral-700",children:a.notes})]})]})})]}),e.jsxs(ce,{className:"flex flex-wrap gap-2 justify-end border-t pt-6",children:[Y&&e.jsx(i,{variant:"destructive",className:"bg-red-500 hover:bg-red-600 text-white font-bold px-6 py-2 rounded-full shadow transition-all duration-150 focus:outline-none focus:ring-2 focus:ring-red-300",onClick:()=>c(!0),children:"Cancelar Agendamento"}),Z&&e.jsx(i,{onClick:()=>p(!0),children:"Avaliar Serviço"}),ee&&e.jsx("div",{className:"w-full text-center text-sm text-muted-foreground mt-2",children:"Este agendamento foi cancelado."}),y&&e.jsx("div",{className:"w-full text-center text-sm text-muted-foreground mt-2",children:"Você já avaliou este serviço. Obrigado pelo feedback!"})]})]})}),e.jsx("div",{children:e.jsxs(C,{className:"rounded-2xl shadow-lg border-0 bg-gradient-to-br from-white to-cyan-50 p-1",children:[e.jsx(F,{className:"pb-2 border-b-0",children:e.jsxs(D,{className:"text-lg text-primary flex items-center gap-2",children:[e.jsx(g,{className:"h-6 w-6 text-primary"})," Prestador de Serviço"]})}),e.jsxs(E,{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-cyan-50 rounded-xl p-3 shadow-sm",children:[e.jsx(g,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-primary",children:"Nome"}),e.jsx("p",{className:"text-base font-semibold text-neutral-800",children:a.providerName})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-cyan-50 rounded-xl p-3 shadow-sm",children:[e.jsx(De,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-primary",children:"Telefone"}),e.jsx("p",{className:"text-base text-neutral-700",children:"Informação não disponível"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-cyan-50 rounded-xl p-3 shadow-sm",children:[e.jsx(Ee,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-primary",children:"Endereço"}),e.jsx("p",{className:"text-base text-neutral-700",children:"Informação não disponível"})]})]})]})]})})]}),e.jsx(P,{open:G,onOpenChange:p,children:e.jsxs(S,{className:"sm:max-w-[425px]",children:[e.jsxs(k,{children:[e.jsx(A,{children:"Avaliar Serviço"}),e.jsx(M,{children:"Conte-nos como foi sua experiência com este serviço."})]}),e.jsx(xe,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(_),className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center py-2",children:e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(s=>e.jsx(Te,{className:`h-8 w-8 cursor-pointer ${s<=b?"fill-yellow-400 text-yellow-400":"text-gray-300"}`,onClick:()=>{U(s),n.setValue("rating",s)}},s))})}),e.jsx(R,{control:n.control,name:"comment",render:({field:s})=>e.jsxs(V,{children:[e.jsx(q,{children:"Comentário"}),e.jsx(O,{children:e.jsx(he,{placeholder:"Compartilhe sua experiência com este serviço...",...s})}),e.jsx(L,{})]})}),e.jsx(R,{control:n.control,name:"isPublic",render:({field:s})=>e.jsxs(V,{className:"space-y-3",children:[e.jsx(q,{children:"Visibilidade"}),e.jsx(O,{children:e.jsxs(ue,{onValueChange:r=>s.onChange(r==="true"),defaultValue:s.value?"true":"false",className:"flex flex-col space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{value:"true",id:"public"}),e.jsx(B,{htmlFor:"public",children:"Pública - Visível para todos"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{value:"false",id:"private"}),e.jsx(B,{htmlFor:"private",children:"Privada - Visível apenas para o prestador"})]})]})}),e.jsx(pe,{children:"Escolha se sua avaliação ficará visível para outros clientes."}),e.jsx(L,{})]})}),e.jsx(I,{children:e.jsx(i,{type:"submit",disabled:h.isPending,children:h.isPending?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviando..."]}):"Enviar Avaliação"})})]})})]})}),e.jsx(P,{open:H,onOpenChange:c,children:e.jsxs(S,{className:"sm:max-w-[425px]",children:[e.jsxs(k,{children:[e.jsx(A,{children:"Cancelar Agendamento"}),e.jsx(M,{children:"Tem certeza que deseja cancelar este agendamento? Esta ação não pode ser desfeita."})]}),e.jsxs(I,{children:[e.jsx(i,{variant:"outline",onClick:()=>c(!1),children:"Voltar"}),e.jsx(i,{variant:"destructive",onClick:()=>u.mutate(),disabled:u.isPending,children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"mr-2 h-4 w-4 animate-spin"}),"Cancelando..."]}):"Sim, Cancelar"})]})]})})]})]})}export{ws as default};
