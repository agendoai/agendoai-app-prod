import{s as ae,u as te,a as re,c as ie,b as ne,r as g,d as C,j as e,e as v,Q as oe,C as E,f as T,g as D,h as le,S as ce,i as F,k as de,l as p}from"./index-BdrEJuYD.js";import{u as P}from"./useMutation-C9nL7V5b.js";import{C as me}from"./client-layout-of4HzYgb.js";import{A as pe}from"./app-header-HnU5DY7s.js";import{B as n}from"./button-CynjWJoH.js";import{D as S,a as k,b as A,c as M,d as R,e as q}from"./dialog-Cv4VtnLP.js";import{F as xe,a as I,b as V,c as O,d as $,e as B,f as he}from"./form-zrbA0ux9.js";import{T as ue}from"./textarea-CTBqUipt.js";import{R as je,a as L}from"./radio-group-CEDre2K1.js";import{L as Q}from"./label-OE63wfRu.js";import{B as fe}from"./badge-muy4ZFs4.js";import{u as ge,t as ve,o as Ne,b as ye,s as be,n as we}from"./zod-Cjvu1gcX.js";import{A as K}from"./arrow-left-nRi6-7bo.js";import{C as G}from"./calendar-CiGw-_KP.js";import{U as N}from"./user-DCpoqoA-.js";import{C as Ce}from"./clock-BTnG-tJG.js";import{C as Ee}from"./credit-card-dV_1iaRW.js";import{F as Te}from"./file-text-RTu2mnTD.js";import{P as De}from"./phone-eJScaGkq.js";import{B as Fe}from"./building-Cy4TWP75.js";import{S as Pe}from"./star-B8vaUN9l.js";import{f as Se}from"./format-CGvBu07F.js";import{p as ke}from"./pt-BR-Cxqo7XV3.js";import"./navbar-BcVSfpub.js";import"./proxy-C6NuY9h3.js";import"./house-CU2aGGLt.js";import"./search-DiCZmcCn.js";import"./calendar-check-BsktWAdS.js";import"./avatar-YOIRMJBI.js";import"./dropdown-menu-DWmQMH9U.js";import"./index-YY5r1pln.js";import"./index-DTy3TPQv.js";import"./index-Bg9Ro7l2.js";import"./index-CeeqZ7YQ.js";import"./index-BoRtQnRr.js";import"./index-BYdWi_2u.js";import"./chevron-right-DQzs9QCW.js";import"./check-WTIUe9ha.js";import"./circle-CB07NW__.js";import"./bell-DPzU_a_S.js";import"./ellipsis-vertical-BhTX8B4K.js";import"./settings-Derag0Pt.js";import"./circle-help-cap19nX6.js";import"./message-square-kvDXS4V3.js";import"./log-out-9hU1A0cG.js";import"./index-CrNpXqsn.js";import"./index-C91vKSn-.js";import"./en-US-xSPtgCq_.js";const Ae=Ne({rating:we().min(1).max(5),comment:be().optional(),isPublic:ye().default(!0)});function Fs(){const y=ae(),x=y.id||y.appointmentId,{user:Me}=te(),[,h]=re(),{toast:c}=ie(),o=ne(),[H,u]=g.useState(!1),[U,d]=g.useState(!1),[b,z]=g.useState(5),t=x?parseInt(x):0;console.log("Acessando detalhes do agendamento ID:",x,"parsed:",t);const{data:a,isLoading:_,error:m}=C({queryKey:["/api/booking",t],queryFn:async()=>{try{if(!await o.fetchQuery({queryKey:["/api/user"],staleTime:0}))throw console.error("Usuário não autenticado. Redirecionando para login..."),h("/auth"),new Error("Usuário não autenticado");const r=await p("GET",`/api/booking/${t}`);if(!r.ok)throw console.error("Erro na resposta do servidor:",r.status,r.statusText),new Error(`Erro ao carregar dados do agendamento: ${r.statusText}`);const i=await r.json();return console.log("Dados do agendamento recebidos:",i),{...i,totalPrice:i.totalPrice||i.price||0,paymentMethod:i.paymentMethod||"credit_card",notes:i.notes||i.observations||""}}catch(s){throw console.error("Exceção ao carregar agendamento:",s),s}},enabled:!!t&&!isNaN(t),retry:1,staleTime:0}),{data:w}=C({queryKey:["/api/appointments",t,"review"],queryFn:async()=>{const s=await p("GET",`/api/appointments/${t}/review`);return s.status===404?null:await s.json()},enabled:!!t&&!isNaN(t)}),l=ge({resolver:ve(Ae),defaultValues:{rating:5,comment:"",isPublic:!0}}),j=P({mutationFn:async s=>await(await p("POST",`/api/appointments/${t}/review`,s)).json(),onSuccess:()=>{c({title:"Avaliação enviada",description:"Obrigado por avaliar o serviço!"}),u(!1),o.invalidateQueries({queryKey:["/api/appointments",t,"review"]}),o.invalidateQueries({queryKey:["/api/appointments",t]})},onError:s=>{c({title:"Erro ao enviar avaliação",description:s.message||"Tente novamente mais tarde",variant:"destructive"})}}),f=P({mutationFn:async()=>await(await p("POST",`/api/appointments/${t}/cancel`)).json(),onSuccess:()=>{c({title:"Agendamento cancelado",description:"Seu agendamento foi cancelado com sucesso"}),d(!1),o.invalidateQueries({queryKey:["/api/appointments",t]}),o.invalidateQueries({queryKey:["/api/appointments"]})},onError:s=>{c({title:"Erro ao cancelar agendamento",description:s.message||"Tente novamente mais tarde",variant:"destructive"})}}),J=s=>{j.mutate({...s,rating:b})};if(_)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(v,{className:"h-8 w-8 animate-spin text-primary"})});if(m||!a)return console.log("Detalhes do erro:",m),console.log("ID do agendamento:",t),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh] text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Agendamento não encontrado"}),e.jsx("p",{className:"mb-6",children:"Não foi possível encontrar os detalhes deste agendamento."}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["ID do agendamento: ",t,e.jsx("br",{}),"Erro: ",m?m.message:"Dados não disponíveis"]}),e.jsxs(n,{onClick:()=>h("/client/dashboard"),children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Voltar para o Dashboard"]})]})});const{bg:W,text:X}=oe(a.status),Y=Se(new Date(a.date),"EEEE, dd 'de' MMMM 'de' yyyy",{locale:ke}),Z=["pending","confirmed"].includes(a.status),ee=a.status==="completed"&&!w;a.status;const se=a.status==="canceled";return e.jsxs(me,{children:[e.jsx(pe,{title:"Detalhes do Agendamento"}),e.jsxs("div",{className:"container mx-auto px-4 py-4",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(n,{variant:"ghost",onClick:()=>h("/client/dashboard"),children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Voltar para o Dashboard"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs(E,{className:"rounded-2xl shadow-lg border-0 bg-gradient-to-br from-white to-green-50 p-1",children:[e.jsx(T,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(D,{className:"text-2xl text-primary flex items-center gap-2",children:[e.jsx(G,{className:"h-7 w-7 text-primary"})," ",a.serviceName]}),e.jsxs(le,{className:"mt-1 text-lg text-neutral-700 font-semibold flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5 text-primary"})," ",a.providerName]})]}),e.jsx(fe,{className:`text-base px-4 py-2 rounded-full ${W} ${X} shadow-md`,children:ce(a.status)})]})}),e.jsxs(F,{className:"space-y-6 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-green-50 rounded-xl p-3 shadow-sm",children:[e.jsx(G,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-primary",children:"Data"}),e.jsx("p",{className:"text-base font-semibold text-neutral-800",children:Y})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-green-50 rounded-xl p-3 shadow-sm",children:[e.jsx(Ce,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-primary",children:"Horário"}),e.jsxs("p",{className:"text-base font-semibold text-neutral-800",children:[a.startTime," - ",a.endTime]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-green-50 rounded-xl p-3 shadow-sm col-span-1 md:col-span-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-primary",children:"Valor"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["R$ ",(a.totalPrice?a.totalPrice/100:0).toFixed(2).replace(".",",")]})]})]})]}),a.notes&&e.jsx("div",{className:"pt-4 border-t mt-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-primary",children:"Observações"}),e.jsx("p",{className:"text-base text-neutral-700",children:a.notes})]})]})})]}),e.jsxs(de,{className:"flex flex-wrap gap-2 justify-end border-t pt-6",children:[Z&&e.jsx(n,{variant:"destructive",className:"bg-red-500 hover:bg-red-600 text-white font-bold px-6 py-2 rounded-full shadow transition-all duration-150 focus:outline-none focus:ring-2 focus:ring-red-300",onClick:()=>d(!0),children:"Cancelar Agendamento"}),ee&&e.jsx(n,{onClick:()=>u(!0),children:"Avaliar Serviço"}),se&&e.jsx("div",{className:"w-full text-center text-sm text-muted-foreground mt-2",children:"Este agendamento foi cancelado."}),w&&e.jsx("div",{className:"w-full text-center text-sm text-muted-foreground mt-2",children:"Você já avaliou este serviço. Obrigado pelo feedback!"})]})]})}),e.jsx("div",{children:e.jsxs(E,{className:"rounded-2xl shadow-lg border-0 bg-gradient-to-br from-white to-cyan-50 p-1",children:[e.jsx(T,{className:"pb-2 border-b-0",children:e.jsxs(D,{className:"text-lg text-primary flex items-center gap-2",children:[e.jsx(N,{className:"h-6 w-6 text-primary"})," Prestador de Serviço"]})}),e.jsxs(F,{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-cyan-50 rounded-xl p-3 shadow-sm",children:[e.jsx(N,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-primary",children:"Nome"}),e.jsx("p",{className:"text-base font-semibold text-neutral-800",children:a.providerName})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-cyan-50 rounded-xl p-3 shadow-sm",children:[e.jsx(De,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-primary",children:"Telefone"}),e.jsx("p",{className:"text-base text-neutral-700",children:"Informação não disponível"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-cyan-50 rounded-xl p-3 shadow-sm",children:[e.jsx(Fe,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-primary",children:"Endereço"}),e.jsx("p",{className:"text-base text-neutral-700",children:"Informação não disponível"})]})]})]})]})})]}),e.jsx(S,{open:H,onOpenChange:u,children:e.jsxs(k,{className:"sm:max-w-[425px]",children:[e.jsxs(A,{children:[e.jsx(M,{children:"Avaliar Serviço"}),e.jsx(R,{children:"Conte-nos como foi sua experiência com este serviço."})]}),e.jsx(xe,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(J),className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center py-2",children:e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(s=>e.jsx(Pe,{className:`h-8 w-8 cursor-pointer ${s<=b?"fill-yellow-400 text-yellow-400":"text-gray-300"}`,onClick:()=>{z(s),l.setValue("rating",s)}},s))})}),e.jsx(I,{control:l.control,name:"comment",render:({field:s})=>e.jsxs(V,{children:[e.jsx(O,{children:"Comentário"}),e.jsx($,{children:e.jsx(ue,{placeholder:"Compartilhe sua experiência com este serviço...",...s})}),e.jsx(B,{})]})}),e.jsx(I,{control:l.control,name:"isPublic",render:({field:s})=>e.jsxs(V,{className:"space-y-3",children:[e.jsx(O,{children:"Visibilidade"}),e.jsx($,{children:e.jsxs(je,{onValueChange:r=>s.onChange(r==="true"),defaultValue:s.value?"true":"false",className:"flex flex-col space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{value:"true",id:"public"}),e.jsx(Q,{htmlFor:"public",children:"Pública - Visível para todos"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{value:"false",id:"private"}),e.jsx(Q,{htmlFor:"private",children:"Privada - Visível apenas para o prestador"})]})]})}),e.jsx(he,{children:"Escolha se sua avaliação ficará visível para outros clientes."}),e.jsx(B,{})]})}),e.jsx(q,{children:e.jsx(n,{type:"submit",disabled:j.isPending,children:j.isPending?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviando..."]}):"Enviar Avaliação"})})]})})]})}),e.jsx(S,{open:U,onOpenChange:d,children:e.jsxs(k,{className:"sm:max-w-[425px]",children:[e.jsxs(A,{children:[e.jsx(M,{children:"Cancelar Agendamento"}),e.jsx(R,{children:"Tem certeza que deseja cancelar este agendamento? Esta ação não pode ser desfeita."})]}),e.jsxs(q,{children:[e.jsx(n,{variant:"outline",onClick:()=>d(!1),children:"Voltar"}),e.jsx(n,{variant:"destructive",onClick:()=>f.mutate(),disabled:f.isPending,children:f.isPending?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}),"Cancelando..."]}):"Sim, Cancelar"})]})]})})]})]})}export{Fs as default};
