import{j as e}from"./ui-UIpCtT3r.js";import{r as R}from"./vendor-vA4cx1mx.js";import{b as q,u as D,a as S,c as x,C as h,d as p,e as j,f as g,g as f,a2 as V,a3 as B,a4 as I}from"./index-BJ9Cw0LR.js";import{u as L}from"./useMutation-CDdW0pzE.js";import{B as v}from"./button-BvsVcTDx.js";import{A as y,a as b}from"./alert-D4b1dLXp.js";import{B as K}from"./badge-BQpU5zw7.js";import{R as c}from"./refresh-cw-CHjwlvH4.js";import{D as Q}from"./dollar-sign-DtfLClfe.js";import{T as F}from"./triangle-alert-DMtpnh1d.js";import{S as O}from"./shield-hm_Fmsg9.js";import{A as T}from"./arrow-right-D9v1pXuJ.js";import{C as k}from"./clock-BoQP0pJL.js";import"./router-CxXythJb.js";function re(){var u;const{toast:d}=q(),{user:o}=D(),i=S(),[z,N]=R.useState(null),a=(o==null?void 0:o.id)||0,{data:r,isLoading:C}=x({queryKey:["asaas-provider-balance",a],queryFn:()=>B(a),enabled:!!a}),{data:t,isLoading:w}=x({queryKey:["asaas-provider-payments",a],queryFn:()=>I(a),enabled:!!a}),l=L({mutationFn:({providerId:s,amount:n})=>V(s,n),onSuccess:()=>{d({title:"Valor liberado!",description:"O valor foi transferido para sua conta com sucesso."}),i.invalidateQueries({queryKey:["asaas-provider-balance"]}),i.invalidateQueries({queryKey:["asaas-provider-payments"]}),N(null)},onError:s=>{d({title:"Erro ao liberar valor",description:s.message||"Erro interno do servidor",variant:"destructive"})}}),m=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s/100),E=s=>new Date(s).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),P=s=>{switch(s.status){case"RECEIVED":return{label:"Recebido",color:"bg-green-100 text-green-800"};case"PENDING":return{label:"Pendente",color:"bg-yellow-100 text-yellow-800"};case"OVERDUE":return{label:"Vencido",color:"bg-red-100 text-red-800"};default:return{label:"Desconhecido",color:"bg-gray-100 text-gray-800"}}},A=s=>{s.status==="RECEIVED"&&s.value>0&&l.mutate({providerId:a,amount:s.value})};return C||w?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(c,{className:"h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Meus Pagamentos Asaas"}),e.jsxs(v,{onClick:()=>{i.invalidateQueries({queryKey:["asaas-provider-balance"]}),i.invalidateQueries({queryKey:["asaas-provider-payments"]})},variant:"outline",children:[e.jsx(c,{className:"h-4 w-4 mr-2"}),"Atualizar"]})]}),e.jsxs(h,{children:[e.jsxs(p,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-green-600"}),"Saldo da Conta"]}),e.jsx(g,{children:"Valores disponíveis na sua subconta Asaas"})]}),e.jsx(f,{children:r!=null&&r.success?e.jsx("div",{className:"text-3xl font-bold text-green-600",children:m(r.balance||0)}):e.jsxs(y,{children:[e.jsx(F,{className:"h-4 w-4"}),e.jsxs(b,{children:["Erro ao carregar saldo: ",r==null?void 0:r.error]})]})})]}),e.jsxs(y,{children:[e.jsx(O,{className:"h-4 w-4"}),e.jsxs(b,{children:[e.jsx("strong",{children:"Como funciona a custódia:"}),e.jsx("br",{}),"• Os valores dos serviços ficam retidos na sua subconta até você confirmar que o serviço foi realizado",e.jsx("br",{}),"• Após a confirmação, o valor é liberado e transferido para sua conta bancária",e.jsx("br",{}),"• A taxa da plataforma (R$ 1,75) vai direto para a empresa"]})]}),e.jsxs(h,{children:[e.jsxs(p,{children:[e.jsx(j,{children:"Histórico de Pagamentos"}),e.jsx(g,{children:"Pagamentos recebidos e valores retidos na custódia"})]}),e.jsx(f,{children:t!=null&&t.success&&((u=t.payments)==null?void 0:u.length)>0?e.jsx("div",{className:"space-y-4",children:t.payments.map(s=>{const n=P(s);return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:m(s.value)}),e.jsx(K,{className:n.color,children:n.label})]}),e.jsx("span",{className:"text-sm text-gray-500",children:E(s.dueDate)})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description||"Pagamento de serviço"}),s.status==="RECEIVED"&&s.value>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Valor retido na custódia"}),e.jsxs(v,{onClick:()=>A(s),disabled:l.isPending,size:"sm",children:[l.isPending?e.jsx(c,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(T,{className:"h-4 w-4 mr-2"}),"Liberar Valor"]})]})]},s.id)})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(k,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Nenhum pagamento encontrado"}),e.jsx("p",{className:"text-sm",children:"Os pagamentos aparecerão aqui quando você receber agendamentos"})]})})]})]})}export{re as default};
