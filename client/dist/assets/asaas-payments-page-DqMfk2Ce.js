import{c as R,u as q,b as D,r as S,d as x,j as e,C as h,f as j,g as p,h as g,i as v,ay as V,az as B,aA as I}from"./index-DlYle-HK.js";import{u as L}from"./useMutation-DGOmPVD5.js";import{B as f}from"./button-0YWTsIWD.js";import{A as y,a as b}from"./alert-Byp0y-1Q.js";import{B as K}from"./badge-CHUQCCUH.js";import{R as c}from"./refresh-cw-Pp2cF6Q6.js";import{D as Q}from"./dollar-sign-PQvuyeTj.js";import{T as z}from"./triangle-alert-Mr8Jnu3R.js";import{S as F}from"./shield-CIvR3TOH.js";import{A as O}from"./arrow-right-0SqgWbEV.js";import{C as T}from"./clock-DRGRXyWQ.js";function ee(){var u;const{toast:d}=R(),{user:o}=q(),i=D(),[k,N]=S.useState(null),a=(o==null?void 0:o.id)||0,{data:r,isLoading:C}=x({queryKey:["asaas-provider-balance",a],queryFn:()=>B(a),enabled:!!a}),{data:t,isLoading:w}=x({queryKey:["asaas-provider-payments",a],queryFn:()=>I(a),enabled:!!a}),l=L({mutationFn:({providerId:s,amount:n})=>V(s,n),onSuccess:()=>{d({title:"Valor liberado!",description:"O valor foi transferido para sua conta com sucesso."}),i.invalidateQueries({queryKey:["asaas-provider-balance"]}),i.invalidateQueries({queryKey:["asaas-provider-payments"]}),N(null)},onError:s=>{d({title:"Erro ao liberar valor",description:s.message||"Erro interno do servidor",variant:"destructive"})}}),m=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s/100),E=s=>new Date(s).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),A=s=>{switch(s.status){case"RECEIVED":return{label:"Recebido",color:"bg-green-100 text-green-800"};case"PENDING":return{label:"Pendente",color:"bg-yellow-100 text-yellow-800"};case"OVERDUE":return{label:"Vencido",color:"bg-red-100 text-red-800"};default:return{label:"Desconhecido",color:"bg-gray-100 text-gray-800"}}},P=s=>{s.status==="RECEIVED"&&s.value>0&&l.mutate({providerId:a,amount:s.value})};return C||w?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(c,{className:"h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Meus Pagamentos Asaas"}),e.jsxs(f,{onClick:()=>{i.invalidateQueries({queryKey:["asaas-provider-balance"]}),i.invalidateQueries({queryKey:["asaas-provider-payments"]})},variant:"outline",children:[e.jsx(c,{className:"h-4 w-4 mr-2"}),"Atualizar"]})]}),e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-green-600"}),"Saldo da Conta"]}),e.jsx(g,{children:"Valores disponíveis na sua subconta Asaas"})]}),e.jsx(v,{children:r!=null&&r.success?e.jsx("div",{className:"text-3xl font-bold text-green-600",children:m(r.balance||0)}):e.jsxs(y,{children:[e.jsx(z,{className:"h-4 w-4"}),e.jsxs(b,{children:["Erro ao carregar saldo: ",r==null?void 0:r.error]})]})})]}),e.jsxs(y,{children:[e.jsx(F,{className:"h-4 w-4"}),e.jsxs(b,{children:[e.jsx("strong",{children:"Como funciona a custódia:"}),e.jsx("br",{}),"• Os valores dos serviços ficam retidos na sua subconta até você confirmar que o serviço foi realizado",e.jsx("br",{}),"• Após a confirmação, o valor é liberado e transferido para sua conta bancária",e.jsx("br",{}),"• A taxa da plataforma (R$ 1,75) vai direto para a empresa"]})]}),e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx(p,{children:"Histórico de Pagamentos"}),e.jsx(g,{children:"Pagamentos recebidos e valores retidos na custódia"})]}),e.jsx(v,{children:t!=null&&t.success&&((u=t.payments)==null?void 0:u.length)>0?e.jsx("div",{className:"space-y-4",children:t.payments.map(s=>{const n=A(s);return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:m(s.value)}),e.jsx(K,{className:n.color,children:n.label})]}),e.jsx("span",{className:"text-sm text-gray-500",children:E(s.dueDate)})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description||"Pagamento de serviço"}),s.status==="RECEIVED"&&s.value>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Valor retido na custódia"}),e.jsxs(f,{onClick:()=>P(s),disabled:l.isPending,size:"sm",children:[l.isPending?e.jsx(c,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(O,{className:"h-4 w-4 mr-2"}),"Liberar Valor"]})]})]},s.id)})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(T,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Nenhum pagamento encontrado"}),e.jsx("p",{className:"text-sm",children:"Os pagamentos aparecerão aqui quando você receber agendamentos"})]})})]})]})}export{ee as default};
