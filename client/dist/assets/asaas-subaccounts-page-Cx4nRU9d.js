import{j as e}from"./ui-UIpCtT3r.js";import{r as T}from"./vendor-vA4cx1mx.js";import{u as V}from"./router-CxXythJb.js";import{b as K,c as J,B as x,a2 as F,C as O,d as U,e as Q,f as W,g as X,i as u}from"./index-C8-zpcKL.js";import{u as N}from"./useMutation-P96WDC87.js";import{u as Y,t as Z,o as _,n as ee,b as se,e as ae,s as r}from"./zod-BPPSwYm9.js";import{C as re}from"./checkbox-B-AHTeD9.js";import{I as c}from"./input-IX-Ccd3C.js";import{T as ne,b as oe,c as P,d as p,e as ie,f as h}from"./table-scwF4lFh.js";import{D as te,f as ce,a as le,b as de,c as me,d as xe,e as pe}from"./dialog-B9ckTsk5.js";import{F as he,a as n,b as o,c as i,d as t,e as l,f as k}from"./form-Bw-fjiTK.js";import{B as C}from"./badge-DP5DyHeb.js";import{A as je}from"./admin-layout-D86jsAEo.js";import{A as ue}from"./arrow-left-DbtXU75N.js";import{P as I}from"./plus-Dqfms9_s.js";import{S as H}from"./shield-hxa6agaR.js";import{U as R}from"./users-B2n0v15j.js";import{D as be}from"./dollar-sign-DShZq9ts.js";import{S as ge}from"./square-pen-6WfsyjUG.js";import"./index-BH3L9zMK.js";import"./check-yFju7Kvd.js";import"./label-BIAKwpsc.js";import"./navbar-vyjn30u5.js";import"./proxy-B2Nma8Bt.js";import"./search-ChrBAPJG.js";import"./calendar-check-B0nV5Uhw.js";import"./user-CXc1AnQW.js";import"./avatar-BBcRvo13.js";import"./dropdown-menu-CUOsS9wa.js";import"./chevron-right-DnXY7g-Q.js";import"./circle-DyW2RO_p.js";import"./settings-DR9OFCdO.js";import"./log-out-BVXZMdHH.js";import"./menu-Cn_vALKP.js";import"./bell-CZnX4FjY.js";import"./calendar-CEG0wbcY.js";import"./trending-up-Bw7pj4fv.js";import"./folder-tree-DnCs9tbC.js";import"./credit-card-CEItYo9H.js";import"./share-2-CLZFBYyy.js";import"./circle-help-BAOtwWti.js";import"./book-open-Cm997j01.js";const Ne=_({name:r().min(1,"Nome é obrigatório"),email:r().email("Email inválido"),cpfCnpj:r().min(11,"CPF/CNPJ é obrigatório"),phone:r().optional(),address:r().optional(),addressNumber:r().optional(),complement:r().optional(),province:r().optional(),city:r().optional(),state:r().optional(),postalCode:r().optional(),bank:r().optional(),accountNumber:r().optional(),accountDigit:r().optional(),branchNumber:r().optional(),branchDigit:r().optional(),accountType:ae(["CHECKING","SAVINGS"]).optional(),enableEscrow:se().default(!1),escrowDays:ee().min(1).max(365).default(30)});function cs(){var E,S,D;const[,G]=V(),{toast:m}=K(),[$,b]=T.useState(!1),[f,y]=T.useState(null),a=Y({resolver:Z(Ne),defaultValues:{name:"",email:"",cpfCnpj:"",phone:"",address:"",addressNumber:"",complement:"",province:"",city:"",state:"",postalCode:"",bank:"",accountNumber:"",accountDigit:"",branchNumber:"",branchDigit:"",accountType:"CHECKING",enableEscrow:!1,escrowDays:30}}),{data:d,isLoading:z,refetch:w}=J({queryKey:["/api/admin/asaas/subaccounts"],queryFn:async()=>{try{return await(await u("GET","/api/admin/asaas/subaccounts")).json()}catch(s){return console.error("Erro ao carregar subcontas:",s),{subAccounts:[]}}}}),g=N({mutationFn:async s=>{const j={name:s.name,email:s.email,cpfCnpj:s.cpfCnpj,phone:s.phone,address:s.address,addressNumber:s.addressNumber,complement:s.complement,province:s.province,city:s.city,state:s.state,postalCode:s.postalCode,bankAccount:s.bank?{bank:s.bank,accountNumber:s.accountNumber||"",accountDigit:s.accountDigit||"",branchNumber:s.branchNumber||"",branchDigit:s.branchDigit,accountType:s.accountType||"CHECKING"}:void 0,enableEscrow:s.enableEscrow,escrowDays:s.escrowDays};return await(await u("POST","/api/admin/asaas/subaccounts",j)).json()},onSuccess:s=>{m({title:"Subconta criada",description:"Subconta criada com sucesso no Asaas."}),b(!1),a.reset(),w()},onError:s=>{m({title:"Erro",description:`Erro ao criar subconta: ${s.message}`,variant:"destructive"})}}),B=N({mutationFn:async({subAccountId:s,data:j})=>await(await u("PATCH",`/api/admin/asaas/subaccounts/${s}`,j)).json(),onSuccess:()=>{m({title:"Subconta atualizada",description:"Subconta atualizada com sucesso."}),y(null),w()},onError:s=>{m({title:"Erro",description:`Erro ao atualizar subconta: ${s.message}`,variant:"destructive"})}}),v=N({mutationFn:async s=>await(await u("GET",`/api/admin/asaas/subaccounts/${s}/balance`)).json(),onSuccess:s=>{m({title:"Saldo consultado",description:`Saldo: R$ ${(s.balance/100).toFixed(2)}`})},onError:s=>{m({title:"Erro",description:`Erro ao consultar saldo: ${s.message}`,variant:"destructive"})}}),L=s=>{f?B.mutate({subAccountId:f.id,data:{name:s.name,email:s.email,phone:s.phone,enableEscrow:s.enableEscrow,escrowDays:s.escrowDays}}):g.mutate(s)},q=s=>{y(s),a.reset({name:s.name,email:s.email,cpfCnpj:s.cpfCnpj,phone:s.phone||"",address:s.address||"",city:s.city||"",state:s.state||"",enableEscrow:s.enableEscrow,escrowDays:s.escrowDays})},A=s=>{v.mutate(s)};return e.jsx(je,{children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>G("/admin/financial-settings"),children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Voltar"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Subcontas Asaas"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie as subcontas dos prestadores para split com custódia"})]})]}),e.jsxs(te,{open:$,onOpenChange:b,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(x,{className:"bg-green-600 hover:bg-green-700",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Nova Subconta"]})}),e.jsxs(le,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(de,{children:[e.jsx(me,{children:"Criar Nova Subconta"}),e.jsx(xe,{children:"Crie uma subconta para um prestador no Asaas com configurações de custódia"})]}),e.jsx(he,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(L),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:a.control,name:"name",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Nome Completo"}),e.jsx(t,{children:e.jsx(c,{...s,placeholder:"Nome do prestador"})}),e.jsx(l,{})]})}),e.jsx(n,{control:a.control,name:"email",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Email"}),e.jsx(t,{children:e.jsx(c,{...s,type:"email",placeholder:"email@exemplo.com"})}),e.jsx(l,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:a.control,name:"cpfCnpj",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"CPF/CNPJ"}),e.jsx(t,{children:e.jsx(c,{...s,placeholder:"000.000.000-00"})}),e.jsx(l,{})]})}),e.jsx(n,{control:a.control,name:"phone",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Telefone"}),e.jsx(t,{children:e.jsx(c,{...s,placeholder:"(11) 99999-9999"})}),e.jsx(l,{})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Endereço"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(n,{control:a.control,name:"address",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Endereço"}),e.jsx(t,{children:e.jsx(c,{...s,placeholder:"Rua, Avenida, etc."})}),e.jsx(l,{})]})}),e.jsx(n,{control:a.control,name:"addressNumber",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Número"}),e.jsx(t,{children:e.jsx(c,{...s,placeholder:"123"})}),e.jsx(l,{})]})}),e.jsx(n,{control:a.control,name:"complement",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Complemento"}),e.jsx(t,{children:e.jsx(c,{...s,placeholder:"Apto 101"})}),e.jsx(l,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(n,{control:a.control,name:"city",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Cidade"}),e.jsx(t,{children:e.jsx(c,{...s,placeholder:"São Paulo"})}),e.jsx(l,{})]})}),e.jsx(n,{control:a.control,name:"state",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Estado"}),e.jsx(t,{children:e.jsx(c,{...s,placeholder:"SP"})}),e.jsx(l,{})]})}),e.jsx(n,{control:a.control,name:"postalCode",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"CEP"}),e.jsx(t,{children:e.jsx(c,{...s,placeholder:"00000-000"})}),e.jsx(l,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Configurações de Custódia (Escrow)"]}),e.jsx(n,{control:a.control,name:"enableEscrow",render:({field:s})=>e.jsxs(o,{className:"flex flex-row items-center space-x-3 space-y-0",children:[e.jsx(t,{children:e.jsx(re,{checked:s.value,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(i,{children:"Habilitar Conta Escrow"}),e.jsx(k,{children:"Retém os valores por um período antes de liberar para o prestador"})]})]})}),a.watch("enableEscrow")&&e.jsx(n,{control:a.control,name:"escrowDays",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Dias de Retenção"}),e.jsx(t,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(c,{...s,type:"number",min:"1",max:"365",className:"w-32"}),e.jsx("span",{className:"text-sm text-gray-600",children:"dias"})]})}),e.jsx(k,{children:"Período que o valor ficará retido antes de ser liberado"}),e.jsx(l,{})]})})]}),e.jsxs(pe,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancelar"}),e.jsx(x,{type:"submit",disabled:g.isPending,children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}),"Criando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Criar Subconta"]})})]})]})})]})]})]}),e.jsxs(O,{children:[e.jsxs(U,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Subcontas (",((E=d==null?void 0:d.subAccounts)==null?void 0:E.length)||0,")"]}),e.jsx(W,{children:"Subcontas criadas no Asaas para split com custódia"})]}),e.jsx(X,{children:z?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(F,{className:"h-8 w-8 animate-spin mx-auto text-gray-400"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Carregando subcontas..."})]}):((S=d==null?void 0:d.subAccounts)==null?void 0:S.length)===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(R,{className:"h-12 w-12 mx-auto text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Nenhuma subconta"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Comece criando uma subconta para um prestador."})]}):e.jsxs(ne,{children:[e.jsx(oe,{children:e.jsxs(P,{children:[e.jsx(p,{children:"Prestador"}),e.jsx(p,{children:"Email"}),e.jsx(p,{children:"CPF/CNPJ"}),e.jsx(p,{children:"Custódia"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Ações"})]})}),e.jsx(ie,{children:(D=d==null?void 0:d.subAccounts)==null?void 0:D.map(s=>e.jsxs(P,{children:[e.jsx(h,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.phone})]})}),e.jsx(h,{children:s.email}),e.jsx(h,{children:s.cpfCnpj}),e.jsx(h,{children:s.enableEscrow?e.jsxs(C,{variant:"secondary",className:"bg-orange-100 text-orange-800",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),s.escrowDays," dias"]}):e.jsx(C,{variant:"outline",children:"Sem custódia"})}),e.jsx(h,{children:e.jsx(C,{variant:s.status==="ACTIVE"?"default":"secondary",children:s.status==="ACTIVE"?"Ativa":"Inativa"})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{size:"sm",variant:"outline",onClick:()=>A(s.id),disabled:v.isPending,children:e.jsx(be,{className:"h-3 w-3"})}),e.jsx(x,{size:"sm",variant:"outline",onClick:()=>q(s),children:e.jsx(ge,{className:"h-3 w-3"})})]})})]},s.id))})]})})]})]})})}export{cs as default};
