import{m as y,a as I,c as T,r as i,j as e,e as m,C as c,f as l,g as x,h as u,i as h,M as S,K as A,I as f,q as L,l as D}from"./index-DlYle-HK.js";import{B as p}from"./button-0YWTsIWD.js";import{u as E}from"./useMutation-DGOmPVD5.js";import{T as k}from"./textarea-CK_2KZ5-.js";import{L as q}from"./label-ClF4Xt_H.js";import{C as B}from"./circle-check-big-Cgf7H_gr.js";import{S as P}from"./scissors-5HnznaYd.js";import{U as b}from"./user-geZPnD2Z.js";import{C as F}from"./calendar-DIqdCud3.js";import{C as $}from"./clock-DRGRXyWQ.js";import{A as z}from"./arrow-left-DEtv-0Pf.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=y("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);function Y(){const[,r]=I(),{toast:t}=T(),[v,j]=i.useState(!0),[d,N]=i.useState(""),[s,g]=i.useState(null);i.useEffect(()=>{const a=sessionStorage.getItem("bookingState");if(a)try{const o=JSON.parse(a);g(o)}catch(o){console.error("Erro ao parsear o estado do agendamento:",o),t({title:"Erro",description:"Houve um problema ao recuperar os dados do agendamento",variant:"destructive"}),r("/client/services")}else t({title:"Agendamento não encontrado",description:"Por favor, inicie um novo agendamento",variant:"destructive"}),r("/client/services");j(!1)},[t,r]);const n=E({mutationFn:async a=>await(await D("POST","/api/appointments",a)).json(),onSuccess:a=>{sessionStorage.removeItem("bookingState"),t({title:"Agendamento realizado com sucesso!",description:"Você receberá uma confirmação em breve.",variant:"default"}),L.invalidateQueries({queryKey:["/api/appointments"]}),r(`/client/appointments/${a.id}`)},onError:a=>{console.error("Erro ao criar agendamento:",a),t({title:"Erro ao agendar",description:a.message||"Ocorreu um erro ao realizar o agendamento. Por favor, tente novamente.",variant:"destructive"})}}),C=()=>{if(!(s!=null&&s.serviceId)||!(s!=null&&s.providerId)||!(s!=null&&s.date)||!(s!=null&&s.timeSlot)){t({title:"Dados incompletos",description:"Faltam informações necessárias para realizar o agendamento",variant:"destructive"});return}const a={serviceId:s.serviceId,providerId:s.providerId,date:s.date,startTime:s.timeSlot.startTime,endTime:s.timeSlot.endTime,notes:d.trim()||null,availabilityId:s.timeSlot.availabilityId};n.mutate(a)},w=()=>{r(`/client/book/${s==null?void 0:s.providerId}/${s==null?void 0:s.serviceId}`)};return v||!s?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(m,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"container max-w-4xl py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Confirmar Agendamento"}),e.jsx("p",{className:"text-muted-foreground",children:"Revise os detalhes e confirme seu agendamento"})]}),e.jsxs(c,{className:"mb-6",children:[e.jsxs(l,{children:[e.jsxs(x,{className:"flex items-center",children:[e.jsx(B,{className:"mr-2 h-5 w-5 text-primary"}),"Detalhes do Agendamento"]}),e.jsx(u,{children:"Confira se todos os detalhes estão corretos"})]}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(P,{className:"h-5 w-5 mr-3 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.serviceName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:S(s.serviceDuration)})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(b,{className:"h-5 w-5 mr-3 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.providerName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Profissional"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(F,{className:"h-5 w-5 mr-3 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.date?A(s.date):"Data não selecionada"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Data do atendimento"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx($,{className:"h-5 w-5 mr-3 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.timeSlot?`${f(s.timeSlot.startTime)} - ${f(s.timeSlot.endTime)}`:"Horário não selecionado"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Horário do atendimento"})]})]})]})})]}),e.jsxs(c,{className:"mb-6",children:[e.jsxs(l,{children:[e.jsx(x,{children:"Informações Adicionais"}),e.jsx(u,{children:"Adicione qualquer informação ou solicitação especial para o prestador"})]}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"notes",children:"Notas/Observações (opcional)"}),e.jsx(k,{id:"notes",placeholder:"Ex: Tenho preferência por corte com navalha, tenho alergia a determinado produto...",value:d,onChange:a=>N(a.target.value),rows:3,className:"resize-none"})]})})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row sm:justify-between gap-3",children:[e.jsxs(p,{variant:"outline",onClick:w,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Voltar"]}),e.jsx(p,{onClick:C,disabled:n.isPending,className:"w-full sm:w-auto",children:n.isPending?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"h-4 w-4 mr-2 animate-spin"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Confirmar Agendamento"]})})]})]})}export{Y as default};
