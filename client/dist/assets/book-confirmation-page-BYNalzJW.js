import{j as e}from"./ui-UIpCtT3r.js";import{r as i}from"./vendor-vA4cx1mx.js";import{j as y,b as I,L as d,C as c,d as l,e as x,f as u,g as f,B as T,z as L,y as h,q as S,i as A}from"./index-BJ9Cw0LR.js";import{B as p}from"./button-BvsVcTDx.js";import{u as B}from"./router-CxXythJb.js";import{u as D}from"./useMutation-CDdW0pzE.js";import{T as E}from"./textarea-6aMtToLP.js";import{L as k}from"./label-qfvszZNj.js";import{C as q}from"./circle-check-big-KcM-m8FQ.js";import{S as P}from"./scissors-BnGTcrvI.js";import{U as b}from"./user-C2y4PfJ8.js";import{C as z}from"./calendar-tibBNAR3.js";import{C as F}from"./clock-BoQP0pJL.js";import{A as $}from"./arrow-left-EWHBe2nW.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=y("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);function ee(){const[,r]=B(),{toast:t}=I(),[v,j]=i.useState(!0),[m,N]=i.useState(""),[s,g]=i.useState(null);i.useEffect(()=>{const a=sessionStorage.getItem("bookingState");if(a)try{const o=JSON.parse(a);g(o)}catch(o){console.error("Erro ao parsear o estado do agendamento:",o),t({title:"Erro",description:"Houve um problema ao recuperar os dados do agendamento",variant:"destructive"}),r("/client/services")}else t({title:"Agendamento não encontrado",description:"Por favor, inicie um novo agendamento",variant:"destructive"}),r("/client/services");j(!1)},[t,r]);const n=D({mutationFn:async a=>await(await A("POST","/api/appointments",a)).json(),onSuccess:a=>{sessionStorage.removeItem("bookingState"),t({title:"Agendamento realizado com sucesso!",description:"Você receberá uma confirmação em breve.",variant:"default"}),S.invalidateQueries({queryKey:["/api/appointments"]}),r(`/client/appointments/${a.id}`)},onError:a=>{console.error("Erro ao criar agendamento:",a),t({title:"Erro ao agendar",description:a.message||"Ocorreu um erro ao realizar o agendamento. Por favor, tente novamente.",variant:"destructive"})}}),C=()=>{if(!(s!=null&&s.serviceId)||!(s!=null&&s.providerId)||!(s!=null&&s.date)||!(s!=null&&s.timeSlot)){t({title:"Dados incompletos",description:"Faltam informações necessárias para realizar o agendamento",variant:"destructive"});return}const a={serviceId:s.serviceId,providerId:s.providerId,date:s.date,startTime:s.timeSlot.startTime,endTime:s.timeSlot.endTime,notes:m.trim()||null,availabilityId:s.timeSlot.availabilityId};n.mutate(a)},w=()=>{r(`/client/book/${s==null?void 0:s.providerId}/${s==null?void 0:s.serviceId}`)};return v||!s?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(d,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"container max-w-4xl py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Confirmar Agendamento"}),e.jsx("p",{className:"text-muted-foreground",children:"Revise os detalhes e confirme seu agendamento"})]}),e.jsxs(c,{className:"mb-6",children:[e.jsxs(l,{children:[e.jsxs(x,{className:"flex items-center",children:[e.jsx(q,{className:"mr-2 h-5 w-5 text-primary"}),"Detalhes do Agendamento"]}),e.jsx(u,{children:"Confira se todos os detalhes estão corretos"})]}),e.jsx(f,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(P,{className:"h-5 w-5 mr-3 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.serviceName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:T(s.serviceDuration)})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(b,{className:"h-5 w-5 mr-3 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.providerName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Profissional"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(z,{className:"h-5 w-5 mr-3 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.date?L(s.date):"Data não selecionada"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Data do atendimento"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(F,{className:"h-5 w-5 mr-3 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.timeSlot?`${h(s.timeSlot.startTime)} - ${h(s.timeSlot.endTime)}`:"Horário não selecionado"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Horário do atendimento"})]})]})]})})]}),e.jsxs(c,{className:"mb-6",children:[e.jsxs(l,{children:[e.jsx(x,{children:"Informações Adicionais"}),e.jsx(u,{children:"Adicione qualquer informação ou solicitação especial para o prestador"})]}),e.jsx(f,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"notes",children:"Notas/Observações (opcional)"}),e.jsx(E,{id:"notes",placeholder:"Ex: Tenho preferência por corte com navalha, tenho alergia a determinado produto...",value:m,onChange:a=>N(a.target.value),rows:3,className:"resize-none"})]})})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row sm:justify-between gap-3",children:[e.jsxs(p,{variant:"outline",onClick:w,children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Voltar"]}),e.jsx(p,{onClick:C,disabled:n.isPending,className:"w-full sm:w-auto",children:n.isPending?e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"h-4 w-4 mr-2 animate-spin"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Confirmar Agendamento"]})})]})]})}export{ee as default};
