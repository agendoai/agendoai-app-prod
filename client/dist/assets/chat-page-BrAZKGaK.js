import{r as g,c as C,l as L,j as s,C as N,f as b,g as w,i as y,o as I,k as O,s as W,u as $,d as T,L as v}from"./index-DFO2lo2s.js";import{u as M}from"./useMutation-BIXw1p8a.js";import{B as j}from"./button-6IH7luFD.js";import{T as q}from"./textarea-D6LzI8S1.js";import{A as F,a as z}from"./alert-NIGMftih.js";import{M as A}from"./message-square-CVPf25-9.js";import{S as B}from"./send-Cyrr1DuV.js";import{C as f}from"./client-navbar-h9ka1u48.js";import{A as V,a as R,b as D}from"./avatar-CVSf1ztN.js";import{B as K}from"./badge-DWGHGqHr.js";import{T as _,a as G,b as S,c as k}from"./tabs-DdC9UF4F.js";import{A as E}from"./arrow-left-DxjewkX7.js";import{P as H}from"./phone-PqoFJEyq.js";import{M as Q}from"./mail-Gdb5LOLb.js";import{M as J}from"./map-pin-wlEWBw89.js";import{C as U}from"./calendar-CXCri533.js";import"./sheet-B7WdakJM.js";import"./index-O3IU6Cgx.js";import"./index-zokK3oQV.js";import"./index-BEl4sio8.js";import"./input-DGvqAMIq.js";import"./popover-kbEvo3Xe.js";import"./index-r8gFfIDH.js";import"./index-heHCkeO_.js";import"./separator-Cw00ASEU.js";import"./bell-BMDILFyN.js";import"./format-CGvBu07F.js";import"./en-US-xSPtgCq_.js";import"./pt-BR-Cxqo7XV3.js";import"./tooltip-BCOswfBn.js";import"./proxy-BltBotVH.js";import"./menu-Chrz4g6w.js";import"./house-sGd4nDnu.js";import"./search-CMPUhstB.js";import"./calendar-check-CDRCjfO9.js";import"./user-WwS7npix.js";import"./log-out-CXzoyitA.js";import"./index-CWnO1h2h.js";import"./index-BZw1vT_C.js";function X({providerId:r,providerName:c,serviceId:l,serviceName:m,className:d}){const[e,x]=g.useState(""),{toast:t}=C(),{mutate:h,isPending:n,error:p}=M({mutationFn:async i=>(await L("POST","/api/whatsapp/generate-link",i)).json(),onSuccess:i=>{window.open(i.whatsappLink,"_blank"),t({title:"Chat aberto com sucesso",description:`Abrindo chat com ${i.providerName}`})},onError:()=>{t({title:"Erro ao abrir chat",description:"Não foi possível conectar ao WhatsApp. Tente novamente.",variant:"destructive"})}}),a=()=>{h({providerId:r,serviceId:l,message:e.trim()||void 0})};return s.jsxs(N,{className:d,children:[s.jsx(b,{children:s.jsxs(w,{className:"flex items-center gap-2",children:[s.jsx(A,{size:18,className:"text-green-500"}),s.jsxs("span",{children:["Chat com ",c]})]})}),s.jsxs(y,{children:[m&&s.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Sobre: ",m]}),p&&s.jsxs(F,{variant:"destructive",className:"mb-4",children:[s.jsx(I,{className:"h-4 w-4"}),s.jsx(z,{children:"Erro ao conectar com WhatsApp. Verifique se o prestador cadastrou um número válido."})]}),s.jsx(q,{placeholder:"Digite sua mensagem para o prestador...",value:e,onChange:i=>x(i.target.value),className:"min-h-[120px]"})]}),s.jsx(O,{children:s.jsxs(j,{onClick:a,disabled:n,className:"w-full bg-green-500 hover:bg-green-600",children:[n?"Abrindo chat...":"Abrir chat no WhatsApp",s.jsx(B,{size:16,className:"ml-2"})]})})]})}function Y({providerId:r,serviceId:c,defaultMessage:l,label:m="Contato rápido",size:d="default",variant:e="default",...x}){const{toast:t}=C(),{mutate:h,isPending:n}=M({mutationFn:async a=>(await L("POST","/api/whatsapp/generate-link",a)).json(),onSuccess:a=>{window.open(a.whatsappLink,"_blank"),t({title:"WhatsApp",description:`Abrindo chat com ${a.providerName}`})},onError:()=>{t({title:"Erro",description:"Não foi possível conectar ao WhatsApp",variant:"destructive"})}}),p=a=>{a.stopPropagation(),h({providerId:r,serviceId:c,message:l})};return s.jsx(j,{size:d,variant:e,onClick:p,disabled:n,className:"bg-green-500 hover:bg-green-600 text-white",...x,children:d==="icon"?s.jsx(A,{size:16}):s.jsxs(s.Fragment,{children:[s.jsx(A,{size:16,className:"mr-2"}),n?"Abrindo...":m]})})}function Fs(){var n,p,a,i,u,P;const{providerId:r}=W(),{user:c}=$(),{toast:l}=C(),[m,d]=g.useState("chat"),{data:e,isLoading:x}=T({queryKey:[`/api/providers/${r}/profile`]}),{data:t,isLoading:h}=T({queryKey:[`/api/services?providerId=${r}`]});return g.useEffect(()=>{c&&e&&c.id===e.id&&(l({title:"Erro",description:"Você não pode enviar mensagens para si mesmo",variant:"destructive"}),window.location.href="/")},[c,e,l]),x||h?s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx(f,{}),s.jsx("div",{className:"container mx-auto py-8 px-4",children:s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})})]}):e?s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx(f,{}),s.jsxs("div",{className:"container mx-auto py-8 px-4",children:[s.jsx("div",{className:"mb-6",children:s.jsx(v,{href:`/providers/${r}`,children:s.jsxs(j,{variant:"ghost",size:"sm",children:[s.jsx(E,{className:"mr-2 h-4 w-4"}),"Voltar para perfil do prestador"]})})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[s.jsx("div",{className:"md:col-span-1",children:s.jsxs(N,{children:[s.jsx(b,{className:"pb-2",children:s.jsx(w,{children:"Prestador"})}),s.jsxs(y,{children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsxs(V,{className:"h-24 w-24",children:[s.jsx(R,{src:e.profileImage||""}),s.jsx(D,{className:"bg-primary text-white uppercase text-lg",children:((n=e.name)==null?void 0:n.charAt(0))||"P"})]}),s.jsx("h2",{className:"mt-4 text-xl font-semibold",children:((p=e.settings)==null?void 0:p.businessName)||e.name}),s.jsx(K,{variant:(a=e.settings)!=null&&a.isOnline?"default":"outline",className:"mt-2",children:(i=e.settings)!=null&&i.isOnline?"Online":"Offline"})]}),s.jsxs("div",{className:"mt-6 space-y-4",children:[e.phone&&s.jsxs("div",{className:"flex items-center",children:[s.jsx(H,{className:"h-4 w-4 mr-2 text-primary"}),s.jsx("span",{children:e.phone})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx(Q,{className:"h-4 w-4 mr-2 text-primary"}),s.jsx("span",{children:e.email})]}),((u=e.settings)==null?void 0:u.address)&&s.jsxs("div",{className:"flex items-start",children:[s.jsx(J,{className:"h-4 w-4 mr-2 text-primary mt-1"}),s.jsx("span",{children:e.settings.address})]})]}),s.jsx("div",{className:"mt-6",children:s.jsx(v,{href:`/providers/${r}/schedule`,children:s.jsxs(j,{className:"w-full",children:[s.jsx(U,{className:"mr-2 h-4 w-4"}),"Agendar serviço"]})})})]})]})}),s.jsx("div",{className:"md:col-span-2",children:s.jsxs(_,{value:m,onValueChange:d,className:"w-full",children:[s.jsxs(G,{className:"w-full mb-6",children:[s.jsx(S,{value:"chat",className:"flex-1",children:"Chat por WhatsApp"}),s.jsx(S,{value:"services",className:"flex-1",children:"Serviços"})]}),s.jsx(k,{value:"chat",className:"mt-0",children:s.jsx(X,{providerId:parseInt(r),providerName:((P=e.settings)==null?void 0:P.businessName)||e.name})}),s.jsx(k,{value:"services",className:"mt-0",children:s.jsxs(N,{children:[s.jsx(b,{children:s.jsx(w,{children:"Serviços Oferecidos"})}),s.jsx(y,{children:t&&t.length>0?s.jsx("div",{className:"space-y-4 divide-y",children:t.map(o=>s.jsx("div",{className:"pt-4",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium",children:o.name}),o.description&&s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:o.description}),s.jsxs("div",{className:"flex items-center mt-2 text-sm text-gray-500",children:[s.jsxs("span",{className:"mr-4",children:[o.duration," min"]}),s.jsxs("span",{children:["R$ ",(o.price/100).toFixed(2)]})]})]}),s.jsx(Y,{providerId:parseInt(r),serviceId:o.id,defaultMessage:`Olá! Gostaria de mais informações sobre o serviço "${o.name}".`,size:"sm"})]})},o.id))}):s.jsx("div",{className:"text-center py-8 text-gray-500",children:s.jsx("p",{children:"Este prestador ainda não cadastrou serviços."})})})]})})]})})]})]})]}):s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx(f,{}),s.jsx("div",{className:"container mx-auto py-8 px-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-red-500",children:"Prestador não encontrado"}),s.jsx("p",{className:"mt-2 text-gray-600",children:"O prestador que você está procurando não existe."}),s.jsx(v,{href:"/",children:s.jsxs(j,{className:"mt-4",children:[s.jsx(E,{className:"mr-2 h-4 w-4"}),"Voltar para a home"]})})]})})]})}export{Fs as ProviderChatPage,Fs as default};
