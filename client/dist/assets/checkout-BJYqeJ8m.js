import{j as e}from"./ui-UIpCtT3r.js";import{E,u as B,a as R,P as X}from"./react-stripe.esm-CMqkxx7A.js";import{l as F}from"./index-C8r34K29.js";import{r as c}from"./vendor-vA4cx1mx.js";import{u as f}from"./router-CxXythJb.js";import{C as T,d as $,e as A,f as O,g as k,L as C,h as L,i as Q,b as w,B as g}from"./index-DMVSlINz.js";import{P as G}from"./page-transition-fz5jz5g5.js";import{A as V}from"./app-header-wB_4hYan.js";import{S as D}from"./separator-D_RfrPgK.js";import{T as _,a as q,b as N,c as b}from"./tabs-BeATRqWY.js";import{C as y}from"./credit-card-DTBtIUOk.js";import{Q as v}from"./qr-code-BogfNbKV.js";import{B as I}from"./banknote-B7RGdfb5.js";import{C as S}from"./circle-check-big-CXpzSzX6.js";import{C as z}from"./clock-DluLCsci.js";import"./index-BvR2MEzN.js";import"./proxy-CAhTMUof.js";import"./avatar-DJ_tL6P_.js";import"./badge-CIXRfmkI.js";import"./dropdown-menu-DwBmztZZ.js";import"./chevron-right-D0P32XR-.js";import"./check-pZ3JKVe2.js";import"./circle-CRjqYs4g.js";import"./arrow-left-3dZ_zEs-.js";import"./bell-D5zNslsE.js";import"./ellipsis-vertical-BwovH0yi.js";import"./calendar-CYlMr0qt.js";import"./user-DxXpbN3a.js";import"./settings-Blcd0dvr.js";import"./circle-help-C8c3Z800.js";import"./message-square-CHbKsffD.js";import"./log-out-CiUJLpAa.js";throw new Error("Chave pública do Stripe não configurada (VITE_STRIPE_PUBLIC_KEY)");const U=F(void 0),M=({amount:x,description:j,appointmentId:a})=>{const t=B(),n=R(),[r,o]=c.useState(!1),[h,p]=c.useState(!1),{toast:s}=w(),[,i]=f(),l=async u=>{if(u.preventDefault(),!(!t||!n)){o(!0);try{const{error:m,paymentIntent:d}=await t.confirmPayment({elements:n,confirmParams:{return_url:`${window.location.origin}/client/payment-success${a?`?appointmentId=${a}`:""}`},redirect:"if_required"});m?(s({title:"Falha no pagamento",description:m.message||"Ocorreu um erro ao processar o pagamento",variant:"destructive"}),o(!1)):(p(!0),s({title:"Pagamento concluído",description:"Seu pagamento foi processado com sucesso!"}),i(`/client/payment-success?payment_intent=${(d==null?void 0:d.id)||""}${a?`&appointmentId=${a}`:""}`))}catch(m){s({title:"Erro no processamento",description:m.message||"Ocorreu um erro ao processar o pagamento",variant:"destructive"}),o(!1)}}};return h?e.jsxs("div",{className:"text-center py-10",children:[e.jsx(S,{className:"w-16 h-16 mx-auto text-green-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"Pagamento Concluído"}),e.jsx("p",{className:"text-neutral-600 mb-6",children:"Seu pagamento foi processado com sucesso!"}),e.jsx("p",{className:"text-neutral-600 mb-6",children:"Redirecionando..."})]}):e.jsxs("form",{onSubmit:l,className:"space-y-6",children:[e.jsx("div",{className:"p-4 bg-neutral-50 rounded-lg",children:e.jsx(X,{})}),e.jsx(g,{type:"submit",className:"w-full py-6",disabled:!t||!n||r,children:r?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),"Pagar R$ ",x.toFixed(2)]})})]})},H=({amount:x,description:j,appointmentId:a})=>{const[t,n]=c.useState(!1),[r,o]=c.useState(null),[h,p]=c.useState(null),{toast:s}=w(),[,i]=f(),l=async()=>{n(!0);try{await new Promise(d=>setTimeout(d,2e3)),o("00020126580014BR.GOV.BCB.PIX0136example@email.com52040000530398654040.005802BR5913Agendo AI6008Sao Paulo62070503***6304A1B2"),p("https://chart.googleapis.com/chart?cht=qr&chl=00020126580014BR.GOV.BCB.PIX0136example@email.com52040000530398654040.005802BR5913Agendo+AI6008Sao+Paulo62070503***6304A1B2&chs=300x300"),s({title:"PIX gerado com sucesso",description:"Escaneie o QR Code ou copie o código PIX"})}catch{s({title:"Erro ao gerar PIX",description:"Não foi possível gerar o QR Code para pagamento PIX",variant:"destructive"})}finally{n(!1)}},u=()=>{r&&(navigator.clipboard.writeText(r),s({title:"Código copiado!",description:"O código PIX foi copiado para sua área de transferência"}))},m=()=>{i(`/client/payment-success?method=pix${a?`&appointmentId=${a}`:""}`)};return e.jsx("div",{className:"space-y-6 py-2",children:r?e.jsxs("div",{className:"bg-neutral-50 p-4 rounded-lg text-center",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"PIX Gerado"}),h&&e.jsx("div",{className:"mb-4 flex justify-center",children:e.jsx("img",{src:h,alt:"QR Code PIX",className:"w-40 h-40 mx-auto border border-neutral-200 rounded"})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-neutral-500 mb-1",children:"CÓDIGO PIX COPIA E COLA"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"p-2 bg-white border border-neutral-200 rounded text-xs text-neutral-700 break-all overflow-hidden max-h-20 overflow-y-auto",children:r}),e.jsx(g,{size:"sm",variant:"outline",className:"absolute top-2 right-2 h-6 text-xs py-0 px-2",onClick:u,children:"Copiar"})]})]}),e.jsxs("div",{className:"text-sm text-neutral-700 mb-4",children:[e.jsx("p",{className:"mb-2",children:"1. Abra o aplicativo do seu banco"}),e.jsx("p",{className:"mb-2",children:"2. Escolha pagar com PIX"}),e.jsx("p",{className:"mb-2",children:"3. Escaneie o QR Code ou cole o código"}),e.jsxs("p",{className:"mb-2",children:["4. Confirme o valor de ",e.jsxs("strong",{children:["R$ ",x.toFixed(2)]})]})]}),e.jsx("p",{className:"text-xs text-neutral-500 mb-4",children:"Após realizar o pagamento, clique no botão abaixo para continuar"}),e.jsxs(g,{onClick:m,className:"w-full",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Já realizei o pagamento"]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg-neutral-50 p-4 rounded-lg text-center",children:[e.jsx(v,{className:"w-16 h-16 mx-auto text-primary mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"Pagamento via PIX"}),e.jsx("p",{className:"text-sm text-neutral-600 mb-4",children:"Gere um QR Code para pagamento instantâneo via PIX"}),e.jsx(g,{onClick:l,className:"w-full",disabled:t,children:t?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Gerando PIX..."]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-2 h-4 w-4"}),"Gerar QR Code PIX"]})})]})})})},J=({amount:x,description:j,appointmentId:a})=>{const[,t]=f(),n=()=>{t(`/client/payment-success?method=cash${a?`&appointmentId=${a}`:""}`)};return e.jsx("div",{className:"space-y-6 py-2",children:e.jsxs("div",{className:"bg-neutral-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx(I,{className:"w-16 h-16 mx-auto text-green-600 mb-3"}),e.jsx("h3",{className:"text-lg font-medium",children:"Pagamento Presencial"}),e.jsx("p",{className:"text-sm text-neutral-600 mt-1",children:"Você optou por pagar presencialmente no momento do serviço"})]}),e.jsxs("div",{className:"mb-6 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("h4",{className:"text-sm font-medium text-yellow-800 flex items-center",children:[e.jsx(z,{className:"w-4 h-4 mr-1"}),"Informações importantes"]}),e.jsxs("ul",{className:"text-sm text-yellow-700 mt-2 list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"O pagamento será feito diretamente ao prestador de serviço"}),e.jsx("li",{children:"Tenha o valor exato para facilitar o troco"}),e.jsx("li",{children:"Solicite sempre o recibo de pagamento"})]})]}),e.jsxs("div",{className:"bg-white p-3 border border-neutral-200 rounded-lg mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm",children:"Valor a pagar:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",x.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Serviço:"}),e.jsx("span",{className:"text-sm text-neutral-600",children:j})]})]}),e.jsx(g,{onClick:n,className:"w-full",children:"Confirmar pagamento presencial"})]})})};function Ee(){const[x,j]=c.useState(null),[a,t]=c.useState(null),[n,r]=c.useState(!0),[o,h]=c.useState("card");f();const p=new URLSearchParams(window.location.search),s=parseFloat(p.get("amount")||"0"),i=p.get("description")||"Pagamento de serviço",l=p.get("appointmentId"),u=p.get("method")||"card";return c.useEffect(()=>{if(h(u),!s||s<=0){t("Valor de pagamento inválido"),r(!1);return}u==="card"?(async()=>{try{const P=await(await Q("POST","/api/create-payment-intent",{amount:s,description:i,appointmentId:l})).json();P.clientSecret?j(P.clientSecret):t("Não foi possível iniciar o pagamento")}catch(d){t(d.message||"Erro ao inicializar pagamento")}finally{r(!1)}})():r(!1)},[s,i,l,u]),e.jsxs("div",{className:"pb-20",children:[e.jsx(V,{title:"Pagamento",showBackButton:!0,backButtonAction:()=>window.history.back()}),e.jsx(G,{children:e.jsx("div",{className:"p-4 max-w-md mx-auto",children:e.jsxs(T,{children:[e.jsxs($,{children:[e.jsx(A,{children:"Escolha como pagar"}),e.jsx(O,{children:"Selecione o método de pagamento de sua preferência"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium mb-2 text-neutral-500",children:"RESUMO DO PEDIDO"}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{children:i}),e.jsxs("span",{className:"font-medium",children:["R$ ",s.toFixed(2)]})]}),e.jsx(D,{className:"my-2"}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["R$ ",s.toFixed(2)]})]})]}),e.jsxs(_,{defaultValue:o,value:o,onValueChange:m=>h(m),className:"w-full",children:[e.jsxs(q,{className:"grid grid-cols-1 sm:grid-cols-3 mb-6",children:[e.jsxs(N,{value:"card",className:"flex items-center gap-1 text-xs sm:text-sm",children:[e.jsx(y,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Cartão"}),e.jsx("span",{className:"sm:hidden",children:"Cartão"})]}),e.jsxs(N,{value:"pix",className:"flex items-center gap-1 text-xs sm:text-sm",children:[e.jsx(v,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"PIX"}),e.jsx("span",{className:"sm:hidden",children:"PIX"})]}),e.jsxs(N,{value:"cash",className:"flex items-center gap-1 text-xs sm:text-sm",children:[e.jsx(I,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Dinheiro"}),e.jsx("span",{className:"sm:hidden",children:"Dinheiro"})]})]}),e.jsx(b,{value:"card",children:n?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(C,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-2",children:"Carregando pagamento..."})]}):a?e.jsxs("div",{className:"bg-red-50 text-red-600 p-4 rounded-lg",children:[e.jsx("p",{className:"font-semibold",children:"Erro"}),e.jsx("p",{children:a})]}):x?e.jsx(E,{stripe:U,options:{clientSecret:x,appearance:{theme:"stripe",variables:{colorPrimary:"#7c3aed"}}},children:e.jsx(M,{amount:s,description:i,appointmentId:l||void 0})}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{children:"Não foi possível inicializar o pagamento com cartão."})})}),e.jsx(b,{value:"pix",children:e.jsx(H,{amount:s,description:i,appointmentId:l||void 0})}),e.jsx(b,{value:"cash",children:e.jsx(J,{amount:s,description:i,appointmentId:l||void 0})})]})]}),e.jsx(L,{className:"flex-col space-y-2",children:e.jsxs("div",{className:"w-full text-center text-xs text-neutral-500",children:[o==="card"&&"Pagamentos com cartão processados com segurança via Stripe",o==="pix"&&"PIX é um método de pagamento instantâneo do Banco Central do Brasil",o==="cash"&&"Você será cobrado pelo prestador no momento do serviço"]})})]})})})]})}export{Ee as default};
