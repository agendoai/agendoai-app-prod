import{r as c,a as f,j as e,C as R,f as B,g as E,h as F,i as X,e as C,k,l as A,c as y}from"./index-BdrEJuYD.js";import{E as T,u as $,a as O,P as G}from"./react-stripe.esm-BtM4KWPL.js";import{l as L}from"./index-C8r34K29.js";import{B as g}from"./button-CynjWJoH.js";import{P as Q}from"./page-transition-CTpfF0H5.js";import{A as z}from"./app-header-HnU5DY7s.js";import{S as D}from"./separator-QYEpahfh.js";import{T as V,a as U,b as N,c as b}from"./tabs-Dh7LOHW3.js";import{C as w}from"./credit-card-dV_1iaRW.js";import{Q as v}from"./qr-code-B85NaMFy.js";import{B as I}from"./banknote-29TU5Mjs.js";import{C as S}from"./circle-check-big-CiI_Z36v.js";import{C as q}from"./clock-BTnG-tJG.js";import"./index-BcAyG2lq.js";import"./proxy-C6NuY9h3.js";import"./avatar-YOIRMJBI.js";import"./badge-muy4ZFs4.js";import"./dropdown-menu-DWmQMH9U.js";import"./index-YY5r1pln.js";import"./index-DTy3TPQv.js";import"./index-Bg9Ro7l2.js";import"./index-CeeqZ7YQ.js";import"./index-BoRtQnRr.js";import"./index-BYdWi_2u.js";import"./chevron-right-DQzs9QCW.js";import"./check-WTIUe9ha.js";import"./circle-CB07NW__.js";import"./arrow-left-nRi6-7bo.js";import"./bell-DPzU_a_S.js";import"./ellipsis-vertical-BhTX8B4K.js";import"./house-CU2aGGLt.js";import"./calendar-CiGw-_KP.js";import"./user-DCpoqoA-.js";import"./settings-Derag0Pt.js";import"./circle-help-cap19nX6.js";import"./message-square-kvDXS4V3.js";import"./log-out-9hU1A0cG.js";const M=L("pk_test_51RkqXrRr6s3UmWYUrWgAlgej5ir5MpLUjjpQLkGPeHeg8vy3ZJAbIttYkjR3EzrI9zzvFgI6lPRMZhGj55NnIFYF00F1YurTA7"),_=({amount:p,description:j,appointmentId:a})=>{const t=$(),i=O(),[r,o]=c.useState(!1),[h,x]=c.useState(!1),{toast:s}=y(),[,n]=f(),l=async u=>{if(u.preventDefault(),!(!t||!i)){o(!0);try{const{error:m,paymentIntent:d}=await t.confirmPayment({elements:i,confirmParams:{return_url:`${window.location.origin}/client/payment-success${a?`?appointmentId=${a}`:""}`},redirect:"if_required"});m?(s({title:"Falha no pagamento",description:m.message||"Ocorreu um erro ao processar o pagamento",variant:"destructive"}),o(!1)):(x(!0),s({title:"Pagamento concluído",description:"Seu pagamento foi processado com sucesso!"}),n(`/client/payment-success?payment_intent=${(d==null?void 0:d.id)||""}${a?`&appointmentId=${a}`:""}`))}catch(m){s({title:"Erro no processamento",description:m.message||"Ocorreu um erro ao processar o pagamento",variant:"destructive"}),o(!1)}}};return h?e.jsxs("div",{className:"text-center py-10",children:[e.jsx(S,{className:"w-16 h-16 mx-auto text-green-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"Pagamento Concluído"}),e.jsx("p",{className:"text-neutral-600 mb-6",children:"Seu pagamento foi processado com sucesso!"}),e.jsx("p",{className:"text-neutral-600 mb-6",children:"Redirecionando..."})]}):e.jsxs("form",{onSubmit:l,className:"space-y-6",children:[e.jsx("div",{className:"p-4 bg-neutral-50 rounded-lg",children:e.jsx(G,{})}),e.jsx(g,{type:"submit",className:"w-full py-6",disabled:!t||!i||r,children:r?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),"Pagar R$ ",p.toFixed(2)]})})]})},Y=({amount:p,description:j,appointmentId:a})=>{const[t,i]=c.useState(!1),[r,o]=c.useState(null),[h,x]=c.useState(null),{toast:s}=y(),[,n]=f(),l=async()=>{i(!0);try{await new Promise(d=>setTimeout(d,2e3)),o("00020126580014BR.GOV.BCB.PIX0136example@email.com52040000530398654040.005802BR5913Agendo AI6008Sao Paulo62070503***6304A1B2"),x("https://chart.googleapis.com/chart?cht=qr&chl=00020126580014BR.GOV.BCB.PIX0136example@email.com52040000530398654040.005802BR5913Agendo+AI6008Sao+Paulo62070503***6304A1B2&chs=300x300"),s({title:"PIX gerado com sucesso",description:"Escaneie o QR Code ou copie o código PIX"})}catch{s({title:"Erro ao gerar PIX",description:"Não foi possível gerar o QR Code para pagamento PIX",variant:"destructive"})}finally{i(!1)}},u=()=>{r&&(navigator.clipboard.writeText(r),s({title:"Código copiado!",description:"O código PIX foi copiado para sua área de transferência"}))},m=()=>{n(`/client/payment-success?method=pix${a?`&appointmentId=${a}`:""}`)};return e.jsx("div",{className:"space-y-6 py-2",children:r?e.jsxs("div",{className:"bg-neutral-50 p-4 rounded-lg text-center",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"PIX Gerado"}),h&&e.jsx("div",{className:"mb-4 flex justify-center",children:e.jsx("img",{src:h,alt:"QR Code PIX",className:"w-40 h-40 mx-auto border border-neutral-200 rounded"})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-neutral-500 mb-1",children:"CÓDIGO PIX COPIA E COLA"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"p-2 bg-white border border-neutral-200 rounded text-xs text-neutral-700 break-all overflow-hidden max-h-20 overflow-y-auto",children:r}),e.jsx(g,{size:"sm",variant:"outline",className:"absolute top-2 right-2 h-6 text-xs py-0 px-2",onClick:u,children:"Copiar"})]})]}),e.jsxs("div",{className:"text-sm text-neutral-700 mb-4",children:[e.jsx("p",{className:"mb-2",children:"1. Abra o aplicativo do seu banco"}),e.jsx("p",{className:"mb-2",children:"2. Escolha pagar com PIX"}),e.jsx("p",{className:"mb-2",children:"3. Escaneie o QR Code ou cole o código"}),e.jsxs("p",{className:"mb-2",children:["4. Confirme o valor de ",e.jsxs("strong",{children:["R$ ",p.toFixed(2)]})]})]}),e.jsx("p",{className:"text-xs text-neutral-500 mb-4",children:"Após realizar o pagamento, clique no botão abaixo para continuar"}),e.jsxs(g,{onClick:m,className:"w-full",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Já realizei o pagamento"]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg-neutral-50 p-4 rounded-lg text-center",children:[e.jsx(v,{className:"w-16 h-16 mx-auto text-primary mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"Pagamento via PIX"}),e.jsx("p",{className:"text-sm text-neutral-600 mb-4",children:"Gere um QR Code para pagamento instantâneo via PIX"}),e.jsx(g,{onClick:l,className:"w-full",disabled:t,children:t?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Gerando PIX..."]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-2 h-4 w-4"}),"Gerar QR Code PIX"]})})]})})})},H=({amount:p,description:j,appointmentId:a})=>{const[,t]=f(),i=()=>{t(`/client/payment-success?method=cash${a?`&appointmentId=${a}`:""}`)};return e.jsx("div",{className:"space-y-6 py-2",children:e.jsxs("div",{className:"bg-neutral-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx(I,{className:"w-16 h-16 mx-auto text-green-600 mb-3"}),e.jsx("h3",{className:"text-lg font-medium",children:"Pagamento Presencial"}),e.jsx("p",{className:"text-sm text-neutral-600 mt-1",children:"Você optou por pagar presencialmente no momento do serviço"})]}),e.jsxs("div",{className:"mb-6 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("h4",{className:"text-sm font-medium text-yellow-800 flex items-center",children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),"Informações importantes"]}),e.jsxs("ul",{className:"text-sm text-yellow-700 mt-2 list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"O pagamento será feito diretamente ao prestador de serviço"}),e.jsx("li",{children:"Tenha o valor exato para facilitar o troco"}),e.jsx("li",{children:"Solicite sempre o recibo de pagamento"})]})]}),e.jsxs("div",{className:"bg-white p-3 border border-neutral-200 rounded-lg mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm",children:"Valor a pagar:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",p.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Serviço:"}),e.jsx("span",{className:"text-sm text-neutral-600",children:j})]})]}),e.jsx(g,{onClick:i,className:"w-full",children:"Confirmar pagamento presencial"})]})})};function ke(){const[p,j]=c.useState(null),[a,t]=c.useState(null),[i,r]=c.useState(!0),[o,h]=c.useState("card");f();const x=new URLSearchParams(window.location.search),s=parseFloat(x.get("amount")||"0"),n=x.get("description")||"Pagamento de serviço",l=x.get("appointmentId"),u=x.get("method")||"card";return c.useEffect(()=>{if(h(u),!s||s<=0){t("Valor de pagamento inválido"),r(!1);return}u==="card"?(async()=>{try{const P=await(await A("POST","/api/create-payment-intent",{amount:s,description:n,appointmentId:l})).json();P.clientSecret?j(P.clientSecret):t("Não foi possível iniciar o pagamento")}catch(d){t(d.message||"Erro ao inicializar pagamento")}finally{r(!1)}})():r(!1)},[s,n,l,u]),e.jsxs("div",{className:"pb-20",children:[e.jsx(z,{title:"Pagamento",showBackButton:!0,backButtonAction:()=>window.history.back()}),e.jsx(Q,{children:e.jsx("div",{className:"p-4 max-w-md mx-auto",children:e.jsxs(R,{children:[e.jsxs(B,{children:[e.jsx(E,{children:"Escolha como pagar"}),e.jsx(F,{children:"Selecione o método de pagamento de sua preferência"})]}),e.jsxs(X,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium mb-2 text-neutral-500",children:"RESUMO DO PEDIDO"}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{children:n}),e.jsxs("span",{className:"font-medium",children:["R$ ",s.toFixed(2)]})]}),e.jsx(D,{className:"my-2"}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["R$ ",s.toFixed(2)]})]})]}),e.jsxs(V,{defaultValue:o,value:o,onValueChange:m=>h(m),className:"w-full",children:[e.jsxs(U,{className:"grid grid-cols-1 sm:grid-cols-3 mb-6",children:[e.jsxs(N,{value:"card",className:"flex items-center gap-1 text-xs sm:text-sm",children:[e.jsx(w,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Cartão"}),e.jsx("span",{className:"sm:hidden",children:"Cartão"})]}),e.jsxs(N,{value:"pix",className:"flex items-center gap-1 text-xs sm:text-sm",children:[e.jsx(v,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"PIX"}),e.jsx("span",{className:"sm:hidden",children:"PIX"})]}),e.jsxs(N,{value:"cash",className:"flex items-center gap-1 text-xs sm:text-sm",children:[e.jsx(I,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Dinheiro"}),e.jsx("span",{className:"sm:hidden",children:"Dinheiro"})]})]}),e.jsx(b,{value:"card",children:i?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(C,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-2",children:"Carregando pagamento..."})]}):a?e.jsxs("div",{className:"bg-red-50 text-red-600 p-4 rounded-lg",children:[e.jsx("p",{className:"font-semibold",children:"Erro"}),e.jsx("p",{children:a})]}):p?e.jsx(T,{stripe:M,options:{clientSecret:p,appearance:{theme:"stripe",variables:{colorPrimary:"#7c3aed"}}},children:e.jsx(_,{amount:s,description:n,appointmentId:l||void 0})}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{children:"Não foi possível inicializar o pagamento com cartão."})})}),e.jsx(b,{value:"pix",children:e.jsx(Y,{amount:s,description:n,appointmentId:l||void 0})}),e.jsx(b,{value:"cash",children:e.jsx(H,{amount:s,description:n,appointmentId:l||void 0})})]})]}),e.jsx(k,{className:"flex-col space-y-2",children:e.jsxs("div",{className:"w-full text-center text-xs text-neutral-500",children:[o==="card"&&"Pagamentos com cartão processados com segurança via Stripe",o==="pix"&&"PIX é um método de pagamento instantâneo do Banco Central do Brasil",o==="cash"&&"Você será cobrado pelo prestador no momento do serviço"]})})]})})})]})}export{ke as default};
