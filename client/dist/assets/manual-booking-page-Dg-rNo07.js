import{j as e}from"./ui-UIpCtT3r.js";import{r,a as Ge}from"./vendor-vA4cx1mx.js";import{u as He}from"./router-CxXythJb.js";import{j as Ke,u as Qe,b as Je,c as be,a1 as We,i as M,C as ye,g as Se,p as X,B as j,m as Xe,q as we}from"./index-C8-zpcKL.js";import{u as Ce}from"./useMutation-P96WDC87.js";import{u as _,t as U,o as O,s as x,l as Ee,d as Ye,b as Ze}from"./zod-BPPSwYm9.js";import{S as Y}from"./scissors-icon-CAXGYzG6.js";import{P as et}from"./page-transition-DPJ0INUt.js";import{P as tt}from"./provider-layout-DUNiDEkI.js";import{R as G,a as A}from"./radio-group-Bf1lSPJM.js";import{L as g}from"./label-BIAKwpsc.js";import{I as H}from"./input-IX-Ccd3C.js";import{T as st}from"./textarea-C9AGRwtx.js";import{F as K,a as f,b as v,e as N,c as b,d as R}from"./form-Bw-fjiTK.js";import{T as at,a as it,b as Te,c as Ie}from"./tabs-BhZpxXQ2.js";import{N as nt}from"./navbar-vyjn30u5.js";import{C as Z}from"./circle-check-big-D7Qp6nDu.js";import{C as ee}from"./calendar-CEG0wbcY.js";import{C as rt}from"./clock-53JnXU7l.js";import{a as ot}from"./addDays-BQ37Zmqx.js";import{f as C}from"./format-CGvBu07F.js";import{p as te}from"./parseISO-C4T3oArM.js";import{p as L}from"./pt-BR-Cxqo7XV3.js";import"./proxy-B2Nma8Bt.js";import"./arrow-left-DbtXU75N.js";import"./index-BH3L9zMK.js";import"./circle-DyW2RO_p.js";import"./search-ChrBAPJG.js";import"./calendar-check-B0nV5Uhw.js";import"./user-CXc1AnQW.js";import"./en-US-xSPtgCq_.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=Ke("UserRound",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]),lt=[{id:1,name:"Serviço"},{id:2,name:"Data/Hora"},{id:3,name:"Cliente"},{id:4,name:"Confirmar"}],ct=O({providerServiceId:x({required_error:"Selecione um serviço"})}),dt=O({date:x({required_error:"Selecione uma data"}),time:x({required_error:"Selecione um horário"})}),mt=O({clientType:Ee("existing"),clientId:x({required_error:"Selecione um cliente existente"}),clientName:x().optional(),clientEmail:x().optional(),clientPhone:x().optional()}),ut=O({clientType:Ee("new"),clientId:x().optional(),clientName:x({required_error:"Nome do cliente é obrigatório"}),clientEmail:x({required_error:"Email do cliente é obrigatório"}).email("Email inválido"),clientPhone:x({required_error:"Telefone do cliente é obrigatório"})}),xt=Ye("clientType",[mt,ut]),pt=O({notes:x().optional(),sendNotification:Ze().default(!0)});function Qt(){const[,se]=He(),{user:o}=Qe(),{toast:l}=Je(),[p,y]=r.useState(1),[$e,ae]=r.useState(!1),[Pe,ie]=r.useState(null),[n,q]=r.useState({providerServiceId:"",date:"",time:"",clientType:"existing",clientId:"",clientName:"",clientEmail:"",clientPhone:"",notes:"",sendNotification:!0}),[S,ht]=r.useState(!0),z=_({resolver:U(ct),defaultValues:{providerServiceId:n.providerServiceId}}),h=_({resolver:U(dt),defaultValues:{date:n.date,time:n.time}}),w=_({resolver:U(xt),defaultValues:{clientType:n.clientType,clientId:n.clientId,clientName:n.clientName,clientEmail:n.clientEmail,clientPhone:n.clientPhone}}),$=_({resolver:U(pt),defaultValues:{notes:n.notes,sendNotification:n.sendNotification}}),{data:Q=[],isLoading:De}=be({queryKey:[`/api/provider-services/provider/${o==null?void 0:o.id}`],enabled:!!(o!=null&&o.id)}),B=Ge.useMemo(()=>Q.map(t=>({id:t.id,serviceId:t.serviceId,name:t.serviceName,description:t.serviceDescription||"",duration:t.executionTime||30,price:t.price,categoryId:t.categoryId,providerId:t.providerId,isActive:!0})),[Q]),ne=De,a=B.find(t=>t.id.toString()===n.providerServiceId),ke=Array.from({length:7}).map((t,s)=>{const i=ot(new Date,s);return{value:C(i,"yyyy-MM-dd"),label:C(i,"EEE, dd/MM",{locale:L}),day:C(i,"dd",{locale:L})}}),{data:P=[],isLoading:Fe}=be({queryKey:["/api/clients"],enabled:!!o}),[re,oe]=r.useState([]),[jt,le]=r.useState(!1),[ce,de]=r.useState([]),[Me,me]=r.useState(!1),[T,Ae]=r.useState(""),[ue,D]=r.useState([]),[Re,xe]=r.useState(!1),[pe,k]=r.useState(""),[I,he]=r.useState(null),E=We("09:00","18:00",30).map(t=>({value:t,label:t})),je=r.useCallback(async t=>{if(!t||t.trim().length===0){D([]),k("");return}if(t.replace(/\D/g,"").length<8){k("Digite pelo menos 8 dígitos para buscar"),D([]);return}try{xe(!0),k("");const i=await M("GET",`/api/clients/search?q=${encodeURIComponent(t.trim())}`);if(!i.ok){const d=await i.json();throw new Error(d.error||"Falha ao buscar clientes")}const c=await i.json();D(c.clients||[])}catch(i){console.error("Erro ao buscar clientes:",i),k(i instanceof Error?i.message:"Erro ao buscar clientes"),D([])}finally{xe(!1)}},[]);r.useEffect(()=>{const t=setTimeout(()=>{T.trim().length>=8?je(T):(D([]),k(""))},500);return()=>clearTimeout(t)},[T,je]);const fe=r.useCallback(async(t,s)=>{var i;if(!(!(o!=null&&o.id)||!t||!s))try{me(!0),console.log(`Buscando time slots para prestador ${o.id}, data ${t}, serviço ${s}`);const c=await M("GET",`/api/time-slots?providerId=${o.id}&date=${t}&serviceId=${s}`);if(!c.ok)throw new Error("Falha ao buscar time slots");const d=await c.json();console.log("Resposta da API time-slots:",d);const u=((i=d.timeSlots)==null?void 0:i.map(m=>({value:m.startTime,label:m.startTime,adaptationScore:m.adaptationScore,adaptationReason:m.adaptationReason})))||[];console.log("Slots formatados:",u),de(u)}catch(c){console.error("Erro ao buscar time slots do prestador:",c),l({title:"Aviso",description:"Não foi possível buscar os horários do prestador. Usando horários padrão.",variant:"default"}),de(E)}finally{me(!1)}},[o,l,E]),ve=r.useCallback(async(t,s)=>{if(!(!(o!=null&&o.id)||!t||!s))try{le(!0);const i=E.map(m=>({startTime:m.value,endTime:F(m.value,30),isAvailable:!0})),u=(await(await M("POST","/api/provider-agenda/optimize",{providerId:o.id,date:t,serviceId:parseInt(s),timeSlots:i})).json()).map(m=>({startTime:m.startTime,endTime:m.endTime,isAvailable:!0,adaptationScore:m.adaptationScore,adaptationReason:m.adaptationReason}));oe(u)}catch(i){console.error("Erro ao otimizar slots:",i),l({title:"Aviso",description:"Não foi possível otimizar os horários com IA. Usando horários padrão.",variant:"default"});const c=E.map(d=>({startTime:d.value,endTime:F(d.value,(a==null?void 0:a.duration)||30),isAvailable:!0}));oe(c)}finally{le(!1)}},[o,l,E,a==null?void 0:a.duration]);r.useEffect(()=>{const t=h.watch((s,{name:i})=>{i==="date"&&s.date&&n.providerServiceId&&a&&(console.log("Data alterada, buscando time slots do prestador"),fe(s.date,a.serviceId.toString()))});return()=>t.unsubscribe()},[h,fe,n.providerServiceId,a]),r.useEffect(()=>{const t=h.watch((s,{name:i})=>{i==="date"&&s.date&&S&&a&&(console.log("Data alterada, buscando slots otimizados"),ve(s.date,a.serviceId.toString()))});return()=>t.unsubscribe()},[h]);const ge=r.useRef(S);r.useEffect(()=>{if(ge.current!==S){const t=h.getValues("date");S&&t&&a&&(console.log("Status de IA alterado, buscando slots otimizados"),ve(t,a.serviceId.toString())),ge.current=S}},[S]);const Ne=ce.length>0?ce:S&&re.length>0?re.map(t=>({value:t.startTime,label:t.startTime,adaptationScore:t.adaptationScore,adaptationReason:t.adaptationReason})):E,Le=Ce({mutationFn:async t=>(await M("POST","/api/register",t)).json(),onSuccess:()=>{l({title:"Cliente criado",description:"Novo cliente registrado com sucesso."})},onError:t=>{l({title:"Erro ao criar cliente",description:t.message||"Não foi possível criar o novo cliente.",variant:"destructive"})}}),J=Ce({mutationFn:async t=>await(await M("POST","/api/appointments",t)).json(),onSuccess:t=>{we.invalidateQueries({queryKey:["/api/appointments"]}),ie(t),ae(!0),l({title:"Agendamento criado",description:"O agendamento manual foi criado com sucesso."})},onError:t=>{l({title:"Erro ao agendar",description:t.message||"Não foi possível criar o agendamento manual.",variant:"destructive"})}});P.filter(t=>{var i,c,d;if(!T)return!0;const s=T.toLowerCase();return((i=t.name)==null?void 0:i.toLowerCase().includes(s))||((c=t.email)==null?void 0:c.toLowerCase().includes(s))||((d=t.phone)==null?void 0:d.toLowerCase().includes(s))});const Ve=t=>{q({...n,providerServiceId:t.providerServiceId}),n.date||h.setValue("date",C(new Date,"yyyy-MM-dd")),y(2)},Oe=t=>{if(console.log("Dados de data/hora selecionados:",t),!t.date){l({title:"Data não selecionada",description:"Selecione uma data para o agendamento",variant:"destructive"});return}if(!t.time){l({title:"Horário não selecionado",description:"Selecione um horário para o agendamento",variant:"destructive"});return}q({...n,date:t.date,time:t.time}),l({title:"Data e hora selecionadas",description:`${C(te(t.date),"dd/MM/yyyy",{locale:L})} às ${t.time}`}),y(3)},qe=t=>{if(console.log("Cliente selecionado:",t),q({...n,clientType:t.clientType,clientId:t.clientId,clientName:t.clientName,clientEmail:t.clientEmail,clientPhone:t.clientPhone}),t.clientType==="existing"&&t.clientId){const s=P.find(i=>i.id.toString()===t.clientId);he(s||null)}else he({name:t.clientName,email:t.clientEmail,phone:t.clientPhone});y(4),l({title:"Cliente selecionado",description:t.clientType==="existing"?`Cliente existente ID: ${t.clientId}`:`Novo cliente: ${t.clientName}`})},ze=async t=>{const s={...n,notes:t.notes,sendNotification:t.sendNotification};try{let i;if(s.clientType==="existing"&&s.clientId)i=parseInt(s.clientId);else if(s.clientType==="new"&&s.clientName&&s.clientEmail)try{const u={name:s.clientName,email:s.clientEmail,phone:s.clientPhone||"",password:Math.random().toString(36).substring(2,10),userType:"client"};i=(await Le.mutateAsync(u)).id,we.invalidateQueries({queryKey:["/api/clients"]})}catch(u){console.error("Erro ao criar cliente:",u),l({title:"Erro ao criar cliente",description:"Não foi possível criar o novo cliente. O email pode já estar em uso.",variant:"destructive"});return}else{l({title:"Erro ao agendar",description:"Informações de cliente incompletas.",variant:"destructive"});return}if(console.log("Dados completos para agendamento:",s),!s.date){l({title:"Erro no agendamento",description:"A data do agendamento não foi selecionada. Volte para a etapa 2.",variant:"destructive"}),y(2);return}const c=Q.find(u=>u.id.toString()===s.providerServiceId);if(!c){l({title:"Erro no agendamento",description:"Serviço não encontrado. Por favor, selecione um serviço válido.",variant:"destructive"}),y(1);return}const d={providerId:o==null?void 0:o.id,serviceId:c.serviceId,providerServiceId:parseInt(s.providerServiceId),date:s.date,startTime:s.time,endTime:F(s.time,(a==null?void 0:a.duration)||30),status:"confirmed",notes:s.notes,isManuallyCreated:!0,clientId:i,duration:(a==null?void 0:a.duration)||30,sendNotification:s.sendNotification,clientName:s.clientType==="new"?s.clientName:void 0,clientEmail:s.clientType==="new"?s.clientEmail:void 0,clientPhone:s.clientType==="new"?s.clientPhone:void 0};console.log("Dados enviados para API:",d),J.mutate(d)}catch(i){console.error("Erro no processo de agendamento:",i),l({title:"Erro ao agendar",description:"Ocorreu um erro inesperado ao processar o agendamento.",variant:"destructive"})}},F=(t,s)=>{const[i,c]=t.split(":").map(Number),u=i*60+c+s,m=Math.floor(u/60),Ue=u%60;return`${m.toString().padStart(2,"0")}:${Ue.toString().padStart(2,"0")}`},W=()=>{p>1?y(p-1):se("/provider/dashboard")},Be=()=>{se("/provider/dashboard")},_e=()=>{ae(!1),ie(null),y(1),q({providerServiceId:"",date:"",time:"",clientType:"existing",clientId:"",clientName:"",clientEmail:"",clientPhone:"",notes:"",sendNotification:!0}),z.reset({providerServiceId:""}),h.reset({date:"",time:""}),w.reset({clientType:"existing",clientId:"",clientName:"",clientEmail:"",clientPhone:""}),$.reset({notes:"",sendNotification:!0})};return e.jsxs(tt,{title:"Novo Agendamento",showBackButton:!0,children:[e.jsx(et,{children:e.jsx("div",{className:"w-full max-w-md mx-auto bg-white min-h-screen px-4 py-6",children:$e&&Pe?e.jsxs("div",{className:"text-center py-8 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Z,{className:"h-8 w-8 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-center mb-2 text-neutral-900",children:"Agendamento Confirmado!"}),e.jsx("p",{className:"text-neutral-600 text-center mb-8",children:"O agendamento foi criado com sucesso e o cliente foi notificado."}),e.jsx(ye,{className:"w-full mb-8 bg-white border border-neutral-200 rounded-xl shadow-sm",children:e.jsx(Se,{className:"pt-6 p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-[#58c9d1]/10 rounded-lg mr-3 flex items-center justify-center",children:e.jsx(Y,{className:"h-5 w-5 text-[#58c9d1]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-neutral-900",children:a==null?void 0:a.name}),e.jsxs("p",{className:"text-sm text-neutral-600",children:[a==null?void 0:a.duration," min • ",X((a==null?void 0:a.price)||0)]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-[#58c9d1]/10 rounded-lg mr-3 flex items-center justify-center",children:e.jsx(ee,{className:"h-5 w-5 text-[#58c9d1]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-neutral-900",children:n.date&&C(te(n.date),"dd 'de' MMMM",{locale:L})}),e.jsx("p",{className:"text-sm text-neutral-600",children:n.time&&`${n.time} - ${F(n.time,(a==null?void 0:a.duration)||30)}`})]})]})]})})}),e.jsxs("div",{className:"flex flex-col w-full space-y-3",children:[e.jsx(j,{onClick:_e,className:"w-full bg-[#58c9d1] text-white hover:bg-[#58c9d1]/90",children:"Novo Agendamento"}),e.jsx(j,{variant:"outline",onClick:Be,className:"w-full border-neutral-200 text-neutral-700 hover:bg-neutral-50",children:"Voltar ao Dashboard"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"py-3 border-b border-neutral-200 bg-white",children:e.jsx("div",{className:"flex items-center justify-between px-2",children:lt.map(t=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-7 h-7 rounded-full flex items-center justify-center text-sm ${t.id===p?"bg-[#58c9d1] text-white":t.id<p?"bg-[#58c9d1]/20 text-[#58c9d1]":"bg-neutral-200 text-neutral-500"}`,children:t.id<p?e.jsx(Z,{className:"h-4 w-4"}):t.id}),e.jsx("span",{className:`text-xs mt-1 px-1 text-center ${t.id===p||t.id<p?"text-[#58c9d1]":"text-neutral-500"}`,children:t.name})]},t.id))})}),e.jsxs("div",{className:"px-3 py-4 bg-white",children:[p===1&&e.jsx(K,{...z,children:e.jsxs("form",{onSubmit:z.handleSubmit(Ve),className:"space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3 text-neutral-900",children:"Selecione o serviço"}),e.jsx(f,{control:z.control,name:"providerServiceId",render:({field:t})=>e.jsxs(v,{children:[e.jsx("div",{className:"space-y-3",children:e.jsx(G,{onValueChange:t.onChange,defaultValue:t.value,className:"flex flex-col space-y-1",children:ne?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#58c9d1] mx-auto"}),e.jsx("p",{className:"text-neutral-600 mt-2",children:"Carregando serviços..."})]}):B.length>0?B.map(s=>e.jsxs(g,{htmlFor:`service-${s.id}`,className:`w-full flex items-center justify-between p-2 rounded-lg border transition-all ${t.value===s.id.toString()?"bg-[#58c9d1]/5 border-[#58c9d1] shadow-sm":"border-neutral-200 hover:border-neutral-300"}`,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-[#58c9d1]/10 rounded-lg mr-3 flex items-center justify-center",children:e.jsx(Y,{className:"h-4 w-4 text-[#58c9d1]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-neutral-900",children:s.name}),e.jsxs("p",{className:"text-sm text-neutral-600",children:[s.duration," min • ",X(s.price||0)]})]})]}),e.jsx(A,{value:s.id.toString(),id:`service-${s.id}`})]},s.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Xe,{className:"h-12 w-12 text-neutral-400 mx-auto mb-3"}),e.jsx("p",{className:"text-neutral-600",children:"Nenhum serviço encontrado."}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"Adicione serviços no seu perfil."})]})})}),e.jsx(N,{})]})}),e.jsx(j,{type:"submit",className:"w-full mt-4 bg-[#58c9d1] text-white hover:bg-[#58c9d1]/90",disabled:ne||B.length===0,children:"Continuar"})]})}),p===2&&a&&e.jsx(K,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(Oe),className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(ee,{className:"h-5 w-5 mr-2 text-primary"}),e.jsx("h2",{className:"font-medium",children:"Selecione data e horário"})]}),e.jsx(f,{control:h.control,name:"date",render:({field:t})=>e.jsxs(v,{children:[e.jsx(b,{children:"Data"}),e.jsx(G,{onValueChange:t.onChange,defaultValue:t.value,className:"grid grid-cols-2 gap-2",children:ke.map(s=>e.jsxs(g,{htmlFor:`date-${s.value}`,className:`flex flex-col items-center p-3 rounded-lg border cursor-pointer transition-all ${t.value===s.value?"bg-[#58c9d1]/5 border-[#58c9d1]":"border-neutral-200 hover:border-neutral-300"}`,children:[e.jsx("span",{className:"text-sm font-medium text-neutral-900",children:s.label}),e.jsx("span",{className:"text-xs text-neutral-600",children:s.day}),e.jsx(A,{value:s.value,id:`date-${s.value}`})]},s.value))}),e.jsx(N,{})]})}),e.jsx(f,{control:h.control,name:"time",render:({field:t})=>e.jsxs(v,{children:[e.jsx(b,{children:"Horário"}),Me?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#58c9d1] mx-auto"}),e.jsx("p",{className:"text-neutral-600 mt-2",children:"Carregando horários do prestador..."})]}):Ne.length>0?e.jsx(G,{onValueChange:t.onChange,defaultValue:t.value,className:"grid grid-cols-3 gap-2",children:Ne.map((s,i)=>e.jsxs(g,{htmlFor:`time-${s.value}-${i}`,className:`flex flex-col items-center p-2 rounded-lg border cursor-pointer transition-all ${t.value===s.value?"bg-[#58c9d1]/5 border-[#58c9d1]":"border-neutral-200 hover:border-neutral-300"}`,children:[e.jsx("span",{className:"text-sm font-medium text-neutral-900",children:s.label}),s.adaptationScore&&e.jsx("span",{className:"text-xs text-neutral-600",children:s.adaptationReason}),e.jsx(A,{value:s.value,id:`time-${s.value}-${i}`})]},`${s.value}-${i}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(rt,{className:"h-12 w-12 text-neutral-400 mx-auto mb-3"}),e.jsx("p",{className:"text-neutral-600",children:"Nenhum horário disponível."}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"Configure sua agenda primeiro."})]}),e.jsx(N,{})]})}),e.jsxs("div",{className:"flex space-x-2 pt-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:W,className:"flex-1",children:"Voltar"}),e.jsx(j,{type:"submit",className:"flex-1 bg-[#58c9d1] text-white hover:bg-[#58c9d1]/90",children:"Continuar"})]})]})}),p===3&&e.jsx(K,{...w,children:e.jsxs("form",{onSubmit:w.handleSubmit(qe),className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(V,{className:"h-5 w-5 mr-2 text-primary"}),e.jsx("h2",{className:"font-medium",children:"Informações do cliente"})]}),e.jsxs(at,{defaultValue:"existing",className:"w-full",children:[e.jsxs(it,{className:"grid w-full grid-cols-2",children:[e.jsx(Te,{value:"existing",children:"Cliente existente"}),e.jsx(Te,{value:"new",children:"Novo cliente"})]}),e.jsxs(Ie,{value:"existing",className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx(g,{htmlFor:"clientSearch",className:"text-sm font-medium text-neutral-700",children:"Buscar cliente por CPF ou telefone"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{id:"clientSearch",type:"text",placeholder:"Digite CPF ou telefone (mínimo 8 dígitos)",value:T,onChange:t=>Ae(t.target.value),className:"pr-10"}),Re&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[#58c9d1]"})})]}),pe&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:pe})]})}),e.jsx("div",{className:"border-t pt-4",children:e.jsx(f,{control:w.control,name:"clientId",render:({field:t})=>e.jsxs(v,{children:[e.jsx(b,{children:"Ou selecione da lista completa"}),e.jsxs(G,{onValueChange:t.onChange,value:t.value,className:"space-y-1",children:[ue.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-3",children:e.jsx(g,{className:"text-sm font-medium text-neutral-700",children:"Clientes encontrados"})}),ue.map(s=>e.jsxs(g,{htmlFor:`searched-client-${s.id}`,className:`w-full flex items-center justify-between p-2 rounded-lg border transition-all cursor-pointer ${t.value===s.id.toString()?"bg-[#58c9d1]/5 border-[#58c9d1] shadow-sm":"border-neutral-200 hover:border-neutral-300"}`,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-[#58c9d1]/10 rounded-lg mr-3 flex items-center justify-center",children:e.jsx(V,{className:"h-4 w-4 text-[#58c9d1]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-neutral-900",children:s.name}),e.jsx("p",{className:"text-sm text-neutral-600",children:s.email}),s.cpf&&e.jsxs("p",{className:"text-xs text-neutral-500",children:["CPF: ",s.cpf]})]})]}),e.jsx(A,{value:s.id.toString(),id:`searched-client-${s.id}`})]},`searched-${s.id}`)),P.length>0&&e.jsx("div",{className:"mt-3 mb-3",children:e.jsx(g,{className:"text-sm font-medium text-neutral-700",children:"Todos os clientes"})})]}),Fe?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#58c9d1] mx-auto"}),e.jsx("p",{className:"text-neutral-600 mt-2",children:"Carregando clientes..."})]}):P.length>0?P.map(s=>e.jsxs(g,{htmlFor:`client-${s.id}`,className:`w-full flex items-center justify-between p-2 rounded-lg border transition-all ${t.value===s.id.toString()?"bg-[#58c9d1]/5 border-[#58c9d1] shadow-sm":"border-neutral-200 hover:border-neutral-300"}`,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-[#58c9d1]/10 rounded-lg mr-3 flex items-center justify-center",children:e.jsx(V,{className:"h-4 w-4 text-[#58c9d1]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-neutral-900",children:s.name}),e.jsx("p",{className:"text-sm text-neutral-600",children:s.email})]})]}),e.jsx(A,{value:s.id.toString(),id:`client-${s.id}`})]},s.id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{className:"h-12 w-12 text-neutral-400 mx-auto mb-3"}),e.jsx("p",{className:"text-neutral-600",children:"Nenhum cliente encontrado."}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"Adicione clientes primeiro."})]})]}),e.jsx(N,{})]})})})]}),e.jsxs(Ie,{value:"new",className:"space-y-4",children:[e.jsx(f,{control:w.control,name:"clientName",render:({field:t})=>e.jsxs(v,{children:[e.jsx(b,{children:"Nome completo"}),e.jsx(R,{children:e.jsx(H,{...t,placeholder:"Digite o nome completo"})}),e.jsx(N,{})]})}),e.jsx(f,{control:w.control,name:"clientEmail",render:({field:t})=>e.jsxs(v,{children:[e.jsx(b,{children:"Email"}),e.jsx(R,{children:e.jsx(H,{...t,type:"email",placeholder:"Digite o email"})}),e.jsx(N,{})]})}),e.jsx(f,{control:w.control,name:"clientPhone",render:({field:t})=>e.jsxs(v,{children:[e.jsx(b,{children:"Telefone (opcional)"}),e.jsx(R,{children:e.jsx(H,{...t,placeholder:"Digite o telefone"})}),e.jsx(N,{})]})})]})]}),e.jsxs("div",{className:"flex space-x-2 pt-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:W,className:"flex-1",children:"Voltar"}),e.jsx(j,{type:"submit",className:"flex-1 bg-[#58c9d1] text-white hover:bg-[#58c9d1]/90",children:"Continuar"})]})]})}),p===4&&e.jsx(K,{...$,children:e.jsxs("form",{onSubmit:$.handleSubmit(ze),className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(Z,{className:"h-5 w-5 mr-2 text-primary"}),e.jsx("h2",{className:"font-medium",children:"Confirmar agendamento"})]}),e.jsx(ye,{className:"bg-white border border-neutral-200 rounded-xl shadow-sm",children:e.jsx(Se,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-[#58c9d1]/10 rounded-lg mr-3 flex items-center justify-center",children:e.jsx(Y,{className:"h-5 w-5 text-[#58c9d1]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-neutral-900",children:a==null?void 0:a.name}),e.jsxs("p",{className:"text-sm text-neutral-600",children:[a==null?void 0:a.duration," min • ",X((a==null?void 0:a.price)||0)]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-[#58c9d1]/10 rounded-lg mr-3 flex items-center justify-center",children:e.jsx(ee,{className:"h-5 w-5 text-[#58c9d1]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-neutral-900",children:n.date&&C(te(n.date),"dd 'de' MMMM",{locale:L})}),e.jsx("p",{className:"text-sm text-neutral-600",children:n.time&&`${n.time} - ${F(n.time,(a==null?void 0:a.duration)||30)}`})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-[#58c9d1]/10 rounded-lg mr-3 flex items-center justify-center",children:e.jsx(V,{className:"h-5 w-5 text-[#58c9d1]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-neutral-900",children:(I==null?void 0:I.name)||n.clientName}),e.jsx("p",{className:"text-sm text-neutral-600",children:(I==null?void 0:I.email)||n.clientEmail})]})]})]})})}),e.jsx(f,{control:$.control,name:"notes",render:({field:t})=>e.jsxs(v,{children:[e.jsx(b,{children:"Observações (opcional)"}),e.jsx(R,{children:e.jsx(st,{...t,placeholder:"Adicione observações sobre este agendamento",value:t.value||""})}),e.jsx(N,{})]})}),e.jsx(f,{control:$.control,name:"sendNotification",render:({field:t})=>e.jsxs(v,{className:"flex flex-row items-center space-x-2 space-y-0",children:[e.jsx(R,{children:e.jsx("input",{type:"checkbox",checked:t.value,onChange:t.onChange,className:"sr-only",id:"send-notification"})}),e.jsx("div",{className:`w-10 h-5 rounded-full relative ${t.value?"bg-primary":"bg-neutral-200"}`,children:e.jsx("div",{className:`absolute w-4 h-4 rounded-full bg-white top-0.5 transition-all ${t.value?"left-[calc(100%-20px)]":"left-0.5"}`,onClick:()=>t.onChange(!t.value)})}),e.jsx(b,{htmlFor:"send-notification",className:"text-sm cursor-pointer",onClick:()=>t.onChange(!t.value),children:"Enviar notificação ao cliente"})]})}),e.jsxs("div",{className:"flex space-x-2 pt-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:W,children:"Voltar"}),e.jsx(j,{type:"submit",className:"flex-1",disabled:J.isPending,children:J.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-4 mr-2 animate-spin rounded-full border-2 border-background border-t-transparent"}),"Agendando..."]}):"Confirmar agendamento"})]})]})})]})]})})}),e.jsx(nt,{})]})}export{Qt as default};
