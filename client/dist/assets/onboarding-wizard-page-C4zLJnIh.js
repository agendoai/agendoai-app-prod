import{u as E,b as Q,c as M,r as N,d as P,j as e,e as w,C as q,f as L,g as O,h as I,i as F,k as $,l as u,a as z}from"./index-DlYle-HK.js";import{u as f}from"./useMutation-DGOmPVD5.js";import{B as v}from"./button-0YWTsIWD.js";import{P as G}from"./progress-CxwTZ0K1.js";import{B as K}from"./badge-CHUQCCUH.js";import{T as V,a as H,b as W,c as _}from"./tooltip-sraDGbxC.js";import{C as A}from"./circle-check-big-Cgf7H_gr.js";import{A as U}from"./arrow-right-0SqgWbEV.js";import{C as X}from"./circle-x--MVya1V3.js";import{C as J}from"./chevron-right-CMIMwi26.js";import{C as Y}from"./circle-help-CdYa6ded.js";import"./index-BBr4QLH3.js";import"./index-COYZuLqD.js";import"./index-BuB8ogb1.js";function Z({onComplete:a,onSkip:x}){const{user:o}=E(),m=Q(),{toast:c}=M(),[p,g]=N.useState(null),[j,h]=N.useState(!1),{data:r,isLoading:b}=P({queryKey:["/api/onboarding/steps",o==null?void 0:o.userType],queryFn:async()=>(await u("GET",`/api/onboarding/steps?userType=${o==null?void 0:o.userType}`)).json(),enabled:!!(o!=null&&o.userType)}),{data:t,isLoading:S}=P({queryKey:["/api/onboarding/progress"],queryFn:async()=>(await u("GET","/api/onboarding/progress")).json(),enabled:!!o}),k=f({mutationFn:async s=>(await u("POST",`/api/onboarding/progress/${s.stepId}`,{status:s.status})).json(),onSuccess:()=>{m.invalidateQueries({queryKey:["/api/onboarding/progress"]})},onError:s=>{c({title:"Erro ao atualizar progresso",description:s.message,variant:"destructive"})}}),y=f({mutationFn:async s=>(await u("POST",`/api/onboarding/complete/${s}`)).json(),onSuccess:s=>{if(m.invalidateQueries({queryKey:["/api/onboarding/progress"]}),j&&s.completionPercentage===100)a==null||a();else if(r&&p!==null){const i=r.findIndex(l=>l.id===p);i<r.length-1?g(r[i+1].id):h(!0)}},onError:s=>{c({title:"Erro ao concluir etapa",description:s.message,variant:"destructive"})}}),n=f({mutationFn:async s=>(await u("POST",`/api/onboarding/skip/${s}`)).json(),onSuccess:s=>{if(m.invalidateQueries({queryKey:["/api/onboarding/progress"]}),r&&p!==null){const i=r.findIndex(l=>l.id===p);i<r.length-1?g(r[i+1].id):(h(!0),s.completionPercentage===100&&(a==null||a()))}},onError:s=>{c({title:"Erro ao pular etapa",description:s.message,variant:"destructive"})}});N.useEffect(()=>{if(r&&t){let s=r.find(i=>{const l=t.progress.find(T=>T.stepId===i.id);return!l||l.status==="pending"||l.status==="in_progress"});if(!s&&r.length>0?(s=r[r.length-1],h(!0)):h(!1),s){g(s.id);const i=t.progress.find(l=>l.stepId===(s==null?void 0:s.id));(!i||i.status==="pending")&&k.mutate({stepId:s.id,status:"in_progress"})}}},[r,t]);const d=r==null?void 0:r.find(s=>s.id===p),B=(t==null?void 0:t.completionPercentage)===100;return b||S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(w,{className:"h-8 w-8 animate-spin text-primary"})}):B?e.jsxs(q,{className:"w-full max-w-3xl mx-auto",children:[e.jsxs(L,{children:[e.jsx(O,{className:"text-center",children:"Configuração Completa!"}),e.jsx(I,{className:"text-center",children:"Você concluiu todas as etapas de configuração da sua conta."})]}),e.jsxs(F,{className:"text-center",children:[e.jsx(A,{className:"h-24 w-24 text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-lg",children:"Sua conta está pronta para uso. Você pode começar a usar todas as funcionalidades do sistema."})]}),e.jsx($,{className:"flex justify-center",children:e.jsxs(v,{onClick:()=>a==null?void 0:a(),children:["Continuar para o Dashboard",e.jsx(U,{className:"ml-2 h-4 w-4"})]})})]}):e.jsxs("div",{className:"w-full max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Progresso"}),e.jsxs("span",{className:"text-sm font-medium",children:[(t==null?void 0:t.completionPercentage)||0,"%"]})]}),e.jsx(G,{value:(t==null?void 0:t.completionPercentage)||0,className:"h-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"col-span-1 space-y-2",children:r==null?void 0:r.map(s=>{const i=t==null?void 0:t.progress.find(R=>R.stepId===s.id),l=(i==null?void 0:i.status)==="completed",T=(i==null?void 0:i.status)==="skipped",C=s.id===p;return e.jsxs("div",{className:`flex items-center p-3 rounded-md cursor-pointer transition-colors ${C?"bg-primary/10 border border-primary":"border border-border hover:bg-accent"} ${l?"opacity-70":""}`,onClick:()=>g(s.id),children:[l?e.jsx(A,{className:"h-5 w-5 text-primary mr-2"}):T?e.jsx(X,{className:"h-5 w-5 text-muted-foreground mr-2"}):e.jsx("span",{className:"flex items-center justify-center w-5 h-5 rounded-full border border-primary mr-2 text-xs",children:s.order}),e.jsx("span",{className:`flex-1 ${C?"font-medium":""}`,children:s.name}),C&&e.jsx(J,{className:"h-4 w-4 text-primary"})]},s.id)})}),e.jsx("div",{className:"col-span-1 md:col-span-2",children:d&&e.jsxs(q,{children:[e.jsxs(L,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(O,{children:d.name}),d.isRequired?e.jsx(K,{variant:"outline",className:"bg-primary/10 text-primary border-primary",children:"Obrigatório"}):e.jsx(K,{variant:"outline",children:"Opcional"})]}),e.jsx(I,{children:d.description})]}),e.jsx(F,{children:e.jsxs("div",{className:"prose max-w-none dark:prose-invert",children:[e.jsx("p",{children:"Siga as instruções abaixo para completar esta etapa de configuração."}),e.jsxs("div",{className:"mt-4 p-4 bg-accent rounded-md",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Etapa ",d.order,": ",d.name]}),e.jsx("p",{className:"mt-2",children:d.helpText||"Complete os campos necessários para esta etapa."})]})]})}),e.jsxs($,{className:"flex justify-between",children:[e.jsx("div",{children:!d.isRequired&&e.jsxs(v,{variant:"outline",onClick:()=>n.mutate(d.id),disabled:n.isPending,children:[n.isPending&&e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),"Pular esta etapa"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{children:e.jsxs(H,{children:[e.jsx(W,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"icon",children:e.jsx(Y,{className:"h-5 w-5"})})}),e.jsx(_,{children:e.jsx("p",{className:"max-w-xs",children:d.helpText})})]})}),e.jsxs(v,{onClick:()=>y.mutate(d.id),disabled:y.isPending,children:[y.isPending&&e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),j?"Concluir":"Avançar"]})]})]})]})})]})]})}function D(){const{user:a}=E(),x=Q(),{toast:o}=M(),{data:m,isLoading:c,error:p}=P({queryKey:["/api/onboarding/steps",a==null?void 0:a.userType],queryFn:async()=>(await u("GET",`/api/onboarding/steps?userType=${a==null?void 0:a.userType}`)).json(),enabled:!!(a!=null&&a.userType)}),{data:g,isLoading:j,error:h}=P({queryKey:["/api/onboarding/progress"],queryFn:async()=>(await u("GET","/api/onboarding/progress")).json(),enabled:!!a}),r=f({mutationFn:async n=>(await u("POST",`/api/onboarding/progress/${n.stepId}`,{status:n.status})).json(),onSuccess:()=>{x.invalidateQueries({queryKey:["/api/onboarding/progress"]})},onError:n=>{o({title:"Erro ao atualizar progresso",description:n.message,variant:"destructive"})}}),b=f({mutationFn:async n=>(await u("POST",`/api/onboarding/complete/${n}`)).json(),onSuccess:()=>{x.invalidateQueries({queryKey:["/api/onboarding/progress"]})},onError:n=>{o({title:"Erro ao concluir etapa",description:n.message,variant:"destructive"})}}),t=f({mutationFn:async n=>(await u("POST",`/api/onboarding/skip/${n}`)).json(),onSuccess:()=>{x.invalidateQueries({queryKey:["/api/onboarding/progress"]})},onError:n=>{o({title:"Erro ao pular etapa",description:n.message,variant:"destructive"})}}),S=(g==null?void 0:g.completionPercentage)===100;return{steps:m,progressData:g,isLoading:c||j,isError:!!p||!!h,isOnboardingComplete:S,updateProgress:r.mutate,completeStep:b.mutate,skipStep:t.mutate,isPendingUpdate:r.isPending,isPendingComplete:b.isPending,isPendingSkip:t.isPending}}function ge(){const{user:a,isLoading:x}=E(),{isOnboardingComplete:o,isLoading:m}=D(),[,c]=z();N.useEffect(()=>{if(!x&&!a&&c("/auth"),!m&&o&&a)switch(a.userType){case"provider":c("/provider/dashboard");break;case"client":c("/client/dashboard");break;case"admin":c("/admin/dashboard");break;default:c("/")}},[a,x,o,m,c]);const p=()=>{if(a)switch(a.userType){case"provider":c("/provider/dashboard");break;case"client":c("/client/dashboard");break;case"admin":c("/admin/dashboard");break;default:c("/")}};return x||m?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(w,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"container py-10",children:[e.jsx("h1",{className:"text-3xl font-bold text-center mb-6",children:"Bem-vindo ao AgendoAI"}),e.jsx("p",{className:"text-center text-muted-foreground mb-10 max-w-2xl mx-auto",children:"Complete as etapas abaixo para configurar sua conta e começar a usar o sistema. Você pode pular algumas etapas e voltar a elas mais tarde."}),e.jsx(Z,{onComplete:p})]})}export{ge as default};
