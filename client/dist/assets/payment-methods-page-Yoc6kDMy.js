import{j as e}from"./ui-UIpCtT3r.js";import{r as t}from"./vendor-vA4cx1mx.js";import{u as z}from"./router-CxXythJb.js";import{b as F,a as R,c as Q,i as m,L as f,C as v,g as N,B as r,T as x}from"./index-_oaftgoR.js";import{D as g,a as C,b,c as y,d as w,e as B}from"./dialog-BvsjuwHe.js";import"./react-stripe.esm-CMqkxx7A.js";import"./index-C8r34K29.js";import{u as D}from"./useMutation-CeSY69nI.js";import"./label-C1VFYQZZ.js";import"./input-BDDyNkir.js";import{C as I}from"./chevron-left-CZwLS4sm.js";import{T as K}from"./trash-2-CFTARSkj.js";import{C as V}from"./credit-card-1Bzqs1Bw.js";import"./index-BvR2MEzN.js";function re(){const[,E]=z(),{toast:a}=F(),p=R(),[n,o]=t.useState(!1),[S,i]=t.useState(!1),[u,h]=t.useState(null),[j,T]=t.useState(null),{data:l,isLoading:O,error:c}=Q({queryKey:["/api/payment/cards"]});t.useEffect(()=>{n&&!j&&m("POST","/api/payment/setup-intent").then(s=>s.json()).then(s=>{T(s.clientSecret)}).catch(s=>{console.error("Error fetching setup intent:",s),a({title:"Erro",description:"Não foi possível inicializar o formulário de pagamento.",variant:"destructive"}),o(!1)})},[n,j,a]);const d=D({mutationFn:async s=>{await m("DELETE",`/api/payment/cards/${s}`)},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/payment/cards"]}),a({title:"Cartão removido",description:"Seu cartão foi removido com sucesso."}),i(!1),h(null)},onError:s=>{a({title:"Erro ao remover cartão",description:s.message,variant:"destructive"})}}),P=D({mutationFn:async s=>{await m("POST",`/api/payment/cards/${s}/set-default`)},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/payment/cards"]}),a({title:"Cartão padrão definido",description:"Seu cartão padrão foi atualizado com sucesso."})},onError:s=>{a({title:"Erro ao definir cartão padrão",description:s.message,variant:"destructive"})}}),k=()=>{u&&d.mutate(u)},L=s=>{h(s),i(!0)},M=s=>{P.mutate(s)},q=()=>{E("/client/profile")},A=s=>e.jsx(V,{className:"h-6 w-6 text-primary"});return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("header",{className:"bg-[#58c9d1] text-white py-6 flex items-center justify-center shadow-md",children:e.jsxs("div",{className:"flex items-center w-full max-w-md mx-auto px-4",children:[e.jsx("button",{onClick:q,className:"mr-3",children:e.jsx(I,{className:"h-6 w-6"})}),e.jsx("h1",{className:"text-xl font-semibold text-center flex-1",children:"Métodos de Pagamento"})]})}),e.jsxs("main",{className:"flex-1 p-4",children:[e.jsx("p",{className:"text-neutral-600 mb-6",children:"Gerencie seus cartões e métodos de pagamento para facilitar suas reservas."}),e.jsx("div",{className:"space-y-4 mb-6",children:O?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(f,{className:"h-8 w-8 animate-spin text-primary"})}):c?e.jsxs("div",{className:"text-center p-4 text-red-500",children:[e.jsx("p",{children:"Ocorreu um erro ao carregar seus cartões."}),e.jsx("p",{className:"text-sm",children:c instanceof Error?c.message:"Erro desconhecido"})]}):l&&l.length>0?l.map(s=>e.jsx(v,{className:"border border-neutral-200",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-3 mt-1",children:A(s.brand)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("p",{className:"font-medium",children:["•••• •••• •••• ",s.last4]}),s.isDefault&&e.jsx("span",{className:"ml-2 bg-primary/10 text-primary text-xs px-2 py-0.5 rounded-full",children:"Padrão"})]}),s.cardholderName&&e.jsx("p",{className:"text-sm text-neutral-500",children:s.cardholderName}),e.jsxs("p",{className:"text-sm text-neutral-500",children:["Válido até: ",s.expMonth,"/",s.expYear.toString().slice(-2)]}),e.jsx("div",{className:"mt-2",children:!s.isDefault&&e.jsx(r,{variant:"outline",size:"sm",className:"text-xs h-7 mr-2",onClick:()=>M(s.id),children:"Definir como padrão"})})]})]}),e.jsx(r,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500",onClick:()=>L(s.id),children:e.jsx(K,{className:"h-4 w-4"})})]})})},s.id)):e.jsx("div",{className:"text-center p-4 text-neutral-500",children:e.jsx("p",{children:"Você ainda não possui cartões cadastrados."})})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-3",children:"Métodos alternativos"}),e.jsx(v,{className:"border border-neutral-200",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-3",children:e.jsx(x,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Pagamento no local"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Você também pode optar por pagar diretamente ao prestador de serviço"})]})]})})})]}),e.jsxs("div",{className:"text-center p-4 border border-dashed border-neutral-300 rounded-lg",children:[e.jsx(x,{className:"h-8 w-8 mx-auto text-neutral-400 mb-2"}),e.jsx("p",{className:"text-neutral-600 mb-2",children:"Em breve disponível"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"A funcionalidade de pagamento com cartão estará disponível em breve."})]})]}),e.jsx(g,{open:n,onOpenChange:o,children:e.jsxs(C,{children:[e.jsxs(b,{children:[e.jsx(y,{children:"Adicionar cartão"}),e.jsx(w,{children:"Adicione um novo cartão para facilitar seus pagamentos."})]}),e.jsxs("div",{className:"text-center p-4",children:[e.jsx(x,{className:"h-8 w-8 mx-auto text-neutral-400 mb-2"}),e.jsx("p",{className:"text-neutral-600 mb-2",children:"Em breve disponível"}),e.jsx("p",{className:"text-sm text-neutral-500 mb-4",children:"A funcionalidade de pagamento com cartão estará disponível em breve."}),e.jsx(r,{onClick:()=>o(!1),children:"Fechar"})]})]})}),e.jsx(g,{open:S,onOpenChange:i,children:e.jsxs(C,{children:[e.jsxs(b,{children:[e.jsx(y,{children:"Remover cartão"}),e.jsx(w,{children:"Tem certeza que deseja remover este cartão? Esta ação não pode ser desfeita."})]}),e.jsxs(B,{children:[e.jsx(r,{variant:"outline",onClick:()=>i(!1),children:"Cancelar"}),e.jsx(r,{variant:"destructive",onClick:k,disabled:d.isPending,children:d.isPending?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"h-4 w-4 mr-2 animate-spin"})," Removendo..."]}):"Remover cartão"})]})]})})]})}export{re as default};
