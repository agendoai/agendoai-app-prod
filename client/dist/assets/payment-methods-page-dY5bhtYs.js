import{r as d,j as e,e as y,a as z,c as Q,b as _,d as K,l as g,C,i as b}from"./index-DFO2lo2s.js";import{B as u}from"./button-6IH7luFD.js";import{D as S,a as E,b as w,c as D,d as O,e as Y}from"./dialog-eRBlhqVz.js";import{u as B,a as G,C as P,E as U}from"./react-stripe.esm-k5jc_Snk.js";import{l as V}from"./index-C8r34K29.js";import{u as M}from"./useMutation-BIXw1p8a.js";import{L as T}from"./label-ByXqB0vV.js";import{I as H}from"./input-DGvqAMIq.js";import{C as W}from"./check-C4mt73Rm.js";import{C as Z}from"./chevron-left-CKZU-S_c.js";import{T as $}from"./trash-2-7t4qwQZj.js";import{T as J}from"./triangle-alert-DUkM71KX.js";import{P as X}from"./plus-CUNQfl1u.js";import{C as ee}from"./credit-card-By0IdnTO.js";import"./index-O3IU6Cgx.js";import"./index-zokK3oQV.js";import"./index-BEl4sio8.js";import"./index-htQLNBgJ.js";function se({onSuccess:v,onError:a,buttonText:x="Salvar cartão",showCardholderName:o=!0,clientSecret:c=null}){const m=B(),r=G(),[p,N]=d.useState(""),[i,n]=d.useState(!1),h=async j=>{if(j.preventDefault(),!m||!r){a("O Stripe ainda não foi carregado.");return}n(!0);const l=r.getElement(P);if(!l){a("Elemento de cartão não encontrado."),n(!1);return}try{if(c){const{error:t,setupIntent:f}=await m.confirmCardSetup(c,{payment_method:{card:l,billing_details:o?{name:p}:void 0}});if(t){a(t.message||"Ocorreu um erro ao salvar o cartão."),n(!1);return}v(f.payment_method)}else{const{error:t,paymentMethod:f}=await m.createPaymentMethod({type:"card",card:l,billing_details:o?{name:p}:void 0});if(t){a(t.message||"Ocorreu um erro ao salvar o cartão."),n(!1);return}v(f)}}catch(t){a(t.message||"Ocorreu um erro inesperado.")}finally{n(!1)}};return e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[o&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"cardholderName",children:"Nome no cartão"}),e.jsx(H,{id:"cardholderName",value:p,onChange:j=>N(j.target.value),placeholder:"NOME COMO ESCRITO NO CARTÃO",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{children:"Dados do cartão"}),e.jsx("div",{className:"border rounded-md p-3",children:e.jsx(P,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}})})]}),e.jsx(u,{type:"submit",className:"w-full",disabled:!m||!r||i,children:i?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-4 w-4 mr-2 animate-spin"}),e.jsx("span",{children:"Processando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:x})]})})]})}const ae="pk_test_51RkqXrRr6s3UmWYUrWgAlgej5ir5MpLUjjpQLkGPeHeg8vy3ZJAbIttYkjR3EzrI9zzvFgI6lPRMZhGj55NnIFYF00F1YurTA7",te=V(ae);function Ce(){const[,v]=z(),{toast:a}=Q(),x=_(),[o,c]=d.useState(!1),[m,r]=d.useState(!1),[p,N]=d.useState(null),[i,n]=d.useState(null),{data:h,isLoading:j,error:l}=K({queryKey:["/api/payment/cards"]});d.useEffect(()=>{o&&!i&&g("POST","/api/payment/setup-intent").then(s=>s.json()).then(s=>{n(s.clientSecret)}).catch(s=>{console.error("Error fetching setup intent:",s),a({title:"Erro",description:"Não foi possível inicializar o formulário de pagamento.",variant:"destructive"}),c(!1)})},[o,i,a]);const t=M({mutationFn:async s=>{await g("DELETE",`/api/payment/cards/${s}`)},onSuccess:()=>{x.invalidateQueries({queryKey:["/api/payment/cards"]}),a({title:"Cartão removido",description:"Seu cartão foi removido com sucesso."}),r(!1),N(null)},onError:s=>{a({title:"Erro ao remover cartão",description:s.message,variant:"destructive"})}}),f=M({mutationFn:async s=>{await g("POST",`/api/payment/cards/${s}/set-default`)},onSuccess:()=>{x.invalidateQueries({queryKey:["/api/payment/cards"]}),a({title:"Cartão padrão definido",description:"Seu cartão padrão foi atualizado com sucesso."})},onError:s=>{a({title:"Erro ao definir cartão padrão",description:s.message,variant:"destructive"})}}),k=async s=>{try{a({title:"Cartão adicionado",description:"Seu novo cartão foi adicionado com sucesso."}),x.invalidateQueries({queryKey:["/api/payment/cards"]}),c(!1),n(null)}catch(q){a({title:"Erro ao adicionar cartão",description:q.message,variant:"destructive"})}},F=()=>{p&&t.mutate(p)},I=s=>{N(s),r(!0)},A=s=>{f.mutate(s)},R=()=>{v("/client/profile")},L=s=>e.jsx(ee,{className:"h-6 w-6 text-primary"});return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("header",{className:"bg-[#58c9d1] text-white py-6 flex items-center justify-center shadow-md",children:e.jsxs("div",{className:"flex items-center w-full max-w-md mx-auto px-4",children:[e.jsx("button",{onClick:R,className:"mr-3",children:e.jsx(Z,{className:"h-6 w-6"})}),e.jsx("h1",{className:"text-xl font-semibold text-center flex-1",children:"Métodos de Pagamento"})]})}),e.jsxs("main",{className:"flex-1 p-4",children:[e.jsx("p",{className:"text-neutral-600 mb-6",children:"Gerencie seus cartões e métodos de pagamento para facilitar suas reservas."}),e.jsx("div",{className:"space-y-4 mb-6",children:j?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(y,{className:"h-8 w-8 animate-spin text-primary"})}):l?e.jsxs("div",{className:"text-center p-4 text-red-500",children:[e.jsx("p",{children:"Ocorreu um erro ao carregar seus cartões."}),e.jsx("p",{className:"text-sm",children:l instanceof Error?l.message:"Erro desconhecido"})]}):h&&h.length>0?h.map(s=>e.jsx(C,{className:"border border-neutral-200",children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-3 mt-1",children:L(s.brand)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("p",{className:"font-medium",children:["•••• •••• •••• ",s.last4]}),s.isDefault&&e.jsx("span",{className:"ml-2 bg-primary/10 text-primary text-xs px-2 py-0.5 rounded-full",children:"Padrão"})]}),s.cardholderName&&e.jsx("p",{className:"text-sm text-neutral-500",children:s.cardholderName}),e.jsxs("p",{className:"text-sm text-neutral-500",children:["Válido até: ",s.expMonth,"/",s.expYear.toString().slice(-2)]}),e.jsx("div",{className:"mt-2",children:!s.isDefault&&e.jsx(u,{variant:"outline",size:"sm",className:"text-xs h-7 mr-2",onClick:()=>A(s.id),children:"Definir como padrão"})})]})]}),e.jsx(u,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500",onClick:()=>I(s.id),children:e.jsx($,{className:"h-4 w-4"})})]})})},s.id)):e.jsx("div",{className:"text-center p-4 text-neutral-500",children:e.jsx("p",{children:"Você ainda não possui cartões cadastrados."})})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-3",children:"Métodos alternativos"}),e.jsx(C,{className:"border border-neutral-200",children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-3",children:e.jsx(J,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Pagamento no local"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Você também pode optar por pagar diretamente ao prestador de serviço"})]})]})})})]}),e.jsxs(u,{variant:"outline",className:"w-full",onClick:()=>c(!0),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Adicionar novo cartão"]})]}),e.jsx(S,{open:o,onOpenChange:c,children:e.jsxs(E,{children:[e.jsxs(w,{children:[e.jsx(D,{children:"Adicionar cartão"}),e.jsx(O,{children:"Adicione um novo cartão para facilitar seus pagamentos."})]}),i?e.jsx(U,{stripe:te,options:{clientSecret:i},children:e.jsx(se,{onSuccess:k,onError:s=>{a({title:"Erro ao adicionar cartão",description:s,variant:"destructive"})},buttonText:"Adicionar cartão",clientSecret:i})}):e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(y,{className:"h-8 w-8 animate-spin text-primary"})})]})}),e.jsx(S,{open:m,onOpenChange:r,children:e.jsxs(E,{children:[e.jsxs(w,{children:[e.jsx(D,{children:"Remover cartão"}),e.jsx(O,{children:"Tem certeza que deseja remover este cartão? Esta ação não pode ser desfeita."})]}),e.jsxs(Y,{children:[e.jsx(u,{variant:"outline",onClick:()=>r(!1),children:"Cancelar"}),e.jsx(u,{variant:"destructive",onClick:F,disabled:t.isPending,children:t.isPending?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-4 w-4 mr-2 animate-spin"})," Removendo..."]}):"Remover cartão"})]})]})})]})}export{Ce as default};
