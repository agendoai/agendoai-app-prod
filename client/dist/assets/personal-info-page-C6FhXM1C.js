import{a as H,c as K,u as W,b as G,r as p,j as e,e as L,l as J}from"./index-BdrEJuYD.js";import{B as x}from"./button-CynjWJoH.js";import{I as g}from"./input-BRNzA_b4.js";import{L as j}from"./label-OE63wfRu.js";import{u as R}from"./useMutation-C9nL7V5b.js";import{D as V,a as X,b as Y,c as Z,d as _}from"./dialog-Cv4VtnLP.js";import{C as ee}from"./client-layout-of4HzYgb.js";import{C as ae}from"./chevron-left-3E0puwn_.js";import{U}from"./user-DCpoqoA-.js";import{C as se}from"./camera-BsTI37en.js";import{C as k}from"./check-WTIUe9ha.js";import{U as te}from"./upload-CgIz6cYD.js";import"./index-CrNpXqsn.js";import"./index-BYdWi_2u.js";import"./index-DTy3TPQv.js";import"./navbar-BcVSfpub.js";import"./proxy-C6NuY9h3.js";import"./house-CU2aGGLt.js";import"./search-DiCZmcCn.js";import"./calendar-check-BsktWAdS.js";function Ee(){const[,E]=H(),{toast:w}=K(),{user:s}=W(),q=G(),I=p.useRef(null),[n,v]=p.useState({name:(s==null?void 0:s.name)||"",email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||"",profileImage:(s==null?void 0:s.profileImage)||"",cpf:(s==null?void 0:s.cpf)||""}),[T,F]=p.useState(!1),[D,P]=p.useState(null),[b,S]=p.useState(null);p.useEffect(()=>{s&&v({name:s.name||"",email:s.email||"",phone:s.phone||"",profileImage:s.profileImage||"",cpf:s.cpf||""})},[s]);const u=R({mutationFn:async a=>(await J("PUT",`/api/users/${s==null?void 0:s.id}`,a)).json(),onSuccess:()=>{q.invalidateQueries({queryKey:["user"]}),w({title:"Perfil atualizado",description:"Suas informações foram atualizadas com sucesso."})},onError:a=>{w({title:"Erro ao atualizar perfil",description:a.message,variant:"destructive"})}}),z=async(a,r=1)=>new Promise((o,t)=>{if(a.size>r*1024*1024){const l=new FileReader;l.readAsDataURL(a),l.onload=N=>{var A;const c=new Image;c.src=(A=N.target)==null?void 0:A.result,c.onload=()=>{const f=document.createElement("canvas");let i=c.width,m=c.height;const d=800;i>m&&i>d?(m=m/i*d,i=d):m>d&&(i=i/m*d,m=d),f.width=i,f.height=m;const C=f.getContext("2d");C==null||C.drawImage(c,0,0,i,m);const $=f.toDataURL("image/jpeg",.7);o($)},c.onerror=()=>{t(new Error("Erro ao carregar imagem para compressão"))}},l.onerror=()=>{t(new Error("Erro ao ler o arquivo de imagem"))}}else{const l=new FileReader;l.readAsDataURL(a),l.onload=()=>{typeof l.result=="string"?o(l.result):t(new Error("Falha ao converter imagem"))},l.onerror=N=>t(N)}}),y=R({mutationFn:async a=>{try{if(!a.type.startsWith("image/"))throw new Error("O arquivo selecionado não é uma imagem válida");return await z(a,2)}catch(r){throw new Error(`Falha ao processar imagem: ${r instanceof Error?r.message:"Erro desconhecido"}`)}},onSuccess:a=>{u.mutate({...n,email:void 0,profileImage:a}),v(r=>({...r,profileImage:a})),F(!1),P(null),S(null)},onError:a=>{w({title:"Erro ao fazer upload da imagem",description:a.message,variant:"destructive"})}}),h=a=>{const{name:r,value:o}=a.target;v(t=>({...t,[r]:o}))},B=a=>{a.preventDefault();const{email:r,...o}=n,t={...o};typeof t.cpf<"u"&&t.cpf===""&&delete t.cpf,u.mutate(t)},O=a=>{var o;const r=(o=a.target.files)==null?void 0:o[0];if(r){S(r);const t=new FileReader;t.onload=()=>{P(t.result)},t.readAsDataURL(r)}},M=()=>{b&&y.mutate(b)},Q=()=>{E("/client/dashboard")};return e.jsxs(ee,{children:[e.jsxs("div",{className:"w-full max-w-md mx-auto bg-gradient-to-br from-[#3EB9AA] to-[#2A9D8F] text-white px-4 py-6 flex items-center rounded-b-3xl shadow-md",children:[e.jsx("button",{onClick:Q,className:"mr-3 p-2 rounded-full bg-white/20 hover:bg-white/30 transition-colors",children:e.jsx(ae,{className:"h-6 w-6"})}),e.jsx("h1",{className:"text-2xl font-bold flex-1 text-center",children:"Informações Pessoais"}),e.jsx("span",{className:"w-8"})]}),e.jsxs("div",{className:"w-full max-w-md mx-auto -mt-12",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsxs("button",{type:"button",className:"w-28 h-28 rounded-full overflow-hidden bg-primary/10 relative mb-2 group shadow-lg border-4 border-white focus:outline-none focus:ring-2 focus:ring-primary opacity-60 cursor-not-allowed",disabled:!0,"aria-label":"Alterar foto de perfil",tabIndex:-1,children:[n.profileImage?e.jsx("img",{src:n.profileImage,alt:"Profile",className:"w-full h-full object-cover",onError:a=>{a.currentTarget.onerror=null,a.currentTarget.src="/src/assets/service-images/perfil de usuario.png"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(U,{className:"h-16 w-16 text-primary"})}),e.jsx("span",{className:"absolute bottom-2 right-2 bg-primary text-white p-3 rounded-full shadow-lg border-2 border-white group-hover:scale-110 transition-transform",children:e.jsx(se,{className:"h-6 w-6"})})]}),e.jsx("button",{type:"button",className:"text-sm text-neutral-500 mt-2 cursor-not-allowed",disabled:!0,children:"Em breve disponível"})]}),e.jsxs("form",{onSubmit:B,className:"space-y-6 bg-white rounded-2xl shadow-lg p-6 mt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"name",children:"Nome completo"}),e.jsx(g,{id:"name",name:"name",value:n.name,onChange:h,placeholder:"Seu nome completo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cpf",children:"CPF"}),e.jsx(g,{id:"cpf",name:"cpf",value:n.cpf,onChange:h,placeholder:"000.000.000-00",maxLength:14})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"email",children:"Email"}),e.jsx(g,{id:"email",name:"email",type:"email",value:n.email,onChange:h,placeholder:"seu.email@exemplo.com",disabled:!0}),e.jsx("p",{className:"text-xs text-neutral-500",children:"O email não pode ser alterado"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"phone",children:"Telefone"}),e.jsx(g,{id:"phone",name:"phone",type:"tel",value:n.phone,onChange:h,placeholder:"(00) 00000-0000"})]}),e.jsx("div",{className:"pt-4",children:e.jsx(x,{type:"submit",className:"w-full text-lg py-3 rounded-xl bg-gradient-to-br from-[#3EB9AA] to-[#2A9D8F] text-white font-bold shadow-md hover:scale-[1.02] transition-transform",disabled:u.isPending,children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-5 w-5 animate-spin"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-5 w-5"}),"Salvar alterações"]})})}),e.jsx("div",{className:"mt-4",children:e.jsx(x,{type:"button",variant:"outline",className:"w-full text-lg py-3 rounded-xl font-bold",onClick:()=>E("/client/change-password"),children:"Alterar senha"})})]})]}),e.jsx(V,{open:T,onOpenChange:F,children:e.jsxs(X,{className:"bg-white",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Alterar foto de perfil"}),e.jsx(_,{children:"Selecione uma nova imagem para seu perfil"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[D?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-32 h-32 rounded-full overflow-hidden bg-primary/10 relative",children:e.jsx("img",{src:D,alt:"Preview",className:"w-full h-full object-cover"})})}):e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-32 h-32 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(U,{className:"h-16 w-16 text-primary"})})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",ref:I,onChange:O}),e.jsxs(x,{type:"button",variant:"outline",className:"w-full mb-2",onClick:()=>{var a;return(a=I.current)==null?void 0:a.click()},children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Selecionar imagem"]}),e.jsx(x,{type:"button",className:"w-full",disabled:!b||y.isPending,onClick:M,children:y.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Salvar nova foto"]})})]})]})]})})]})}export{Ee as default};
