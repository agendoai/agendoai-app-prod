import{j as e}from"./ui-UIpCtT3r.js";import{r as l}from"./vendor-vA4cx1mx.js";import{u as T}from"./router-CxXythJb.js";import{b as B,u as O,a as U,B as c,L as I,i as q}from"./index-C8-zpcKL.js";import{I as d}from"./input-IX-Ccd3C.js";import{L as p}from"./label-BIAKwpsc.js";import{u as F}from"./useMutation-P96WDC87.js";import{D as R,a as M,b as $,c as Q,d as K}from"./dialog-B9ckTsk5.js";import{C as H}from"./client-layout-DkJA58XK.js";import{C as W}from"./chevron-left-tkC6Z4zt.js";import{U as D}from"./user-CXc1AnQW.js";import{C as G}from"./camera-B4Z_iX80.js";import{C as E}from"./check-yFju7Kvd.js";import{U as J}from"./upload-ByUP9uGz.js";import"./navbar-vyjn30u5.js";import"./proxy-B2Nma8Bt.js";import"./search-ChrBAPJG.js";import"./calendar-check-B0nV5Uhw.js";function ue(){const[,j]=T(),{toast:n}=B(),{user:a}=O(),w=U(),v=l.useRef(null),[i,u]=l.useState({name:(a==null?void 0:a.name)||"",email:(a==null?void 0:a.email)||"",phone:(a==null?void 0:a.phone)||"",profileImage:(a==null?void 0:a.profileImage)||"",cpf:(a==null?void 0:a.cpf)||""}),[S,h]=l.useState(!1),[y,b]=l.useState(null),[f,N]=l.useState(null);l.useEffect(()=>{a&&u({name:a.name||"",email:a.email||"",phone:a.phone||"",profileImage:a.profileImage||"",cpf:a.cpf||""})},[a]);const x=F({mutationFn:async s=>(await q("PUT",`/api/users/${a==null?void 0:a.id}`,s)).json(),onSuccess:()=>{w.invalidateQueries({queryKey:["user"]}),n({title:"Perfil atualizado",description:"Suas informações foram atualizadas com sucesso."})},onError:s=>{n({title:"Erro ao atualizar perfil",description:s.message,variant:"destructive"})}}),g=F({mutationFn:async s=>{try{if(!s.type.startsWith("image/"))throw new Error("O arquivo selecionado não é uma imagem válida");if(s.size>5*1024*1024)throw new Error("O arquivo é muito grande. Tamanho máximo: 5MB");const t=new FormData;t.append("image",s);const o=await fetch(`/api/users/${a==null?void 0:a.id}/profile-image-cloudinary`,{method:"POST",body:t,headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(!o.ok){const L=await o.json();throw new Error(L.error||"Erro ao fazer upload da imagem")}return await o.json()}catch(t){throw new Error(`Falha ao fazer upload: ${t instanceof Error?t.message:"Erro desconhecido"}`)}},onSuccess:s=>{u(t=>({...t,profileImage:s.profileImage})),w.invalidateQueries({queryKey:["user"]}),h(!1),b(null),N(null),n({title:"Imagem atualizada",description:"Sua foto de perfil foi atualizada com sucesso."})},onError:s=>{n({title:"Erro ao fazer upload",description:s.message,variant:"destructive"})}}),m=s=>{const{name:t,value:o}=s.target;u(r=>({...r,[t]:o}))},P=s=>{s.preventDefault();const{email:t,...o}=i,r={...o};typeof r.cpf<"u"&&r.cpf===""&&delete r.cpf,x.mutate(r)},C=()=>{h(!0)},A=s=>{var o;const t=(o=s.target.files)==null?void 0:o[0];if(t){N(t);const r=new FileReader;r.onload=()=>{b(r.result)},r.readAsDataURL(t)}},k=()=>{f&&g.mutate(f)},z=()=>{j("/client/dashboard")};return e.jsxs(H,{children:[e.jsxs("div",{className:"w-full max-w-md mx-auto bg-gradient-to-br from-[#3EB9AA] to-[#2A9D8F] text-white px-4 py-6 flex items-center rounded-b-3xl shadow-md",children:[e.jsx("button",{onClick:z,className:"mr-3 p-2 rounded-full bg-white/20 hover:bg-white/30 transition-colors",children:e.jsx(W,{className:"h-6 w-6"})}),e.jsx("h1",{className:"text-2xl font-bold flex-1 text-center",children:"Informações Pessoais"}),e.jsx("span",{className:"w-8"})]}),e.jsxs("div",{className:"w-full max-w-md mx-auto -mt-12",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsxs("button",{type:"button",onClick:C,className:"w-28 h-28 rounded-full overflow-hidden bg-primary/10 relative mb-2 group shadow-lg border-4 border-white focus:outline-none focus:ring-2 focus:ring-primary hover:opacity-80 transition-opacity","aria-label":"Alterar foto de perfil",children:[i.profileImage?e.jsx("img",{src:i.profileImage,alt:"Profile",className:"w-full h-full object-cover rounded-full",onError:s=>{s.currentTarget.onerror=null,s.currentTarget.src="/src/assets/service-images/perfil de usuario.png"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(D,{className:"h-16 w-16 text-primary"})}),e.jsx("span",{className:"absolute bottom-2 right-2 bg-primary text-white p-3 rounded-full shadow-lg border-2 border-white group-hover:scale-110 transition-transform",children:e.jsx(G,{className:"h-6 w-6"})})]}),e.jsx("button",{type:"button",onClick:C,className:"text-sm text-primary hover:text-primary/80 mt-2 transition-colors",children:"Alterar foto"})]}),e.jsxs("form",{onSubmit:P,className:"space-y-6 bg-white rounded-2xl shadow-lg p-6 mt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"name",children:"Nome completo"}),e.jsx(d,{id:"name",name:"name",value:i.name,onChange:m,placeholder:"Seu nome completo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"cpf",children:"CPF"}),e.jsx(d,{id:"cpf",name:"cpf",value:i.cpf,onChange:m,placeholder:"000.000.000-00",maxLength:14})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"email",children:"Email"}),e.jsx(d,{id:"email",name:"email",type:"email",value:i.email,onChange:m,placeholder:"seu.email@exemplo.com",disabled:!0}),e.jsx("p",{className:"text-xs text-neutral-500",children:"O email não pode ser alterado"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"phone",children:"Telefone"}),e.jsx(d,{id:"phone",name:"phone",type:"tel",value:i.phone,onChange:m,placeholder:"(00) 00000-0000"})]}),e.jsx("div",{className:"pt-4",children:e.jsx(c,{type:"submit",className:"w-full text-lg py-3 rounded-xl bg-gradient-to-br from-[#3EB9AA] to-[#2A9D8F] text-white font-bold shadow-md hover:scale-[1.02] transition-transform",disabled:x.isPending,children:x.isPending?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-5 w-5 animate-spin"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mr-2 h-5 w-5"}),"Salvar alterações"]})})}),e.jsx("div",{className:"mt-4",children:e.jsx(c,{type:"button",variant:"outline",className:"w-full text-lg py-3 rounded-xl font-bold",onClick:()=>j("/client/change-password"),children:"Alterar senha"})})]})]}),e.jsx(R,{open:S,onOpenChange:h,children:e.jsxs(M,{className:"bg-white",children:[e.jsxs($,{children:[e.jsx(Q,{children:"Alterar foto de perfil"}),e.jsx(K,{children:"Selecione uma nova imagem para seu perfil"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[y?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-32 h-32 rounded-full overflow-hidden bg-primary/10 relative",children:e.jsx("img",{src:y,alt:"Preview",className:"w-full h-full object-cover"})})}):e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-32 h-32 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(D,{className:"h-16 w-16 text-primary"})})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",ref:v,onChange:A}),e.jsxs(c,{type:"button",variant:"outline",className:"w-full mb-2",onClick:()=>{var s;return(s=v.current)==null?void 0:s.click()},children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Selecionar imagem"]}),e.jsx(c,{type:"button",className:"w-full",disabled:!f||g.isPending,onClick:k,children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Salvar nova foto"]})})]})]})]})})]})}export{ue as default};
