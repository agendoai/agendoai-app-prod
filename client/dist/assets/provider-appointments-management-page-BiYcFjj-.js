import{a as Z,u as ee,b as se,r as d,d as ae,j as e,C as h,i as b,y as te,f as re,g as le,t as p,l as R}from"./index-DOe1OCu1.js";import{u as U}from"./useMutation-Lmj9MX3Y.js";import{T as oe,a as ce,b as f}from"./tabs-BbH-RVGd.js";import{P as de}from"./provider-layout-nV42KACr.js";import{B as Q}from"./badge-Bzn9UYFT.js";import{B as j}from"./button-C168b4m4.js";import{S as g}from"./skeleton-B-0dSqkR.js";import{I as ie}from"./input-BHH75Tpk.js";import{S as v,a as N,b as w,c as y,d as t}from"./select-CXehJHOL.js";import{c as k}from"./constructNow-BcZzM1ki.js";import{i as z}from"./isSameDay-BJjwZdUf.js";import{A as ne}from"./arrow-left-BPt4aJQo.js";import{S as me}from"./search-Bjz8DxPP.js";import{C as ue}from"./circle-x-x0lNBPbI.js";import{C as _}from"./calendar-Mn3IWFfL.js";import{m as xe}from"./proxy-Ct5X7xz4.js";import{C as he}from"./clock-CVsS3BCD.js";import{D as ge}from"./dollar-sign-D5ikk9cU.js";import{S as be}from"./square-pen-B-RCtsVU.js";import{s as pe}from"./subDays-K6OA95hK.js";import{a as fe}from"./addDays-BQ37Zmqx.js";import{p as T}from"./parseISO-C4T3oArM.js";import{f as je}from"./format-CGvBu07F.js";import{p as ve}from"./pt-BR-Cxqo7XV3.js";import"./index-DbsNQ1RS.js";import"./index-CQF81cx3.js";import"./index-DdZceiuF.js";import"./index-BdQq_4o_.js";import"./index-CtQ14QdP.js";import"./index-C933frGi.js";import"./index-tIxYtZzE.js";import"./index-CCWTWNPs.js";import"./chevron-down-C3yMjgZz.js";import"./check-C4wNsCXx.js";import"./en-US-xSPtgCq_.js";function P(r){return z(r,k(r))}function Ne(r){return z(r,fe(k(r),1))}function we(r){return z(r,pe(k(r),1))}const ye={pending:"bg-yellow-100 text-yellow-800 hover:bg-yellow-200",confirmed:"bg-blue-100 text-blue-800 hover:bg-blue-200",completed:"bg-green-100 text-green-800 hover:bg-green-200",canceled:"bg-red-100 text-red-800 hover:bg-red-200",no_show:"bg-gray-100 text-gray-800 hover:bg-gray-200",executing:"bg-purple-100 text-purple-800 hover:bg-purple-200"},H={pending:"Pendente",confirmed:"Confirmado",completed:"Concluído",canceled:"Cancelado",no_show:"Não Compareceu",executing:"Executando"},Se={pending:"bg-yellow-100 text-yellow-800",paid:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",refunded:"bg-gray-100 text-gray-800"},Ce={pending:"Pendente",paid:"Pago",failed:"Falhou",refunded:"Reembolsado"};function ns(){const[,r]=Z(),{user:Te}=ee(),E=se(),[x,K]=d.useState("all"),[i,D]=d.useState(null),[n,A]=d.useState(null),[l,L]=d.useState(""),[o,m]=d.useState(null),[Pe,S]=d.useState(!1),{data:u=[],isLoading:G}=ae({queryKey:["/api/appointments"],retry:1}),$=d.useMemo(()=>u.filter(s=>{var q,B,I,O;const a=new Date(`${s.date}T${s.startTime}`)>=new Date,c=new Date(`${s.date}T${s.startTime}`)<new Date;if(x==="upcoming"&&!a||x==="past"&&!c||x==="today"&&!P(T(s.date))||i&&s.status!==i||n&&s.paymentStatus!==n)return!1;const C=l.toLowerCase();return!l||((q=s.clientName)==null?void 0:q.toLowerCase().includes(C))||((B=s.serviceName)==null?void 0:B.toLowerCase().includes(C))||((I=s.clientPhone)==null?void 0:I.includes(l))||((O=s.clientEmail)==null?void 0:O.toLowerCase().includes(C))}).sort((s,a)=>s.date!==a.date?s.date.localeCompare(a.date):s.startTime.localeCompare(a.startTime)),[u,x,i,n,l]),M=U({mutationFn:async({appointmentId:s,status:a})=>{const c=await R("PUT",`/api/appointments/${s}/status`,{status:a});if(!c.ok)throw new Error("Erro ao atualizar status");return c.json()},onSuccess:()=>{E.invalidateQueries({queryKey:["/api/appointments"]}),p({title:"Status atualizado",description:"O status do agendamento foi atualizado com sucesso"}),S(!1),m(null)},onError:s=>{p({title:"Erro",description:s.message||"Erro ao atualizar status",variant:"destructive"})}}),F=U({mutationFn:async({appointmentId:s,paymentStatus:a})=>{const c=await R("PUT",`/api/appointments/${s}/status`,{paymentStatus:a});if(!c.ok)throw new Error("Erro ao atualizar status de pagamento");return c.json()},onSuccess:()=>{E.invalidateQueries({queryKey:["/api/appointments"]}),p({title:"Status de pagamento atualizado",description:"O status de pagamento foi atualizado com sucesso"}),S(!1),m(null)},onError:s=>{p({title:"Erro",description:s.message||"Erro ao atualizar status de pagamento",variant:"destructive"})}}),X=(s,a)=>{m(s),M.mutate({appointmentId:s.id,status:a})},Y=(s,a)=>{m(s),F.mutate({appointmentId:s.id,paymentStatus:a})},J=s=>{const a=T(s);return P(a)?"Hoje":we(a)?"Ontem":Ne(a)?"Amanhã":je(a,"dd/MM/yyyy",{locale:ve})},V=s=>s.substring(0,5),W=()=>{D(null),A(null),L("")};return e.jsxs(de,{children:[e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#58c9d1]/5 to-[#58c9d1]/10",children:e.jsxs("div",{className:"container mx-auto py-6 px-4 max-w-6xl",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>r("/provider/dashboard"),className:"hover:bg-[#58c9d1]/10 transition-colors h-7 text-[#58c9d1] hover:text-[#58c9d1]/80",children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),"Voltar"]}),e.jsx("div",{className:"h-4 w-px bg-[#58c9d1]/30"}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"Gerenciar Agendamentos"})]}),e.jsx("p",{className:"text-gray-600 text-xs max-w-2xl",children:"Gerencie todos os seus agendamentos, atualize status e controle pagamentos."})]}),e.jsx(h,{className:"mb-3 shadow-lg border-0 bg-white/95 backdrop-blur-sm border-[#58c9d1]/20",children:e.jsx(b,{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-[#58c9d1]"}),e.jsx(ie,{placeholder:"Buscar...",value:l,onChange:s=>L(s.target.value),className:"pl-7 h-8 text-xs bg-white border-[#58c9d1]/30 focus:border-[#58c9d1] focus:ring-[#58c9d1]/20"})]}),e.jsxs(v,{value:i||"all",onValueChange:s=>D(s==="all"?null:s),children:[e.jsx(N,{className:"h-8 text-xs bg-white border-[#58c9d1]/30 focus:border-[#58c9d1] focus:ring-[#58c9d1]/20",children:e.jsx(w,{placeholder:"Status"})}),e.jsxs(y,{className:"bg-white border border-gray-200 shadow-lg",children:[e.jsx(t,{value:"all",children:"Todos os status"}),e.jsx(t,{value:"pending",children:"Pendente"}),e.jsx(t,{value:"confirmed",children:"Confirmado"}),e.jsx(t,{value:"completed",children:"Concluído"}),e.jsx(t,{value:"canceled",children:"Cancelado"}),e.jsx(t,{value:"no_show",children:"Não Compareceu"}),e.jsx(t,{value:"executing",children:"Executando"})]})]}),e.jsxs(v,{value:n||"all",onValueChange:s=>A(s==="all"?null:s),children:[e.jsx(N,{className:"h-8 text-xs bg-white border-[#58c9d1]/30 focus:border-[#58c9d1] focus:ring-[#58c9d1]/20",children:e.jsx(w,{placeholder:"Pagamento"})}),e.jsxs(y,{className:"bg-white border border-gray-200 shadow-lg",children:[e.jsx(t,{value:"all",children:"Todos os pagamentos"}),e.jsx(t,{value:"pending",children:"Pendente"}),e.jsx(t,{value:"paid",children:"Pago"}),e.jsx(t,{value:"failed",children:"Falhou"}),e.jsx(t,{value:"refunded",children:"Reembolsado"})]})]}),(i||n||l)&&e.jsxs(j,{variant:"outline",onClick:W,className:"h-8 text-xs border-[#58c9d1]/30 hover:border-[#58c9d1] hover:bg-[#58c9d1]/5 text-[#58c9d1]",children:[e.jsx(ue,{className:"h-2 w-2 mr-1"}),"Limpar"]})]})})}),e.jsx(oe,{value:x,onValueChange:K,className:"mb-3",children:e.jsxs(ce,{className:"bg-white/95 backdrop-blur-sm border border-[#58c9d1]/20 shadow-lg h-8",children:[e.jsxs(f,{value:"all",className:"text-xs data-[state=active]:bg-[#58c9d1] data-[state=active]:text-white data-[state=active]:shadow-md",children:["Todos (",u.length,")"]}),e.jsxs(f,{value:"upcoming",className:"text-xs data-[state=active]:bg-[#58c9d1] data-[state=active]:text-white data-[state=active]:shadow-md",children:["Próximos (",u.filter(s=>new Date(`${s.date}T${s.startTime}`)>=new Date).length,")"]}),e.jsxs(f,{value:"today",className:"text-xs data-[state=active]:bg-[#58c9d1] data-[state=active]:text-white data-[state=active]:shadow-md",children:["Hoje (",u.filter(s=>P(T(s.date))).length,")"]}),e.jsxs(f,{value:"past",className:"text-xs data-[state=active]:bg-[#58c9d1] data-[state=active]:text-white data-[state=active]:shadow-md",children:["Passados (",u.filter(s=>new Date(`${s.date}T${s.startTime}`)<new Date).length,")"]})]})}),e.jsx("div",{className:"space-y-3",children:G?Array(5).fill(0).map((s,a)=>e.jsx(h,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm",children:e.jsxs(b,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between mb-3",children:[e.jsx(g,{className:"h-5 w-28"}),e.jsx(g,{className:"h-5 w-20"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(g,{className:"w-10 h-10 rounded-lg mr-3"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(g,{className:"h-4 w-36 mb-2"}),e.jsx(g,{className:"h-3 w-48"})]})]})]})},a)):$.length===0?e.jsxs(h,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm p-6 text-center",children:[e.jsx(_,{className:"h-12 w-12 mx-auto mb-3 text-gray-400"}),e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-2",children:"Nenhum agendamento encontrado"}),e.jsx("p",{className:"text-gray-600 text-sm",children:l||i||n?"Tente ajustar os filtros ou termos de busca":"Não há agendamentos para exibir"})]}):$.map(s=>e.jsx(xe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsx(h,{className:"border-0 shadow-lg bg-white/95 backdrop-blur-sm hover:shadow-xl transition-all duration-300 border-[#58c9d1]/10 hover:border-[#58c9d1]/30",children:e.jsx(b,{className:"p-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-900 truncate",children:s.clientName}),e.jsx(Q,{className:`text-xs ${ye[s.status]||"bg-gray-100 text-gray-800"}`,children:H[s.status]||s.status}),s.paymentStatus&&e.jsx(Q,{className:`text-xs ${Se[s.paymentStatus]||"bg-gray-100 text-gray-800"}`,children:Ce[s.paymentStatus]||s.paymentStatus})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600 mb-2 flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"h-2 w-2 text-[#58c9d1]"}),J(s.date)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"h-2 w-2 text-[#58c9d1]"}),V(s.startTime)," - ",V(s.endTime)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"h-2 w-2 text-[#58c9d1]"}),te(s.totalPrice||s.price||0)]})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("p",{className:"font-medium truncate",children:s.serviceName}),s.notes&&e.jsx("p",{className:"text-gray-500 mt-1 truncate",children:s.notes})]})]}),e.jsx("div",{className:"flex flex-col gap-1 ml-2",children:e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>m(s),className:"text-xs h-6 px-2 border-[#58c9d1]/30 hover:border-[#58c9d1] hover:bg-[#58c9d1]/5 text-[#58c9d1] hover:text-[#58c9d1]/80",children:[e.jsx(be,{className:"h-2 w-2 mr-1"}),"Status"]})})]})})})},s.id))})]})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[9999] p-3",children:e.jsxs(h,{className:"w-full max-w-sm border-[#58c9d1]/20 shadow-2xl bg-white relative",children:[e.jsx(re,{className:"pb-2 border-b border-[#58c9d1]/10",children:e.jsx(le,{className:"text-base text-[#58c9d1]",children:"Atualizar Status"})}),e.jsxs(b,{className:"space-y-3",children:[e.jsxs("div",{className:"text-xs",children:[e.jsxs("h4",{className:"font-medium mb-1 text-gray-900",children:["Cliente: ",o.clientName]}),e.jsx("p",{className:"text-gray-600",children:o.serviceName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700",children:"Status do Agendamento"}),e.jsxs(v,{value:o.status,onValueChange:s=>X(o,s),disabled:M.isPending,children:[e.jsx(N,{className:"h-8 text-xs border-[#58c9d1]/30 focus:border-[#58c9d1] focus:ring-[#58c9d1]/20",children:e.jsx(w,{placeholder:"Selecione o status"})}),e.jsx(y,{className:"z-[10000] bg-white border border-gray-200 shadow-lg",children:Object.entries(H).map(([s,a])=>e.jsx(t,{value:s,children:a},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700",children:"Status do Pagamento"}),e.jsxs(v,{value:o.paymentStatus||"paid",onValueChange:s=>Y(o,s),disabled:F.isPending,children:[e.jsx(N,{className:"h-8 text-xs border-[#58c9d1]/30 focus:border-[#58c9d1] focus:ring-[#58c9d1]/20",children:e.jsx(w,{placeholder:"Pago ou Pendente"})}),e.jsxs(y,{className:"z-[10000] bg-white border border-gray-200 shadow-lg",children:[e.jsx(t,{value:"pending",children:"Pendente"}),e.jsx(t,{value:"paid",children:"Pago"})]})]})]}),e.jsx("div",{className:"flex gap-2 pt-2",children:e.jsx(j,{variant:"outline",onClick:()=>{m(null),S(!1)},className:"flex-1 text-xs border-[#58c9d1]/30 hover:border-[#58c9d1] hover:bg-[#58c9d1]/5 text-[#58c9d1]",children:"Cancelar"})})]})]})})]})}export{ns as default};
