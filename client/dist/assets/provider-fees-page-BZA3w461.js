import{c as le,r as j,d as L,j as e,C as ce,f as me,g as xe,h as pe,i as he,q as T,l as v}from"./index-DOe1OCu1.js";import{u as F}from"./useMutation-Lmj9MX3Y.js";import{u as ue,t as je,o as ve,b as ge,s as V,n as fe}from"./zod-DXT7XQRH.js";import{A as Ne}from"./admin-layout-DMuYYlcx.js";import{B as n}from"./button-C168b4m4.js";import{I as D}from"./input-BHH75Tpk.js";import{T as ye,b as be,c as R,d as g,e as Ce,f}from"./table-CpYERuu-.js";import{F as B,a as d,b as l,c,d as m,f as p,e as h}from"./form-KOvJa5oz.js";import{D as O,a as M,b as Q,c as H,d as K,e as $}from"./dialog-DsJAgbDW.js";import{A as Se,b as we,c as Te,d as Fe,e as De,f as Ae,g as Ee,h as Pe}from"./alert-dialog-DHnaaDCZ.js";import{S as U}from"./switch-CGdZOur1.js";import{S as G,a as J,b as _,c as W,d as X}from"./select-CXehJHOL.js";import{S as ke}from"./skeleton-B-0dSqkR.js";import{T as Y}from"./textarea-D8qc73Fv.js";import{B as A}from"./badge-Bzn9UYFT.js";import{P as Z}from"./plus-DCNyMku-.js";import{S as qe}from"./search-Bjz8DxPP.js";import{S as Ie}from"./square-pen-B-RCtsVU.js";import{T as ee}from"./trash-2-Bi3jo0Dj.js";import{U as ze}from"./users-CKUz_ceh.js";import{D as ae}from"./dollar-sign-D5ikk9cU.js";import{R as E}from"./refresh-cw-ClGhKB9y.js";import{S as se}from"./save-C3GtLHVl.js";import"./navbar-DlESdVVP.js";import"./proxy-Ct5X7xz4.js";import"./house-Calz6FJi.js";import"./calendar-check-CY2XiYKN.js";import"./user-BQOYdOBU.js";import"./avatar-DkIWG9bC.js";import"./dropdown-menu-BOCN3PER.js";import"./index-DdZceiuF.js";import"./index-CtQ14QdP.js";import"./index-C933frGi.js";import"./index-tIxYtZzE.js";import"./index-DbsNQ1RS.js";import"./index-CQF81cx3.js";import"./chevron-right-D4BSFwhT.js";import"./check-C4wNsCXx.js";import"./circle-DjQT6JQX.js";import"./settings-CM1XtqIa.js";import"./log-out-Bcm4dD8k.js";import"./menu-ylsVJAGl.js";import"./bell-JEvyLzwJ.js";import"./arrow-left-BPt4aJQo.js";import"./calendar-Mn3IWFfL.js";import"./trending-up-CWfbCM5F.js";import"./folder-tree-CekGzc5n.js";import"./credit-card-DtANwWGP.js";import"./share-2-BYcRmu4H.js";import"./circle-help-BJUcWgq1.js";import"./book-open-DVxVhmVC.js";import"./label-MMklymaS.js";import"./index-DxOiueDc.js";import"./index-CCWTWNPs.js";import"./index-BdQq_4o_.js";import"./chevron-down-C3yMjgZz.js";const Le=ve({providerId:fe({required_error:"Selecione um prestador"}),fixedFee:V().min(1,"Valor é obrigatório").transform(i=>Math.round(parseFloat(i.replace(",","."))*100)),description:V().nullable().optional(),isActive:ge().default(!0)});function Ba(){const{toast:i}=le(),[re,u]=j.useState(!1),[ie,N]=j.useState(!1),[te,b]=j.useState(!1),[y,oe]=j.useState(""),[x,P]=j.useState(null),r=ue({resolver:je(Le),defaultValues:{fixedFee:"",description:"",isActive:!0}}),C=L({queryKey:["/api/admin/provider-fees"],queryFn:async()=>await v("/api/admin/provider-fees",{method:"GET"}),onError:a=>{i({title:"Erro ao buscar taxas",description:a.message,variant:"destructive"})}}),k=L({queryKey:["/api/admin/providers"],queryFn:async()=>await v("/api/admin/providers",{method:"GET"}),onError:a=>{i({title:"Erro ao buscar prestadores",description:a.message,variant:"destructive"})}}),S=F({mutationFn:async a=>await v("/api/admin/provider-fees",{method:"POST",body:JSON.stringify(a)}),onSuccess:()=>{i({title:"Taxa criada com sucesso",description:"A taxa de serviço foi configurada para o prestador."}),u(!1),r.reset(),T.invalidateQueries({queryKey:["/api/admin/provider-fees"]})},onError:a=>{i({title:"Erro ao criar taxa",description:a.message,variant:"destructive"})}}),w=F({mutationFn:async a=>await v(`/api/admin/provider-fees/${a.id}`,{method:"PUT",body:JSON.stringify(a)}),onSuccess:()=>{i({title:"Taxa atualizada com sucesso",description:"A taxa de serviço do prestador foi atualizada."}),N(!1),r.reset(),T.invalidateQueries({queryKey:["/api/admin/provider-fees"]})},onError:a=>{i({title:"Erro ao atualizar taxa",description:a.message,variant:"destructive"})}}),q=F({mutationFn:async a=>await v(`/api/admin/provider-fees/${a}`,{method:"DELETE"}),onSuccess:()=>{i({title:"Taxa removida com sucesso",description:"A taxa de serviço do prestador foi removida."}),b(!1),T.invalidateQueries({queryKey:["/api/admin/provider-fees"]})},onError:a=>{i({title:"Erro ao remover taxa",description:a.message,variant:"destructive"})}}),ne=a=>{P(a),r.reset({providerId:a.providerId,fixedFee:(a.fixedFee/100).toFixed(2).replace(".",","),description:a.description,isActive:a.isActive}),N(!0)},de=a=>{P(a),b(!0)},I=C.data?C.data.filter(a=>{var t,o,s;return((t=a.providerName)==null?void 0:t.toLowerCase().includes(y.toLowerCase()))||((o=a.providerEmail)==null?void 0:o.toLowerCase().includes(y.toLowerCase()))||((s=a.description)==null?void 0:s.toLowerCase().includes(y.toLowerCase()))}):[],z=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a/100);return e.jsxs(Ne,{children:[e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Taxas por Prestador"}),e.jsx("p",{className:"text-muted-foreground",children:"Configure taxas de serviço fixas personalizadas para cada prestador"})]}),e.jsxs(n,{onClick:()=>u(!0),children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Nova Taxa"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(qe,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(D,{type:"search",placeholder:"Buscar prestador...",className:"pl-8",value:y,onChange:a=>oe(a.target.value)})]})}),e.jsxs(ce,{children:[e.jsxs(me,{children:[e.jsx(xe,{children:"Taxas por Prestador"}),e.jsx(pe,{children:"Defina valores fixos de taxas para cada prestador ao invés de usar uma porcentagem padrão"})]}),e.jsx(he,{children:C.isLoading?e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((a,t)=>e.jsx(ke,{className:"h-12 w-full"},t))}):I.length>0?e.jsxs(ye,{children:[e.jsx(be,{children:e.jsxs(R,{children:[e.jsx(g,{children:"Prestador"}),e.jsx(g,{children:"Taxa Fixa"}),e.jsx(g,{children:"Descrição"}),e.jsx(g,{children:"Status"}),e.jsx(g,{className:"text-right",children:"Ações"})]})}),e.jsx(Ce,{children:I.map(a=>e.jsxs(R,{children:[e.jsx(f,{className:"font-medium",children:e.jsxs("div",{children:[e.jsx("div",{children:a.providerName||"Sem nome"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.providerEmail})]})}),e.jsx(f,{children:e.jsx(A,{variant:"outline",className:"font-mono",children:z(a.fixedFee)})}),e.jsx(f,{children:a.description||"-"}),e.jsx(f,{children:a.isActive?e.jsx(A,{variant:"success",className:"bg-green-100 text-green-800",children:"Ativo"}):e.jsx(A,{variant:"outline",className:"bg-gray-100",children:"Inativo"})}),e.jsxs(f,{className:"text-right",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>ne(a),className:"h-8 w-8",children:e.jsx(Ie,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>de(a),className:"h-8 w-8 text-destructive",children:e.jsx(ee,{className:"h-4 w-4"})})]})]},a.id))})]}):e.jsxs("div",{className:"text-center py-10",children:[e.jsx(ze,{className:"h-10 w-10 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"Nenhuma taxa configurada"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Você ainda não configurou taxas personalizadas para nenhum prestador."}),e.jsxs(n,{className:"mt-4",onClick:()=>u(!0),children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Adicionar Taxa de Prestador"]})]})})]})]}),e.jsx(O,{open:re,onOpenChange:u,children:e.jsxs(M,{className:"sm:max-w-[500px]",children:[e.jsxs(Q,{children:[e.jsx(H,{children:"Nova Taxa de Prestador"}),e.jsx(K,{children:"Configure uma taxa de serviço fixa personalizada para um prestador específico."})]}),e.jsx(B,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(a=>{S.mutate(a)}),className:"space-y-4",children:[e.jsx(d,{control:r.control,name:"providerId",render:({field:a})=>{var t,o;return e.jsxs(l,{children:[e.jsx(c,{children:"Prestador"}),e.jsxs(G,{onValueChange:s=>a.onChange(parseInt(s,10)),defaultValue:(t=a.value)==null?void 0:t.toString(),children:[e.jsx(m,{children:e.jsx(J,{children:e.jsx(_,{placeholder:"Selecione um prestador"})})}),e.jsx(W,{children:(o=k.data)==null?void 0:o.map(s=>e.jsxs(X,{value:s.id.toString(),children:[s.name," (",s.email,")"]},s.id))})]}),e.jsx(p,{children:"Selecione o prestador para definir a taxa."}),e.jsx(h,{})]})}}),e.jsx(d,{control:r.control,name:"fixedFee",render:({field:a})=>e.jsxs(l,{children:[e.jsx(c,{children:"Taxa Fixa (R$)"}),e.jsx(m,{children:e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"0,00",className:"pl-8",...a})]})}),e.jsx(p,{children:"Valor fixo que será cobrado em cada agendamento deste prestador."}),e.jsx(h,{})]})}),e.jsx(d,{control:r.control,name:"description",render:({field:a})=>e.jsxs(l,{children:[e.jsx(c,{children:"Descrição (opcional)"}),e.jsx(m,{children:e.jsx(Y,{placeholder:"Descreva o motivo desta taxa específica...",...a,value:a.value||""})}),e.jsx(h,{})]})}),e.jsx(d,{control:r.control,name:"isActive",render:({field:a})=>e.jsxs(l,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{children:"Taxa Ativa"}),e.jsx(p,{children:"Ative ou desative essa taxa de serviço"})]}),e.jsx(m,{children:e.jsx(U,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsxs($,{children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),e.jsx(n,{type:"submit",disabled:S.isPending,children:S.isPending?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2 animate-spin"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Salvar Taxa"]})})]})]})})]})}),e.jsx(O,{open:ie,onOpenChange:N,children:e.jsxs(M,{className:"sm:max-w-[500px]",children:[e.jsxs(Q,{children:[e.jsx(H,{children:"Editar Taxa de Prestador"}),e.jsx(K,{children:"Atualize a taxa de serviço fixa para o prestador selecionado."})]}),e.jsx(B,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(a=>{x&&w.mutate({...a,id:x.id})}),className:"space-y-4",children:[e.jsx(d,{control:r.control,name:"providerId",render:({field:a})=>{var t,o;return e.jsxs(l,{children:[e.jsx(c,{children:"Prestador"}),e.jsxs(G,{onValueChange:s=>a.onChange(parseInt(s,10)),value:(t=a.value)==null?void 0:t.toString(),disabled:!0,children:[e.jsx(m,{children:e.jsx(J,{children:e.jsx(_,{placeholder:"Selecione um prestador"})})}),e.jsx(W,{children:(o=k.data)==null?void 0:o.map(s=>e.jsxs(X,{value:s.id.toString(),children:[s.name," (",s.email,")"]},s.id))})]}),e.jsx(p,{children:"O prestador não pode ser alterado. Crie uma nova taxa se necessário."}),e.jsx(h,{})]})}}),e.jsx(d,{control:r.control,name:"fixedFee",render:({field:a})=>e.jsxs(l,{children:[e.jsx(c,{children:"Taxa Fixa (R$)"}),e.jsx(m,{children:e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"0,00",className:"pl-8",...a})]})}),e.jsx(p,{children:"Valor fixo que será cobrado em cada agendamento deste prestador."}),e.jsx(h,{})]})}),e.jsx(d,{control:r.control,name:"description",render:({field:a})=>e.jsxs(l,{children:[e.jsx(c,{children:"Descrição (opcional)"}),e.jsx(m,{children:e.jsx(Y,{placeholder:"Descreva o motivo desta taxa específica...",...a,value:a.value||""})}),e.jsx(h,{})]})}),e.jsx(d,{control:r.control,name:"isActive",render:({field:a})=>e.jsxs(l,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{children:"Taxa Ativa"}),e.jsx(p,{children:"Ative ou desative essa taxa de serviço"})]}),e.jsx(m,{children:e.jsx(U,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsxs($,{children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancelar"}),e.jsx(n,{type:"submit",disabled:w.isPending,children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2 animate-spin"}),"Atualizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Atualizar Taxa"]})})]})]})})]})}),e.jsx(Se,{open:te,onOpenChange:b,children:e.jsxs(we,{children:[e.jsxs(Te,{children:[e.jsx(Fe,{children:"Excluir Taxa de Prestador"}),e.jsxs(De,{children:["Tem certeza que deseja excluir esta taxa de serviço?",x&&e.jsxs("div",{className:"mt-2 p-3 bg-muted rounded-md",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Prestador:"})," ",x.providerName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Valor:"})," ",z(x.fixedFee)]})]})]})]}),e.jsxs(Ae,{children:[e.jsx(Ee,{children:"Cancelar"}),e.jsx(Pe,{onClick:()=>{x&&q.mutate(x.id)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:q.isPending?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2 animate-spin"}),"Excluindo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Excluir Taxa"]})})]})]})})]})}export{Ba as default};
