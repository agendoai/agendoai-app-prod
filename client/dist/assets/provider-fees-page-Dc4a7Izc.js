import{j as e}from"./ui-UIpCtT3r.js";import{r as j}from"./vendor-vA4cx1mx.js";import{b as le,c as L,B as n,C as ce,d as me,e as xe,f as pe,g as he,a2 as T,q as F,i as v}from"./index-DMVSlINz.js";import{u as D}from"./useMutation-mYWno7MC.js";import{u as ue,t as je,o as ve,b as ge,s as V,n as fe}from"./zod-BPPSwYm9.js";import{A as Ne}from"./admin-layout-BMhrpvyD.js";import{I as A}from"./input-swbZ2nNg.js";import{T as ye,b as be,c as B,d as g,e as Ce,f}from"./table-BurWIJog.js";import{F as R,a as d,b as l,c,d as m,f as p,e as h}from"./form-Cd6jU7SU.js";import{D as O,a as M,b as Q,c as H,d as K,e as $}from"./dialog-Ct2TP9w5.js";import{A as Se,b as we,c as Te,d as Fe,e as De,f as Ae,g as Ee,h as Pe}from"./alert-dialog-DGhL5t4S.js";import{S as U}from"./switch-Cd7tOnM5.js";import{S as G,a as J,b as _,c as W,d as X}from"./select-CQK1553m.js";import{S as ke}from"./skeleton-CgQ25LnD.js";import{T as Y}from"./textarea-C4WahNzO.js";import{B as E}from"./badge-CIXRfmkI.js";import{P as Z}from"./plus-Vuc5HB83.js";import{S as qe}from"./search-0bFur5DB.js";import{S as Ie}from"./square-pen-D-ChMROE.js";import{T as ee}from"./trash-2-CmNHyACN.js";import{U as ze}from"./users-CGD53Qtc.js";import{D as ae}from"./dollar-sign-ByvZRex2.js";import{S as se}from"./save-BS2hpAuB.js";import"./router-CxXythJb.js";import"./navbar-5CcLqczq.js";import"./proxy-CAhTMUof.js";import"./calendar-check-DBfSly3E.js";import"./user-DxXpbN3a.js";import"./avatar-DJ_tL6P_.js";import"./dropdown-menu-DwBmztZZ.js";import"./chevron-right-D0P32XR-.js";import"./check-pZ3JKVe2.js";import"./circle-CRjqYs4g.js";import"./settings-Blcd0dvr.js";import"./log-out-CiUJLpAa.js";import"./menu-DQAb75no.js";import"./bell-D5zNslsE.js";import"./arrow-left-3dZ_zEs-.js";import"./calendar-CYlMr0qt.js";import"./trending-up-BatoiHQK.js";import"./folder-tree-Kq2bE1K6.js";import"./credit-card-DTBtIUOk.js";import"./share-2-CQaeBUod.js";import"./circle-help-C8c3Z800.js";import"./book-open-B5Rj8pVZ.js";import"./label-DJxjY-7j.js";import"./index-BH3L9zMK.js";import"./index-BdQq_4o_.js";import"./chevron-down-CUS16Dcb.js";const Le=ve({providerId:fe({required_error:"Selecione um prestador"}),fixedFee:V().min(1,"Valor é obrigatório").transform(i=>Math.round(parseFloat(i.replace(",","."))*100)),description:V().nullable().optional(),isActive:ge().default(!0)});function ka(){const{toast:i}=le(),[re,u]=j.useState(!1),[ie,N]=j.useState(!1),[te,b]=j.useState(!1),[y,oe]=j.useState(""),[x,P]=j.useState(null),r=ue({resolver:je(Le),defaultValues:{fixedFee:"",description:"",isActive:!0}}),C=L({queryKey:["/api/admin/provider-fees"],queryFn:async()=>await v("/api/admin/provider-fees",{method:"GET"}),onError:a=>{i({title:"Erro ao buscar taxas",description:a.message,variant:"destructive"})}}),k=L({queryKey:["/api/admin/providers"],queryFn:async()=>await v("/api/admin/providers",{method:"GET"}),onError:a=>{i({title:"Erro ao buscar prestadores",description:a.message,variant:"destructive"})}}),S=D({mutationFn:async a=>await v("/api/admin/provider-fees",{method:"POST",body:JSON.stringify(a)}),onSuccess:()=>{i({title:"Taxa criada com sucesso",description:"A taxa de serviço foi configurada para o prestador."}),u(!1),r.reset(),F.invalidateQueries({queryKey:["/api/admin/provider-fees"]})},onError:a=>{i({title:"Erro ao criar taxa",description:a.message,variant:"destructive"})}}),w=D({mutationFn:async a=>await v(`/api/admin/provider-fees/${a.id}`,{method:"PUT",body:JSON.stringify(a)}),onSuccess:()=>{i({title:"Taxa atualizada com sucesso",description:"A taxa de serviço do prestador foi atualizada."}),N(!1),r.reset(),F.invalidateQueries({queryKey:["/api/admin/provider-fees"]})},onError:a=>{i({title:"Erro ao atualizar taxa",description:a.message,variant:"destructive"})}}),q=D({mutationFn:async a=>await v(`/api/admin/provider-fees/${a}`,{method:"DELETE"}),onSuccess:()=>{i({title:"Taxa removida com sucesso",description:"A taxa de serviço do prestador foi removida."}),b(!1),F.invalidateQueries({queryKey:["/api/admin/provider-fees"]})},onError:a=>{i({title:"Erro ao remover taxa",description:a.message,variant:"destructive"})}}),ne=a=>{P(a),r.reset({providerId:a.providerId,fixedFee:(a.fixedFee/100).toFixed(2).replace(".",","),description:a.description,isActive:a.isActive}),N(!0)},de=a=>{P(a),b(!0)},I=C.data?C.data.filter(a=>{var t,o,s;return((t=a.providerName)==null?void 0:t.toLowerCase().includes(y.toLowerCase()))||((o=a.providerEmail)==null?void 0:o.toLowerCase().includes(y.toLowerCase()))||((s=a.description)==null?void 0:s.toLowerCase().includes(y.toLowerCase()))}):[],z=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a/100);return e.jsxs(Ne,{children:[e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Taxas por Prestador"}),e.jsx("p",{className:"text-muted-foreground",children:"Configure taxas de serviço fixas personalizadas para cada prestador"})]}),e.jsxs(n,{onClick:()=>u(!0),children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Nova Taxa"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(qe,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(A,{type:"search",placeholder:"Buscar prestador...",className:"pl-8",value:y,onChange:a=>oe(a.target.value)})]})}),e.jsxs(ce,{children:[e.jsxs(me,{children:[e.jsx(xe,{children:"Taxas por Prestador"}),e.jsx(pe,{children:"Defina valores fixos de taxas para cada prestador ao invés de usar uma porcentagem padrão"})]}),e.jsx(he,{children:C.isLoading?e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((a,t)=>e.jsx(ke,{className:"h-12 w-full"},t))}):I.length>0?e.jsxs(ye,{children:[e.jsx(be,{children:e.jsxs(B,{children:[e.jsx(g,{children:"Prestador"}),e.jsx(g,{children:"Taxa Fixa"}),e.jsx(g,{children:"Descrição"}),e.jsx(g,{children:"Status"}),e.jsx(g,{className:"text-right",children:"Ações"})]})}),e.jsx(Ce,{children:I.map(a=>e.jsxs(B,{children:[e.jsx(f,{className:"font-medium",children:e.jsxs("div",{children:[e.jsx("div",{children:a.providerName||"Sem nome"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.providerEmail})]})}),e.jsx(f,{children:e.jsx(E,{variant:"outline",className:"font-mono",children:z(a.fixedFee)})}),e.jsx(f,{children:a.description||"-"}),e.jsx(f,{children:a.isActive?e.jsx(E,{variant:"success",className:"bg-green-100 text-green-800",children:"Ativo"}):e.jsx(E,{variant:"outline",className:"bg-gray-100",children:"Inativo"})}),e.jsxs(f,{className:"text-right",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>ne(a),className:"h-8 w-8",children:e.jsx(Ie,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>de(a),className:"h-8 w-8 text-destructive",children:e.jsx(ee,{className:"h-4 w-4"})})]})]},a.id))})]}):e.jsxs("div",{className:"text-center py-10",children:[e.jsx(ze,{className:"h-10 w-10 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"Nenhuma taxa configurada"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Você ainda não configurou taxas personalizadas para nenhum prestador."}),e.jsxs(n,{className:"mt-4",onClick:()=>u(!0),children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Adicionar Taxa de Prestador"]})]})})]})]}),e.jsx(O,{open:re,onOpenChange:u,children:e.jsxs(M,{className:"sm:max-w-[500px]",children:[e.jsxs(Q,{children:[e.jsx(H,{children:"Nova Taxa de Prestador"}),e.jsx(K,{children:"Configure uma taxa de serviço fixa personalizada para um prestador específico."})]}),e.jsx(R,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(a=>{S.mutate(a)}),className:"space-y-4",children:[e.jsx(d,{control:r.control,name:"providerId",render:({field:a})=>{var t,o;return e.jsxs(l,{children:[e.jsx(c,{children:"Prestador"}),e.jsxs(G,{onValueChange:s=>a.onChange(parseInt(s,10)),defaultValue:(t=a.value)==null?void 0:t.toString(),children:[e.jsx(m,{children:e.jsx(J,{children:e.jsx(_,{placeholder:"Selecione um prestador"})})}),e.jsx(W,{children:(o=k.data)==null?void 0:o.map(s=>e.jsxs(X,{value:s.id.toString(),children:[s.name," (",s.email,")"]},s.id))})]}),e.jsx(p,{children:"Selecione o prestador para definir a taxa."}),e.jsx(h,{})]})}}),e.jsx(d,{control:r.control,name:"fixedFee",render:({field:a})=>e.jsxs(l,{children:[e.jsx(c,{children:"Taxa Fixa (R$)"}),e.jsx(m,{children:e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(A,{placeholder:"0,00",className:"pl-8",...a})]})}),e.jsx(p,{children:"Valor fixo que será cobrado em cada agendamento deste prestador."}),e.jsx(h,{})]})}),e.jsx(d,{control:r.control,name:"description",render:({field:a})=>e.jsxs(l,{children:[e.jsx(c,{children:"Descrição (opcional)"}),e.jsx(m,{children:e.jsx(Y,{placeholder:"Descreva o motivo desta taxa específica...",...a,value:a.value||""})}),e.jsx(h,{})]})}),e.jsx(d,{control:r.control,name:"isActive",render:({field:a})=>e.jsxs(l,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{children:"Taxa Ativa"}),e.jsx(p,{children:"Ative ou desative essa taxa de serviço"})]}),e.jsx(m,{children:e.jsx(U,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsxs($,{children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),e.jsx(n,{type:"submit",disabled:S.isPending,children:S.isPending?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-2 animate-spin"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Salvar Taxa"]})})]})]})})]})}),e.jsx(O,{open:ie,onOpenChange:N,children:e.jsxs(M,{className:"sm:max-w-[500px]",children:[e.jsxs(Q,{children:[e.jsx(H,{children:"Editar Taxa de Prestador"}),e.jsx(K,{children:"Atualize a taxa de serviço fixa para o prestador selecionado."})]}),e.jsx(R,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(a=>{x&&w.mutate({...a,id:x.id})}),className:"space-y-4",children:[e.jsx(d,{control:r.control,name:"providerId",render:({field:a})=>{var t,o;return e.jsxs(l,{children:[e.jsx(c,{children:"Prestador"}),e.jsxs(G,{onValueChange:s=>a.onChange(parseInt(s,10)),value:(t=a.value)==null?void 0:t.toString(),disabled:!0,children:[e.jsx(m,{children:e.jsx(J,{children:e.jsx(_,{placeholder:"Selecione um prestador"})})}),e.jsx(W,{children:(o=k.data)==null?void 0:o.map(s=>e.jsxs(X,{value:s.id.toString(),children:[s.name," (",s.email,")"]},s.id))})]}),e.jsx(p,{children:"O prestador não pode ser alterado. Crie uma nova taxa se necessário."}),e.jsx(h,{})]})}}),e.jsx(d,{control:r.control,name:"fixedFee",render:({field:a})=>e.jsxs(l,{children:[e.jsx(c,{children:"Taxa Fixa (R$)"}),e.jsx(m,{children:e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(A,{placeholder:"0,00",className:"pl-8",...a})]})}),e.jsx(p,{children:"Valor fixo que será cobrado em cada agendamento deste prestador."}),e.jsx(h,{})]})}),e.jsx(d,{control:r.control,name:"description",render:({field:a})=>e.jsxs(l,{children:[e.jsx(c,{children:"Descrição (opcional)"}),e.jsx(m,{children:e.jsx(Y,{placeholder:"Descreva o motivo desta taxa específica...",...a,value:a.value||""})}),e.jsx(h,{})]})}),e.jsx(d,{control:r.control,name:"isActive",render:({field:a})=>e.jsxs(l,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(c,{children:"Taxa Ativa"}),e.jsx(p,{children:"Ative ou desative essa taxa de serviço"})]}),e.jsx(m,{children:e.jsx(U,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsxs($,{children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancelar"}),e.jsx(n,{type:"submit",disabled:w.isPending,children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-2 animate-spin"}),"Atualizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Atualizar Taxa"]})})]})]})})]})}),e.jsx(Se,{open:te,onOpenChange:b,children:e.jsxs(we,{children:[e.jsxs(Te,{children:[e.jsx(Fe,{children:"Excluir Taxa de Prestador"}),e.jsxs(De,{children:["Tem certeza que deseja excluir esta taxa de serviço?",x&&e.jsxs("div",{className:"mt-2 p-3 bg-muted rounded-md",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Prestador:"})," ",x.providerName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Valor:"})," ",z(x.fixedFee)]})]})]})]}),e.jsxs(Ae,{children:[e.jsx(Ee,{children:"Cancelar"}),e.jsx(Pe,{onClick:()=>{x&&q.mutate(x.id)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:q.isPending?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-2 animate-spin"}),"Excluindo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Excluir Taxa"]})})]})]})})]})}export{ka as default};
