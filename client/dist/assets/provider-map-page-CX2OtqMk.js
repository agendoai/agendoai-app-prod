import{j as e}from"./ui-UIpCtT3r.js";import{r as i}from"./vendor-vA4cx1mx.js";import{C as B}from"./client-layout-DcnrflWl.js";import{M as V,T as $,a as w,l as A,P as b,C as O,u as R}from"./TileLayer-CZZSNZ0w.js";import{I as F}from"./input-swbZ2nNg.js";import{b as I,B as m,C as u,d as f,e as j,f as g,g as v}from"./index-DMVSlINz.js";import{S as T}from"./slider-Rin09-ek.js";import{B as C}from"./badge-CIXRfmkI.js";import{L as E}from"./router-CxXythJb.js";import{S as L}from"./search-0bFur5DB.js";import{M as U}from"./map-pin-BJouWYuW.js";import{U as Z}from"./user-check-CCkLKyz9.js";import"./navbar-5CcLqczq.js";import"./proxy-CAhTMUof.js";import"./calendar-check-DBfSly3E.js";import"./user-DxXpbN3a.js";import"./index-BdQq_4o_.js";import"./index-BH3L9zMK.js";const k=new A.Icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});function q({coords:t}){const a=R();return a.setView(t,a.getZoom()),null}function D(){const{toast:t}=I(),[a,N]=i.useState([-23.5505,-46.6333]),[n,P]=i.useState(10),[h,z]=i.useState(""),[p,l]=i.useState(!1),S=i.useRef(null),[d,M]=i.useState([]);i.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(s=>{N([s.coords.latitude,s.coords.longitude])},s=>{console.error("Erro ao obter localização:",s),t({title:"Erro de localização",description:"Não foi possível obter sua localização atual. Usando localização padrão.",variant:"destructive"})})},[t]);const x=async()=>{if(!a)return;l(!0);const[s,o]=Array.isArray(a)?a:[a.lat,a.lng];try{const r=await fetch(`/api/providers?latitude=${s}&longitude=${o}&radius=${n}`);if(!r.ok)throw new Error("Falha ao buscar prestadores");const c=await r.json();M(c.providers||[]),t({title:"Prestadores encontrados",description:`${c.count||0} prestadores encontrados num raio de ${n}km`})}catch(r){console.error("Erro ao buscar prestadores:",r),t({title:"Erro",description:"Não foi possível buscar prestadores próximos",variant:"destructive"})}finally{l(!1)}},y=async()=>{if(!h.trim()){t({title:"Endereço vazio",description:"Digite um endereço para buscar",variant:"destructive"});return}l(!0);try{const s=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(h)}`);if(!s.ok)throw new Error("Falha ao geocodificar endereço");const o=await s.json();if(o&&o.length>0){const r=o[0];N([parseFloat(r.lat),parseFloat(r.lon)]),setTimeout(()=>{x()},500)}else t({title:"Endereço não encontrado",description:"Não foi possível encontrar o endereço especificado",variant:"destructive"})}catch(s){console.error("Erro ao buscar endereço:",s),t({title:"Erro",description:"Não foi possível buscar o endereço",variant:"destructive"})}finally{l(!1)}};return i.useEffect(()=>{a&&x()},[]),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 w-full h-full",children:[e.jsx("div",{className:"w-full md:w-3/4 h-[60vh] md:h-[80vh] relative",children:e.jsxs(V,{center:a,zoom:13,style:{height:"100%",width:"100%"},ref:S,children:[e.jsx($,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(w,{position:a,icon:k,children:e.jsx(b,{children:"Você está aqui"})}),e.jsx(O,{center:a,radius:n*1e3,pathOptions:{color:"blue",fillColor:"blue",fillOpacity:.1}}),d.map(s=>{var o;if(s.settings&&s.settings.latitude&&s.settings.longitude){const r=[s.settings.latitude,s.settings.longitude];return e.jsx(w,{position:r,icon:k,children:e.jsx(b,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-bold",children:s.name}),s.settings.businessName&&e.jsx("p",{className:"text-sm",children:s.settings.businessName}),e.jsx("p",{className:"text-xs mt-1",children:e.jsxs(C,{variant:"outline",className:"ml-1",children:[(o=s.distance)==null?void 0:o.toFixed(1),"km"]})}),e.jsx("div",{className:"mt-2",children:e.jsx(E,{href:`/providers/${s.id}`,children:e.jsx(m,{size:"sm",variant:"default",children:"Ver perfil"})})})]})})},s.id)}return null}),e.jsx(q,{coords:a})]})}),e.jsxs("div",{className:"w-full md:w-1/4 space-y-4",children:[e.jsxs(u,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Busca de Prestadores"}),e.jsx(g,{children:"Encontre prestadores de serviços próximos a você"})]}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Endereço"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{placeholder:"Digite um endereço...",value:h,onChange:s=>z(s.target.value),onKeyPress:s=>s.key==="Enter"&&y()}),e.jsx(m,{variant:"outline",size:"icon",onClick:y,disabled:p,children:e.jsx(L,{size:18})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex justify-between",children:e.jsxs("label",{className:"text-sm font-medium",children:["Raio de busca: ",n," km"]})}),e.jsx(T,{min:1,max:50,step:1,value:[n],onValueChange:s=>P(s[0])})]}),e.jsx(m,{className:"w-full",onClick:x,disabled:p,children:p?"Buscando...":"Buscar Prestadores"})]})]}),e.jsxs(u,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Prestadores Encontrados"}),e.jsxs(g,{children:[d.length," prestadores num raio de ",n,"km"]})]}),e.jsx(v,{className:"max-h-[40vh] overflow-y-auto",children:d.length===0?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Nenhum prestador encontrado nesta área"}):e.jsx("div",{className:"space-y-3",children:d.map(s=>{var o,r,c;return e.jsx(u,{className:"p-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.name}),((o=s.settings)==null?void 0:o.businessName)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.settings.businessName}),e.jsxs("div",{className:"flex items-center mt-1 gap-1",children:[e.jsx(U,{size:14,className:"text-muted-foreground"}),e.jsxs("span",{className:"text-xs",children:[(r=s.distance)==null?void 0:r.toFixed(1),"km"]}),((c=s.settings)==null?void 0:c.isOnline)&&e.jsxs(C,{variant:"outline",className:"ml-1",children:[e.jsx(Z,{size:12,className:"mr-1 text-green-500"}),"Online"]})]})]}),e.jsx(E,{href:`/providers/${s.id}`,children:e.jsx(m,{variant:"ghost",size:"sm",children:"Ver"})})]})},s.id)})})})]})]})]})}function le(){return i.useEffect(()=>{const t=document.createElement("script");return t.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",t.integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=",t.crossOrigin="",document.head.appendChild(t),()=>{document.head.removeChild(t)}},[]),e.jsx(B,{children:e.jsx("div",{className:"container mx-auto py-6 space-y-6",children:e.jsxs(u,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Mapa de Prestadores"}),e.jsx(g,{children:"Encontre prestadores de serviços próximos da sua localização"})]}),e.jsx(v,{children:e.jsx(D,{})})]})})})}export{le as default};
