import{j as e}from"./ui-UIpCtT3r.js";import{r as x}from"./vendor-vA4cx1mx.js";import{j as de,L as ce,C as K,d as U,e as V,f as W,g as Y,r as h,B as N,h as ae,i as me,u as he,c as E,o as xe,n as z}from"./index-C8-zpcKL.js";import{u as pe,b as ue}from"./router-CxXythJb.js";import{C as fe}from"./calendar-DX713B9i.js";import{C as H}from"./client-layout-DkJA58XK.js";import{P as ge,a as je,b as ye}from"./popover-Chrvm51y.js";import{A as Q,b as Z,a as X}from"./alert-CTqSX79T.js";import{B as _}from"./badge-DP5DyHeb.js";import{P as be}from"./progress-xNcuy4d3.js";import{T as ve,a as Ne,b as we,c as Se}from"./tooltip-BXcu8v5X.js";import{C as te}from"./clock-53JnXU7l.js";import{S as Te}from"./star-D5FTFs0S.js";import{T as Ce}from"./tag-siacXDaj.js";import{i as ke,f as I}from"./format-CGvBu07F.js";import{A as ee}from"./arrow-left-DbtXU75N.js";import{C as Ae}from"./calendar-CEG0wbcY.js";import{I as De}from"./info-T3nclRBe.js";import{p as Pe}from"./parse-DkXBBKDI.js";import{a as se}from"./addDays-BQ37Zmqx.js";import{p as re}from"./pt-BR-Cxqo7XV3.js";import"./en-US-xSPtgCq_.js";import"./endOfMonth-CH6FLORf.js";import"./isSameDay-BJjwZdUf.js";import"./subDays-K6OA95hK.js";import"./chevron-right-DnXY7g-Q.js";import"./chevron-left-tkC6Z4zt.js";import"./navbar-vyjn30u5.js";import"./proxy-B2Nma8Bt.js";import"./search-ChrBAPJG.js";import"./calendar-check-B0nV5Uhw.js";import"./user-CXc1AnQW.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=de("BrainCircuit",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M9 13a4.5 4.5 0 0 0 3-4",key:"10igwf"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M12 13h4",key:"1ku699"}],["path",{d:"M12 18h6a2 2 0 0 1 2 2v1",key:"105ag5"}],["path",{d:"M12 8h8",key:"1lhi5i"}],["path",{d:"M16 8V5a2 2 0 0 1 2-2",key:"u6izg6"}],["circle",{cx:"16",cy:"13",r:".5",key:"ry7gng"}],["circle",{cx:"18",cy:"3",r:".5",key:"1aiba7"}],["circle",{cx:"20",cy:"21",r:".5",key:"yhc1fs"}],["circle",{cx:"20",cy:"8",r:".5",key:"1e43v0"}]]);function Me({providerId:g,serviceId:D,date:j,availableTimeSlots:u,onSelectTimeSlot:o,selectedSlot:c}){const[C,w]=x.useState([]),[k,t]=x.useState(!0),[P,i]=x.useState("ai"),[S,y]=x.useState(!1);x.useEffect(()=>{if(u.length===0){t(!1);return}(async()=>{try{t(!0);const T=await(await me("GET",`/api/providers/${g}/ai-recommendations?date=${j}&serviceId=${D}`)).json();T.recommendations?(w(T.recommendations),i(T.source||"simple")):w([])}catch(d){console.error("Erro ao obter recomendações:",d),w([]),i("error")}finally{t(!1)}})()},[g,D,j,u]);const L={manhã:"bg-yellow-100 text-yellow-800",tarde:"bg-blue-100 text-blue-800",noite:"bg-indigo-100 text-indigo-800","horário popular":"bg-pink-100 text-pink-800","menos ocupado":"bg-green-100 text-green-800",recomendado:"bg-purple-100 text-purple-800",produtivo:"bg-cyan-100 text-cyan-800","período ótimo":"bg-emerald-100 text-emerald-800","horário de almoço":"bg-orange-100 text-orange-800","após expediente":"bg-violet-100 text-violet-800","horário cheio":"bg-slate-100 text-slate-800"},b=C.filter(r=>r.score>=70).slice(0,S?void 0:3),m=r=>u.find(d=>d.startTime===r.slot.startTime&&d.endTime===r.slot.endTime&&d.isAvailable),R=r=>c!==null&&c.startTime===r.slot.startTime&&c.endTime===r.slot.endTime,G=r=>{const d=m(r);d&&o(d)};return k?e.jsxs("div",{className:"flex flex-col items-center justify-center py-6 space-y-3 text-center",children:[e.jsx(ce,{className:"h-6 w-6 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Analisando os melhores horários..."})]}):C.length===0?null:e.jsxs(K,{className:"mb-6 bg-primary/5 border-primary/20",children:[e.jsxs(U,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5 text-primary"}),e.jsx(V,{className:"text-base font-medium",children:"Recomendações de Horários"})]}),P==="ai"?e.jsx(_,{variant:"outline",className:"bg-primary/10 text-xs",children:"Inteligente"}):e.jsx(_,{variant:"outline",className:"bg-secondary/20 text-xs",children:"Simplificado"})]}),e.jsx(W,{children:P==="ai"?"Horários recomendados com base em padrões de agendamento e preferências":"Sugestões de horários baseadas em disponibilidade"})]}),e.jsx(Y,{className:"pb-3",children:e.jsx("div",{className:"space-y-3",children:b.length>0?b.map((r,d)=>{const T=m(r),l=R(r);return!T?null:e.jsxs("div",{className:h("p-3 rounded-lg border transition-colors",l?"bg-primary border-primary text-primary-foreground":"bg-card hover:bg-accent/50"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:h("h-4 w-4",l?"text-primary-foreground":"text-primary")}),e.jsxs("span",{className:"font-medium",children:[r.slot.startTime," - ",r.slot.endTime]})]}),e.jsx(ve,{children:e.jsxs(Ne,{children:[e.jsx(we,{asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Te,{className:h("h-4 w-4",r.score>=85?"fill-yellow-400 text-yellow-400":l?"text-primary-foreground":"text-muted-foreground")}),e.jsxs("span",{className:h("text-sm font-medium",l?"text-primary-foreground":"text-muted-foreground"),children:[r.score,"%"]})]})}),e.jsx(Se,{children:e.jsx("p",{children:"Pontuação de recomendação"})})]})})]}),e.jsx("div",{className:"mb-2.5",children:e.jsx(be,{value:r.score,className:"h-1.5"})}),e.jsx("p",{className:h("text-sm mb-2.5",l?"text-primary-foreground":"text-muted-foreground"),children:r.reason}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mb-3",children:r.tags.map((f,F)=>e.jsxs("div",{className:h("text-xs px-2 py-0.5 rounded-full flex items-center gap-1",l?"bg-primary-foreground/20 text-primary-foreground":L[f]||"bg-gray-100 text-gray-800"),children:[e.jsx(Ce,{className:"h-3 w-3"}),f]},F))}),e.jsx(N,{variant:l?"secondary":"outline",size:"sm",className:"w-full",onClick:()=>G(r),children:l?"Selecionado":"Selecionar Horário"})]},d)}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-2",children:"Não foi possível gerar recomendações para os horários disponíveis."})})}),C.length>3&&e.jsx(ae,{children:e.jsx(N,{variant:"ghost",size:"sm",className:"w-full text-xs",onClick:()=>y(!S),children:S?"Mostrar menos":`Mostrar mais ${C.length-3} recomendações`})})]})}function hs(){const[,g]=pe(),{user:D}=he(),{providerId:j,serviceId:u}=ue(),o=parseInt(j),c=parseInt(u);x.useEffect(()=>{if(!new URLSearchParams(window.location.search).get("fromWizard")){g(`/client/booking-wizard?${params.toString()}`);return}},[j,u,g]);const w=new URLSearchParams(window.location.search).get("date"),k=w?Pe(w,"yyyy-MM-dd",new Date):void 0,[t,P]=x.useState(k&&ke(k)?k:void 0),[i,S]=x.useState(null),[y,L]=x.useState([]),b=t?I(t,"yyyy-MM-dd"):"",{data:m,isLoading:R,error:G}=E({queryKey:["/api/providers",o],queryFn:()=>z(`/providers/${o}`).then(s=>{if(!s.ok)throw new Error(`Erro ao buscar prestador: ${s.status}`);return s.json()}).then(s=>s).catch(s=>{throw s}),enabled:!isNaN(o)}),{data:r,isLoading:d,error:T}=E({queryKey:["/api/services",c],queryFn:()=>z(`/services/${c}`).then(s=>{if(!s.ok)throw new Error(`Erro ao buscar serviço: ${s.status}`);return s.json()}).then(s=>s).catch(s=>{throw s}),enabled:!isNaN(c)}),{data:l,isLoading:q}=E({queryKey:["/api/providers",o,"availability"],queryFn:()=>z(`/providers/${o}/availability`).then(s=>{if(s.status===401)throw new Error("Unauthorized");if(!s.ok)throw new Error(`Falha na requisição: ${s.status}`);return s.json().then(a=>a)}).catch(s=>{throw s}),enabled:!isNaN(o)});x.useEffect(()=>{if(l&&Array.isArray(l)&&l.length>0){const s=ie(l,60);L(s)}},[l]);const{data:f,isLoading:F,refetch:Ee}=E({queryKey:["/api/providers",o,"time-slots",b],queryFn:()=>{const s=`/api/providers/${o}/time-slots?date=${b}`;return fetch(s).then(a=>{if(a.status===401)throw new Error("Unauthorized");if(!a.ok)throw new Error(`Request failed with status ${a.status}`);return a.json().then(n=>n)}).catch(a=>{throw a})},enabled:!isNaN(o)&&!!b}),ie=(s,a)=>{const n=[],v=new Date,O=s.filter(p=>p.isAvailable).map(p=>p.dayOfWeek);if(O.length===0)return n;for(let p=0;p<a;p++){const M=se(v,p),le=M.getDay();O.includes(le)&&n.push(M)}return n},ne=s=>{P(s),S(null)},B=s=>{s.isAvailable&&S(s)},oe=()=>{if(t&&i){const s=I(t,"yyyy-MM-dd");if(!D){const n={providerId:j,serviceId:u,date:s,startTime:i.startTime,endTime:i.endTime,availabilityId:i.availabilityId};sessionStorage.setItem("pendingBooking",JSON.stringify(n)),g("/auth?redirect=booking");return}const a=i.availabilityId?`/${i.availabilityId}`:"";g(`/client/booking-confirmation/${j}/${u}/${s}/${i.startTime}/${i.endTime}${a}`)}},$=s=>{try{const[a,n]=s.split(":");return`${a}:${n}`}catch(a){return console.error("Erro ao formatar horário:",a),s}},J=(s,a)=>{try{if(r!=null&&r.duration)return r.duration;const n=new Date().toISOString().split("T")[0],v=new Date(`${n}T${s}`),p=new Date(`${n}T${a}`).getTime()-v.getTime(),M=Math.round(p/6e4);return Math.max(M,0)}catch(n){return console.error("Erro ao calcular duração:",n),(r==null?void 0:r.duration)||45}},A=m==null?void 0:m.user;return m==null||m.settings,R||d?e.jsx(H,{children:e.jsx("div",{className:"container py-8",children:e.jsx("div",{className:"flex justify-center items-center min-h-[50vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})})})}):!A||!r?(console.log("Erro: dados não encontrados",{providerId:o,serviceId:c,providerData:m,service:r}),e.jsx(H,{children:e.jsx("div",{className:"container py-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-destructive",children:"Informações não encontradas"}),e.jsx("p",{className:"text-muted-foreground",children:"O prestador ou serviço que você está procurando não existe ou não está mais disponível."}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:[!A&&e.jsxs("p",{children:["Prestador não encontrado (ID: ",o,")"]}),!r&&e.jsxs("p",{children:["Serviço não encontrado (ID: ",c,")"]})]}),e.jsxs(N,{onClick:()=>window.history.back(),variant:"outline",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Voltar"]})]})})})):e.jsxs(e.Fragment,{children:[e.jsx(xe,{children:e.jsx("title",{children:"Agendar Serviço | AgendoAI"})}),e.jsx(H,{children:e.jsxs("div",{className:"container py-6 space-y-6 max-w-4xl",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs(N,{variant:"ghost",onClick:()=>window.history.back(),className:"mr-4",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Voltar"]}),e.jsx("h1",{className:"text-2xl font-bold",children:"Agendar Serviço"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-1 space-y-4",children:[e.jsxs(K,{children:[e.jsxs(U,{children:[e.jsx(V,{className:"text-lg",children:"Selecione uma data"}),e.jsx(W,{children:q?"Carregando datas disponíveis...":y.length>0?"Selecione uma data disponível para o agendamento":"Sem disponibilidade cadastrada para o prestador"})]}),e.jsx(Y,{className:"pb-2",children:e.jsxs("div",{children:[y.length===0&&!q?e.jsxs(Q,{variant:"destructive",className:"mb-4",children:[e.jsx(Z,{children:"Sem disponibilidade"}),e.jsx(X,{children:"Este prestador não possui horários disponíveis no momento."})]}):e.jsxs(ge,{children:[e.jsx(je,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:h("w-full justify-start text-left font-normal mb-4",!t&&"text-muted-foreground"),children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),t?I(t,"PPP",{locale:re}):e.jsx("span",{children:"Selecione uma data"})]})}),e.jsx(ye,{className:"w-auto p-0",children:e.jsx(fe,{mode:"single",selected:t,onSelect:ne,disabled:s=>{const a=s<new Date||s>se(new Date,60),n=y.length>0&&!y.some(v=>v.getDate()===s.getDate()&&v.getMonth()===s.getMonth()&&v.getFullYear()===s.getFullYear());return a||n},modifiers:{available:y},modifiersClassNames:{available:"bg-green-100 hover:bg-green-200 text-green-700"},initialFocus:!0})})]}),e.jsxs("div",{className:"text-sm mt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Detalhes do serviço"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Prestador:"})," ",A==null?void 0:A.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Serviço:"})," ",r==null?void 0:r.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Duração:"})," ",r==null?void 0:r.duration," minutos"]}),e.jsxs("p",{className:"mt-2",children:[e.jsx("strong",{children:"Preço:"})," ",r!=null&&r.price?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r.price/100):"Carregando..."]})]})]})})]}),e.jsxs(Q,{children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx(Z,{children:"Política de Cancelamento"}),e.jsx(X,{children:"Cancelamentos devem ser feitos com pelo menos 24 horas de antecedência para reembolso total."})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs(K,{className:"h-full",children:[e.jsxs(U,{children:[e.jsx(V,{className:"text-lg",children:"Agenda do Prestador"}),e.jsx(W,{children:t?`Selecione um horário disponível para ${I(t,"EEEE, dd 'de' MMMM",{locale:re})}`:"Selecione uma data para ver os horários disponíveis"})]}),e.jsx(Y,{className:"pb-2",children:F?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})}):f&&f.length>0?e.jsxs(e.Fragment,{children:[t&&e.jsx(Me,{providerId:o,serviceId:c,date:b,availableTimeSlots:f,onSelectTimeSlot:B,selectedSlot:i}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2 mb-6",children:f.map((s,a)=>e.jsxs("button",{className:h("px-3 py-2 text-sm rounded-md flex flex-col items-center justify-center transition-colors",s.isAvailable?i===s?"bg-primary text-primary-foreground":"bg-secondary hover:bg-secondary/80":"bg-muted cursor-not-allowed opacity-50"),onClick:()=>s.isAvailable&&B(s),disabled:!s.isAvailable,children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),$(s.startTime)," - ",$(s.endTime)]}),e.jsxs("div",{className:"text-xs opacity-80",children:[r&&J(s.startTime,s.endTime)," min"]})]},a))}),e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsxs("table",{className:"w-full caption-bottom text-sm",children:[e.jsx("thead",{className:"border-b bg-muted/50",children:e.jsxs("tr",{className:"text-left",children:[e.jsx("th",{className:"p-2 font-medium",children:"Horário"}),e.jsx("th",{className:"p-2 font-medium",children:"Duração"}),e.jsx("th",{className:"p-2 font-medium",children:"Status"}),e.jsx("th",{className:"p-2 font-medium",children:"Ação"})]})}),e.jsx("tbody",{children:f.map((s,a)=>e.jsxs("tr",{className:h("border-b transition-colors",i===s&&"bg-primary/10",!s.isAvailable&&"bg-muted/30"),children:[e.jsxs("td",{className:"p-2 font-medium",children:[$(s.startTime)," - ",$(s.endTime)]}),e.jsxs("td",{className:"p-2",children:[r&&J(s.startTime,s.endTime)," min"]}),e.jsx("td",{className:"p-2",children:s.isAvailable?e.jsxs("span",{className:"inline-flex items-center rounded-full px-2 py-1 text-xs bg-green-100 text-green-800",children:[e.jsx("span",{className:"mr-1 h-1.5 w-1.5 rounded-full bg-green-600"}),"Disponível"]}):e.jsxs("span",{className:"inline-flex items-center rounded-full px-2 py-1 text-xs bg-red-100 text-red-800",children:[e.jsx("span",{className:"mr-1 h-1.5 w-1.5 rounded-full bg-red-600"}),"Ocupado"]})}),e.jsx("td",{className:"p-2",children:e.jsx(N,{variant:"outline",size:"sm",className:h(i===s&&"bg-primary text-primary-foreground"),disabled:!s.isAvailable,onClick:()=>s.isAvailable&&B(s),children:i===s?"Selecionado":"Selecionar"})})]},a))})]})})]})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:t?e.jsx("p",{children:"Não há horários disponíveis para esta data. Por favor, selecione outra data."}):e.jsx("p",{children:"Selecione uma data para ver os horários disponíveis."})})}),e.jsx(ae,{className:"pt-4",children:e.jsx(N,{className:"w-full",disabled:!t||!i,onClick:oe,children:"Continuar"})})]})})]})]})})]})}export{hs as default};
