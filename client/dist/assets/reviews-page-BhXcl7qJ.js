import{j as e}from"./ui-UIpCtT3r.js";import{c as P,b as C,q as j,i as S,o as M,s as g,B as m,u as F,C as A,d as R,f as D,g as E,m as I,p as Q,e as $}from"./index-DMVSlINz.js";import{C as H}from"./client-layout-DcnrflWl.js";import{u as b}from"./useMutation-mYWno7MC.js";import{r as p}from"./vendor-vA4cx1mx.js";import{T}from"./textarea-C4WahNzO.js";import{A as K,a as L,b as B,c as _,d as U,e as G,f as V,g as J,h as W}from"./alert-dialog-DGhL5t4S.js";import{D as X,a as Y,b as Z,c as O,d as ee,e as se}from"./dialog-Ct2TP9w5.js";import{S as ae}from"./switch-Cd7tOnM5.js";import{L as N}from"./label-DJxjY-7j.js";import{S as q}from"./star-BTI1i1jV.js";import{S as ie}from"./square-pen-D-ChMROE.js";import{T as te}from"./trash-2-CmNHyACN.js";import{M as re}from"./message-square-CHbKsffD.js";import{S as ne}from"./send-B92lcq98.js";import{f as oe}from"./format-CGvBu07F.js";import{p as le}from"./pt-BR-Cxqo7XV3.js";import{A as ce,b as de,a as me}from"./alert-93oPSpR2.js";import{S as y}from"./skeleton-CgQ25LnD.js";import"./router-CxXythJb.js";import"./navbar-5CcLqczq.js";import"./proxy-CAhTMUof.js";import"./search-0bFur5DB.js";import"./calendar-check-DBfSly3E.js";import"./user-DxXpbN3a.js";import"./index-BH3L9zMK.js";import"./en-US-xSPtgCq_.js";function ue(){return P({queryKey:["/api/client/reviews"],queryFn:M({on401:"returnNull"}),enabled:!!localStorage.getItem("authToken")})}function xe(){const{toast:s}=C();return b({mutationFn:async({id:a,...i})=>await(await S("PUT",`/api/reviews/${a}`,i)).json(),onSuccess:a=>{s({title:"Avaliação atualizada",description:"Sua avaliação foi atualizada com sucesso!"}),j.invalidateQueries({queryKey:["/api/providers",a.providerId,"reviews"]}),j.invalidateQueries({queryKey:["/api/client/reviews"]})},onError:a=>{s({title:"Erro ao atualizar avaliação",description:a.message||"Ocorreu um erro ao atualizar sua avaliação.",variant:"destructive"})}})}function pe(){const{toast:s}=C();return b({mutationFn:async a=>await(await S("DELETE",`/api/reviews/${a}`)).json(),onSuccess:(a,i)=>{s({title:"Avaliação excluída",description:"Sua avaliação foi excluída com sucesso!"}),j.invalidateQueries({queryKey:["/api/providers"]}),j.invalidateQueries({queryKey:["/api/client/reviews"]})},onError:a=>{s({title:"Erro ao excluir avaliação",description:a.message||"Ocorreu um erro ao excluir sua avaliação.",variant:"destructive"})}})}function he(){const{toast:s}=C();return b({mutationFn:async({id:a,response:i})=>await(await S("POST",`/api/reviews/${a}/response`,{response:i})).json(),onSuccess:a=>{s({title:"Resposta enviada",description:"Sua resposta à avaliação foi enviada com sucesso!"}),j.invalidateQueries({queryKey:["/api/providers",a.providerId,"reviews"]})},onError:a=>{s({title:"Erro ao enviar resposta",description:a.message||"Ocorreu um erro ao enviar sua resposta.",variant:"destructive"})}})}function ve({value:s=0,onChange:a,readOnly:i=!1,size:t="md",className:l}){const r=Math.max(0,Math.min(5,s)),o={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-7 h-7"}[t],c=Array.from({length:5}).map((h,u)=>{const d=u+1,v=d<=r,f=()=>{i||a&&a(r===d?0:d)};return e.jsx("button",{type:"button",onClick:f,className:g("focus:outline-none",i?"cursor-default":"cursor-pointer"),disabled:i,tabIndex:i?-1:0,"aria-label":`Avaliar ${d} de 5 estrelas`,children:e.jsx(q,{className:g(o,"transition-all",v?"text-yellow-400 fill-yellow-400":"text-gray-300 hover:text-yellow-200",i&&"hover:text-gray-300")})},u)});return e.jsxs("div",{className:g("flex items-center space-x-1",l),children:[c,!i&&e.jsx("span",{className:"ml-2 text-sm text-muted-foreground",children:r>0?`${r} ${r===1?"estrela":"estrelas"}`:""})]})}function je({review:s,open:a,onOpenChange:i}){const[t,l]=p.useState(s.rating),[r,n]=p.useState(s.comment||""),[o,c]=p.useState(s.isPublic||!1),{mutate:h,isPending:u}=xe(),d=()=>{h({id:s.id,rating:t,comment:r.trim()||null,isPublic:o},{onSuccess:()=>{i(!1)}})};return e.jsx(X,{open:a,onOpenChange:i,children:e.jsxs(Y,{className:"sm:max-w-[500px]",children:[e.jsxs(Z,{children:[e.jsx(O,{children:"Editar avaliação"}),e.jsx(ee,{children:"Atualize sua avaliação para este serviço."})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Sua avaliação"}),e.jsx(ve,{rating:t,onChange:l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"comment",children:"Comentário (opcional)"}),e.jsx(T,{id:"comment",placeholder:"Compartilhe sua experiência com este serviço...",value:r,onChange:v=>n(v.target.value),className:"min-h-[120px]"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{id:"isPublic",checked:o,onCheckedChange:c}),e.jsx(N,{htmlFor:"isPublic",children:"Tornar esta avaliação pública"})]})]}),e.jsxs(se,{children:[e.jsx(m,{variant:"outline",onClick:()=>i(!1),children:"Cancelar"}),e.jsx(m,{type:"submit",onClick:d,disabled:u,children:"Salvar alterações"})]})]})})}function fe({review:s,showControls:a=!1,showProviderControls:i=!1}){const{user:t}=F(),[l,r]=p.useState(!1),[n,o]=p.useState(!1),[c,h]=p.useState(""),{mutate:u}=pe(),{mutate:d,isPending:v}=he(),f=x=>x?oe(new Date(x),"dd 'de' MMMM 'de' yyyy 'às' HH:mm",{locale:le}):"Data desconhecida",z=()=>{c.trim()&&d({id:s.id,response:c.trim()},{onSuccess:()=>{h(""),o(!1)}})},k=x=>Array.from({length:5}).map((Ne,w)=>e.jsx(q,{className:`w-4 h-4 ${w<x?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},w));return e.jsxs(A,{className:"w-full",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center space-x-1 mb-1",children:k(s.rating)}),e.jsxs(D,{children:[f(s.publishedAt),!s.isPublic&&" (Privado)"]})]}),a&&(t==null?void 0:t.id)===s.clientId&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>r(!0),children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsxs(K,{children:[e.jsx(L,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",children:e.jsx(te,{className:"h-4 w-4 text-destructive"})})}),e.jsxs(B,{children:[e.jsxs(_,{children:[e.jsx(U,{children:"Excluir avaliação"}),e.jsx(G,{children:"Tem certeza que deseja excluir esta avaliação? Esta ação não pode ser desfeita."})]}),e.jsxs(V,{children:[e.jsx(J,{children:"Cancelar"}),e.jsx(W,{onClick:()=>u(s.id),className:"bg-destructive text-destructive-foreground",children:"Excluir"})]})]})]})]})]})}),e.jsxs(E,{children:[s.comment&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Comentário do cliente:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.comment})]})}),s.providerResponse&&e.jsxs("div",{className:"mt-4 p-3 bg-secondary/50 rounded-md",children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Resposta do prestador:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.providerResponse})]}),i&&(t==null?void 0:t.id)===s.providerId&&!s.providerResponse&&!n&&e.jsx("div",{className:"mt-4",children:e.jsxs(m,{variant:"outline",size:"sm",className:"flex items-center",onClick:()=>o(!0),children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Responder"]})}),n&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(T,{placeholder:"Escreva sua resposta a esta avaliação...",value:c,onChange:x=>h(x.target.value),className:"min-h-[100px]"}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>o(!1),children:"Cancelar"}),e.jsxs(m,{variant:"default",size:"sm",className:"flex items-center",onClick:z,disabled:!c.trim()||v,children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Enviar"]})]})]})]}),l&&e.jsx(je,{review:s,open:l,onOpenChange:r})]})}function ge({reviews:s,isLoading:a,error:i,emptyMessage:t="Nenhuma avaliação encontrada.",showControls:l=!1,showProviderControls:r=!1}){return a?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(n=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-3",children:[e.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(o=>e.jsx(y,{className:"w-4 h-4 rounded-full"},o))}),e.jsx(y,{className:"h-4 w-[200px]"}),e.jsx(y,{className:"h-12 w-full"})]},n))}):i?e.jsxs(ce,{variant:"destructive",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx(de,{children:"Erro"}),e.jsxs(me,{children:["Não foi possível carregar as avaliações. ",i.message]})]}):!s||s.length===0?e.jsx("div",{className:"text-center p-8 text-muted-foreground",children:t}):e.jsx("div",{className:"space-y-4",children:s.map(n=>e.jsx(fe,{review:n,showControls:l,showProviderControls:r},n.id))})}function Je(){const{data:s,isLoading:a,error:i}=ue();return e.jsxs(e.Fragment,{children:[e.jsx(Q,{children:e.jsx("title",{children:"Minhas Avaliações | AgendoAI"})}),e.jsx(H,{children:e.jsxs("div",{className:"container py-6 space-y-6 max-w-5xl",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Minhas Avaliações"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Gerencie suas avaliações para prestadores de serviços."})]}),e.jsxs(A,{children:[e.jsxs(R,{children:[e.jsx($,{children:"Avaliações Enviadas"}),e.jsx(D,{children:"Todas as avaliações que você enviou para prestadores de serviços."})]}),e.jsx(E,{children:e.jsx(ge,{reviews:s,isLoading:a,error:i,showControls:!0,emptyMessage:"Você ainda não enviou nenhuma avaliação. Após concluir um agendamento, você poderá avaliar o serviço."})})]})]})})]})}export{Je as default};
