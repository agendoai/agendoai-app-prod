import{j as e}from"./ui-UIpCtT3r.js";import{c as P,b as S,q as j,i as f,r as N,B as m,u as M,C as A,d as R,f as D,g as E,m as F,o as I,e as $}from"./index-C8-zpcKL.js";import{C as H}from"./client-layout-DkJA58XK.js";import{u as b}from"./useMutation-P96WDC87.js";import{r as p}from"./vendor-vA4cx1mx.js";import{T}from"./textarea-C9AGRwtx.js";import{A as K,a as L,b as Q,c as B,d as _,e as G,f as U,g as V,h as J}from"./alert-dialog-CLWxW7Hi.js";import{D as W,a as X,b as Y,c as Z,d as O,e as ee}from"./dialog-B9ckTsk5.js";import{S as se}from"./switch-CdyWQkqI.js";import{L as y}from"./label-BIAKwpsc.js";import{S as q}from"./star-D5FTFs0S.js";import{S as ae}from"./square-pen-6WfsyjUG.js";import{T as ie}from"./trash-2-DZ48xLrv.js";import{M as te}from"./message-square-CMlinHqp.js";import{S as re}from"./send-CRrRHsPn.js";import{f as ne}from"./format-CGvBu07F.js";import{p as oe}from"./pt-BR-Cxqo7XV3.js";import{A as le,b as ce,a as de}from"./alert-CTqSX79T.js";import{S as C}from"./skeleton-BVOxvpuD.js";import"./router-CxXythJb.js";import"./navbar-vyjn30u5.js";import"./proxy-B2Nma8Bt.js";import"./search-ChrBAPJG.js";import"./calendar-check-B0nV5Uhw.js";import"./user-CXc1AnQW.js";import"./index-BH3L9zMK.js";import"./en-US-xSPtgCq_.js";function me(){return P({queryKey:["/api/client/reviews"],queryFn:()=>f("GET","/api/client/reviews").then(s=>s.json()),enabled:!!localStorage.getItem("authToken")})}function ue(){const{toast:s}=S();return b({mutationFn:async({id:a,...i})=>await(await f("PUT",`/api/reviews/${a}`,i)).json(),onSuccess:a=>{s({title:"Avaliação atualizada",description:"Sua avaliação foi atualizada com sucesso!"}),j.invalidateQueries({queryKey:["/api/providers",a.providerId,"reviews"]}),j.invalidateQueries({queryKey:["/api/client/reviews"]})},onError:a=>{s({title:"Erro ao atualizar avaliação",description:a.message||"Ocorreu um erro ao atualizar sua avaliação.",variant:"destructive"})}})}function xe(){const{toast:s}=S();return b({mutationFn:async a=>await(await f("DELETE",`/api/reviews/${a}`)).json(),onSuccess:(a,i)=>{s({title:"Avaliação excluída",description:"Sua avaliação foi excluída com sucesso!"}),j.invalidateQueries({queryKey:["/api/providers"]}),j.invalidateQueries({queryKey:["/api/client/reviews"]})},onError:a=>{s({title:"Erro ao excluir avaliação",description:a.message||"Ocorreu um erro ao excluir sua avaliação.",variant:"destructive"})}})}function pe(){const{toast:s}=S();return b({mutationFn:async({id:a,response:i})=>await(await f("POST",`/api/reviews/${a}/response`,{response:i})).json(),onSuccess:a=>{s({title:"Resposta enviada",description:"Sua resposta à avaliação foi enviada com sucesso!"}),j.invalidateQueries({queryKey:["/api/providers",a.providerId,"reviews"]})},onError:a=>{s({title:"Erro ao enviar resposta",description:a.message||"Ocorreu um erro ao enviar sua resposta.",variant:"destructive"})}})}function he({value:s=0,onChange:a,readOnly:i=!1,size:t="md",className:l}){const r=Math.max(0,Math.min(5,s)),o={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-7 h-7"}[t],c=Array.from({length:5}).map((h,u)=>{const d=u+1,v=d<=r,g=()=>{i||a&&a(r===d?0:d)};return e.jsx("button",{type:"button",onClick:g,className:N("focus:outline-none",i?"cursor-default":"cursor-pointer"),disabled:i,tabIndex:i?-1:0,"aria-label":`Avaliar ${d} de 5 estrelas`,children:e.jsx(q,{className:N(o,"transition-all",v?"text-yellow-400 fill-yellow-400":"text-gray-300 hover:text-yellow-200",i&&"hover:text-gray-300")})},u)});return e.jsxs("div",{className:N("flex items-center space-x-1",l),children:[c,!i&&e.jsx("span",{className:"ml-2 text-sm text-muted-foreground",children:r>0?`${r} ${r===1?"estrela":"estrelas"}`:""})]})}function ve({review:s,open:a,onOpenChange:i}){const[t,l]=p.useState(s.rating),[r,n]=p.useState(s.comment||""),[o,c]=p.useState(s.isPublic||!1),{mutate:h,isPending:u}=ue(),d=()=>{h({id:s.id,rating:t,comment:r.trim()||null,isPublic:o},{onSuccess:()=>{i(!1)}})};return e.jsx(W,{open:a,onOpenChange:i,children:e.jsxs(X,{className:"sm:max-w-[500px]",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Editar avaliação"}),e.jsx(O,{children:"Atualize sua avaliação para este serviço."})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Sua avaliação"}),e.jsx(he,{rating:t,onChange:l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"comment",children:"Comentário (opcional)"}),e.jsx(T,{id:"comment",placeholder:"Compartilhe sua experiência com este serviço...",value:r,onChange:v=>n(v.target.value),className:"min-h-[120px]"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{id:"isPublic",checked:o,onCheckedChange:c}),e.jsx(y,{htmlFor:"isPublic",children:"Tornar esta avaliação pública"})]})]}),e.jsxs(ee,{children:[e.jsx(m,{variant:"outline",onClick:()=>i(!1),children:"Cancelar"}),e.jsx(m,{type:"submit",onClick:d,disabled:u,children:"Salvar alterações"})]})]})})}function je({review:s,showControls:a=!1,showProviderControls:i=!1}){const{user:t}=M(),[l,r]=p.useState(!1),[n,o]=p.useState(!1),[c,h]=p.useState(""),{mutate:u}=xe(),{mutate:d,isPending:v}=pe(),g=x=>x?ne(new Date(x),"dd 'de' MMMM 'de' yyyy 'às' HH:mm",{locale:oe}):"Data desconhecida",z=()=>{c.trim()&&d({id:s.id,response:c.trim()},{onSuccess:()=>{h(""),o(!1)}})},k=x=>Array.from({length:5}).map((ge,w)=>e.jsx(q,{className:`w-4 h-4 ${w<x?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},w));return e.jsxs(A,{className:"w-full",children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center space-x-1 mb-1",children:k(s.rating)}),e.jsxs(D,{children:[g(s.publishedAt),!s.isPublic&&" (Privado)"]})]}),a&&(t==null?void 0:t.id)===s.clientId&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>r(!0),children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsxs(K,{children:[e.jsx(L,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",children:e.jsx(ie,{className:"h-4 w-4 text-destructive"})})}),e.jsxs(Q,{children:[e.jsxs(B,{children:[e.jsx(_,{children:"Excluir avaliação"}),e.jsx(G,{children:"Tem certeza que deseja excluir esta avaliação? Esta ação não pode ser desfeita."})]}),e.jsxs(U,{children:[e.jsx(V,{children:"Cancelar"}),e.jsx(J,{onClick:()=>u(s.id),className:"bg-destructive text-destructive-foreground",children:"Excluir"})]})]})]})]})]})}),e.jsxs(E,{children:[s.comment&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Comentário do cliente:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.comment})]})}),s.providerResponse&&e.jsxs("div",{className:"mt-4 p-3 bg-secondary/50 rounded-md",children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Resposta do prestador:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.providerResponse})]}),i&&(t==null?void 0:t.id)===s.providerId&&!s.providerResponse&&!n&&e.jsx("div",{className:"mt-4",children:e.jsxs(m,{variant:"outline",size:"sm",className:"flex items-center",onClick:()=>o(!0),children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Responder"]})}),n&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(T,{placeholder:"Escreva sua resposta a esta avaliação...",value:c,onChange:x=>h(x.target.value),className:"min-h-[100px]"}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>o(!1),children:"Cancelar"}),e.jsxs(m,{variant:"default",size:"sm",className:"flex items-center",onClick:z,disabled:!c.trim()||v,children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Enviar"]})]})]})]}),l&&e.jsx(ve,{review:s,open:l,onOpenChange:r})]})}function fe({reviews:s,isLoading:a,error:i,emptyMessage:t="Nenhuma avaliação encontrada.",showControls:l=!1,showProviderControls:r=!1}){return a?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(n=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-3",children:[e.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(o=>e.jsx(C,{className:"w-4 h-4 rounded-full"},o))}),e.jsx(C,{className:"h-4 w-[200px]"}),e.jsx(C,{className:"h-12 w-full"})]},n))}):i?e.jsxs(le,{variant:"destructive",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx(ce,{children:"Erro"}),e.jsxs(de,{children:["Não foi possível carregar as avaliações. ",i.message]})]}):!s||s.length===0?e.jsx("div",{className:"text-center p-8 text-muted-foreground",children:t}):e.jsx("div",{className:"space-y-4",children:s.map(n=>e.jsx(je,{review:n,showControls:l,showProviderControls:r},n.id))})}function Ve(){const{data:s,isLoading:a,error:i}=me();return e.jsxs(e.Fragment,{children:[e.jsx(I,{children:e.jsx("title",{children:"Minhas Avaliações | AgendoAI"})}),e.jsx(H,{children:e.jsxs("div",{className:"container py-6 space-y-6 max-w-5xl",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Minhas Avaliações"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Gerencie suas avaliações para prestadores de serviços."})]}),e.jsxs(A,{children:[e.jsxs(R,{children:[e.jsx($,{children:"Avaliações Enviadas"}),e.jsx(D,{children:"Todas as avaliações que você enviou para prestadores de serviços."})]}),e.jsx(E,{children:e.jsx(fe,{reviews:s,isLoading:a,error:i,showControls:!0,emptyMessage:"Você ainda não enviou nenhuma avaliação. Após concluir um agendamento, você poderá avaliar o serviço."})})]})]})})]})}export{Ve as default};
