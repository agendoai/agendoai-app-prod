import{j as e}from"./ui-UIpCtT3r.js";import{r as n,a as L}from"./vendor-vA4cx1mx.js";import{j as O,r as I,c as f,C as p,g as h,d as u,e as j,f as N}from"./index-BJ9Cw0LR.js";import{P as D}from"./page-transition-BoMAQpsl.js";import{S as T,a as E,b as B,c as V,d as b}from"./select-hCrJFe1P.js";import{B as g}from"./button-BvsVcTDx.js";import{p as q,C as U}from"./calendar-BHDT7uQV.js";import{P as H,a as K,b as R}from"./popover-Cm05a-D6.js";import{C as $}from"./calendar-tibBNAR3.js";import{f as Q}from"./format-CGvBu07F.js";import{L as w}from"./label-qfvszZNj.js";import{l as C,M as W,T as Z,a as y,P as S,C as G,u as J}from"./TileLayer-CZZSNZ0w.js";import{F as X}from"./filter-DD6WvVwF.js";import{S as Y}from"./search-ByWcnwgm.js";import"./router-CxXythJb.js";import"./proxy-Bw6ASuXk.js";import"./index-BdQq_4o_.js";import"./index-BH3L9zMK.js";import"./chevron-down-Dg2l6tfZ.js";import"./check-ZbxB06uW.js";import"./en-US-xSPtgCq_.js";import"./endOfMonth-CH6FLORf.js";import"./isSameDay-BJjwZdUf.js";import"./addDays-BQ37Zmqx.js";import"./subDays-K6OA95hK.js";import"./chevron-right-CATzdtP3.js";import"./chevron-left-_ap2kAKS.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=O("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);function ee({date:a,onSelect:t,placeholderText:d="Selecione uma data",className:o}){return e.jsxs(H,{children:[e.jsx(K,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:I("w-full justify-start text-left font-normal",!a&&"text-muted-foreground",o),children:[e.jsx($,{className:"mr-2 h-4 w-4"}),a?Q(a,"PPP",{locale:q}):e.jsx("span",{children:d})]})}),e.jsx(R,{className:"w-auto p-0",align:"start",children:e.jsx(U,{mode:"single",selected:a,onSelect:t,initialFocus:!0})})]})}function se({center:a}){const t=J();return n.useEffect(()=>{t.setView(a)},[a,t]),null}const ae=({serviceId:a,initialCenter:t=[-23.5558,-46.6396],initialZoom:d=12})=>{const[o,x]=n.useState(t),[m,v]=n.useState(null),[l,r]=n.useState(null),{data:F=[],isLoading:k}=f({queryKey:["/api/providers/locations",a],queryFn:async()=>{const s=a?`/api/providers/locations?serviceId=${a}`:"/api/providers/locations",i=await fetch(s);if(!i.ok)throw new Error("Falha ao buscar localizações dos prestadores");return i.json()},enabled:!0});n.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(s=>{const{latitude:i,longitude:c}=s.coords;v([i,c]),x([i,c])},s=>{console.error("Erro ao obter localização:",s)})},[]);const z=new C.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),P=new C.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),A=s=>{const i=s.availability||0;return i>=75?{fillColor:"#4CAF50",color:"#4CAF50",fillOpacity:.3}:i>=50?{fillColor:"#8BC34A",color:"#8BC34A",fillOpacity:.3}:i>=25?{fillColor:"#FFC107",color:"#FFC107",fillOpacity:.3}:{fillColor:"#F44336",color:"#F44336",fillOpacity:.2}};return k?e.jsx("div",{className:"h-full flex items-center justify-center",children:"Carregando mapa de disponibilidade..."}):e.jsx(p,{className:"w-full",children:e.jsx(h,{className:"p-0",children:e.jsxs("div",{className:"h-[500px] w-full relative",children:[e.jsxs(W,{center:o,zoom:d,style:{height:"100%",width:"100%"},zoomControl:!1,children:[e.jsx(Z,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(se,{center:o}),m&&e.jsx(y,{position:m,icon:P,children:e.jsx(S,{children:"Sua localização"})}),F.map(s=>{const i=parseFloat(s.latitude),c=parseFloat(s.longitude);if(isNaN(i)||isNaN(c))return null;const M=500+(s.availability||0)*10;return e.jsxs(L.Fragment,{children:[e.jsx(G,{center:[i,c],radius:M,...A(s),eventHandlers:{click:()=>r(s)}}),e.jsx(y,{position:[i,c],icon:z,eventHandlers:{click:()=>r(s)},children:e.jsx(S,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-bold text-sm",children:s.businessName||s.name}),e.jsx("p",{className:"text-xs",children:s.isOnline?e.jsx("span",{className:"text-green-500",children:"● Online"}):e.jsx("span",{className:"text-gray-500",children:"● Offline"})}),s.serviceCount&&e.jsxs("p",{className:"text-xs mt-1",children:[s.serviceCount," serviços disponíveis"]}),s.rating&&e.jsxs("p",{className:"text-xs",children:[(s.rating/10).toFixed(1)," ★"]})]})})})]},s.id)})]}),l&&e.jsxs("div",{className:"absolute top-3 right-3 w-64 bg-white rounded-md shadow-lg p-3 border z-[1000]",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"font-bold",children:l.businessName||l.name}),e.jsx("button",{className:"text-xs text-gray-400",onClick:()=>r(null),children:"✕"})]}),e.jsx("p",{className:"text-sm mt-1",children:l.isOnline?e.jsx("span",{className:"text-green-500",children:"● Online"}):e.jsx("span",{className:"text-gray-500",children:"● Offline"})}),l.rating&&e.jsxs("p",{className:"text-sm",children:["Avaliação: ",(l.rating/10).toFixed(1)," ★"]}),l.serviceCount&&e.jsxs("p",{className:"text-sm",children:[l.serviceCount," serviços"]}),l.availability!==void 0&&e.jsxs("p",{className:"text-sm",children:["Disponibilidade: ",l.availability,"%"]}),e.jsx("div",{className:"flex justify-center mt-3",children:e.jsx(g,{size:"sm",className:"w-full",onClick:()=>{window.location.href=`/provider/${l.id}`},children:"Ver Perfil"})})]}),m&&e.jsx("button",{className:"absolute bottom-4 right-4 p-2 bg-white rounded-full shadow-md z-[1000]",onClick:()=>x(m),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-navigation",children:e.jsx("polygon",{points:"3 11 22 2 13 21 11 13 3 11"})})})]})})})};function Ae(){const[a,t]=n.useState(""),[d,o]=n.useState(void 0),{data:x=[],isLoading:m}=f({queryKey:["/api/services"]}),{data:v=[],isLoading:l}=f({queryKey:["/api/categories"]});return e.jsx(D,{children:e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Mapa de Disponibilidade de Serviços"}),e.jsx("p",{className:"text-muted-foreground",children:"Visualize a disponibilidade de prestadores de serviços por localização."})]}),e.jsxs(p,{children:[e.jsxs(u,{children:[e.jsxs(j,{className:"text-lg flex items-center",children:[e.jsx(X,{className:"mr-2 h-5 w-5"}),"Filtros"]}),e.jsx(N,{children:"Filtre por serviço, categoria ou data para visualizar a disponibilidade."})]}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"service",children:"Serviço"}),e.jsxs(T,{value:a,onValueChange:t,children:[e.jsx(E,{id:"service",children:e.jsx(B,{placeholder:"Selecione um serviço"})}),e.jsxs(V,{children:[e.jsx(b,{value:"",children:"Todos os serviços"}),x.map(r=>e.jsx(b,{value:r.id.toString(),children:r.name},r.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"date",children:"Data"}),e.jsx(ee,{date:d,onSelect:o,placeholderText:"Selecione uma data"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(g,{className:"w-full",onClick:()=>{},children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Aplicar Filtros"]})})]})})]}),e.jsxs(p,{children:[e.jsxs(u,{children:[e.jsxs(j,{className:"text-lg flex items-center",children:[e.jsx(_,{className:"mr-2 h-5 w-5"}),"Mapa de Disponibilidade"]}),e.jsx(N,{children:"As áreas em verde indicam alta disponibilidade, enquanto as áreas em vermelho indicam baixa disponibilidade."})]}),e.jsx(h,{className:"p-0",children:e.jsx(ae,{serviceId:a?parseInt(a):void 0,initialCenter:[-23.5558,-46.6396],initialZoom:12})})]}),e.jsxs(p,{children:[e.jsx(u,{children:e.jsx(j,{className:"text-lg",children:"Legenda"})}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500"}),e.jsx("span",{className:"text-sm",children:"Alta disponibilidade (75-100%)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-yellow-500"}),e.jsx("span",{className:"text-sm",children:"Média disponibilidade (50-75%)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500"}),e.jsx("span",{className:"text-sm",children:"Baixa disponibilidade (25-50%)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500"}),e.jsx("span",{className:"text-sm",children:"Muito baixa disponibilidade (0-25%)"})]})]})})]})]})})}export{Ae as default};
