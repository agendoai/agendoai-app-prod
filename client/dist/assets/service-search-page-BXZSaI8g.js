import{j as s}from"./ui-UIpCtT3r.js";import{C as V}from"./client-layout-DcnrflWl.js";import{A as W}from"./app-header-wB_4hYan.js";import{r as t}from"./vendor-vA4cx1mx.js";import{I as c}from"./input-swbZ2nNg.js";import{n as j,B as v,G as J,C as K}from"./index-DMVSlINz.js";import{B as E}from"./badge-CIXRfmkI.js";import{M as O}from"./map-pin-BJouWYuW.js";import{S as Q}from"./search-0bFur5DB.js";import{S as X}from"./star-BTI1i1jV.js";import"./navbar-5CcLqczq.js";import"./router-CxXythJb.js";import"./proxy-CAhTMUof.js";import"./calendar-check-DBfSly3E.js";import"./user-DxXpbN3a.js";import"./avatar-DJ_tL6P_.js";import"./dropdown-menu-DwBmztZZ.js";import"./chevron-right-D0P32XR-.js";import"./check-pZ3JKVe2.js";import"./circle-CRjqYs4g.js";import"./arrow-left-3dZ_zEs-.js";import"./bell-D5zNslsE.js";import"./ellipsis-vertical-BwovH0yi.js";import"./calendar-CYlMr0qt.js";import"./settings-Blcd0dvr.js";import"./circle-help-C8c3Z800.js";import"./message-square-CHbKsffD.js";import"./log-out-CiUJLpAa.js";function Y(){const[d,B]=t.useState(""),[L,A]=t.useState(""),[P,m]=t.useState(!1),[p,R]=t.useState(null),[z,D]=t.useState([]),[G,N]=t.useState([]),[M,S]=t.useState([]),[r,U]=t.useState(""),[i,y]=t.useState(""),[x,h]=t.useState(""),[u,F]=t.useState(""),[f,$]=t.useState(""),[b,w]=t.useState(!1),[q,C]=t.useState([]),[k,n]=t.useState("");t.useEffect(()=>{fetch("/api/niches").then(e=>e.json()).then(e=>D(e||[]))},[]),t.useEffect(()=>{r?j(`/niches/${r}/categories`).then(e=>e.json()).then(e=>N(e||[])):N([]),y(""),h("")},[r]),t.useEffect(()=>{i?j(`/services?categoryId=${i}`).then(e=>e.json()).then(e=>S(e||[])):S([]),h("")},[i]);const H=()=>{if(!navigator.geolocation){n("Geolocalização não suportada.");return}n(""),m(!0),navigator.geolocation.getCurrentPosition(e=>{R({lat:e.coords.latitude,lng:e.coords.longitude}),m(!1)},()=>{n("Não foi possível obter sua localização."),m(!1)})},T=async e=>{e.preventDefault(),w(!0),n(""),C([]);const a=new URLSearchParams;d&&a.append("q",d),r&&a.append("nicheId",r),i&&a.append("categoryId",i),x&&a.append("serviceId",x),u&&a.append("minRating",u),f&&a.append("maxDistance",f),p&&(a.append("lat",String(p.lat)),a.append("lng",String(p.lng)));try{const o=await(await j(`/providers/optimized/search?${a.toString()}`)).json();C(o.providers||[]),(!o.providers||o.providers.length===0)&&n("Nenhum prestador encontrado.")}catch{n("Erro ao buscar prestadores.")}finally{w(!1)}};return s.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[s.jsxs("form",{onSubmit:T,className:"bg-white rounded-xl shadow p-4 flex flex-col gap-4 mb-6",children:[s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4",children:[s.jsx(c,{placeholder:"Nome do prestador",value:d,onChange:e=>B(e.target.value)}),s.jsx(c,{placeholder:"Endereço ou região",value:L,onChange:e=>A(e.target.value)}),s.jsxs(v,{type:"button",variant:"outline",onClick:H,disabled:P,children:[s.jsx(O,{className:"w-4 h-4 mr-1"})," Usar minha localização"]})]}),s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4",children:[s.jsxs("select",{className:"border rounded px-2 py-1",value:r,onChange:e=>U(e.target.value),children:[s.jsx("option",{value:"",children:"Nicho"}),z.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsxs("select",{className:"border rounded px-2 py-1",value:i,onChange:e=>y(e.target.value),disabled:!r,children:[s.jsx("option",{value:"",children:"Categoria"}),G.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsxs("select",{className:"border rounded px-2 py-1",value:x,onChange:e=>h(e.target.value),disabled:!i,children:[s.jsx("option",{value:"",children:"Serviço"}),M.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4",children:[s.jsx(c,{placeholder:"Avaliação mínima",type:"number",min:"0",max:"5",value:u,onChange:e=>F(e.target.value)}),s.jsx(c,{placeholder:"Distância máxima (km)",type:"number",min:"1",value:f,onChange:e=>$(e.target.value)}),s.jsxs(v,{type:"submit",className:"flex items-center gap-2",disabled:b,children:[s.jsx(Q,{className:"w-4 h-4"})," Buscar"]})]})]}),b&&s.jsx("div",{className:"flex justify-center py-8",children:s.jsx(J,{})}),k&&s.jsx("div",{className:"text-center text-red-500 mb-4",children:k}),s.jsx("div",{className:"grid gap-4",children:q.map(e=>{var a,l,o,I;return s.jsxs(K,{className:"p-4 flex flex-col sm:flex-row gap-4 items-center shadow-md hover:shadow-xl transition-shadow",children:[s.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-2xl",children:((a=e.name)==null?void 0:a.charAt(0))||"?"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-bold text-lg text-primary",children:e.name}),((l=e.settings)==null?void 0:l.rating)&&s.jsxs("span",{className:"flex items-center gap-1 text-amber-500 font-semibold",children:[s.jsx(X,{size:16})," ",e.settings.rating]}),e.distance&&s.jsxs(E,{className:"ml-2 bg-primary/10 text-primary",children:[e.distance," km"]})]}),s.jsx("div",{className:"text-sm text-neutral-600",children:(o=e.settings)==null?void 0:o.businessName}),s.jsx("div",{className:"flex gap-2 mt-1 flex-wrap",children:(I=e.services)==null?void 0:I.map(g=>s.jsx(E,{className:"bg-primary/10 text-primary",children:g.serviceName||g.name},g.serviceId))})]}),s.jsx(v,{className:"bg-primary text-white mt-2 sm:mt-0",onClick:()=>window.location.href=`/providers/${e.id}`,children:"Ver perfil"})]},e.id)})})]})}function ke(){return s.jsxs(V,{children:[s.jsx(W,{showUserInfo:!0,showNotificationIcon:!0,userType:"client"}),s.jsxs("div",{className:"max-w-3xl mx-auto p-4",children:[s.jsx("h1",{className:"text-3xl font-extrabold text-primary dark:text-white mb-6 text-center",children:"Buscar Prestadores"}),s.jsx(Y,{}),s.jsxs("div",{className:"flex flex-col items-center py-6 text-neutral-500 dark:text-neutral-400",children:[s.jsxs("svg",{width:"64",height:"64",fill:"none",viewBox:"0 0 64 64",children:[s.jsx("circle",{cx:"32",cy:"32",r:"32",fill:"#F3F4F6"}),s.jsx("path",{d:"M32 20v12l8 4",stroke:"#6366F1",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),s.jsx("p",{className:"mt-2",children:"Nenhum prestador encontrado."})]})]})]})}export{ke as default};
