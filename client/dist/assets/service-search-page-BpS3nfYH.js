import{r as s,j as t,O,C as T}from"./index-DFO2lo2s.js";import{C as V}from"./client-layout-Dqh0s42V.js";import{A as W}from"./app-header-DqrHdmor.js";import{I as c}from"./input-DGvqAMIq.js";import{B as j}from"./button-6IH7luFD.js";import{B as I}from"./badge-DWGHGqHr.js";import{M as J}from"./map-pin-wlEWBw89.js";import{S as K}from"./search-CMPUhstB.js";import{S as Q}from"./star-CkZPtYKi.js";import"./navbar-BoNMuwo_.js";import"./proxy-BltBotVH.js";import"./house-sGd4nDnu.js";import"./calendar-check-CDRCjfO9.js";import"./user-WwS7npix.js";import"./avatar-CVSf1ztN.js";import"./dropdown-menu-ap6SW7g-.js";import"./index-BZw1vT_C.js";import"./index-BEl4sio8.js";import"./index-r8gFfIDH.js";import"./index-heHCkeO_.js";import"./index-CWnO1h2h.js";import"./index-zokK3oQV.js";import"./chevron-right-BpYdX1P5.js";import"./check-C4mt73Rm.js";import"./circle-AYNPgkgN.js";import"./arrow-left-DxjewkX7.js";import"./bell-BMDILFyN.js";import"./ellipsis-vertical-DYWZ3H3h.js";import"./calendar-CXCri533.js";import"./settings-DgRwRsZF.js";import"./circle-help-HpEjPFgh.js";import"./message-square-CVPf25-9.js";import"./log-out-CXzoyitA.js";function X(){const[m,E]=s.useState(""),[B,L]=s.useState(""),[A,d]=s.useState(!1),[p,P]=s.useState(null),[R,z]=s.useState([]),[D,v]=s.useState([]),[M,N]=s.useState([]),[r,U]=s.useState(""),[i,S]=s.useState(""),[x,h]=s.useState(""),[u,F]=s.useState(""),[f,G]=s.useState(""),[y,b]=s.useState(!1),[$,w]=s.useState([]),[C,o]=s.useState("");s.useEffect(()=>{fetch("/api/niches").then(e=>e.json()).then(e=>z(e||[]))},[]),s.useEffect(()=>{r?fetch(`/api/niches/${r}/categories`).then(e=>e.json()).then(e=>v(e||[])):v([]),S(""),h("")},[r]),s.useEffect(()=>{i?fetch(`/api/services?categoryId=${i}`).then(e=>e.json()).then(e=>N(e||[])):N([]),h("")},[i]);const q=()=>{if(!navigator.geolocation){o("Geolocalização não suportada.");return}o(""),d(!0),navigator.geolocation.getCurrentPosition(e=>{P({lat:e.coords.latitude,lng:e.coords.longitude}),d(!1)},()=>{o("Não foi possível obter sua localização."),d(!1)})},H=async e=>{e.preventDefault(),b(!0),o(""),w([]);const a=new URLSearchParams;m&&a.append("q",m),r&&a.append("nicheId",r),i&&a.append("categoryId",i),x&&a.append("serviceId",x),u&&a.append("minRating",u),f&&a.append("maxDistance",f),p&&(a.append("lat",String(p.lat)),a.append("lng",String(p.lng)));try{const n=await(await fetch(`/api/providers/optimized/search?${a.toString()}`)).json();w(n.providers||[]),(!n.providers||n.providers.length===0)&&o("Nenhum prestador encontrado.")}catch{o("Erro ao buscar prestadores.")}finally{b(!1)}};return t.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[t.jsxs("form",{onSubmit:H,className:"bg-white rounded-xl shadow p-4 flex flex-col gap-4 mb-6",children:[t.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4",children:[t.jsx(c,{placeholder:"Nome do prestador",value:m,onChange:e=>E(e.target.value)}),t.jsx(c,{placeholder:"Endereço ou região",value:B,onChange:e=>L(e.target.value)}),t.jsxs(j,{type:"button",variant:"outline",onClick:q,disabled:A,children:[t.jsx(J,{className:"w-4 h-4 mr-1"})," Usar minha localização"]})]}),t.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4",children:[t.jsxs("select",{className:"border rounded px-2 py-1",value:r,onChange:e=>U(e.target.value),children:[t.jsx("option",{value:"",children:"Nicho"}),R.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsxs("select",{className:"border rounded px-2 py-1",value:i,onChange:e=>S(e.target.value),disabled:!r,children:[t.jsx("option",{value:"",children:"Categoria"}),D.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsxs("select",{className:"border rounded px-2 py-1",value:x,onChange:e=>h(e.target.value),disabled:!i,children:[t.jsx("option",{value:"",children:"Serviço"}),M.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),t.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4",children:[t.jsx(c,{placeholder:"Avaliação mínima",type:"number",min:"0",max:"5",value:u,onChange:e=>F(e.target.value)}),t.jsx(c,{placeholder:"Distância máxima (km)",type:"number",min:"1",value:f,onChange:e=>G(e.target.value)}),t.jsxs(j,{type:"submit",className:"flex items-center gap-2",disabled:y,children:[t.jsx(K,{className:"w-4 h-4"})," Buscar"]})]})]}),y&&t.jsx("div",{className:"flex justify-center py-8",children:t.jsx(O,{})}),C&&t.jsx("div",{className:"text-center text-red-500 mb-4",children:C}),t.jsx("div",{className:"grid gap-4",children:$.map(e=>{var a,l,n,k;return t.jsxs(T,{className:"p-4 flex flex-col sm:flex-row gap-4 items-center shadow-md hover:shadow-xl transition-shadow",children:[t.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-2xl",children:((a=e.name)==null?void 0:a.charAt(0))||"?"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-bold text-lg text-primary",children:e.name}),((l=e.settings)==null?void 0:l.rating)&&t.jsxs("span",{className:"flex items-center gap-1 text-amber-500 font-semibold",children:[t.jsx(Q,{size:16})," ",e.settings.rating]}),e.distance&&t.jsxs(I,{className:"ml-2 bg-primary/10 text-primary",children:[e.distance," km"]})]}),t.jsx("div",{className:"text-sm text-neutral-600",children:(n=e.settings)==null?void 0:n.businessName}),t.jsx("div",{className:"flex gap-2 mt-1 flex-wrap",children:(k=e.services)==null?void 0:k.map(g=>t.jsx(I,{className:"bg-primary/10 text-primary",children:g.serviceName||g.name},g.serviceId))})]}),t.jsx(j,{className:"bg-primary text-white mt-2 sm:mt-0",onClick:()=>window.location.href=`/providers/${e.id}`,children:"Ver perfil"})]},e.id)})})]})}function Le(){return t.jsxs(V,{children:[t.jsx(W,{showUserInfo:!0,showNotificationIcon:!0,userType:"client"}),t.jsxs("div",{className:"max-w-3xl mx-auto p-4",children:[t.jsx("h1",{className:"text-3xl font-extrabold text-primary dark:text-white mb-6 text-center",children:"Buscar Prestadores"}),t.jsx(X,{}),t.jsxs("div",{className:"flex flex-col items-center py-6 text-neutral-500 dark:text-neutral-400",children:[t.jsxs("svg",{width:"64",height:"64",fill:"none",viewBox:"0 0 64 64",children:[t.jsx("circle",{cx:"32",cy:"32",r:"32",fill:"#F3F4F6"}),t.jsx("path",{d:"M32 20v12l8 4",stroke:"#6366F1",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),t.jsx("p",{className:"mt-2",children:"Nenhum prestador encontrado."})]})]})]})}export{Le as default};
