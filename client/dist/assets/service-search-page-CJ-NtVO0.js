import{j as s}from"./ui-UIpCtT3r.js";import{C as V}from"./client-layout-DkJA58XK.js";import{A as W}from"./app-header-BagtWBY8.js";import{r as t}from"./vendor-vA4cx1mx.js";import{I as c}from"./input-IX-Ccd3C.js";import{n as d,B as v,F as J,C as K}from"./index-C8-zpcKL.js";import{B as E}from"./badge-DP5DyHeb.js";import{M as O}from"./map-pin-DhYkN1aN.js";import{S as Q}from"./search-ChrBAPJG.js";import{S as X}from"./star-D5FTFs0S.js";import"./navbar-vyjn30u5.js";import"./router-CxXythJb.js";import"./proxy-B2Nma8Bt.js";import"./calendar-check-B0nV5Uhw.js";import"./user-CXc1AnQW.js";import"./avatar-BBcRvo13.js";import"./dropdown-menu-CUOsS9wa.js";import"./chevron-right-DnXY7g-Q.js";import"./check-yFju7Kvd.js";import"./circle-DyW2RO_p.js";import"./arrow-left-DbtXU75N.js";import"./bell-CZnX4FjY.js";import"./ellipsis-vertical-lNYOA75X.js";import"./calendar-CEG0wbcY.js";import"./settings-DR9OFCdO.js";import"./circle-help-BAOtwWti.js";import"./message-square-CMlinHqp.js";import"./log-out-BVXZMdHH.js";function Y(){const[m,B]=t.useState(""),[L,A]=t.useState(""),[P,p]=t.useState(!1),[x,R]=t.useState(null),[z,D]=t.useState([]),[F,N]=t.useState([]),[M,S]=t.useState([]),[r,U]=t.useState(""),[i,y]=t.useState(""),[h,u]=t.useState(""),[f,G]=t.useState(""),[g,$]=t.useState(""),[b,w]=t.useState(!1),[q,C]=t.useState([]),[k,n]=t.useState("");t.useEffect(()=>{d("/api/niches").then(e=>e.json()).then(e=>D(e||[]))},[]),t.useEffect(()=>{r?d(`/niches/${r}/categories`).then(e=>e.json()).then(e=>N(e||[])):N([]),y(""),u("")},[r]),t.useEffect(()=>{i?d(`/services?categoryId=${i}`).then(e=>e.json()).then(e=>S(e||[])):S([]),u("")},[i]);const H=()=>{if(!navigator.geolocation){n("Geolocalização não suportada.");return}n(""),p(!0),navigator.geolocation.getCurrentPosition(e=>{R({lat:e.coords.latitude,lng:e.coords.longitude}),p(!1)},()=>{n("Não foi possível obter sua localização."),p(!1)})},T=async e=>{e.preventDefault(),w(!0),n(""),C([]);const a=new URLSearchParams;m&&a.append("q",m),r&&a.append("nicheId",r),i&&a.append("categoryId",i),h&&a.append("serviceId",h),f&&a.append("minRating",f),g&&a.append("maxDistance",g),x&&(a.append("lat",String(x.lat)),a.append("lng",String(x.lng)));try{const o=await(await d(`/providers/optimized/search?${a.toString()}`)).json();C(o.providers||[]),(!o.providers||o.providers.length===0)&&n("Nenhum prestador encontrado.")}catch{n("Erro ao buscar prestadores.")}finally{w(!1)}};return s.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[s.jsxs("form",{onSubmit:T,className:"bg-white rounded-xl shadow p-4 flex flex-col gap-4 mb-6",children:[s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4",children:[s.jsx(c,{placeholder:"Nome do prestador",value:m,onChange:e=>B(e.target.value)}),s.jsx(c,{placeholder:"Endereço ou região",value:L,onChange:e=>A(e.target.value)}),s.jsxs(v,{type:"button",variant:"outline",onClick:H,disabled:P,children:[s.jsx(O,{className:"w-4 h-4 mr-1"})," Usar minha localização"]})]}),s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4",children:[s.jsxs("select",{className:"border rounded px-2 py-1",value:r,onChange:e=>U(e.target.value),children:[s.jsx("option",{value:"",children:"Nicho"}),z.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsxs("select",{className:"border rounded px-2 py-1",value:i,onChange:e=>y(e.target.value),disabled:!r,children:[s.jsx("option",{value:"",children:"Categoria"}),F.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsxs("select",{className:"border rounded px-2 py-1",value:h,onChange:e=>u(e.target.value),disabled:!i,children:[s.jsx("option",{value:"",children:"Serviço"}),M.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4",children:[s.jsx(c,{placeholder:"Avaliação mínima",type:"number",min:"0",max:"5",value:f,onChange:e=>G(e.target.value)}),s.jsx(c,{placeholder:"Distância máxima (km)",type:"number",min:"1",value:g,onChange:e=>$(e.target.value)}),s.jsxs(v,{type:"submit",className:"flex items-center gap-2",disabled:b,children:[s.jsx(Q,{className:"w-4 h-4"})," Buscar"]})]})]}),b&&s.jsx("div",{className:"flex justify-center py-8",children:s.jsx(J,{})}),k&&s.jsx("div",{className:"text-center text-red-500 mb-4",children:k}),s.jsx("div",{className:"grid gap-4",children:q.map(e=>{var a,l,o,I;return s.jsxs(K,{className:"p-4 flex flex-col sm:flex-row gap-4 items-center shadow-md hover:shadow-xl transition-shadow",children:[s.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-2xl",children:((a=e.name)==null?void 0:a.charAt(0))||"?"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-bold text-lg text-primary",children:e.name}),((l=e.settings)==null?void 0:l.rating)&&s.jsxs("span",{className:"flex items-center gap-1 text-amber-500 font-semibold",children:[s.jsx(X,{size:16})," ",e.settings.rating]}),e.distance&&s.jsxs(E,{className:"ml-2 bg-primary/10 text-primary",children:[e.distance," km"]})]}),s.jsx("div",{className:"text-sm text-neutral-600",children:(o=e.settings)==null?void 0:o.businessName}),s.jsx("div",{className:"flex gap-2 mt-1 flex-wrap",children:(I=e.services)==null?void 0:I.map(j=>s.jsx(E,{className:"bg-primary/10 text-primary",children:j.serviceName||j.name},j.serviceId))})]}),s.jsx(v,{className:"bg-primary text-white mt-2 sm:mt-0",onClick:()=>window.location.href=`/providers/${e.id}`,children:"Ver perfil"})]},e.id)})})]})}function ke(){return s.jsxs(V,{children:[s.jsx(W,{showUserInfo:!0,showNotificationIcon:!0,userType:"client"}),s.jsxs("div",{className:"max-w-3xl mx-auto p-4",children:[s.jsx("h1",{className:"text-3xl font-extrabold text-primary dark:text-white mb-6 text-center",children:"Buscar Prestadores"}),s.jsx(Y,{}),s.jsxs("div",{className:"flex flex-col items-center py-6 text-neutral-500 dark:text-neutral-400",children:[s.jsxs("svg",{width:"64",height:"64",fill:"none",viewBox:"0 0 64 64",children:[s.jsx("circle",{cx:"32",cy:"32",r:"32",fill:"#F3F4F6"}),s.jsx("path",{d:"M32 20v12l8 4",stroke:"#6366F1",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),s.jsx("p",{className:"mt-2",children:"Nenhum prestador encontrado."})]})]})]})}export{ke as default};
