import{j as e}from"./ui-UIpCtT3r.js";import{r as v}from"./vendor-vA4cx1mx.js";import{b as pe,a as he,c as L,C as V,d as K,e as M,g as Q,f as ue,B as p,m as je,i as u}from"./index-C8-zpcKL.js";import{u as E}from"./useMutation-P96WDC87.js";import{T as ge,b as ve,c as H,d as f,e as fe,f as b}from"./table-scwF4lFh.js";import{D as I,f as be,a as k,b as P,c as A,e as q}from"./dialog-B9ckTsk5.js";import{I as h}from"./input-IX-Ccd3C.js";import{T as B}from"./textarea-C9AGRwtx.js";import{S as R,a as G,b as $,c as U,d as J}from"./select-UQJx9KyZ.js";import{A as W}from"./admin-layout-D86jsAEo.js";import{u as X,t as Y,o as ye,b as Ce,f as Z,s as j,n as _}from"./zod-BPPSwYm9.js";import{F as ee,a as i,b as o,c as t,d as n,e as l,f as y}from"./form-Bw-fjiTK.js";import{P as Ne}from"./plus-Dqfms9_s.js";import{C as Te}from"./clock-53JnXU7l.js";import{P as Se}from"./pencil-C_xYDF_J.js";import{T as we}from"./trash-2-DZ48xLrv.js";import"./router-CxXythJb.js";import"./index-BdQq_4o_.js";import"./index-BH3L9zMK.js";import"./chevron-down-CYpsWMdR.js";import"./check-yFju7Kvd.js";import"./navbar-vyjn30u5.js";import"./proxy-B2Nma8Bt.js";import"./search-ChrBAPJG.js";import"./calendar-check-B0nV5Uhw.js";import"./user-CXc1AnQW.js";import"./badge-DP5DyHeb.js";import"./avatar-BBcRvo13.js";import"./dropdown-menu-CUOsS9wa.js";import"./chevron-right-DnXY7g-Q.js";import"./circle-DyW2RO_p.js";import"./settings-DR9OFCdO.js";import"./log-out-BVXZMdHH.js";import"./menu-Cn_vALKP.js";import"./bell-CZnX4FjY.js";import"./arrow-left-DbtXU75N.js";import"./users-B2n0v15j.js";import"./calendar-CEG0wbcY.js";import"./trending-up-Bw7pj4fv.js";import"./folder-tree-DnCs9tbC.js";import"./credit-card-CEItYo9H.js";import"./share-2-CLZFBYyy.js";import"./circle-help-BAOtwWti.js";import"./book-open-Cm997j01.js";import"./label-BIAKwpsc.js";const re=ye({name:j().min(1),description:j().optional(),categoryId:Z([j(),_()]).transform(a=>Number(a)),icon:j().optional(),duration:Z([j(),_()]).transform(a=>Number(a)),isActive:Ce().optional()});function vr(){const{toast:a}=pe(),C=he(),[se,z]=v.useState(!1),[ae,N]=v.useState(!1),[ie,g]=v.useState(!1),[x,T]=v.useState(null),{data:O=[],isLoading:oe}=L({queryKey:["/api/service-templates"],queryFn:async()=>{const r=await u("GET","/api/service-templates");if(!r.ok)throw new Error("Falha ao carregar templates de serviço");return r.json()}}),{data:S=[],isLoading:te}=L({queryKey:["/api/categories"],queryFn:async()=>{const r=await u("GET","/api/categories");if(!r.ok)throw new Error("Falha ao carregar categorias");return r.json()}}),d=X({resolver:Y(re),defaultValues:{name:"",description:"",categoryId:0,icon:"",duration:60,isActive:!0}}),m=X({resolver:Y(re),defaultValues:{name:"",description:"",categoryId:0,icon:"",duration:60,isActive:!0}}),w=E({mutationFn:async r=>{const s=await u("POST","/api/service-templates",r);if(!s.ok){const c=await s.json().catch(()=>({error:"Falha ao criar template"}));throw new Error(c.error||"Falha ao criar template")}return s.json()},onSuccess:()=>{C.invalidateQueries({queryKey:["/api/service-templates"]}),a({title:"Template criado com sucesso",description:"O novo template de serviço foi adicionado."}),z(!1),d.reset({name:"",description:"",categoryId:0,icon:"",duration:60,isActive:!0})},onError:r=>{a({title:"Erro ao criar template",description:r.message,variant:"destructive"})}}),D=E({mutationFn:async({id:r,data:s})=>{const c=await u("PUT",`/api/service-templates/${r}`,s);if(!c.ok){const xe=await c.json().catch(()=>({error:"Falha ao atualizar template"}));throw new Error(xe.error||"Falha ao atualizar template")}return c.json()},onSuccess:()=>{C.invalidateQueries({queryKey:["/api/service-templates"]}),a({title:"Template atualizado com sucesso",description:"As alterações foram salvas."}),N(!1)},onError:r=>{a({title:"Erro ao atualizar template",description:r.message,variant:"destructive"})}}),F=E({mutationFn:async r=>{const s=await u("DELETE",`/api/service-templates/${r}`);if(!s.ok){const c=await s.text();throw new Error(c||"Falha ao excluir template")}return!0},onSuccess:()=>{C.invalidateQueries({queryKey:["/api/service-templates"]}),a({title:"Template excluído com sucesso",description:"O template foi removido do sistema."}),g(!1),T(null)},onError:r=>{a({title:"Erro ao excluir template",description:r.message,variant:"destructive"})}}),ne=r=>{w.mutate(r)},le=r=>{x&&D.mutate({id:x.id,data:r})},ce=r=>{T(r),m.reset({name:r.name,description:r.description||"",categoryId:r.categoryId,icon:r.icon||"",duration:r.duration||60,isActive:r.isActive!==!1}),N(!0)},de=r=>{T(r),g(!0)},me=()=>{x&&F.mutate(x.id)};return oe||te?e.jsx(W,{children:e.jsx("div",{className:"p-6",children:e.jsxs(V,{children:[e.jsx(K,{children:e.jsx(M,{children:"Templates de Serviço"})}),e.jsx(Q,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full"})})})]})})}):e.jsxs(W,{children:[e.jsx("div",{className:"p-6",children:e.jsxs(V,{children:[e.jsxs(K,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Templates de Serviço"}),e.jsx(ue,{children:"Crie e gerencie templates de serviços que serão oferecidos pelos prestadores"})]}),e.jsxs(I,{open:se,onOpenChange:z,children:[e.jsx(be,{asChild:!0,children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(Ne,{size:16}),"Novo Template"]})}),e.jsxs(k,{className:"sm:max-w-[550px]",children:[e.jsx(P,{children:e.jsx(A,{children:"Criar Novo Template de Serviço"})}),e.jsx(ee,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(ne),className:"space-y-4",children:[e.jsx(i,{control:d.control,name:"name",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Nome"}),e.jsx(n,{children:e.jsx(h,{...r,placeholder:"Nome do serviço"})}),e.jsx(l,{})]})}),e.jsx(i,{control:d.control,name:"description",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Descrição"}),e.jsx(n,{children:e.jsx(B,{...r,placeholder:"Descreva o serviço",rows:3})}),e.jsx(l,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:d.control,name:"categoryId",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Categoria"}),e.jsxs(R,{onValueChange:r.onChange,defaultValue:r.value?r.value.toString():void 0,children:[e.jsx(n,{children:e.jsx(G,{children:e.jsx($,{placeholder:"Selecione uma categoria"})})}),e.jsx(U,{children:S.map(s=>e.jsx(J,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx(l,{})]})}),e.jsx(i,{control:d.control,name:"icon",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Ícone"}),e.jsx(n,{children:e.jsx(h,{...r,placeholder:"Nome do ícone"})}),e.jsx(y,{children:"Nome do ícone Lucide (ex: scissors, heart)"}),e.jsx(l,{})]})})]}),e.jsx(i,{control:d.control,name:"duration",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Duração Padrão (minutos)"}),e.jsx(n,{children:e.jsx(h,{...r,type:"number",min:"5",placeholder:"Duração estimada do serviço"})}),e.jsx(y,{children:"Tempo médio para executar este serviço (os prestadores poderão personalizar)"}),e.jsx(l,{})]})}),e.jsx(q,{children:e.jsx(p,{type:"submit",disabled:w.isPending,children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2 inline-block h-4 w-4 border-2 border-current border-t-transparent rounded-full"}),"Salvando..."]}):"Criar Template"})})]})})]})]})]}),e.jsx(Q,{children:O.length>0?e.jsxs(ge,{children:[e.jsx(ve,{children:e.jsxs(H,{children:[e.jsx(f,{children:"Nome"}),e.jsx(f,{children:"Categoria"}),e.jsx(f,{children:"Duração"}),e.jsx(f,{className:"text-right",children:"Ações"})]})}),e.jsx(fe,{children:O.map(r=>{var s;return e.jsxs(H,{children:[e.jsx(b,{className:"font-medium",children:r.name}),e.jsx(b,{children:((s=S.find(c=>c.id===r.categoryId))==null?void 0:s.name)||"N/A"}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{className:"h-4 w-4 mr-1 text-muted-foreground"}),e.jsxs("span",{children:[r.duration||60," min"]})]})}),e.jsx(b,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(p,{variant:"outline",size:"icon",onClick:()=>ce(r),children:e.jsx(Se,{size:16})}),e.jsx(p,{variant:"outline",size:"icon",className:"text-destructive hover:bg-destructive/10",onClick:()=>de(r),children:e.jsx(we,{size:16})})]})})]},r.id)})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[e.jsx(je,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"Nenhum template encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Crie templates de serviço para que os prestadores possam usá-los como base."})]})})]})}),e.jsx(I,{open:ae,onOpenChange:N,children:e.jsxs(k,{className:"sm:max-w-[550px]",children:[e.jsx(P,{children:e.jsx(A,{children:"Editar Template de Serviço"})}),e.jsx(ee,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(le),className:"space-y-4",children:[e.jsx(i,{control:m.control,name:"name",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Nome"}),e.jsx(n,{children:e.jsx(h,{...r,placeholder:"Nome do serviço"})}),e.jsx(l,{})]})}),e.jsx(i,{control:m.control,name:"description",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Descrição"}),e.jsx(n,{children:e.jsx(B,{...r,placeholder:"Descreva o serviço",rows:3})}),e.jsx(l,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:m.control,name:"categoryId",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Categoria"}),e.jsxs(R,{onValueChange:r.onChange,value:r.value.toString(),children:[e.jsx(n,{children:e.jsx(G,{children:e.jsx($,{placeholder:"Selecione uma categoria"})})}),e.jsx(U,{children:S.map(s=>e.jsx(J,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx(l,{})]})}),e.jsx(i,{control:m.control,name:"icon",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Ícone"}),e.jsx(n,{children:e.jsx(h,{...r,placeholder:"Nome do ícone"})}),e.jsx(y,{children:"Nome do ícone Lucide (ex: scissors, heart)"}),e.jsx(l,{})]})})]}),e.jsx(i,{control:m.control,name:"duration",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Duração Padrão (minutos)"}),e.jsx(n,{children:e.jsx(h,{...r,type:"number",min:"5",placeholder:"Duração estimada do serviço"})}),e.jsx(y,{children:"Tempo médio para executar este serviço (os prestadores poderão personalizar)"}),e.jsx(l,{})]})}),e.jsx(q,{children:e.jsx(p,{type:"submit",disabled:D.isPending,children:D.isPending?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2 inline-block h-4 w-4 border-2 border-current border-t-transparent rounded-full"}),"Salvando..."]}):"Salvar Alterações"})})]})})]})}),e.jsx(I,{open:ie,onOpenChange:g,children:e.jsxs(k,{className:"sm:max-w-[425px]",children:[e.jsx(P,{children:e.jsx(A,{children:"Confirmar Exclusão"})}),e.jsx("div",{className:"py-4",children:e.jsxs("p",{children:['Tem certeza que deseja excluir o template "',x==null?void 0:x.name,'"? Esta ação não pode ser desfeita.']})}),e.jsxs(q,{children:[e.jsx(p,{variant:"outline",onClick:()=>g(!1),children:"Cancelar"}),e.jsx(p,{variant:"destructive",onClick:me,disabled:F.isPending,children:F.isPending?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2 inline-block h-4 w-4 border-2 border-current border-t-transparent rounded-full"}),"Excluindo..."]}):"Excluir"})]})]})})]})}export{vr as default};
