import{c as xe,b as he,r as g,d as L,j as e,C as V,f as K,g as M,i as Q,h as ue,o as je,l as F}from"./index-DOe1OCu1.js";import{u as E}from"./useMutation-Lmj9MX3Y.js";import{B as x}from"./button-C168b4m4.js";import{T as ge,b as ve,c as H,d as v,e as fe,f}from"./table-CpYERuu-.js";import{D as I,f as be,a as k,b as P,c as A,e as q}from"./dialog-DsJAgbDW.js";import{I as h}from"./input-BHH75Tpk.js";import{T as B}from"./textarea-D8qc73Fv.js";import{S as R,a as $,b as U,c as G,d as J}from"./select-CXehJHOL.js";import{A as W}from"./admin-layout-DMuYYlcx.js";import{u as X,t as Y,o as ye,b as Ce,f as Z,s as u,n as _}from"./zod-DXT7XQRH.js";import{F as ee,a as i,b as o,c as t,d as n,e as l,f as b}from"./form-KOvJa5oz.js";import{P as Ne}from"./plus-DCNyMku-.js";import{C as Te}from"./clock-CVsS3BCD.js";import{P as Se}from"./pencil-8MXIxfby.js";import{T as we}from"./trash-2-Bi3jo0Dj.js";import"./index-DxOiueDc.js";import"./index-CQF81cx3.js";import"./index-CtQ14QdP.js";import"./index-BdQq_4o_.js";import"./index-DdZceiuF.js";import"./index-C933frGi.js";import"./index-tIxYtZzE.js";import"./index-CCWTWNPs.js";import"./chevron-down-C3yMjgZz.js";import"./check-C4wNsCXx.js";import"./navbar-DlESdVVP.js";import"./proxy-Ct5X7xz4.js";import"./house-Calz6FJi.js";import"./search-Bjz8DxPP.js";import"./calendar-check-CY2XiYKN.js";import"./user-BQOYdOBU.js";import"./badge-Bzn9UYFT.js";import"./avatar-DkIWG9bC.js";import"./dropdown-menu-BOCN3PER.js";import"./index-DbsNQ1RS.js";import"./chevron-right-D4BSFwhT.js";import"./circle-DjQT6JQX.js";import"./settings-CM1XtqIa.js";import"./log-out-Bcm4dD8k.js";import"./menu-ylsVJAGl.js";import"./bell-JEvyLzwJ.js";import"./arrow-left-BPt4aJQo.js";import"./users-CKUz_ceh.js";import"./calendar-Mn3IWFfL.js";import"./trending-up-CWfbCM5F.js";import"./folder-tree-CekGzc5n.js";import"./credit-card-DtANwWGP.js";import"./share-2-BYcRmu4H.js";import"./circle-help-BJUcWgq1.js";import"./book-open-DVxVhmVC.js";import"./label-MMklymaS.js";const re=ye({name:u().min(1),description:u().optional(),categoryId:Z([u(),_()]).transform(a=>Number(a)),icon:u().optional(),duration:Z([u(),_()]).transform(a=>Number(a)),isActive:Ce().optional()});function Tr(){const{toast:a}=xe(),y=he(),[se,z]=g.useState(!1),[ae,C]=g.useState(!1),[ie,j]=g.useState(!1),[p,N]=g.useState(null),{data:O=[],isLoading:oe}=L({queryKey:["/api/service-templates"],queryFn:async()=>{const r=await fetch("/api/service-templates");if(!r.ok)throw new Error("Falha ao carregar templates de serviço");return r.json()}}),{data:T=[],isLoading:te}=L({queryKey:["/api/categories"],queryFn:async()=>{const r=await fetch("/api/categories");if(!r.ok)throw new Error("Falha ao carregar categorias");return r.json()}}),d=X({resolver:Y(re),defaultValues:{name:"",description:"",categoryId:0,icon:"",duration:60,isActive:!0}}),m=X({resolver:Y(re),defaultValues:{name:"",description:"",categoryId:0,icon:"",duration:60,isActive:!0}}),S=E({mutationFn:async r=>{const s=await F("POST","/api/service-templates",r);if(!s.ok){const c=await s.json().catch(()=>({error:"Falha ao criar template"}));throw new Error(c.error||"Falha ao criar template")}return s.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["/api/service-templates"]}),a({title:"Template criado com sucesso",description:"O novo template de serviço foi adicionado."}),z(!1),d.reset({name:"",description:"",categoryId:0,icon:"",duration:60,isActive:!0})},onError:r=>{a({title:"Erro ao criar template",description:r.message,variant:"destructive"})}}),w=E({mutationFn:async({id:r,data:s})=>{const c=await F("PUT",`/api/service-templates/${r}`,s);if(!c.ok){const pe=await c.json().catch(()=>({error:"Falha ao atualizar template"}));throw new Error(pe.error||"Falha ao atualizar template")}return c.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["/api/service-templates"]}),a({title:"Template atualizado com sucesso",description:"As alterações foram salvas."}),C(!1)},onError:r=>{a({title:"Erro ao atualizar template",description:r.message,variant:"destructive"})}}),D=E({mutationFn:async r=>{const s=await F("DELETE",`/api/service-templates/${r}`);if(!s.ok){const c=await s.text();throw new Error(c||"Falha ao excluir template")}return!0},onSuccess:()=>{y.invalidateQueries({queryKey:["/api/service-templates"]}),a({title:"Template excluído com sucesso",description:"O template foi removido do sistema."}),j(!1),N(null)},onError:r=>{a({title:"Erro ao excluir template",description:r.message,variant:"destructive"})}}),ne=r=>{S.mutate(r)},le=r=>{p&&w.mutate({id:p.id,data:r})},ce=r=>{N(r),m.reset({name:r.name,description:r.description||"",categoryId:r.categoryId,icon:r.icon||"",duration:r.duration||60,isActive:r.isActive!==!1}),C(!0)},de=r=>{N(r),j(!0)},me=()=>{p&&D.mutate(p.id)};return oe||te?e.jsx(W,{children:e.jsx("div",{className:"p-6",children:e.jsxs(V,{children:[e.jsx(K,{children:e.jsx(M,{children:"Templates de Serviço"})}),e.jsx(Q,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full"})})})]})})}):e.jsxs(W,{children:[e.jsx("div",{className:"p-6",children:e.jsxs(V,{children:[e.jsxs(K,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Templates de Serviço"}),e.jsx(ue,{children:"Crie e gerencie templates de serviços que serão oferecidos pelos prestadores"})]}),e.jsxs(I,{open:se,onOpenChange:z,children:[e.jsx(be,{asChild:!0,children:e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(Ne,{size:16}),"Novo Template"]})}),e.jsxs(k,{className:"sm:max-w-[550px]",children:[e.jsx(P,{children:e.jsx(A,{children:"Criar Novo Template de Serviço"})}),e.jsx(ee,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(ne),className:"space-y-4",children:[e.jsx(i,{control:d.control,name:"name",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Nome"}),e.jsx(n,{children:e.jsx(h,{...r,placeholder:"Nome do serviço"})}),e.jsx(l,{})]})}),e.jsx(i,{control:d.control,name:"description",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Descrição"}),e.jsx(n,{children:e.jsx(B,{...r,placeholder:"Descreva o serviço",rows:3})}),e.jsx(l,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:d.control,name:"categoryId",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Categoria"}),e.jsxs(R,{onValueChange:r.onChange,defaultValue:r.value?r.value.toString():void 0,children:[e.jsx(n,{children:e.jsx($,{children:e.jsx(U,{placeholder:"Selecione uma categoria"})})}),e.jsx(G,{children:T.map(s=>e.jsx(J,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx(l,{})]})}),e.jsx(i,{control:d.control,name:"icon",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Ícone"}),e.jsx(n,{children:e.jsx(h,{...r,placeholder:"Nome do ícone"})}),e.jsx(b,{children:"Nome do ícone Lucide (ex: scissors, heart)"}),e.jsx(l,{})]})})]}),e.jsx(i,{control:d.control,name:"duration",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Duração Padrão (minutos)"}),e.jsx(n,{children:e.jsx(h,{...r,type:"number",min:"5",placeholder:"Duração estimada do serviço"})}),e.jsx(b,{children:"Tempo médio para executar este serviço (os prestadores poderão personalizar)"}),e.jsx(l,{})]})}),e.jsx(q,{children:e.jsx(x,{type:"submit",disabled:S.isPending,children:S.isPending?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2 inline-block h-4 w-4 border-2 border-current border-t-transparent rounded-full"}),"Salvando..."]}):"Criar Template"})})]})})]})]})]}),e.jsx(Q,{children:O.length>0?e.jsxs(ge,{children:[e.jsx(ve,{children:e.jsxs(H,{children:[e.jsx(v,{children:"Nome"}),e.jsx(v,{children:"Categoria"}),e.jsx(v,{children:"Duração"}),e.jsx(v,{className:"text-right",children:"Ações"})]})}),e.jsx(fe,{children:O.map(r=>{var s;return e.jsxs(H,{children:[e.jsx(f,{className:"font-medium",children:r.name}),e.jsx(f,{children:((s=T.find(c=>c.id===r.categoryId))==null?void 0:s.name)||"N/A"}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{className:"h-4 w-4 mr-1 text-muted-foreground"}),e.jsxs("span",{children:[r.duration||60," min"]})]})}),e.jsx(f,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{variant:"outline",size:"icon",onClick:()=>ce(r),children:e.jsx(Se,{size:16})}),e.jsx(x,{variant:"outline",size:"icon",className:"text-destructive hover:bg-destructive/10",onClick:()=>de(r),children:e.jsx(we,{size:16})})]})})]},r.id)})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[e.jsx(je,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"Nenhum template encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Crie templates de serviço para que os prestadores possam usá-los como base."})]})})]})}),e.jsx(I,{open:ae,onOpenChange:C,children:e.jsxs(k,{className:"sm:max-w-[550px]",children:[e.jsx(P,{children:e.jsx(A,{children:"Editar Template de Serviço"})}),e.jsx(ee,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(le),className:"space-y-4",children:[e.jsx(i,{control:m.control,name:"name",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Nome"}),e.jsx(n,{children:e.jsx(h,{...r,placeholder:"Nome do serviço"})}),e.jsx(l,{})]})}),e.jsx(i,{control:m.control,name:"description",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Descrição"}),e.jsx(n,{children:e.jsx(B,{...r,placeholder:"Descreva o serviço",rows:3})}),e.jsx(l,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{control:m.control,name:"categoryId",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Categoria"}),e.jsxs(R,{onValueChange:r.onChange,value:r.value.toString(),children:[e.jsx(n,{children:e.jsx($,{children:e.jsx(U,{placeholder:"Selecione uma categoria"})})}),e.jsx(G,{children:T.map(s=>e.jsx(J,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx(l,{})]})}),e.jsx(i,{control:m.control,name:"icon",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Ícone"}),e.jsx(n,{children:e.jsx(h,{...r,placeholder:"Nome do ícone"})}),e.jsx(b,{children:"Nome do ícone Lucide (ex: scissors, heart)"}),e.jsx(l,{})]})})]}),e.jsx(i,{control:m.control,name:"duration",render:({field:r})=>e.jsxs(o,{children:[e.jsx(t,{children:"Duração Padrão (minutos)"}),e.jsx(n,{children:e.jsx(h,{...r,type:"number",min:"5",placeholder:"Duração estimada do serviço"})}),e.jsx(b,{children:"Tempo médio para executar este serviço (os prestadores poderão personalizar)"}),e.jsx(l,{})]})}),e.jsx(q,{children:e.jsx(x,{type:"submit",disabled:w.isPending,children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2 inline-block h-4 w-4 border-2 border-current border-t-transparent rounded-full"}),"Salvando..."]}):"Salvar Alterações"})})]})})]})}),e.jsx(I,{open:ie,onOpenChange:j,children:e.jsxs(k,{className:"sm:max-w-[425px]",children:[e.jsx(P,{children:e.jsx(A,{children:"Confirmar Exclusão"})}),e.jsx("div",{className:"py-4",children:e.jsxs("p",{children:['Tem certeza que deseja excluir o template "',p==null?void 0:p.name,'"? Esta ação não pode ser desfeita.']})}),e.jsxs(q,{children:[e.jsx(x,{variant:"outline",onClick:()=>j(!1),children:"Cancelar"}),e.jsx(x,{variant:"destructive",onClick:me,disabled:D.isPending,children:D.isPending?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2 inline-block h-4 w-4 border-2 border-current border-t-transparent rounded-full"}),"Excluindo..."]}):"Excluir"})]})]})})]})}export{Tr as default};
