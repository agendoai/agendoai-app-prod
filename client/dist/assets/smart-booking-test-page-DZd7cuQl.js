import{m as V,c as z,r as j,d as P,j as e,a as _,C as I,f as L,g as R,h as B,i as F,k as O}from"./index-DFO2lo2s.js";import{C as Q}from"./calendar-CiY0AdYf.js";import{S as G,a as J,b as W,c as X,d as Y}from"./select-KhIWU-DA.js";import{B as T}from"./button-6IH7luFD.js";import{S as u}from"./skeleton-DHzWUt6V.js";import{B as Z}from"./badge-DWGHGqHr.js";import{P as ee,a as se,b as te}from"./popover-kbEvo3Xe.js";import{T as re,a as ae,b as ie,c as ne}from"./tooltip-BCOswfBn.js";import{C as oe}from"./calendar-CXCri533.js";import{C as K}from"./clock-BQ1l0DXv.js";import{S as le}from"./sparkles-B780Ik13.js";import{T as de}from"./thumbs-up-CbFVx6Vm.js";import{f as q}from"./format-CGvBu07F.js";import{p as ce}from"./pt-BR-Cxqo7XV3.js";import"./en-US-xSPtgCq_.js";import"./endOfMonth-CH6FLORf.js";import"./isSameDay-BJjwZdUf.js";import"./addDays-BQ37Zmqx.js";import"./chevron-right-BpYdX1P5.js";import"./chevron-left-CKZU-S_c.js";import"./index-BdQq_4o_.js";import"./index-BZw1vT_C.js";import"./index-BEl4sio8.js";import"./index-zokK3oQV.js";import"./index-r8gFfIDH.js";import"./index-heHCkeO_.js";import"./index-BGiioUCj.js";import"./chevron-down-Cj8L_1vh.js";import"./check-C4mt73Rm.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=V("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);function ue({providerId:t,serviceId:a,date:o,onSelectTimeSlot:d,selectedTimeSlot:m}){z();const[r,b]=j.useState(!0),{data:c,isLoading:y,error:f,refetch:v}=P({queryKey:[`/api/providers/${t}/smart-time-slots`,{date:o,serviceId:a,providerId:t}],enabled:!!t&&!!a&&!!o&&r}),{data:g,isLoading:C,error:w,refetch:n}=P({queryKey:[`/api/providers/${t}/time-slots`,{date:o,serviceId:a,providerId:t}],enabled:!!t&&!!a&&!!o&&!r}),x=j.useMemo(()=>{let s=[];r&&(c!=null&&c.timeSlots)?s=c.timeSlots:!r&&g&&(s=g),s=s.filter(i=>{if(!i||!i.startTime||!i.endTime)return console.warn("Slot inválido removido:",i),!1;if(i.isAvailable!==!0)return!1;if(!i.serviceDuration){const[p,A]=i.startTime.split(":").map(Number),[D,H]=i.endTime.split(":").map(Number),k=p*60+A,$=D*60+H;i.serviceDuration=$-k}return!0}),console.log(`Smart Time Slot Selector: Filtrando ${s.length} slots disponíveis`);const l=new Date,N=l.toISOString().split("T")[0];if(o===N){const i=l.getHours(),p=l.getMinutes(),A=i*60+p,D=s.length;s=s.filter(H=>{const[k,$]=H.startTime.split(":").map(Number);return k*60+$>A}),console.log(`Smart Time Slot Selector: Filtrados ${D-s.length} slots passados`)}return s},[r,c,g,o]),h=j.useMemo(()=>{const s=[],l=[],N=[];return x.forEach(i=>{const p=parseInt(i.startTime.split(":")[0],10);p<12?s.push(i):p<18?l.push(i):N.push(i)}),{morning:s,afternoon:l,evening:N}},[x]),M=s=>{s.isAvailable&&d(s)},U=()=>{b(!r),r?n():v()};return(r?y:C)?e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(u,{className:"h-6 w-48"}),e.jsx(u,{className:"h-10 w-36"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx(u,{className:"h-5 w-28 mb-3"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[...Array(8)].map((s,l)=>e.jsx(u,{className:"h-10 w-full rounded-md"},l))})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx(u,{className:"h-5 w-28 mb-3"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[...Array(8)].map((s,l)=>e.jsx(u,{className:"h-10 w-full rounded-md"},l))})]})]}):(r?f:w)?e.jsxs("div",{className:"text-center p-6 text-destructive",children:[e.jsx("p",{children:"Erro ao carregar horários disponíveis. Por favor, tente novamente."}),e.jsx(T,{variant:"outline",onClick:()=>r?v():n(),className:"mt-2",children:"Tentar novamente"})]}):x.length===0?e.jsxs("div",{className:"text-center p-6",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto mb-2 text-muted-foreground"}),e.jsx("h3",{className:"font-medium text-lg",children:"Sem horários disponíveis"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Não há horários disponíveis nesta data. Tente selecionar outra data."})]}):e.jsxs("div",{className:"p-2 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"font-medium text-lg flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Horários Disponíveis"]}),e.jsx(re,{children:e.jsxs(ae,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(T,{variant:r?"default":"outline",size:"sm",onClick:U,className:"gap-2",children:[r?e.jsx(le,{className:"h-4 w-4"}):e.jsx(e.Fragment,{}),r?"Recomendações IA":"Horários Padrão"]})}),e.jsx(ne,{children:r?"Usando IA para recomendar os melhores horários para este serviço":"Mostrando todos os horários disponíveis sem análise de IA"})]})})]}),h.morning.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Manhã"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:h.morning.map(s=>e.jsx(E,{slot:s,isSelected:m===s.startTime,onSelect:M},s.startTime))})]}),h.afternoon.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Tarde"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:h.afternoon.map(s=>e.jsx(E,{slot:s,isSelected:m===s.startTime,onSelect:M},s.startTime))})]}),h.evening.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Noite"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:h.evening.map(s=>e.jsx(E,{slot:s,isSelected:m===s.startTime,onSelect:M},s.startTime))})]})]})}function E({slot:t,isSelected:a,onSelect:o}){return t.isAvailable?e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(T,{variant:a?"default":"outline",size:"sm",onClick:()=>o(t),className:`relative flex flex-col h-auto py-2 items-center justify-center ${t.isRecommended&&!a?"border-primary/50":""}`,children:[e.jsx("span",{className:"font-medium",children:S(t.startTime)}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["até ",S(t.endTime)]}),t.isRecommended&&e.jsx("div",{className:"absolute -top-1 -right-1",children:e.jsx(Z,{variant:"default",className:"h-4 w-4 p-0 flex items-center justify-center rounded-full",children:e.jsx(de,{className:"h-2.5 w-2.5"})})})]})}),e.jsx(te,{className:"w-80 p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(K,{className:"h-4 w-4 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Detalhes do horário"}),e.jsxs("div",{className:"text-xs grid grid-cols-2 gap-x-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Início:"}),e.jsx("span",{children:S(t.startTime)}),e.jsx("span",{className:"text-muted-foreground",children:"Término:"}),e.jsx("span",{children:S(t.endTime)}),e.jsx("span",{className:"text-muted-foreground",children:"Duração:"}),e.jsxs("span",{children:[t.serviceDuration," minutos"]})]}),t.reason&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(me,{className:"h-4 w-4 text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium mb-1",children:"Recomendação da IA"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.reason})]})]})})]})]})})]}):null}function S(t){if(!t)return"";const[a,o]=t.split(":").map(Number),d=a===0?"00":a.toString().padStart(2,"0"),m=o.toString().padStart(2,"0");return`${d}:${m}`}function Ue(){const{toast:t}=z();_();const[a,o]=j.useState(new Date),[d,m]=j.useState(),[r,b]=j.useState(),c=2,y=a?q(a,"yyyy-MM-dd"):"",{data:f,isLoading:v,error:g}=P({queryKey:["/api/services",{providerId:c}],enabled:!0}),C=n=>{b(n),t({title:"Horário selecionado",description:`Você selecionou ${n.startTime} - ${n.endTime}`})},w=()=>{if(!d||!a||!r){t({title:"Informações incompletas",description:"Por favor, preencha todas as informações para continuar.",variant:"destructive"});return}t({title:"Teste concluído",description:`Agendamento teste para ${q(a,"dd/MM/yyyy")} às ${r.startTime}`})};return e.jsxs("div",{className:"container max-w-4xl py-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Teste de Agendamento Inteligente"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Esta página testa a API de recomendação inteligente de horários usando IA"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(I,{children:[e.jsxs(L,{children:[e.jsx(R,{children:"Escolha o serviço e a data"}),e.jsx(B,{children:"Selecione o serviço desejado e a data para o agendamento"})]}),e.jsxs(F,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Serviço"}),v?e.jsx(u,{className:"h-10 w-full"}):g?e.jsx("div",{className:"text-destructive text-sm",children:"Erro ao carregar serviços"}):e.jsxs(G,{value:d,onValueChange:m,children:[e.jsx(J,{children:e.jsx(W,{placeholder:"Selecione um serviço"})}),e.jsx(X,{children:f==null?void 0:f.map(n=>e.jsxs(Y,{value:n.id.toString(),children:[n.name," (",n.duration," min)"]},n.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Data"}),e.jsx(Q,{mode:"single",selected:a,onSelect:o,locale:ce,className:"border rounded-md",disabled:n=>{const x=new Date;return x.setHours(0,0,0,0),n<x}})]})]})]}),e.jsxs(I,{children:[e.jsxs(L,{children:[e.jsx(R,{children:"Escolha o horário"}),e.jsx(B,{children:"Horários disponíveis para a data selecionada"})]}),e.jsx(F,{children:d&&a?e.jsx(ue,{providerId:c,serviceId:parseInt(d),date:y,onSelectTimeSlot:C,selectedTimeSlot:r==null?void 0:r.startTime}):e.jsx("div",{className:"text-center p-8 text-muted-foreground",children:"Selecione um serviço e uma data para ver os horários disponíveis"})}),r&&e.jsxs(O,{className:"flex justify-between border-t pt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Horário selecionado:"}),e.jsxs("p",{className:"text-muted-foreground",children:[r.startTime," - ",r.endTime]})]}),e.jsx(T,{onClick:w,children:"Continuar"})]})]})]})]})}export{Ue as default};
