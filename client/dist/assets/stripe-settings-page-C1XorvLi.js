import{j as e}from"./ui-UIpCtT3r.js";import{r as p}from"./vendor-vA4cx1mx.js";import{u as A,t as V,o as W,s as j,b as _}from"./zod-BPPSwYm9.js";import{b as I,u as D,c as U,L as g,C as R,d as z,e as $,f as B,g as H,m as T,q as O,i as f}from"./index-BJ9Cw0LR.js";import{u as Q}from"./useMutation-CDdW0pzE.js";import{u as G}from"./router-CxXythJb.js";import{F as J,a as i,b as n,d as c,c as b,f as v,e as y}from"./form-Cf7t4W3I.js";import{I as S}from"./input-CNw_l4dQ.js";import{B as E}from"./button-BvsVcTDx.js";import{S as P}from"./switch-BjwSyAKP.js";import{A as X,b as Y,a as Z}from"./alert-D4b1dLXp.js";import{S as C}from"./separator-B7JIGNlt.js";import{T as ee,a as se,b as F,c as q}from"./tabs-0uPJ4FVU.js";import{C as te}from"./check-ZbxB06uW.js";import"./label-qfvszZNj.js";import"./index-BH3L9zMK.js";const ae=W({stripeEnabled:_().default(!1),stripeLiveMode:_().default(!1),stripePublicKey:j().min(1,"Chave pública é obrigatória"),stripeSecretKey:j().min(1,"Chave secreta é obrigatória"),stripeWebhookSecret:j().optional()});function ve(){const{toast:r}=I(),{user:u}=D(),[,N]=G(),[k,w]=p.useState(!1),[d,x]=p.useState(null);p.useEffect(()=>{(!u||u.userType!=="admin")&&N("/")},[u,N]);const{data:a,isLoading:K}=U({queryKey:["/api/admin/payment-settings"],queryFn:async()=>{const s=await f("GET","/api/admin/payment-settings");if(!s.ok)throw new Error("Falha ao carregar configurações de pagamento");return s.json()}}),t=A({resolver:V(ae),defaultValues:{stripeEnabled:!1,stripeLiveMode:!1,stripePublicKey:"",stripeSecretKey:"",stripeWebhookSecret:""}});p.useEffect(()=>{a&&t.reset({stripeEnabled:a.stripeEnabled,stripeLiveMode:a.stripeLiveMode,stripePublicKey:a.stripePublicKey||"",stripeSecretKey:a.stripeSecretKey||"",stripeWebhookSecret:a.stripeWebhookSecret||""})},[a,t]);const h=Q({mutationFn:async s=>{const o=await f("PATCH",`/api/admin/payment-settings/${a==null?void 0:a.id}`,s);if(!o.ok){const l=await o.json();throw new Error(l.message||"Falha ao atualizar configurações")}return o.json()},onSuccess:()=>{O.invalidateQueries({queryKey:["/api/admin/payment-settings"]}),r({title:"Configurações salvas",description:"As configurações de pagamento foram atualizadas com sucesso.",variant:"default"})},onError:s=>{r({title:"Erro",description:`Falha ao salvar configurações: ${s.message}`,variant:"destructive"})}}),M=async()=>{const s=t.getValues("stripeSecretKey"),o=t.getValues("stripeLiveMode");if(!s){r({title:"Atenção",description:"Informe a chave secreta do Stripe para testar a conexão.",variant:"destructive"});return}w(!0),x(null);try{const m=await(await f("POST","/api/admin/payment-settings/test-stripe",{stripeSecretKey:s,stripeLiveMode:o})).json();x(m),r({title:m.success?"Sucesso":"Erro",description:m.message,variant:m.success?"default":"destructive"})}catch(l){x({success:!1,message:"Erro ao testar conexão com o Stripe. Verifique o console para mais detalhes."}),console.error("Erro ao testar conexão:",l),r({title:"Erro",description:"Falha ao testar conexão com o Stripe",variant:"destructive"})}finally{w(!1)}},L=s=>{h.mutate(s)};return K?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(g,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsx("div",{className:"container mx-auto py-8 max-w-4xl",children:e.jsxs(R,{children:[e.jsxs(z,{children:[e.jsx($,{children:"Configurações do Stripe"}),e.jsx(B,{children:"Configure a integração com o Stripe para processamento de pagamentos."})]}),e.jsx(H,{children:e.jsxs(ee,{defaultValue:"settings",children:[e.jsxs(se,{className:"mb-6",children:[e.jsx(F,{value:"settings",children:"Configurações"}),e.jsx(F,{value:"help",children:"Ajuda"})]}),e.jsx(q,{value:"settings",children:e.jsx(J,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(L),className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Status do Stripe"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ativar ou desativar a integração com o Stripe."})]}),e.jsx(i,{control:t.control,name:"stripeEnabled",render:({field:s})=>e.jsx(n,{children:e.jsx(c,{children:e.jsx(P,{checked:s.value,onCheckedChange:s.onChange})})})})]}),e.jsx(C,{}),e.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Modo de Produção"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ativar para usar em produção real. Desativar para usar no modo teste."})]}),e.jsx(i,{control:t.control,name:"stripeLiveMode",render:({field:s})=>e.jsx(n,{children:e.jsx(c,{children:e.jsx(P,{checked:s.value,onCheckedChange:s.onChange})})})})]}),e.jsx(i,{control:t.control,name:"stripePublicKey",render:({field:s})=>e.jsxs(n,{children:[e.jsx(b,{children:"Chave Pública do Stripe"}),e.jsx(c,{children:e.jsx(S,{placeholder:"pk_...",...s})}),e.jsx(v,{children:t.getValues("stripeLiveMode")?"Use a chave pública de produção que começa com pk_live_":"Use a chave pública de teste que começa com pk_test_"}),e.jsx(y,{})]})}),e.jsx(i,{control:t.control,name:"stripeSecretKey",render:({field:s})=>e.jsxs(n,{children:[e.jsx(b,{children:"Chave Secreta do Stripe"}),e.jsx(c,{children:e.jsx(S,{type:"password",placeholder:"sk_...",...s})}),e.jsx(v,{children:t.getValues("stripeLiveMode")?"Use a chave secreta de produção que começa com sk_live_":"Use a chave secreta de teste que começa com sk_test_"}),e.jsx(y,{})]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(E,{type:"button",variant:"outline",onClick:M,disabled:k||!t.getValues("stripeSecretKey"),children:k?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"mr-2 h-4 w-4 animate-spin"}),"Testando..."]}):"Testar Conexão"}),e.jsx("div",{className:"flex-1 ml-4",children:d&&e.jsxs("div",{className:`flex items-center text-sm ${d.success?"text-green-600":"text-red-600"}`,children:[d.success?e.jsx(te,{className:"h-4 w-4 mr-2"}):e.jsx(T,{className:"h-4 w-4 mr-2"}),d.message]})})]}),e.jsx(i,{control:t.control,name:"stripeWebhookSecret",render:({field:s})=>e.jsxs(n,{children:[e.jsx(b,{children:"Segredo do Webhook Stripe"}),e.jsx(c,{children:e.jsx(S,{type:"password",placeholder:"whsec_...",...s})}),e.jsxs(v,{children:["Segredo usado para verificar webhooks do Stripe. Configure o webhook no painel do Stripe apontando para:",e.jsxs("code",{className:"bg-muted mx-1 px-1 py-0.5 rounded text-sm",children:[window.location.origin,"/api/stripe/webhook"]})]}),e.jsx(y,{})]})}),t.getValues("stripeEnabled")&&!t.getValues("stripeWebhookSecret")&&e.jsxs(X,{children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx(Y,{children:"Webhook não configurado"}),e.jsx(Z,{children:"Para receber atualizações em tempo real do status de pagamento, configure um webhook no painel do Stripe."})]}),e.jsx(E,{type:"submit",className:"w-full mt-4",disabled:h.isPending,children:h.isPending?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"mr-2 h-4 w-4 animate-spin"}),"Salvando..."]}):"Salvar Configurações"})]})})}),e.jsx(q,{value:"help",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Como configurar o Stripe"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Siga estas etapas para configurar corretamente a integração do Stripe:"}),e.jsxs("ol",{className:"list-decimal ml-5 mt-2 space-y-2",children:[e.jsxs("li",{children:["Crie uma conta no Stripe em ",e.jsx("a",{href:"https://stripe.com",target:"_blank",rel:"noreferrer",className:"text-primary underline",children:"stripe.com"})]}),e.jsxs("li",{children:["Obtenha suas chaves API no painel do Stripe em ",e.jsx("a",{href:"https://dashboard.stripe.com/apikeys",target:"_blank",rel:"noreferrer",className:"text-primary underline",children:"dashboard.stripe.com/apikeys"})]}),e.jsxs("li",{children:["Configure um endpoint de webhook no painel do Stripe apontando para ",e.jsxs("code",{className:"bg-muted px-1 py-0.5 rounded text-sm",children:[window.location.origin,"/api/stripe/webhook"]})]}),e.jsxs("li",{children:["Defina os eventos que deseja receber, no mínimo: ",e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded text-sm",children:"payment_intent.succeeded"})," e ",e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded text-sm",children:"payment_intent.payment_failed"})]}),e.jsx("li",{children:'Copie o "Signing Secret" do webhook e adicione-o no campo "Segredo do Webhook Stripe"'})]})]}),e.jsx(C,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Modo Teste vs. Produção"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["No modo de teste, nenhuma transação real é processada. Use chaves que começam com ",e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded text-sm",children:"pk_test_"})," e ",e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded text-sm",children:"sk_test_"}),'. Para processar pagamentos reais, ative o "Modo de Produção" e use chaves que começam com ',e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded text-sm",children:"pk_live_"})," e ",e.jsx("code",{className:"bg-muted px-1 py-0.5 rounded text-sm",children:"sk_live_"}),"."]})]}),e.jsx(C,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Resolução de Problemas"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Se estiver tendo problemas com a integração do Stripe:"}),e.jsxs("ul",{className:"list-disc ml-5 mt-2 space-y-2",children:[e.jsx("li",{children:"Verifique se as chaves API estão corretas"}),e.jsx("li",{children:"Confirme se o webhook está configurado corretamente"}),e.jsx("li",{children:"Verifique os logs de eventos do Stripe no painel do Stripe"}),e.jsx("li",{children:'Use o botão "Testar Conexão" para validar suas credenciais'})]})]})]})})]})})]})})}export{ve as default};
