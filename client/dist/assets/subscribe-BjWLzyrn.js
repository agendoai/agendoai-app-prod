import{j as s}from"./ui-UIpCtT3r.js";import{E as S,u as y,a as C,P as E}from"./react-stripe.esm-CMqkxx7A.js";import{l as A}from"./index-C8r34K29.js";import{r as i}from"./vendor-vA4cx1mx.js";import{b as j,L as f,C as p,m as k,B as N,o as I,d as b,e as w,g,h as v,f as T}from"./index-C8-zpcKL.js";import{C as x}from"./client-layout-DkJA58XK.js";import{A as D,a as L}from"./alert-CTqSX79T.js";import{C as l}from"./check-yFju7Kvd.js";import"./index-BvR2MEzN.js";import"./router-CxXythJb.js";import"./navbar-vyjn30u5.js";import"./proxy-B2Nma8Bt.js";import"./search-ChrBAPJG.js";import"./calendar-check-B0nV5Uhw.js";import"./user-CXc1AnQW.js";throw new Error("Chave pública do Stripe não encontrada (VITE_STRIPE_PUBLIC_KEY)");const B=A(void 0),F=()=>{const e=y(),n=C(),{toast:o}=j(),[a,t]=i.useState(!1),m=async c=>{if(c.preventDefault(),!e||!n){o({title:"Stripe não inicializado",description:"Tente novamente em alguns instantes",variant:"destructive"});return}t(!0);const{error:d}=await e.confirmPayment({elements:n,confirmParams:{return_url:`${window.location.origin}/client/subscription-confirmation`}});d&&o({title:"Falha na Assinatura",description:d.message||"Houve um erro ao processar a assinatura",variant:"destructive"}),t(!1)};return s.jsx("form",{onSubmit:m,children:s.jsxs(p,{children:[s.jsxs(b,{children:[s.jsx(w,{children:"Inscrever-se no Plano Premium"}),s.jsx(T,{children:"Preencha os dados do seu cartão para iniciar sua assinatura"})]}),s.jsx(g,{className:"space-y-4",children:s.jsx(E,{})}),s.jsx(v,{children:s.jsx(N,{type:"submit",className:"w-full",disabled:!e||a,children:a?s.jsxs(s.Fragment,{children:[s.jsx(f,{className:"mr-2 h-4 w-4 animate-spin"}),"Processando..."]}):"Assinar"})})]})})};function W(){const[e,n]=i.useState(""),[o,a]=i.useState(!0),[t,m]=i.useState(null),{toast:c}=j();return i.useEffect(()=>{(async()=>{var h;try{a(!0);const r=await apiCall("/api/get-or-create-subscription",{method:"POST",headers:{"Content-Type":"application/json"}});if(!r.ok){const P=await r.json();throw new Error(((h=P.error)==null?void 0:h.message)||"Erro ao criar assinatura")}const u=await r.json();if(!u.clientSecret)throw new Error("Não foi possível iniciar o pagamento da assinatura");n(u.clientSecret)}catch(r){m(r.message),c({title:"Erro",description:r.message,variant:"destructive"})}finally{a(!1)}})()},[c]),o?s.jsx(x,{children:s.jsx("div",{className:"container mx-auto py-10 max-w-2xl",children:s.jsxs("div",{className:"flex items-center justify-center h-64",children:[s.jsx(f,{className:"h-8 w-8 animate-spin text-primary"}),s.jsx("span",{className:"ml-2",children:"Preparando sua assinatura..."})]})})}):t?s.jsx(x,{children:s.jsx("div",{className:"container mx-auto py-10 max-w-2xl",children:s.jsxs(p,{className:"p-6",children:[s.jsxs(D,{variant:"destructive",className:"mb-4",children:[s.jsx(k,{className:"h-4 w-4"}),s.jsx(L,{children:t})]}),s.jsx("p",{className:"mb-4",children:"Possíveis causas:"}),s.jsxs("ul",{className:"list-disc pl-5 mb-4 space-y-1",children:[s.jsx("li",{children:"O servidor pode não estar configurado com o ID de preço do Stripe"}),s.jsx("li",{children:"Você pode precisar estar autenticado para assinar"}),s.jsx("li",{children:"A conta do Stripe pode não estar configurada corretamente"})]}),s.jsx(N,{className:"mt-2",variant:"outline",onClick:()=>window.history.back(),children:"Voltar"})]})})}):s.jsxs(x,{children:[s.jsx(I,{children:s.jsx("title",{children:"Assinar Plano Premium | AgendoAI"})}),s.jsxs("div",{className:"container mx-auto py-10 max-w-2xl",children:[s.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Plano Premium"}),s.jsx("div",{className:"mb-6",children:s.jsxs(p,{className:"mb-4",children:[s.jsx(b,{children:s.jsx(w,{children:"Benefícios do Plano Premium"})}),s.jsx(g,{children:s.jsxs("ul",{className:"space-y-2",children:[s.jsxs("li",{className:"flex items-start",children:[s.jsx(l,{className:"h-5 w-5 text-green-500 mr-2 flex-shrink-0 mt-0.5"}),s.jsx("span",{children:"Agendamento prioritário com os melhores profissionais"})]}),s.jsxs("li",{className:"flex items-start",children:[s.jsx(l,{className:"h-5 w-5 text-green-500 mr-2 flex-shrink-0 mt-0.5"}),s.jsx("span",{children:"Descontos especiais em serviços selecionados"})]}),s.jsxs("li",{className:"flex items-start",children:[s.jsx(l,{className:"h-5 w-5 text-green-500 mr-2 flex-shrink-0 mt-0.5"}),s.jsx("span",{children:"Suporte prioritário"})]}),s.jsxs("li",{className:"flex items-start",children:[s.jsx(l,{className:"h-5 w-5 text-green-500 mr-2 flex-shrink-0 mt-0.5"}),s.jsx("span",{children:"Acesso a horários exclusivos"})]})]})}),s.jsxs(v,{className:"flex justify-between border-t pt-6",children:[s.jsx("span",{className:"text-muted-foreground",children:"Valor mensal:"}),s.jsx("span",{className:"font-semibold text-lg",children:"R$ 19,90"})]})]})}),e&&s.jsx(S,{stripe:B,options:{clientSecret:e,appearance:{theme:"stripe",variables:{colorPrimary:"#10b981",colorBackground:"#ffffff",colorText:"#1f2937"}}},children:s.jsx(F,{})})]})]})}export{W as default};
