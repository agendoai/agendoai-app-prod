import{j as e}from"./ui-UIpCtT3r.js";import{r as j}from"./vendor-vA4cx1mx.js";import{u as ie,b as ee,c as k,r as F,C as b,d as y,e as w,f as C,g as A,m as le,q as Q,i as de}from"./index-BJ9Cw0LR.js";import{u as ce}from"./useMutation-CDdW0pzE.js";import{u as oe,L as R}from"./router-CxXythJb.js";import{B as o}from"./button-BvsVcTDx.js";import{D as G,a as $,b as J,c as W,d as X,e as Y}from"./dropdown-menu-Dyfg7Gk4.js";import{A as me,a as xe,b as he}from"./avatar-DEanbPY_.js";import{B as m}from"./badge-BQpU5zw7.js";import{a as ue,S as pe,b as je}from"./sheet-NdLuqHVB.js";import{M as fe}from"./menu-B7gXVrLX.js";import{L as Z}from"./log-out-CdVFLkWN.js";import{B as ge}from"./bell-vRE7a1ng.js";import{M as se}from"./message-square-8xU1RYWw.js";import{C as ae}from"./clock-BoQP0pJL.js";import{C as Ne}from"./chart-no-axes-column-increasing-BVwDjs9K.js";import{U as ve}from"./users-ZhvK7Ip9.js";import{T as z,a as I,b as B,c,d as i,e as E,f as r}from"./table-DAcL9sM6.js";import{I as be}from"./input-CNw_l4dQ.js";import{T as ye,a as we,b as P,c as U}from"./tabs-0uPJ4FVU.js";import{T as Ce}from"./textarea-6aMtToLP.js";import{D as Ae,a as Se,b as Te,c as De,d as Me,e as Le}from"./dialog-BlryVO8p.js";import{R as Re}from"./refresh-ccw-HHWXnnnR.js";import{C as _}from"./circle-check-big-KcM-m8FQ.js";import{S as ze}from"./search-ByWcnwgm.js";import{f as Ie}from"./formatDistanceToNow-S4dAOUBN.js";import{p as Be}from"./pt-BR-Cxqo7XV3.js";import"./chevron-right-CATzdtP3.js";import"./check-ZbxB06uW.js";import"./circle-CxgECyF4.js";import"./constructNow-BcZzM1ki.js";import"./en-US-xSPtgCq_.js";import"./endOfMonth-CH6FLORf.js";function Ee({children:f}){const{user:t,logoutMutation:q}=ie(),[d,h]=oe(),[u,p]=j.useState(!1),{toast:S}=ee(),{data:x}=k({queryKey:["/api/admin/support/pending"],refetchInterval:3e4}),a=Array.isArray(x)?x.length:0;j.useEffect(()=>{t&&t.userType!=="support"&&h("/")},[t,h]);const g=async()=>{localStorage.removeItem("authToken"),sessionStorage.removeItem("authToken"),window.authToken&&(window.authToken=void 0),console.log("ðŸ”‘ Token removido diretamente do localStorage e sessionStorage"),S({title:"Logout realizado",description:"VocÃª saiu da sua conta com sucesso."}),setTimeout(()=>{console.log("ðŸ”„ Recarregando pÃ¡gina..."),window.location.reload()},500)},v=[{name:"Central de Suporte",href:"/support/dashboard",icon:e.jsx(se,{size:20}),active:d==="/support/dashboard"||d==="/support"},{name:"Mensagens Pendentes",href:"/support/pending",icon:e.jsx(ae,{size:20}),active:d==="/support/pending",badge:a},{name:"HistÃ³rico de Mensagens",href:"/support/history",icon:e.jsx(Ne,{size:20}),active:d==="/support/history"},{name:"Clientes",href:"/support/clients",icon:e.jsx(ve,{size:20}),active:d==="/support/clients"}];if(!t)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:"Carregando..."});const N=t.name?t.name.split(" ").map(n=>n[0]).join("").toUpperCase().substring(0,2):"SU";return e.jsxs("div",{className:"h-screen flex flex-col",children:[e.jsxs("header",{className:"h-16 border-b bg-background flex items-center justify-between px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(ue,{open:u,onOpenChange:p,children:[e.jsx(pe,{asChild:!0,className:"lg:hidden mr-2",children:e.jsx(o,{variant:"ghost",size:"icon",children:e.jsx(fe,{size:20})})}),e.jsx(je,{side:"left",className:"w-64 p-0 pt-10",children:e.jsxs("div",{className:"flex flex-col space-y-2 p-4",children:[v.map(n=>e.jsx(R,{href:n.href,children:e.jsxs("a",{className:F("flex items-center space-x-2 rounded-lg px-3 py-2 text-sm font-medium",n.active?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-primary/5"),onClick:()=>p(!1),children:[n.icon,e.jsx("span",{children:n.name}),n.badge?e.jsx(m,{variant:"destructive",className:"ml-auto flex h-5 w-5 items-center justify-center rounded-full p-0",children:n.badge}):null]})},n.href)),e.jsxs(o,{variant:"ghost",className:"justify-start",onClick:g,children:[e.jsx(Z,{size:20,className:"mr-2"}),e.jsx("span",{children:"Sair"})]})]})})]}),e.jsx(R,{href:"/",children:e.jsxs("a",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-xl",children:"AgendoAI"}),e.jsx(m,{variant:"secondary",children:"Suporte"})]})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(G,{children:[e.jsx($,{asChild:!0,children:e.jsxs(o,{variant:"ghost",size:"icon",className:"relative",children:[e.jsx(ge,{size:20}),a>0&&e.jsx(m,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-[10px]",children:a})]})}),e.jsxs(J,{align:"end",className:"w-80",children:[e.jsx(W,{children:"NotificaÃ§Ãµes"}),e.jsx(X,{}),a>0?e.jsx(e.Fragment,{children:e.jsxs(Y,{className:"cursor-pointer",onClick:()=>h("/support/pending"),children:["VocÃª tem ",a," ",a===1?"mensagem":"mensagens"," pendente",a===1?"":"s"]})}):e.jsx("div",{className:"px-2 py-4 text-center text-muted-foreground",children:"Nenhuma notificaÃ§Ã£o no momento"})]})]}),e.jsxs(G,{children:[e.jsx($,{asChild:!0,children:e.jsx(o,{variant:"ghost",className:"relative h-10 w-10 rounded-full",children:e.jsxs(me,{className:"h-10 w-10",children:[e.jsx(xe,{src:t.profileImage||"",alt:t.name||"Avatar"}),e.jsx(he,{children:N})]})})}),e.jsxs(J,{className:"w-56",align:"end",forceMount:!0,children:[e.jsx(W,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:t.name}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:t.email})]})}),e.jsx(X,{}),e.jsxs(Y,{onClick:g,className:"cursor-pointer",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Sair"})]})]})]})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"hidden lg:flex lg:w-64 lg:flex-col lg:border-r",children:e.jsx("div",{className:"flex flex-col space-y-2 p-4",children:v.map(n=>e.jsx(R,{href:n.href,children:e.jsxs("a",{className:F("flex items-center space-x-2 rounded-lg px-3 py-2 text-sm font-medium",n.active?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-primary/5"),children:[n.icon,e.jsx("span",{children:n.name}),n.badge?e.jsx(m,{variant:"destructive",className:"ml-auto flex h-5 w-5 items-center justify-center rounded-full p-0",children:n.badge}):null]})},n.href))})}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-secondary/10 p-4",children:f})]})]})}function ps(){const{toast:f}=ee(),[t,q]=j.useState(""),[d,h]=j.useState(null),[u,p]=j.useState(""),[S,x]=j.useState(!1),{data:a,isLoading:g,refetch:v}=k({queryKey:["/api/admin/support/all"],staleTime:6e4}),{data:N,isLoading:n,refetch:re}=k({queryKey:["/api/admin/support/pending"],staleTime:6e4}),T=ce({mutationFn:async({messageId:s,reply:l})=>await(await de("POST",`/api/admin/support/resolve/${s}`,{response:l})).json(),onSuccess:()=>{Q.invalidateQueries({queryKey:["/api/admin/support/all"]}),Q.invalidateQueries({queryKey:["/api/admin/support/pending"]}),f({title:"Resposta enviada com sucesso",variant:"default"}),x(!1),p(""),h(null)},onError:s=>{f({title:"Erro ao enviar resposta",description:s.message||"Tente novamente mais tarde",variant:"destructive"})}}),D=s=>{h(s),p(""),x(!0)},O=Array.isArray(a)?a.filter(s=>{var l,L,H,K;return((l=s.subject)==null?void 0:l.toLowerCase().includes(t.toLowerCase()))||((L=s.message)==null?void 0:L.toLowerCase().includes(t.toLowerCase()))||((H=s.userName)==null?void 0:H.toLowerCase().includes(t.toLowerCase()))||((K=s.userEmail)==null?void 0:K.toLowerCase().includes(t.toLowerCase()))}):[],V=s=>Array.isArray(a)?a.filter(l=>l.status===s).length:0,ne=()=>{!d||!u.trim()||T.mutate({messageId:d,reply:u.trim()})},te=s=>{switch(s){case"open":return e.jsx(m,{variant:"secondary",children:"Aberto"});case"pending":return e.jsx(m,{variant:"warning",children:"Pendente"});case"closed":return e.jsx(m,{variant:"success",children:"Resolvido"});default:return e.jsx(m,{variant:"outline",children:"Desconhecido"})}},M=s=>{try{const l=new Date(s);return Ie(l,{addSuffix:!0,locale:Be})}catch{return"Data invÃ¡lida"}};return e.jsx(Ee,{children:e.jsxs("div",{className:"container py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Central de Suporte"}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(o,{variant:"outline",onClick:()=>{v(),re(),f({title:"Mensagens atualizadas",variant:"default"})},className:"flex items-center gap-2",children:[e.jsx(Re,{size:16}),"Atualizar"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs(b,{children:[e.jsxs(y,{className:"pb-2",children:[e.jsx(w,{className:"text-2xl",children:Array.isArray(a)?a.length:0}),e.jsx(C,{children:"Total de Mensagens"})]}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{className:"mr-2 text-muted-foreground",size:18}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Todas as mensagens"})]})})]}),e.jsxs(b,{children:[e.jsxs(y,{className:"pb-2",children:[e.jsx(w,{className:"text-2xl",children:V("pending")}),e.jsx(C,{children:"Mensagens Pendentes"})]}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"mr-2 text-amber-500",size:18}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Aguardando resposta"})]})})]}),e.jsxs(b,{children:[e.jsxs(y,{className:"pb-2",children:[e.jsx(w,{className:"text-2xl",children:V("closed")}),e.jsx(C,{children:"Mensagens Resolvidas"})]}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"mr-2 text-green-500",size:18}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Casos encerrados"})]})})]})]}),e.jsxs(b,{className:"mb-8",children:[e.jsxs(y,{children:[e.jsx(w,{children:"Gerenciar Mensagens"}),e.jsx(C,{children:"Visualize e responda mensagens de suporte dos usuÃ¡rios"})]}),e.jsxs(A,{children:[e.jsx("div",{className:"flex mb-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ze,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(be,{type:"search",placeholder:"Buscar por assunto, mensagem ou usuÃ¡rio...",className:"pl-8",value:t,onChange:s=>q(s.target.value)})]})}),e.jsxs(ye,{defaultValue:"all",className:"w-full",children:[e.jsxs(we,{className:"mb-4",children:[e.jsx(P,{value:"all",children:"Todas"}),e.jsx(P,{value:"pending",children:"Pendentes"}),e.jsx(P,{value:"closed",children:"Resolvidas"})]}),e.jsx(U,{value:"all",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(z,{children:[e.jsx(I,{children:"Lista de todas as mensagens de suporte"}),e.jsx(B,{children:e.jsxs(c,{children:[e.jsx(i,{className:"w-[50px]",children:"ID"}),e.jsx(i,{children:"UsuÃ¡rio"}),e.jsx(i,{children:"Assunto"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Data"}),e.jsx(i,{className:"text-right",children:"AÃ§Ãµes"})]})}),e.jsx(E,{children:g?e.jsx(c,{children:e.jsx(r,{colSpan:6,className:"text-center py-10",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})})})}):O.length===0?e.jsx(c,{children:e.jsxs(r,{colSpan:6,className:"text-center py-10",children:[e.jsx(le,{className:"mx-auto h-8 w-8 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhuma mensagem encontrada"})]})}):O.map(s=>e.jsxs(c,{children:[e.jsx(r,{children:s.id}),e.jsx(r,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.userName||"UsuÃ¡rio nÃ£o identificado"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.userEmail})]})}),e.jsx(r,{children:s.subject}),e.jsx(r,{children:te(s.status)}),e.jsx(r,{children:M(s.createdAt)}),e.jsx(r,{className:"text-right",children:e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>D(s.id),children:"Detalhes"})})]},s.id))})]})})}),e.jsx(U,{value:"pending",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(z,{children:[e.jsx(I,{children:"Lista de mensagens pendentes"}),e.jsx(B,{children:e.jsxs(c,{children:[e.jsx(i,{className:"w-[50px]",children:"ID"}),e.jsx(i,{children:"UsuÃ¡rio"}),e.jsx(i,{children:"Assunto"}),e.jsx(i,{children:"Data"}),e.jsx(i,{className:"text-right",children:"AÃ§Ãµes"})]})}),e.jsx(E,{children:n?e.jsx(c,{children:e.jsx(r,{colSpan:5,className:"text-center py-10",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})})})}):!Array.isArray(N)||N.length===0?e.jsx(c,{children:e.jsxs(r,{colSpan:5,className:"text-center py-10",children:[e.jsx(_,{className:"mx-auto h-8 w-8 text-green-500 mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"NÃ£o hÃ¡ mensagens pendentes"})]})}):N.map(s=>e.jsxs(c,{children:[e.jsx(r,{children:s.id}),e.jsx(r,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.userName||"UsuÃ¡rio nÃ£o identificado"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.userEmail})]})}),e.jsx(r,{children:s.subject}),e.jsx(r,{children:M(s.createdAt)}),e.jsx(r,{className:"text-right",children:e.jsx(o,{variant:"outline",size:"sm",onClick:()=>D(s.id),children:"Responder"})})]},s.id))})]})})}),e.jsx(U,{value:"closed",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(z,{children:[e.jsx(I,{children:"Lista de mensagens resolvidas"}),e.jsx(B,{children:e.jsxs(c,{children:[e.jsx(i,{className:"w-[50px]",children:"ID"}),e.jsx(i,{children:"UsuÃ¡rio"}),e.jsx(i,{children:"Assunto"}),e.jsx(i,{children:"Data"}),e.jsx(i,{className:"text-right",children:"AÃ§Ãµes"})]})}),e.jsx(E,{children:g?e.jsx(c,{children:e.jsx(r,{colSpan:5,className:"text-center py-10",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})})})}):(Array.isArray(a)?a.filter(s=>s.status==="closed"):[]).map(s=>e.jsxs(c,{children:[e.jsx(r,{children:s.id}),e.jsx(r,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.userName||"UsuÃ¡rio nÃ£o identificado"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.userEmail})]})}),e.jsx(r,{children:s.subject}),e.jsx(r,{children:M(s.createdAt)}),e.jsx(r,{className:"text-right",children:e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>D(s.id),children:"Visualizar"})})]},s.id))})]})})})]})]})]}),d&&e.jsx(Ae,{open:S,onOpenChange:x,children:e.jsxs(Se,{className:"sm:max-w-[600px]",children:[e.jsxs(Te,{children:[e.jsx(De,{children:"Detalhes da Mensagem"}),e.jsx(Me,{children:"Visualize e responda a mensagem do cliente"})]}),a&&Array.isArray(a)&&(()=>{const s=a.find(l=>l.id===d);return s?e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"De:"}),e.jsx("p",{className:"text-sm",children:s.userName||"NÃ£o informado"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.userEmail})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Data:"}),e.jsx("p",{className:"text-sm",children:new Date(s.createdAt).toLocaleString("pt-BR")})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Assunto:"}),e.jsx("p",{className:"text-sm font-medium",children:s.subject})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Mensagem:"}),e.jsx("div",{className:"border rounded-md p-3 bg-secondary/20 text-sm",children:s.message})]}),s.status!=="closed"&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Sua resposta:"}),e.jsx(Ce,{value:u,onChange:l=>p(l.target.value),placeholder:"Digite sua resposta para o cliente...",className:"min-h-[120px]"})]}),s.reply&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Resposta Anterior:"}),e.jsx("div",{className:"border rounded-md p-3 bg-primary/5 text-sm",children:s.reply}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Respondido em: ",s.repliedAt?new Date(s.repliedAt).toLocaleString("pt-BR"):"N/A"]})]})]}):e.jsx("div",{children:"Mensagem nÃ£o encontrada"})})(),e.jsxs(Le,{children:[e.jsx(o,{variant:"outline",onClick:()=>x(!1),children:"Cancelar"}),a&&Array.isArray(a)&&(()=>{const s=a.find(l=>l.id===d);return!s||s.status==="closed"?null:e.jsx(o,{disabled:!u.trim()||T.isPending,onClick:ne,children:T.isPending?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white"}),"Enviando..."]}):"Enviar Resposta"})})()]})]})})]})})}export{ps as default};
