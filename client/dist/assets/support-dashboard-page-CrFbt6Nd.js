import{u as te,a as ie,r as j,d as q,j as e,L as z,z as k,c as le,C as v,f as b,g as y,h as C,i as w,o as de,q as F,l as ce}from"./index-BdrEJuYD.js";import{u as oe}from"./useMutation-C9nL7V5b.js";import{B as m}from"./button-CynjWJoH.js";import{D as Q,a as G,b as $,c as J,d as W,e as X}from"./dropdown-menu-DWmQMH9U.js";import{A as me,a as xe,b as he}from"./avatar-YOIRMJBI.js";import{B as x}from"./badge-muy4ZFs4.js";import{a as ue,S as pe,b as je}from"./sheet-oTYlejKF.js";import{M as fe}from"./menu-BVXWFAVP.js";import{L as Y}from"./log-out-9hU1A0cG.js";import{B as ge}from"./bell-DPzU_a_S.js";import{M as _}from"./message-square-kvDXS4V3.js";import{C as ee}from"./clock-BTnG-tJG.js";import{C as Ne}from"./chart-no-axes-column-increasing-CBmVYrCq.js";import{U as ve}from"./users--EJM8Ox4.js";import{T as R,a as I,b as B,c as o,d as i,e as E,f as r}from"./table-D8Lzxcvt.js";import{I as be}from"./input-BRNzA_b4.js";import{T as ye,a as Ce,b as P,c as U}from"./tabs-Dh7LOHW3.js";import{T as we}from"./textarea-CTBqUipt.js";import{D as Ae,a as Se,b as De,c as Te,d as Me,e as Le}from"./dialog-Cv4VtnLP.js";import{R as ze}from"./refresh-ccw-CYI-yMdY.js";import{C as Z}from"./circle-check-big-CiI_Z36v.js";import{S as Re}from"./search-DiCZmcCn.js";import{f as Ie}from"./formatDistanceToNow-S4dAOUBN.js";import{p as Be}from"./pt-BR-Cxqo7XV3.js";import"./index-YY5r1pln.js";import"./index-DTy3TPQv.js";import"./index-Bg9Ro7l2.js";import"./index-CeeqZ7YQ.js";import"./index-BoRtQnRr.js";import"./index-BYdWi_2u.js";import"./chevron-right-DQzs9QCW.js";import"./check-WTIUe9ha.js";import"./circle-CB07NW__.js";import"./index-CrNpXqsn.js";import"./constructNow-BcZzM1ki.js";import"./en-US-xSPtgCq_.js";import"./endOfMonth-CH6FLORf.js";function Ee({children:f}){const{user:t,logoutMutation:A}=te(),[c,h]=ie(),[u,p]=j.useState(!1),{data:N}=q({queryKey:["/api/admin/support/pending"],refetchInterval:3e4}),d=Array.isArray(N)?N.length:0;j.useEffect(()=>{t&&t.userType!=="support"&&h("/")},[t,h]);const n=async()=>{A.mutate(void 0,{onSuccess:()=>{window.location.reload()},onError:a=>{console.error("Erro no logout:",a)}})},g=[{name:"Central de Suporte",href:"/support/dashboard",icon:e.jsx(_,{size:20}),active:c==="/support/dashboard"||c==="/support"},{name:"Mensagens Pendentes",href:"/support/pending",icon:e.jsx(ee,{size:20}),active:c==="/support/pending",badge:d},{name:"Histórico de Mensagens",href:"/support/history",icon:e.jsx(Ne,{size:20}),active:c==="/support/history"},{name:"Clientes",href:"/support/clients",icon:e.jsx(ve,{size:20}),active:c==="/support/clients"}];if(!t)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:"Carregando..."});const S=t.name?t.name.split(" ").map(a=>a[0]).join("").toUpperCase().substring(0,2):"SU";return e.jsxs("div",{className:"h-screen flex flex-col",children:[e.jsxs("header",{className:"h-16 border-b bg-background flex items-center justify-between px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(ue,{open:u,onOpenChange:p,children:[e.jsx(pe,{asChild:!0,className:"lg:hidden mr-2",children:e.jsx(m,{variant:"ghost",size:"icon",children:e.jsx(fe,{size:20})})}),e.jsx(je,{side:"left",className:"w-64 p-0 pt-10",children:e.jsxs("div",{className:"flex flex-col space-y-2 p-4",children:[g.map(a=>e.jsx(z,{href:a.href,children:e.jsxs("a",{className:k("flex items-center space-x-2 rounded-lg px-3 py-2 text-sm font-medium",a.active?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-primary/5"),onClick:()=>p(!1),children:[a.icon,e.jsx("span",{children:a.name}),a.badge?e.jsx(x,{variant:"destructive",className:"ml-auto flex h-5 w-5 items-center justify-center rounded-full p-0",children:a.badge}):null]})},a.href)),e.jsxs(m,{variant:"ghost",className:"justify-start",onClick:n,children:[e.jsx(Y,{size:20,className:"mr-2"}),e.jsx("span",{children:"Sair"})]})]})})]}),e.jsx(z,{href:"/",children:e.jsxs("a",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-xl",children:"AgendoAI"}),e.jsx(x,{variant:"secondary",children:"Suporte"})]})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(Q,{children:[e.jsx(G,{asChild:!0,children:e.jsxs(m,{variant:"ghost",size:"icon",className:"relative",children:[e.jsx(ge,{size:20}),d>0&&e.jsx(x,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-[10px]",children:d})]})}),e.jsxs($,{align:"end",className:"w-80",children:[e.jsx(J,{children:"Notificações"}),e.jsx(W,{}),d>0?e.jsx(e.Fragment,{children:e.jsxs(X,{className:"cursor-pointer",onClick:()=>h("/support/pending"),children:["Você tem ",d," ",d===1?"mensagem":"mensagens"," pendente",d===1?"":"s"]})}):e.jsx("div",{className:"px-2 py-4 text-center text-muted-foreground",children:"Nenhuma notificação no momento"})]})]}),e.jsxs(Q,{children:[e.jsx(G,{asChild:!0,children:e.jsx(m,{variant:"ghost",className:"relative h-10 w-10 rounded-full",children:e.jsxs(me,{className:"h-10 w-10",children:[e.jsx(xe,{src:t.profileImage||"",alt:t.name||"Avatar"}),e.jsx(he,{children:S})]})})}),e.jsxs($,{className:"w-56",align:"end",forceMount:!0,children:[e.jsx(J,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:t.name}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:t.email})]})}),e.jsx(W,{}),e.jsxs(X,{onClick:n,className:"cursor-pointer",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Sair"})]})]})]})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"hidden lg:flex lg:w-64 lg:flex-col lg:border-r",children:e.jsx("div",{className:"flex flex-col space-y-2 p-4",children:g.map(a=>e.jsx(z,{href:a.href,children:e.jsxs("a",{className:k("flex items-center space-x-2 rounded-lg px-3 py-2 text-sm font-medium",a.active?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-primary/5"),children:[a.icon,e.jsx("span",{children:a.name}),a.badge?e.jsx(x,{variant:"destructive",className:"ml-auto flex h-5 w-5 items-center justify-center rounded-full p-0",children:a.badge}):null]})},a.href))})}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-secondary/10 p-4",children:f})]})]})}function Ns(){const{toast:f}=le(),[t,A]=j.useState(""),[c,h]=j.useState(null),[u,p]=j.useState(""),[N,d]=j.useState(!1),{data:n,isLoading:g,refetch:S}=q({queryKey:["/api/admin/support/all"],staleTime:6e4}),{data:a,isLoading:se,refetch:ae}=q({queryKey:["/api/admin/support/pending"],staleTime:6e4}),D=oe({mutationFn:async({messageId:s,reply:l})=>await(await ce("POST",`/api/admin/support/resolve/${s}`,{response:l})).json(),onSuccess:()=>{F.invalidateQueries({queryKey:["/api/admin/support/all"]}),F.invalidateQueries({queryKey:["/api/admin/support/pending"]}),f({title:"Resposta enviada com sucesso",variant:"default"}),d(!1),p(""),h(null)},onError:s=>{f({title:"Erro ao enviar resposta",description:s.message||"Tente novamente mais tarde",variant:"destructive"})}}),T=s=>{h(s),p(""),d(!0)},O=Array.isArray(n)?n.filter(s=>{var l,L,K,V;return((l=s.subject)==null?void 0:l.toLowerCase().includes(t.toLowerCase()))||((L=s.message)==null?void 0:L.toLowerCase().includes(t.toLowerCase()))||((K=s.userName)==null?void 0:K.toLowerCase().includes(t.toLowerCase()))||((V=s.userEmail)==null?void 0:V.toLowerCase().includes(t.toLowerCase()))}):[],H=s=>Array.isArray(n)?n.filter(l=>l.status===s).length:0,re=()=>{!c||!u.trim()||D.mutate({messageId:c,reply:u.trim()})},ne=s=>{switch(s){case"open":return e.jsx(x,{variant:"secondary",children:"Aberto"});case"pending":return e.jsx(x,{variant:"warning",children:"Pendente"});case"closed":return e.jsx(x,{variant:"success",children:"Resolvido"});default:return e.jsx(x,{variant:"outline",children:"Desconhecido"})}},M=s=>{try{const l=new Date(s);return Ie(l,{addSuffix:!0,locale:Be})}catch{return"Data inválida"}};return e.jsx(Ee,{children:e.jsxs("div",{className:"container py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Central de Suporte"}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(m,{variant:"outline",onClick:()=>{S(),ae(),f({title:"Mensagens atualizadas",variant:"default"})},className:"flex items-center gap-2",children:[e.jsx(ze,{size:16}),"Atualizar"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs(v,{children:[e.jsxs(b,{className:"pb-2",children:[e.jsx(y,{className:"text-2xl",children:Array.isArray(n)?n.length:0}),e.jsx(C,{children:"Total de Mensagens"})]}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"mr-2 text-muted-foreground",size:18}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Todas as mensagens"})]})})]}),e.jsxs(v,{children:[e.jsxs(b,{className:"pb-2",children:[e.jsx(y,{className:"text-2xl",children:H("pending")}),e.jsx(C,{children:"Mensagens Pendentes"})]}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"mr-2 text-amber-500",size:18}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Aguardando resposta"})]})})]}),e.jsxs(v,{children:[e.jsxs(b,{className:"pb-2",children:[e.jsx(y,{className:"text-2xl",children:H("closed")}),e.jsx(C,{children:"Mensagens Resolvidas"})]}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{className:"mr-2 text-green-500",size:18}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Casos encerrados"})]})})]})]}),e.jsxs(v,{className:"mb-8",children:[e.jsxs(b,{children:[e.jsx(y,{children:"Gerenciar Mensagens"}),e.jsx(C,{children:"Visualize e responda mensagens de suporte dos usuários"})]}),e.jsxs(w,{children:[e.jsx("div",{className:"flex mb-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Re,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(be,{type:"search",placeholder:"Buscar por assunto, mensagem ou usuário...",className:"pl-8",value:t,onChange:s=>A(s.target.value)})]})}),e.jsxs(ye,{defaultValue:"all",className:"w-full",children:[e.jsxs(Ce,{className:"mb-4",children:[e.jsx(P,{value:"all",children:"Todas"}),e.jsx(P,{value:"pending",children:"Pendentes"}),e.jsx(P,{value:"closed",children:"Resolvidas"})]}),e.jsx(U,{value:"all",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(R,{children:[e.jsx(I,{children:"Lista de todas as mensagens de suporte"}),e.jsx(B,{children:e.jsxs(o,{children:[e.jsx(i,{className:"w-[50px]",children:"ID"}),e.jsx(i,{children:"Usuário"}),e.jsx(i,{children:"Assunto"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Data"}),e.jsx(i,{className:"text-right",children:"Ações"})]})}),e.jsx(E,{children:g?e.jsx(o,{children:e.jsx(r,{colSpan:6,className:"text-center py-10",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})})})}):O.length===0?e.jsx(o,{children:e.jsxs(r,{colSpan:6,className:"text-center py-10",children:[e.jsx(de,{className:"mx-auto h-8 w-8 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhuma mensagem encontrada"})]})}):O.map(s=>e.jsxs(o,{children:[e.jsx(r,{children:s.id}),e.jsx(r,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.userName||"Usuário não identificado"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.userEmail})]})}),e.jsx(r,{children:s.subject}),e.jsx(r,{children:ne(s.status)}),e.jsx(r,{children:M(s.createdAt)}),e.jsx(r,{className:"text-right",children:e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>T(s.id),children:"Detalhes"})})]},s.id))})]})})}),e.jsx(U,{value:"pending",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(R,{children:[e.jsx(I,{children:"Lista de mensagens pendentes"}),e.jsx(B,{children:e.jsxs(o,{children:[e.jsx(i,{className:"w-[50px]",children:"ID"}),e.jsx(i,{children:"Usuário"}),e.jsx(i,{children:"Assunto"}),e.jsx(i,{children:"Data"}),e.jsx(i,{className:"text-right",children:"Ações"})]})}),e.jsx(E,{children:se?e.jsx(o,{children:e.jsx(r,{colSpan:5,className:"text-center py-10",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})})})}):!Array.isArray(a)||a.length===0?e.jsx(o,{children:e.jsxs(r,{colSpan:5,className:"text-center py-10",children:[e.jsx(Z,{className:"mx-auto h-8 w-8 text-green-500 mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Não há mensagens pendentes"})]})}):a.map(s=>e.jsxs(o,{children:[e.jsx(r,{children:s.id}),e.jsx(r,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.userName||"Usuário não identificado"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.userEmail})]})}),e.jsx(r,{children:s.subject}),e.jsx(r,{children:M(s.createdAt)}),e.jsx(r,{className:"text-right",children:e.jsx(m,{variant:"outline",size:"sm",onClick:()=>T(s.id),children:"Responder"})})]},s.id))})]})})}),e.jsx(U,{value:"closed",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(R,{children:[e.jsx(I,{children:"Lista de mensagens resolvidas"}),e.jsx(B,{children:e.jsxs(o,{children:[e.jsx(i,{className:"w-[50px]",children:"ID"}),e.jsx(i,{children:"Usuário"}),e.jsx(i,{children:"Assunto"}),e.jsx(i,{children:"Data"}),e.jsx(i,{className:"text-right",children:"Ações"})]})}),e.jsx(E,{children:g?e.jsx(o,{children:e.jsx(r,{colSpan:5,className:"text-center py-10",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})})})}):(Array.isArray(n)?n.filter(s=>s.status==="closed"):[]).map(s=>e.jsxs(o,{children:[e.jsx(r,{children:s.id}),e.jsx(r,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.userName||"Usuário não identificado"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.userEmail})]})}),e.jsx(r,{children:s.subject}),e.jsx(r,{children:M(s.createdAt)}),e.jsx(r,{className:"text-right",children:e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>T(s.id),children:"Visualizar"})})]},s.id))})]})})})]})]})]}),c&&e.jsx(Ae,{open:N,onOpenChange:d,children:e.jsxs(Se,{className:"sm:max-w-[600px]",children:[e.jsxs(De,{children:[e.jsx(Te,{children:"Detalhes da Mensagem"}),e.jsx(Me,{children:"Visualize e responda a mensagem do cliente"})]}),n&&Array.isArray(n)&&(()=>{const s=n.find(l=>l.id===c);return s?e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"De:"}),e.jsx("p",{className:"text-sm",children:s.userName||"Não informado"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.userEmail})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Data:"}),e.jsx("p",{className:"text-sm",children:new Date(s.createdAt).toLocaleString("pt-BR")})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Assunto:"}),e.jsx("p",{className:"text-sm font-medium",children:s.subject})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Mensagem:"}),e.jsx("div",{className:"border rounded-md p-3 bg-secondary/20 text-sm",children:s.message})]}),s.status!=="closed"&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Sua resposta:"}),e.jsx(we,{value:u,onChange:l=>p(l.target.value),placeholder:"Digite sua resposta para o cliente...",className:"min-h-[120px]"})]}),s.reply&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Resposta Anterior:"}),e.jsx("div",{className:"border rounded-md p-3 bg-primary/5 text-sm",children:s.reply}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Respondido em: ",s.repliedAt?new Date(s.repliedAt).toLocaleString("pt-BR"):"N/A"]})]})]}):e.jsx("div",{children:"Mensagem não encontrada"})})(),e.jsxs(Le,{children:[e.jsx(m,{variant:"outline",onClick:()=>d(!1),children:"Cancelar"}),n&&Array.isArray(n)&&(()=>{const s=n.find(l=>l.id===c);return!s||s.status==="closed"?null:e.jsx(m,{disabled:!u.trim()||D.isPending,onClick:re,children:D.isPending?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white"}),"Enviando..."]}):"Enviar Resposta"})})()]})]})})]})})}export{Ns as default};
