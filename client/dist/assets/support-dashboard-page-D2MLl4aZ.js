import{j as e}from"./ui-UIpCtT3r.js";import{r as j}from"./vendor-vA4cx1mx.js";import{u as ie,b as se,c as q,B as o,r as G,C as b,d as y,e as w,f as C,g as A,m as le,q as Q,i as de}from"./index-_oaftgoR.js";import{u as ce}from"./useMutation-CeSY69nI.js";import{u as oe,L as z}from"./router-CxXythJb.js";import{D as J,a as $,b as W,c as X,d as Y,e as Z}from"./dropdown-menu-SXsdRjpy.js";import{A as me,a as xe,b as he}from"./avatar-DJIjDcKV.js";import{B as m}from"./badge-ku74LRvb.js";import{a as ue,S as pe,b as je}from"./sheet-D7J49Z8r.js";import{M as fe}from"./menu-ClVtlElC.js";import{L as _}from"./log-out-BxiFzjZw.js";import{B as ge}from"./bell-Ba9Vpo4G.js";import{M as ae}from"./message-square-CTw3dXYe.js";import{C as re}from"./clock-B5v9VZOW.js";import{C as Ne}from"./chart-no-axes-column-increasing-aErHeUtj.js";import{U as ve}from"./users-FiLp6VlV.js";import{T as I,a as B,b as k,c,d as i,e as E,f as n}from"./table-C5AtHS6a.js";import{I as be}from"./input-BDDyNkir.js";import{T as ye,a as we,b as P,c as U}from"./tabs-C6Wggbd4.js";import{T as Ce}from"./textarea-CN0IV-RX.js";import{D as Ae,a as Te,b as Se,c as Me,d as De,e as Le}from"./dialog-BvsjuwHe.js";import{R as Re}from"./refresh-ccw-C0-KCtCa.js";import{C as ee}from"./circle-check-big-BHshGvXV.js";import{S as ze}from"./search-DOY73Z0K.js";import{f as Ie}from"./formatDistanceToNow-S4dAOUBN.js";import{p as Be}from"./pt-BR-Cxqo7XV3.js";import"./chevron-right-B7vqsZez.js";import"./check-BMyHMEgN.js";import"./circle-C4JZ1W_T.js";import"./constructNow-BcZzM1ki.js";import"./en-US-xSPtgCq_.js";import"./endOfMonth-CH6FLORf.js";function ke({children:f}){const{user:t,logoutMutation:O}=ie(),[d,h]=oe(),[u,p]=j.useState(!1),{toast:T}=se(),{data:x}=q({queryKey:["/api/admin/support/pending"],refetchInterval:3e4}),a=Array.isArray(x)?x.length:0;j.useEffect(()=>{t&&t.userType!=="support"&&h("/")},[t,h]);const g=async()=>{localStorage.removeItem("authToken"),sessionStorage.removeItem("authToken"),window.authToken&&(window.authToken=void 0),document.cookie="authToken=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="authToken=; path=/; domain="+window.location.hostname+"; expires=Thu, 01 Jan 1970 00:00:00 GMT","caches"in window&&caches.keys().then(r=>{r.forEach(S=>{caches.delete(S)})}),T({title:"Logout realizado",description:"VocÃª saiu da sua conta com sucesso."}),setTimeout(()=>{console.log("ðŸ”„ Recarregando pÃ¡gina..."),window.location.reload()},500)},v=[{name:"Central de Suporte",href:"/support/dashboard",icon:e.jsx(ae,{size:20}),active:d==="/support/dashboard"||d==="/support"},{name:"Mensagens Pendentes",href:"/support/pending",icon:e.jsx(re,{size:20}),active:d==="/support/pending",badge:a},{name:"HistÃ³rico de Mensagens",href:"/support/history",icon:e.jsx(Ne,{size:20}),active:d==="/support/history"},{name:"Clientes",href:"/support/clients",icon:e.jsx(ve,{size:20}),active:d==="/support/clients"}];if(!t)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:"Carregando..."});const N=t.name?t.name.split(" ").map(r=>r[0]).join("").toUpperCase().substring(0,2):"SU";return e.jsxs("div",{className:"h-screen flex flex-col",children:[e.jsxs("header",{className:"h-16 border-b bg-background flex items-center justify-between px-4 lg:px-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(ue,{open:u,onOpenChange:p,children:[e.jsx(pe,{asChild:!0,className:"lg:hidden mr-2",children:e.jsx(o,{variant:"ghost",size:"icon",children:e.jsx(fe,{size:20})})}),e.jsx(je,{side:"left",className:"w-64 p-0 pt-10",children:e.jsxs("div",{className:"flex flex-col space-y-2 p-4",children:[v.map(r=>e.jsx(z,{href:r.href,children:e.jsxs("a",{className:G("flex items-center space-x-2 rounded-lg px-3 py-2 text-sm font-medium",r.active?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-primary/5"),onClick:()=>p(!1),children:[r.icon,e.jsx("span",{children:r.name}),r.badge?e.jsx(m,{variant:"destructive",className:"ml-auto flex h-5 w-5 items-center justify-center rounded-full p-0",children:r.badge}):null]})},r.href)),e.jsxs(o,{variant:"ghost",className:"justify-start",onClick:g,children:[e.jsx(_,{size:20,className:"mr-2"}),e.jsx("span",{children:"Sair"})]})]})})]}),e.jsx(z,{href:"/",children:e.jsxs("a",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-xl",children:"AgendoAI"}),e.jsx(m,{variant:"secondary",children:"Suporte"})]})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(J,{children:[e.jsx($,{asChild:!0,children:e.jsxs(o,{variant:"ghost",size:"icon",className:"relative",children:[e.jsx(ge,{size:20}),a>0&&e.jsx(m,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-[10px]",children:a})]})}),e.jsxs(W,{align:"end",className:"w-80",children:[e.jsx(X,{children:"NotificaÃ§Ãµes"}),e.jsx(Y,{}),a>0?e.jsx(e.Fragment,{children:e.jsxs(Z,{className:"cursor-pointer",onClick:()=>h("/support/pending"),children:["VocÃª tem ",a," ",a===1?"mensagem":"mensagens"," pendente",a===1?"":"s"]})}):e.jsx("div",{className:"px-2 py-4 text-center text-muted-foreground",children:"Nenhuma notificaÃ§Ã£o no momento"})]})]}),e.jsxs(J,{children:[e.jsx($,{asChild:!0,children:e.jsx(o,{variant:"ghost",className:"relative h-10 w-10 rounded-full",children:e.jsxs(me,{className:"h-10 w-10",children:[e.jsx(xe,{src:t.profileImage||"",alt:t.name||"Avatar"}),e.jsx(he,{children:N})]})})}),e.jsxs(W,{className:"w-56",align:"end",forceMount:!0,children:[e.jsx(X,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:t.name}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:t.email})]})}),e.jsx(Y,{}),e.jsxs(Z,{onClick:g,className:"cursor-pointer",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Sair"})]})]})]})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"hidden lg:flex lg:w-64 lg:flex-col lg:border-r",children:e.jsx("div",{className:"flex flex-col space-y-2 p-4",children:v.map(r=>e.jsx(z,{href:r.href,children:e.jsxs("a",{className:G("flex items-center space-x-2 rounded-lg px-3 py-2 text-sm font-medium",r.active?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-primary/5"),children:[r.icon,e.jsx("span",{children:r.name}),r.badge?e.jsx(m,{variant:"destructive",className:"ml-auto flex h-5 w-5 items-center justify-center rounded-full p-0",children:r.badge}):null]})},r.href))})}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-secondary/10 p-4",children:f})]})]})}function us(){const{toast:f}=se(),[t,O]=j.useState(""),[d,h]=j.useState(null),[u,p]=j.useState(""),[T,x]=j.useState(!1),{data:a,isLoading:g,refetch:v}=q({queryKey:["/api/admin/support/all"],staleTime:6e4}),{data:N,isLoading:r,refetch:S}=q({queryKey:["/api/admin/support/pending"],staleTime:6e4}),M=ce({mutationFn:async({messageId:s,reply:l})=>await(await de("POST",`/api/admin/support/resolve/${s}`,{response:l})).json(),onSuccess:()=>{Q.invalidateQueries({queryKey:["/api/admin/support/all"]}),Q.invalidateQueries({queryKey:["/api/admin/support/pending"]}),f({title:"Resposta enviada com sucesso",variant:"default"}),x(!1),p(""),h(null)},onError:s=>{f({title:"Erro ao enviar resposta",description:s.message||"Tente novamente mais tarde",variant:"destructive"})}}),D=s=>{h(s),p(""),x(!0)},V=Array.isArray(a)?a.filter(s=>{var l,R,K,F;return((l=s.subject)==null?void 0:l.toLowerCase().includes(t.toLowerCase()))||((R=s.message)==null?void 0:R.toLowerCase().includes(t.toLowerCase()))||((K=s.userName)==null?void 0:K.toLowerCase().includes(t.toLowerCase()))||((F=s.userEmail)==null?void 0:F.toLowerCase().includes(t.toLowerCase()))}):[],H=s=>Array.isArray(a)?a.filter(l=>l.status===s).length:0,ne=()=>{!d||!u.trim()||M.mutate({messageId:d,reply:u.trim()})},te=s=>{switch(s){case"open":return e.jsx(m,{variant:"secondary",children:"Aberto"});case"pending":return e.jsx(m,{variant:"warning",children:"Pendente"});case"closed":return e.jsx(m,{variant:"success",children:"Resolvido"});default:return e.jsx(m,{variant:"outline",children:"Desconhecido"})}},L=s=>{try{const l=new Date(s);return Ie(l,{addSuffix:!0,locale:Be})}catch{return"Data invÃ¡lida"}};return e.jsx(ke,{children:e.jsxs("div",{className:"container py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Central de Suporte"}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(o,{variant:"outline",onClick:()=>{v(),S(),f({title:"Mensagens atualizadas",variant:"default"})},className:"flex items-center gap-2",children:[e.jsx(Re,{size:16}),"Atualizar"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs(b,{children:[e.jsxs(y,{className:"pb-2",children:[e.jsx(w,{className:"text-2xl",children:Array.isArray(a)?a.length:0}),e.jsx(C,{children:"Total de Mensagens"})]}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"mr-2 text-muted-foreground",size:18}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Todas as mensagens"})]})})]}),e.jsxs(b,{children:[e.jsxs(y,{className:"pb-2",children:[e.jsx(w,{className:"text-2xl",children:H("pending")}),e.jsx(C,{children:"Mensagens Pendentes"})]}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"mr-2 text-amber-500",size:18}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Aguardando resposta"})]})})]}),e.jsxs(b,{children:[e.jsxs(y,{className:"pb-2",children:[e.jsx(w,{className:"text-2xl",children:H("closed")}),e.jsx(C,{children:"Mensagens Resolvidas"})]}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"mr-2 text-green-500",size:18}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Casos encerrados"})]})})]})]}),e.jsxs(b,{className:"mb-8",children:[e.jsxs(y,{children:[e.jsx(w,{children:"Gerenciar Mensagens"}),e.jsx(C,{children:"Visualize e responda mensagens de suporte dos usuÃ¡rios"})]}),e.jsxs(A,{children:[e.jsx("div",{className:"flex mb-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ze,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(be,{type:"search",placeholder:"Buscar por assunto, mensagem ou usuÃ¡rio...",className:"pl-8",value:t,onChange:s=>O(s.target.value)})]})}),e.jsxs(ye,{defaultValue:"all",className:"w-full",children:[e.jsxs(we,{className:"mb-4",children:[e.jsx(P,{value:"all",children:"Todas"}),e.jsx(P,{value:"pending",children:"Pendentes"}),e.jsx(P,{value:"closed",children:"Resolvidas"})]}),e.jsx(U,{value:"all",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(I,{children:[e.jsx(B,{children:"Lista de todas as mensagens de suporte"}),e.jsx(k,{children:e.jsxs(c,{children:[e.jsx(i,{className:"w-[50px]",children:"ID"}),e.jsx(i,{children:"UsuÃ¡rio"}),e.jsx(i,{children:"Assunto"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Data"}),e.jsx(i,{className:"text-right",children:"AÃ§Ãµes"})]})}),e.jsx(E,{children:g?e.jsx(c,{children:e.jsx(n,{colSpan:6,className:"text-center py-10",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})})})}):V.length===0?e.jsx(c,{children:e.jsxs(n,{colSpan:6,className:"text-center py-10",children:[e.jsx(le,{className:"mx-auto h-8 w-8 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhuma mensagem encontrada"})]})}):V.map(s=>e.jsxs(c,{children:[e.jsx(n,{children:s.id}),e.jsx(n,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.userName||"UsuÃ¡rio nÃ£o identificado"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.userEmail})]})}),e.jsx(n,{children:s.subject}),e.jsx(n,{children:te(s.status)}),e.jsx(n,{children:L(s.createdAt)}),e.jsx(n,{className:"text-right",children:e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>D(s.id),children:"Detalhes"})})]},s.id))})]})})}),e.jsx(U,{value:"pending",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(I,{children:[e.jsx(B,{children:"Lista de mensagens pendentes"}),e.jsx(k,{children:e.jsxs(c,{children:[e.jsx(i,{className:"w-[50px]",children:"ID"}),e.jsx(i,{children:"UsuÃ¡rio"}),e.jsx(i,{children:"Assunto"}),e.jsx(i,{children:"Data"}),e.jsx(i,{className:"text-right",children:"AÃ§Ãµes"})]})}),e.jsx(E,{children:r?e.jsx(c,{children:e.jsx(n,{colSpan:5,className:"text-center py-10",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})})})}):!Array.isArray(N)||N.length===0?e.jsx(c,{children:e.jsxs(n,{colSpan:5,className:"text-center py-10",children:[e.jsx(ee,{className:"mx-auto h-8 w-8 text-green-500 mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"NÃ£o hÃ¡ mensagens pendentes"})]})}):N.map(s=>e.jsxs(c,{children:[e.jsx(n,{children:s.id}),e.jsx(n,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.userName||"UsuÃ¡rio nÃ£o identificado"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.userEmail})]})}),e.jsx(n,{children:s.subject}),e.jsx(n,{children:L(s.createdAt)}),e.jsx(n,{className:"text-right",children:e.jsx(o,{variant:"outline",size:"sm",onClick:()=>D(s.id),children:"Responder"})})]},s.id))})]})})}),e.jsx(U,{value:"closed",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(I,{children:[e.jsx(B,{children:"Lista de mensagens resolvidas"}),e.jsx(k,{children:e.jsxs(c,{children:[e.jsx(i,{className:"w-[50px]",children:"ID"}),e.jsx(i,{children:"UsuÃ¡rio"}),e.jsx(i,{children:"Assunto"}),e.jsx(i,{children:"Data"}),e.jsx(i,{className:"text-right",children:"AÃ§Ãµes"})]})}),e.jsx(E,{children:g?e.jsx(c,{children:e.jsx(n,{colSpan:5,className:"text-center py-10",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})})})}):(Array.isArray(a)?a.filter(s=>s.status==="closed"):[]).map(s=>e.jsxs(c,{children:[e.jsx(n,{children:s.id}),e.jsx(n,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.userName||"UsuÃ¡rio nÃ£o identificado"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.userEmail})]})}),e.jsx(n,{children:s.subject}),e.jsx(n,{children:L(s.createdAt)}),e.jsx(n,{className:"text-right",children:e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>D(s.id),children:"Visualizar"})})]},s.id))})]})})})]})]})]}),d&&e.jsx(Ae,{open:T,onOpenChange:x,children:e.jsxs(Te,{className:"sm:max-w-[600px]",children:[e.jsxs(Se,{children:[e.jsx(Me,{children:"Detalhes da Mensagem"}),e.jsx(De,{children:"Visualize e responda a mensagem do cliente"})]}),a&&Array.isArray(a)&&(()=>{const s=a.find(l=>l.id===d);return s?e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"De:"}),e.jsx("p",{className:"text-sm",children:s.userName||"NÃ£o informado"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.userEmail})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Data:"}),e.jsx("p",{className:"text-sm",children:new Date(s.createdAt).toLocaleString("pt-BR")})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Assunto:"}),e.jsx("p",{className:"text-sm font-medium",children:s.subject})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Mensagem:"}),e.jsx("div",{className:"border rounded-md p-3 bg-secondary/20 text-sm",children:s.message})]}),s.status!=="closed"&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Sua resposta:"}),e.jsx(Ce,{value:u,onChange:l=>p(l.target.value),placeholder:"Digite sua resposta para o cliente...",className:"min-h-[120px]"})]}),s.reply&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Resposta Anterior:"}),e.jsx("div",{className:"border rounded-md p-3 bg-primary/5 text-sm",children:s.reply}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Respondido em: ",s.repliedAt?new Date(s.repliedAt).toLocaleString("pt-BR"):"N/A"]})]})]}):e.jsx("div",{children:"Mensagem nÃ£o encontrada"})})(),e.jsxs(Le,{children:[e.jsx(o,{variant:"outline",onClick:()=>x(!1),children:"Cancelar"}),a&&Array.isArray(a)&&(()=>{const s=a.find(l=>l.id===d);return!s||s.status==="closed"?null:e.jsx(o,{disabled:!u.trim()||M.isPending,onClick:ne,children:M.isPending?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white"}),"Enviando..."]}):"Enviar Resposta"})})()]})]})})]})})}export{us as default};
