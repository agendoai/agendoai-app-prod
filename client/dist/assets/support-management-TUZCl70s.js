import{j as e}from"./ui-UIpCtT3r.js";import{r as n}from"./vendor-vA4cx1mx.js";import{j as se,b as ae,c,C as h,d as B,e as K,g,B as te,L as U,q as j,i as o,m as re}from"./index-DMVSlINz.js";import{u as ie}from"./useMutation-mYWno7MC.js";import{T as ne,a as de,b as f}from"./tabs-BeATRqWY.js";import{I as oe}from"./input-swbZ2nNg.js";import{T as le}from"./textarea-C4WahNzO.js";import{A as z,a as Q,b as G}from"./avatar-DJ_tL6P_.js";import{B as V}from"./badge-CIXRfmkI.js";import{A as ce}from"./admin-layout-BMhrpvyD.js";import{M as v}from"./message-square-CHbKsffD.js";import{S as me}from"./search-0bFur5DB.js";import{U as N}from"./user-DxXpbN3a.js";import{C as $}from"./clock-DluLCsci.js";import{f as b}from"./formatDistanceToNow-S4dAOUBN.js";import{S as ue}from"./send-B92lcq98.js";import{C as xe}from"./circle-check-big-CXpzSzX6.js";import{p as y}from"./pt-BR-Cxqo7XV3.js";import"./router-CxXythJb.js";import"./navbar-5CcLqczq.js";import"./proxy-CAhTMUof.js";import"./calendar-check-DBfSly3E.js";import"./dropdown-menu-DwBmztZZ.js";import"./chevron-right-D0P32XR-.js";import"./check-pZ3JKVe2.js";import"./circle-CRjqYs4g.js";import"./settings-Blcd0dvr.js";import"./log-out-CiUJLpAa.js";import"./dialog-Ct2TP9w5.js";import"./menu-DQAb75no.js";import"./bell-D5zNslsE.js";import"./arrow-left-3dZ_zEs-.js";import"./users-CGD53Qtc.js";import"./calendar-CYlMr0qt.js";import"./trending-up-BatoiHQK.js";import"./folder-tree-Kq2bE1K6.js";import"./credit-card-DTBtIUOk.js";import"./share-2-CQaeBUod.js";import"./circle-help-C8c3Z800.js";import"./book-open-B5Rj8pVZ.js";import"./constructNow-BcZzM1ki.js";import"./en-US-xSPtgCq_.js";import"./endOfMonth-CH6FLORf.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=se("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);function rs(){var I,k,E,R,D,F,P;const{toast:w}=ae(),[l,S]=n.useState("pending"),[a,C]=n.useState(null),[m,T]=n.useState(""),[d,M]=n.useState(""),[A,u]=n.useState([]),[i,H]=n.useState(null),{data:O,isLoading:J}=c({queryKey:["/api/admin/support/all"],queryFn:async()=>await(await o("GET","/api/admin/support/all")).json()}),{data:W,isLoading:X}=c({queryKey:["/api/admin/support/pending"],queryFn:async()=>await(await o("GET","/api/admin/support/pending")).json()}),{data:Y,isLoading:Z}=c({queryKey:["/api/admin/support/user",i],queryFn:async()=>i?await(await o("GET",`/api/admin/support/user/${i}`)).json():[],enabled:!!i}),{data:x}=c({queryKey:["/api/admin/users"],queryFn:async()=>await(await o("GET","/api/admin/users")).json()}),p=ie({mutationFn:async({messageId:s,response:r})=>await(await o("POST",`/api/admin/support/resolve/${s}`,{response:r})).json(),onSuccess:()=>{w({title:"Mensagem resolvida com sucesso",description:"A resposta foi enviada ao usuário",variant:"default"}),T(""),C(null),j.invalidateQueries({queryKey:["/api/admin/support/all"]}),j.invalidateQueries({queryKey:["/api/admin/support/pending"]}),i&&j.invalidateQueries({queryKey:["/api/admin/support/user",i]})},onError:s=>{w({title:"Erro ao resolver mensagem",description:s.message,variant:"destructive"})}});n.useEffect(()=>{if(d.length>2&&x){const s=x.filter(r=>{var t;return((t=r.name)==null?void 0:t.toLowerCase().includes(d.toLowerCase()))||r.email.toLowerCase().includes(d.toLowerCase())});u(s)}else u([])},[d,x]);const _=s=>{H(s),S("user"),M(""),u([])},L=s=>{switch(s){case"pending":return"outline";case"in-progress":return"default";case"resolved":return"success";default:return"secondary"}},q=s=>{switch(s){case"pending":return e.jsx($,{className:"h-4 w-4 mr-1"});case"in-progress":return e.jsx(v,{className:"h-4 w-4 mr-1"});case"resolved":return e.jsx(xe,{className:"h-4 w-4 mr-1"});default:return e.jsx(re,{className:"h-4 w-4 mr-1"})}},ee=()=>{let s=[],r=!1;return l==="pending"?(s=W||[],r=X):l==="all"?(s=O||[],r=J):l==="user"&&i&&(s=Y||[],r=Z),r?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(U,{className:"h-8 w-8 animate-spin text-primary"})}):s.length===0?e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"Nenhuma mensagem encontrada"}):e.jsx("div",{className:"space-y-4",children:s.map(t=>e.jsx(h,{className:`cursor-pointer hover:bg-accent/50 transition-colors ${(a==null?void 0:a.id)===t.id?"border-primary":""}`,onClick:()=>C(t),children:e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium",children:["#",t.id," - ",t.subject]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.message}),e.jsxs("div",{className:"mt-2 flex items-center space-x-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["ID do usuário: ",t.userId]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:t.createdAt?b(new Date(t.createdAt),{addSuffix:!0,locale:y}):"Data desconhecida"})]})]}),e.jsxs(V,{variant:L(t.status),className:"flex items-center",children:[q(t.status),t.status==="pending"?"Pendente":t.status==="in-progress"?"Em andamento":t.status==="resolved"?"Resolvido":t.status]})]})})},t.id))})};return e.jsx(ce,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 py-8",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx(v,{className:"h-8 w-8 text-indigo-600"}),e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-700 to-indigo-700 bg-clip-text text-transparent",children:"Central de Suporte"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsx("div",{className:"md:col-span-1",children:e.jsxs(h,{className:"bg-white shadow-lg rounded-2xl",children:[e.jsxs(B,{className:"pb-3",children:[e.jsx(K,{className:"flex items-center gap-2 text-indigo-700 text-xl",children:"Mensagens"}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx(oe,{placeholder:"Pesquisar usuário...",value:d,onChange:s=>M(s.target.value),className:"pr-10 rounded-full border-blue-100 focus:border-indigo-400 focus:ring-2 focus:ring-indigo-200 shadow-sm"}),e.jsx(me,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-indigo-400"}),A.length>0&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white border rounded-md shadow-lg",children:A.map(s=>e.jsxs("div",{className:"p-2 hover:bg-indigo-50 cursor-pointer flex items-center rounded-md",onClick:()=>_(s.id),children:[e.jsxs(z,{className:"h-7 w-7 mr-2",children:[e.jsx(Q,{src:s.profileImage||""}),e.jsx(G,{children:e.jsx(N,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-semibold text-indigo-700",children:s.name||"Sem nome"}),e.jsx("div",{className:"text-xs text-gray-400",children:s.email})]})]},s.id))})]}),e.jsx(ne,{defaultValue:"pending",value:l,onValueChange:S,children:e.jsxs(de,{className:"grid w-full grid-cols-3 bg-white rounded-full shadow-sm border border-blue-100",children:[e.jsxs(f,{value:"pending",className:"text-xs sm:text-sm rounded-full data-[state=active]:bg-indigo-100 data-[state=active]:text-indigo-700",children:[" ",e.jsx($,{className:"h-4 w-4 mr-1"})," Pendentes "]}),e.jsxs(f,{value:"all",className:"text-xs sm:text-sm rounded-full data-[state=active]:bg-indigo-100 data-[state=active]:text-indigo-700",children:[" ",e.jsx(pe,{className:"h-4 w-4 mr-1"})," Todos "]}),e.jsxs(f,{value:"user",disabled:!i,className:"text-xs sm:text-sm rounded-full data-[state=active]:bg-indigo-100 data-[state=active]:text-indigo-700",children:[" ",e.jsx(N,{className:"h-4 w-4 mr-1"})," Usuário "]})]})})]}),e.jsx(g,{className:"h-[calc(100vh-300px)] overflow-y-auto",children:e.jsx("div",{className:"space-y-4",children:ee()})})]})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(h,{className:"h-[calc(100vh-150px)] flex flex-col bg-white shadow-lg rounded-2xl",children:a?e.jsxs(e.Fragment,{children:[e.jsxs(B,{className:"pb-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(K,{className:"text-indigo-700 text-xl",children:["Detalhes da Mensagem #",a.id]}),e.jsxs(V,{variant:L(a.status),className:"text-base px-3 py-1 rounded-full",children:[q(a.status),a.status==="pending"?"Pendente":a.status==="in-progress"?"Em andamento":a.status==="resolved"?"Resolvido":a.status]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Enviado ",a.createdAt?b(new Date(a.createdAt),{addSuffix:!0,locale:y}):"em data desconhecida",a.resolvedAt&&e.jsxs("span",{children:[" • Resolvido ",b(new Date(a.resolvedAt),{addSuffix:!0,locale:y})]})]})]}),e.jsx(g,{className:"flex-grow overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-indigo-700",children:"Informações do usuário"}),e.jsxs("div",{className:"mt-2 flex items-center gap-4 p-4 bg-indigo-50 rounded-xl",children:[e.jsxs(z,{className:"h-16 w-16",children:[e.jsx(Q,{src:((I=a.user)==null?void 0:I.profileImage)||""}),e.jsx(G,{children:e.jsx(N,{className:"h-8 w-8 text-indigo-400"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg text-indigo-800",children:((k=a.user)==null?void 0:k.name)||"Não informado"}),e.jsx("p",{className:"text-gray-500",children:(E=a.user)==null?void 0:E.email}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["ID: ",a.userId," • Tipo: ",((R=a.user)==null?void 0:R.userType)==="client"?"Cliente":((D=a.user)==null?void 0:D.userType)==="provider"?"Prestador de Serviços":((F=a.user)==null?void 0:F.userType)==="admin"?"Administrador":(P=a.user)==null?void 0:P.userType]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-indigo-700",children:"Assunto da mensagem"}),e.jsx("p",{className:"mt-1 text-base text-gray-800",children:a.subject})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-indigo-700",children:"Mensagem"}),e.jsx("div",{className:"mt-1 p-4 bg-indigo-50 rounded-xl text-base text-gray-800 whitespace-pre-wrap",children:a.message})]}),a.response&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-green-700",children:"Resposta do Administrador"}),e.jsx("div",{className:"mt-1 p-4 bg-green-50 rounded-xl text-base text-gray-800 whitespace-pre-wrap",children:a.response}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Respondido por: Admin ID ",a.adminId]})]})]})}),a.status==="pending"&&e.jsxs("div",{className:"p-6 border-t bg-gray-50 rounded-b-2xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-indigo-700 mb-2",children:"Responder Mensagem"}),e.jsx(le,{placeholder:"Digite sua resposta para o usuário...",value:m,onChange:s=>T(s.target.value),className:"mb-2 rounded-xl border-blue-100 focus:border-indigo-400 focus:ring-2 focus:ring-indigo-200",rows:4}),e.jsx("div",{className:"flex justify-end",children:e.jsx(te,{onClick:()=>p.mutate({messageId:a.id,response:m}),disabled:!m.trim()||p.isPending,className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold px-6 py-2 rounded-xl shadow",children:p.isPending?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Enviar Resposta"]})})})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx(v,{className:"h-16 w-16 mb-4 text-indigo-200"}),e.jsx("p",{children:"Selecione uma mensagem para visualizar os detalhes"})]})})})]})]})})})}export{rs as default};
