import{m as X,c as Qe,r as n,d as H,j as e,e as C,C as A,f as ke,g as Ae,i as Ie,q as I,l as p,o as He}from"./index-BdrEJuYD.js";import{u as _}from"./useMutation-C9nL7V5b.js";import{B as c}from"./button-CynjWJoH.js";import{T as _e,a as Je,b as P}from"./tabs-Dh7LOHW3.js";import{I as Pe}from"./input-BRNzA_b4.js";import{T as J}from"./textarea-CTBqUipt.js";import{A as T,a as D,b as j}from"./avatar-YOIRMJBI.js";import{B as g}from"./badge-muy4ZFs4.js";import{S as M,a as F,b as E,c as q,d as i}from"./select-CN2dG1AP.js";import{S as De}from"./separator-QYEpahfh.js";import{A as We}from"./admin-layout-1ziWQ5Sp.js";import{D as Xe,a as Ye,b as Ze,c as Me,d as W,e as m}from"./dropdown-menu-DWmQMH9U.js";import{D as es,f as ss,a as as,b as rs,c as ts,d as is}from"./dialog-Cv4VtnLP.js";import{T as ns,a as ls,b as cs,c as os}from"./tooltip-C-Noit57.js";import{P as ds}from"./plus-BsEGDOAo.js";import{U as B}from"./user-DCpoqoA-.js";import{F as ms}from"./filter-ILFh_joG.js";import{E as us}from"./ellipsis-vertical-BhTX8B4K.js";import{S as xs}from"./send-CbpwGWOo.js";import{M as Fe}from"./message-square-kvDXS4V3.js";import{C as hs}from"./circle-check-big-CiI_Z36v.js";import{C as ps}from"./clock-BTnG-tJG.js";import{f}from"./formatDistanceToNow-S4dAOUBN.js";import{p as v}from"./pt-BR-Cxqo7XV3.js";import"./index-BoRtQnRr.js";import"./index-BYdWi_2u.js";import"./index-YY5r1pln.js";import"./index-BdQq_4o_.js";import"./index-DTy3TPQv.js";import"./index-Bg9Ro7l2.js";import"./index-CeeqZ7YQ.js";import"./index-C91vKSn-.js";import"./chevron-down-BZqgkKgk.js";import"./check-WTIUe9ha.js";import"./navbar-BcVSfpub.js";import"./proxy-C6NuY9h3.js";import"./house-CU2aGGLt.js";import"./search-DiCZmcCn.js";import"./calendar-check-BsktWAdS.js";import"./settings-Derag0Pt.js";import"./log-out-9hU1A0cG.js";import"./menu-BVXWFAVP.js";import"./bell-DPzU_a_S.js";import"./arrow-left-nRi6-7bo.js";import"./users--EJM8Ox4.js";import"./calendar-CiGw-_KP.js";import"./trending-up-1wc0HeSK.js";import"./folder-tree-BGKo5vyT.js";import"./credit-card-dV_1iaRW.js";import"./share-2-BAuPUoCw.js";import"./circle-help-cap19nX6.js";import"./book-open-BuqwZspb.js";import"./chevron-right-DQzs9QCW.js";import"./circle-CB07NW__.js";import"./index-CrNpXqsn.js";import"./constructNow-BcZzM1ki.js";import"./en-US-xSPtgCq_.js";import"./endOfMonth-CH6FLORf.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=X("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=X("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=X("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);function wa(){var ge,fe,ve,Ne,ye,we,be,Ce,Te;const{toast:u}=Qe(),[N,Y]=n.useState("pending"),[y,qe]=n.useState(""),[w,Be]=n.useState(""),[b,Z]=n.useState(""),[ee,U]=n.useState([]),[s,L]=n.useState(null),[S,se]=n.useState(""),[Ue,R]=n.useState(!1),[k,V]=n.useState(""),[ae,Le]=n.useState(10),[z,Re]=n.useState(!0),[Ve,re]=n.useState(!1),[te,ie]=n.useState(null),[$,ne]=n.useState(""),[le,ce]=n.useState("general"),[oe,de]=n.useState("normal"),[G,me]=n.useState(""),{data:K,isLoading:ze}=H({queryKey:["/api/admin/support/tickets",N,y,w],queryFn:async()=>{const a=new URLSearchParams;return N==="pending"&&a.append("status","pending"),N==="in-progress"&&a.append("status","in-progress"),N==="resolved"&&a.append("status","resolved"),y&&y!==""&&a.append("priority",y),w&&w!==""&&a.append("category",w),await(await p("GET",`/api/admin/support/tickets?${a.toString()}`)).json()}}),{data:ue,isLoading:$e}=H({queryKey:["/api/admin/support/ticket/messages",s==null?void 0:s.id],queryFn:async()=>s!=null&&s.id?await(await p("GET",`/api/admin/support/ticket/${s.id}/messages`)).json():[],enabled:!!(s!=null&&s.id)}),{data:x}=H({queryKey:["/api/admin/users"],queryFn:async()=>await(await p("GET","/api/admin/users")).json()}),h=_({mutationFn:async({ticketId:a,message:r,isInternal:l=!1})=>await(await p("POST",`/api/admin/support/ticket/${a}/reply`,{message:r,isInternal:l})).json(),onSuccess:()=>{u({title:"Mensagem enviada com sucesso",variant:"default"}),se(""),V(""),R(!1),I.invalidateQueries({queryKey:["/api/admin/support/tickets"]}),s!=null&&s.id&&I.invalidateQueries({queryKey:["/api/admin/support/ticket/messages",s.id]})},onError:a=>{u({title:"Erro ao enviar mensagem",description:a.message,variant:"destructive"})}}),o=_({mutationFn:async({ticketId:a,status:r,priority:l,adminId:t})=>await(await p("PUT",`/api/admin/support/ticket/${a}`,{status:r,priority:l,adminId:t})).json(),onSuccess:a=>{u({title:"Ticket atualizado com sucesso",variant:"default"}),s&&s.id===a.id&&L(r=>r?{...r,...a}:null),I.invalidateQueries({queryKey:["/api/admin/support/tickets"]})},onError:a=>{u({title:"Erro ao atualizar ticket",description:a.message,variant:"destructive"})}}),O=_({mutationFn:async({userId:a,subject:r,message:l,category:t,priority:d})=>await(await p("POST","/api/admin/support/ticket",{userId:a,subject:r,message:l,category:t,priority:d})).json(),onSuccess:a=>{u({title:"Ticket criado com sucesso",variant:"default"}),ie(null),ne(""),ce("general"),de("normal"),me(""),re(!1),L(a),Y("pending"),I.invalidateQueries({queryKey:["/api/admin/support/tickets"]})},onError:a=>{u({title:"Erro ao criar ticket",description:a.message,variant:"destructive"})}});n.useEffect(()=>{if(b.length>2&&x){const a=x.filter(r=>{var l;return((l=r.name)==null?void 0:l.toLowerCase().includes(b.toLowerCase()))||r.email.toLowerCase().includes(b.toLowerCase())});U(a)}else U([])},[b,x]);const Ge=a=>{ie(a);const r=x==null?void 0:x.find(l=>l.id===a);Z((r==null?void 0:r.name)||(r==null?void 0:r.email)||""),U([])},xe=a=>{switch(a){case"pending":return"outline";case"in-progress":return"default";case"resolved":return"success";case"closed":return"secondary";default:return"secondary"}},he=a=>{switch(a){case"low":return"secondary";case"normal":return"default";case"high":return"warning";case"urgent":return"destructive";default:return"default"}},pe=a=>{switch(a){case"pending":return e.jsx(ps,{className:"h-4 w-4 mr-1"});case"in-progress":return e.jsx(Fe,{className:"h-4 w-4 mr-1"});case"resolved":return e.jsx(hs,{className:"h-4 w-4 mr-1"});default:return e.jsx(He,{className:"h-4 w-4 mr-1"})}},je=a=>{switch(a){case"low":return null;case"normal":return null;case"high":return e.jsx(Ee,{className:"h-4 w-4 mr-1"});case"urgent":return e.jsx(Ee,{className:"h-4 w-4 mr-1 text-red-500"});default:return null}},Ke=()=>{if(ze)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(C,{className:"h-8 w-8 animate-spin text-primary"})});if(!K||K.length===0)return e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"Nenhum ticket encontrado"});let a=K;return e.jsx("div",{className:"space-y-4",children:a.map(r=>{var l,t,d;return e.jsx(A,{className:`cursor-pointer hover:bg-accent/50 transition-colors ${(s==null?void 0:s.id)===r.id?"border-primary":""}`,onClick:()=>L(r),children:e.jsxs(Ie,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("h3",{className:"font-medium truncate",children:["#",r.id," - ",r.subject]}),e.jsxs(g,{variant:he(r.priority),className:"flex items-center",children:[je(r.priority),r.priority==="low"?"Baixa":r.priority==="normal"?"Normal":r.priority==="high"?"Alta":r.priority==="urgent"?"Urgente":r.priority]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(g,{variant:"outline",className:"text-xs",children:r.category==="general"?"Geral":r.category==="technical"?"Técnico":r.category==="billing"?"Faturamento":r.category}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Último contato: ",r.lastResponseAt?f(new Date(r.lastResponseAt),{addSuffix:!0,locale:v}):r.createdAt?f(new Date(r.createdAt),{addSuffix:!0,locale:v}):"Data desconhecida"]})]})]}),e.jsxs(g,{variant:xe(r.status),className:"flex items-center ml-2",children:[pe(r.status),r.status==="pending"?"Pendente":r.status==="in-progress"?"Em andamento":r.status==="resolved"?"Resolvido":r.status==="closed"?"Fechado":r.status]})]}),e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground flex items-center",children:[e.jsxs(T,{className:"h-5 w-5 mr-1",children:[e.jsx(D,{src:((l=r.user)==null?void 0:l.profileImage)||""}),e.jsx(j,{children:e.jsx(B,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"flex-1 truncate",children:[((t=r.user)==null?void 0:t.name)||`Usuário #${r.userId}`,((d=r.user)==null?void 0:d.email)&&e.jsxs("span",{className:"ml-1",children:["(",r.user.email,")"]})]}),!r.readByAdmin&&e.jsx("span",{className:"ml-2 bg-primary w-2 h-2 rounded-full",title:"Não lido"})]})]})},r.id)})})},Oe=()=>{if(!s||!ue)return null;const a=[...ue||[]].sort((t,d)=>new Date(t.createdAt).getTime()-new Date(d.createdAt).getTime()),r=a.slice(-ae),l=a.length>ae;return e.jsxs("div",{className:"space-y-4",children:[l&&e.jsx("div",{className:"text-center",children:e.jsx(c,{variant:"outline",size:"sm",onClick:()=>Le(t=>t+10),children:"Carregar mais mensagens"})}),r.map((t,d)=>{var Q,Se;return e.jsxs("div",{className:`p-3 rounded-lg ${t.adminId?"bg-muted ml-6":"bg-accent mr-6"} ${t.isInternal?"border-l-4 border-amber-500":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{className:"h-6 w-6 mr-2",children:t.adminId?e.jsx(j,{className:"bg-primary text-primary-foreground",children:"A"}):e.jsxs(e.Fragment,{children:[e.jsx(D,{src:((Q=s.user)==null?void 0:Q.profileImage)||""}),e.jsx(j,{children:e.jsx(B,{className:"h-4 w-4"})})]})}),e.jsxs("span",{className:"font-medium text-sm",children:[t.adminId?"Administrador":((Se=s.user)==null?void 0:Se.name)||`Usuário #${s.userId}`,t.isInternal&&e.jsx("span",{className:"text-amber-600 ml-2 text-xs",children:"(Nota interna)"})]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t.createdAt?f(new Date(t.createdAt),{addSuffix:!0,locale:v}):"Data desconhecida"})]}),e.jsx("div",{className:"whitespace-pre-wrap text-sm pl-8",children:t.message}),t.attachmentUrl&&e.jsx("div",{className:"mt-2 pl-8",children:e.jsxs("a",{href:t.attachmentUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-xs text-primary hover:underline",children:[e.jsx(gs,{className:"h-3 w-3 mr-1"}),"Anexo"]})})]},t.id)})]})};return e.jsx(We,{children:e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Central de Suporte"}),e.jsxs(es,{open:Ve,onOpenChange:re,children:[e.jsx(ss,{asChild:!0,children:e.jsxs(c,{children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),"Novo Ticket"]})}),e.jsxs(as,{className:"max-w-md",children:[e.jsxs(rs,{children:[e.jsx(ts,{children:"Criar Novo Ticket"}),e.jsx(is,{children:"Crie um novo ticket de suporte em nome de um usuário."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Usuário"}),e.jsx(Pe,{placeholder:"Procurar usuário por nome ou email...",value:b,onChange:a=>Z(a.target.value)}),ee.length>0&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-background border rounded-md shadow-md",children:ee.map(a=>e.jsxs("div",{className:"p-2 hover:bg-accent cursor-pointer flex items-center",onClick:()=>Ge(a.id),children:[e.jsxs(T,{className:"h-6 w-6 mr-2",children:[e.jsx(D,{src:a.profileImage||""}),e.jsx(j,{children:e.jsx(B,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:a.name||"Sem nome"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.email})]})]},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Assunto"}),e.jsx(Pe,{placeholder:"Assunto do ticket",value:$,onChange:a=>ne(a.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Categoria"}),e.jsxs(M,{value:le,onValueChange:ce,children:[e.jsx(F,{children:e.jsx(E,{placeholder:"Categoria"})}),e.jsxs(q,{children:[e.jsx(i,{value:"general",children:"Geral"}),e.jsx(i,{value:"technical",children:"Técnico"}),e.jsx(i,{value:"billing",children:"Faturamento"}),e.jsx(i,{value:"feature",children:"Sugestão"}),e.jsx(i,{value:"bug",children:"Bug"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Prioridade"}),e.jsxs(M,{value:oe,onValueChange:de,children:[e.jsx(F,{children:e.jsx(E,{placeholder:"Prioridade"})}),e.jsxs(q,{children:[e.jsx(i,{value:"low",children:"Baixa"}),e.jsx(i,{value:"normal",children:"Normal"}),e.jsx(i,{value:"high",children:"Alta"}),e.jsx(i,{value:"urgent",children:"Urgente"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Mensagem"}),e.jsx(J,{placeholder:"Descreva o problema ou solicitação do usuário...",value:G,onChange:a=>me(a.target.value),rows:5})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(c,{onClick:()=>O.mutate({userId:te,subject:$,message:G,category:le,priority:oe}),disabled:!te||!$||!G||O.isPending,children:O.isPending?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}),"Criando..."]}):"Criar Ticket"})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(A,{className:"h-[calc(100vh-150px)] overflow-hidden flex flex-col",children:[e.jsxs(ke,{className:"pb-3 space-y-4",children:[e.jsx(Ae,{children:"Tickets de Suporte"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ms,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(M,{value:y||"",onValueChange:a=>qe(a||null),children:[e.jsx(F,{children:e.jsx(E,{placeholder:"Prioridade"})}),e.jsxs(q,{children:[e.jsx(i,{value:"",children:"Todas prioridades"}),e.jsx(i,{value:"low",children:"Baixa"}),e.jsx(i,{value:"normal",children:"Normal"}),e.jsx(i,{value:"high",children:"Alta"}),e.jsx(i,{value:"urgent",children:"Urgente"})]})]}),e.jsxs(M,{value:w||"",onValueChange:a=>Be(a||null),children:[e.jsx(F,{children:e.jsx(E,{placeholder:"Categoria"})}),e.jsxs(q,{children:[e.jsx(i,{value:"",children:"Todas categorias"}),e.jsx(i,{value:"general",children:"Geral"}),e.jsx(i,{value:"technical",children:"Técnico"}),e.jsx(i,{value:"billing",children:"Faturamento"}),e.jsx(i,{value:"feature",children:"Sugestão"}),e.jsx(i,{value:"bug",children:"Bug"})]})]})]})]}),e.jsx(_e,{defaultValue:"pending",value:N,onValueChange:Y,children:e.jsxs(Je,{className:"grid w-full grid-cols-4",children:[e.jsx(P,{value:"pending",children:"Pendentes"}),e.jsx(P,{value:"in-progress",children:"Em Andamento"}),e.jsx(P,{value:"resolved",children:"Resolvidos"}),e.jsx(P,{value:"all",children:"Todos"})]})})]}),e.jsx(Ie,{className:"flex-grow overflow-y-auto",children:Ke()})]})}),e.jsx("div",{className:"lg:col-span-2",children:s?e.jsxs(A,{className:"h-[calc(100vh-150px)] flex flex-col",children:[e.jsxs(ke,{className:"pb-3 border-b",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(Ae,{children:["Ticket #",s.id]}),e.jsxs(g,{variant:he(s.priority),children:[je(s.priority),s.priority==="low"?"Baixa":s.priority==="normal"?"Normal":s.priority==="high"?"Alta":s.priority==="urgent"?"Urgente":s.priority]}),e.jsxs(g,{variant:xe(s.status),children:[pe(s.status),s.status==="pending"?"Pendente":s.status==="in-progress"?"Em andamento":s.status==="resolved"?"Resolvido":s.status==="closed"?"Fechado":s.status]})]}),e.jsx("div",{className:"text-sm font-medium mt-1",children:s.subject})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ns,{children:e.jsxs(ls,{children:[e.jsx(cs,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>Re(!z),children:e.jsx(js,{className:"h-4 w-4"})})}),e.jsxs(os,{children:[z?"Esconder":"Mostrar"," informações do ticket"]})]})}),e.jsxs(Xe,{children:[e.jsx(Ye,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"icon",children:e.jsx(us,{className:"h-4 w-4"})})}),e.jsxs(Ze,{align:"end",children:[e.jsx(Me,{children:"Ações do Ticket"}),e.jsx(W,{}),e.jsx(m,{disabled:s.status==="in-progress",onClick:()=>o.mutate({ticketId:s.id,status:"in-progress",adminId:1}),children:"Assumir Ticket"}),e.jsx(m,{disabled:s.status==="pending",onClick:()=>o.mutate({ticketId:s.id,status:"pending",adminId:null}),children:"Marcar como Pendente"}),e.jsx(m,{disabled:s.status==="resolved",onClick:()=>o.mutate({ticketId:s.id,status:"resolved"}),children:"Marcar como Resolvido"}),e.jsx(m,{disabled:s.status==="closed",onClick:()=>o.mutate({ticketId:s.id,status:"closed"}),children:"Fechar Ticket"}),e.jsx(W,{}),e.jsx(Me,{children:"Alterar Prioridade"}),e.jsx(W,{}),e.jsx(m,{disabled:s.priority==="low",onClick:()=>o.mutate({ticketId:s.id,priority:"low"}),children:"Baixa"}),e.jsx(m,{disabled:s.priority==="normal",onClick:()=>o.mutate({ticketId:s.id,priority:"normal"}),children:"Normal"}),e.jsx(m,{disabled:s.priority==="high",onClick:()=>o.mutate({ticketId:s.id,priority:"high"}),children:"Alta"}),e.jsx(m,{disabled:s.priority==="urgent",onClick:()=>o.mutate({ticketId:s.id,priority:"urgent"}),children:"Urgente"})]})]})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center justify-between mt-2",children:[e.jsxs("div",{children:["Criado ",s.createdAt?f(new Date(s.createdAt),{addSuffix:!0,locale:v}):"em data desconhecida",s.lastResponseAt&&e.jsxs("span",{children:[" • Última resposta ",f(new Date(s.lastResponseAt),{addSuffix:!0,locale:v})]})]}),e.jsx(g,{variant:"outline",className:"text-xs",children:s.category==="general"?"Geral":s.category==="technical"?"Técnico":s.category==="billing"?"Faturamento":s.category==="feature"?"Sugestão":s.category==="bug"?"Bug":s.category})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[z&&e.jsx("div",{className:"w-64 border-r p-4 overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Informações do Usuário"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(T,{children:[e.jsx(D,{src:((ge=s.user)==null?void 0:ge.profileImage)||""}),e.jsx(j,{children:e.jsx(B,{className:"h-4 w-4"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:((fe=s.user)==null?void 0:fe.name)||"Sem nome"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:(ve=s.user)==null?void 0:ve.email})]})]}),e.jsx("div",{className:"text-xs",children:e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsx("span",{className:"font-medium",children:"ID:"}),e.jsx("span",{children:s.userId}),e.jsx("span",{className:"font-medium",children:"Tipo:"}),e.jsx("span",{children:((Ne=s.user)==null?void 0:Ne.userType)==="client"?"Cliente":((ye=s.user)==null?void 0:ye.userType)==="provider"?"Prestador":((we=s.user)==null?void 0:we.userType)==="admin"?"Administrador":((be=s.user)==null?void 0:be.userType)||"Desconhecido"}),e.jsx("span",{className:"font-medium",children:"Telefone:"}),e.jsx("span",{children:((Ce=s.user)==null?void 0:Ce.phone)||"Não informado"}),e.jsx("span",{className:"font-medium",children:"Cadastro:"}),e.jsx("span",{children:(Te=s.user)!=null&&Te.createdAt?f(new Date(s.user.createdAt),{addSuffix:!0,locale:v}):"Desconhecido"})]})})]})]}),e.jsx(De,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Histórico de Tickets"}),e.jsx("div",{className:"space-y-2",children:e.jsx(c,{variant:"outline",size:"sm",className:"w-full",children:"Ver todos os tickets"})})]}),e.jsx(De,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Notas Internas"}),e.jsx(c,{variant:"outline",size:"sm",className:"w-full",onClick:()=>R(!0),children:"Adicionar nota interna"}),Ue&&e.jsxs("div",{className:"mt-2",children:[e.jsx(J,{placeholder:"Adicione uma nota interna (visível apenas para admins)...",value:k,onChange:a=>V(a.target.value),className:"mb-2 text-xs",rows:3}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(c,{size:"sm",variant:"default",className:"text-xs",onClick:()=>{k.trim()&&h.mutate({ticketId:s.id,message:k,isInternal:!0})},disabled:!k.trim()||h.isPending,children:h.isPending?e.jsx(C,{className:"h-3 w-3 animate-spin"}):"Salvar"}),e.jsx(c,{size:"sm",variant:"outline",className:"text-xs",onClick:()=>{R(!1),V("")},children:"Cancelar"})]})]})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:$e?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx(C,{className:"h-6 w-6 animate-spin text-primary"})}):Oe()}),s.status!=="closed"&&e.jsxs("div",{className:"p-4 border-t",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(T,{className:"h-6 w-6",children:e.jsx(j,{className:"bg-primary text-primary-foreground text-xs",children:"A"})}),e.jsx("span",{className:"text-sm font-medium",children:"Responder como Admin"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(J,{placeholder:"Digite sua resposta...",value:S,onChange:a=>se(a.target.value),className:"flex-1",rows:3}),e.jsx(c,{className:"self-end",onClick:()=>{S.trim()&&h.mutate({ticketId:s.id,message:S})},disabled:!S.trim()||h.isPending,children:h.isPending?e.jsx(C,{className:"h-4 w-4 animate-spin"}):e.jsx(xs,{className:"h-4 w-4"})})]})]})]})]})]}):e.jsx(A,{className:"h-[calc(100vh-150px)] flex items-center justify-center",children:e.jsxs("div",{className:"text-center p-6",children:[e.jsx(Fe,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium mb-2",children:"Nenhum ticket selecionado"}),e.jsx("p",{className:"text-muted-foreground",children:"Selecione um ticket na lista à esquerda para visualizar os detalhes."})]})})})]})]})})}export{wa as default};
