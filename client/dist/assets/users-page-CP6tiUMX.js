import{j as e}from"./ui-UIpCtT3r.js";import{r as j,a as H}from"./vendor-vA4cx1mx.js";import{j as X,b as Y,c as z,C as c,g as d,L as S,d as J,e as W,f as Z,B as y,q as M,i as w}from"./index-DMVSlINz.js";import{A as k}from"./admin-layout-BMhrpvyD.js";import{u as q}from"./useMutation-mYWno7MC.js";import{D as F,a as P,b as B,e as n}from"./dropdown-menu-DwBmztZZ.js";import{B as U}from"./badge-CIXRfmkI.js";import{D as _,a as ee,b as se,c as re,d as ae,e as te}from"./dialog-Ct2TP9w5.js";import{I as ie}from"./input-swbZ2nNg.js";import{U as f}from"./users-CGD53Qtc.js";import{S as ne}from"./search-0bFur5DB.js";import{F as oe}from"./filter-DJG0WVh4.js";import{U as E}from"./user-DxXpbN3a.js";import{B as I}from"./building-JS0BSPiZ.js";import{E as le}from"./ellipsis-BX3rdPVm.js";import{S as ce}from"./square-pen-D-ChMROE.js";import{U as de}from"./user-x-hPaZeYoW.js";import{U as me}from"./user-check-CCkLKyz9.js";import{T as xe}from"./trash-2-CmNHyACN.js";import{M as he}from"./mail-COCtj6fG.js";import{P as ue}from"./phone-CDpJ8Rux.js";import{C as pe}from"./calendar-CYlMr0qt.js";import{S as V}from"./shield-BR0fjka_.js";import{U as ge}from"./user-plus-4ldeG-Sj.js";import{T as je}from"./trending-up-BatoiHQK.js";import"./router-CxXythJb.js";import"./navbar-5CcLqczq.js";import"./proxy-CAhTMUof.js";import"./calendar-check-DBfSly3E.js";import"./avatar-DJ_tL6P_.js";import"./settings-Blcd0dvr.js";import"./log-out-CiUJLpAa.js";import"./menu-DQAb75no.js";import"./bell-D5zNslsE.js";import"./arrow-left-3dZ_zEs-.js";import"./folder-tree-Kq2bE1K6.js";import"./credit-card-DTBtIUOk.js";import"./share-2-CQaeBUod.js";import"./circle-help-C8c3Z800.js";import"./book-open-B5Rj8pVZ.js";import"./chevron-right-D0P32XR-.js";import"./check-pZ3JKVe2.js";import"./circle-CRjqYs4g.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=X("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);function fe(){const{toast:t}=Y(),[m,r]=j.useState(""),[x,o]=j.useState(null),[N,i]=j.useState(!1),[a,p]=j.useState(null),[C,D]=j.useState(!1),{data:h=[],isLoading:l}=z({queryKey:["/api/admin/users"],queryFn:async()=>{try{return await(await w("GET","/api/admin/users")).json()}catch(s){return console.error("Erro ao carregar usuários:",s),[]}}}),b=q({mutationFn:async({id:s,data:u})=>(await w("PUT",`/api/admin/users/${s}`,u)).json(),onSuccess:()=>{M.invalidateQueries({queryKey:["/api/admin/users"]}),t({title:"Usuário atualizado",description:"As informações do usuário foram atualizadas com sucesso."})},onError:s=>{t({title:"Erro ao atualizar usuário",description:s.message,variant:"destructive"})}}),T=q({mutationFn:async s=>{if((a==null?void 0:a.userType)==="admin"&&h.filter(v=>v.userType==="admin"&&v.isActive).length<=1)throw new Error("Não é possível excluir o último administrador ativo");return(await w("DELETE",`/api/admin/users/${s}`)).json()},onSuccess:()=>{M.invalidateQueries({queryKey:["/api/admin/users"]}),i(!1),p(null),t({title:"Usuário excluído",description:"O usuário foi excluído com sucesso."})},onError:s=>{t({title:"Erro ao excluir usuário",description:s.message,variant:"destructive"})}}),L=s=>{b.mutate({id:s.id,data:{isActive:!s.isActive}})},g=h==null?void 0:h.filter(s=>{if(x&&s.userType!==x)return!1;if(m){const u=m.toLowerCase(),A=(s.name||"").toLowerCase(),v=s.email.toLowerCase(),R=(s.phone||"").toLowerCase();return A.includes(u)||v.includes(u)||R.includes(u)}return!0}),Q=s=>{p(s),D(!0)},$=s=>{p(s),i(!0)},G=s=>{switch(s){case"admin":return e.jsx(O,{className:"h-4 w-4"});case"provider":return e.jsx(I,{className:"h-4 w-4"});default:return e.jsx(E,{className:"h-4 w-4"})}},K=s=>{switch(s){case"admin":return"bg-gradient-to-r from-purple-100 to-purple-200 text-purple-800 border-purple-300";case"provider":return"bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800 border-blue-300";default:return"bg-gradient-to-r from-green-100 to-green-200 text-green-800 border-green-300"}};return l?e.jsx(c,{className:"border-0 shadow-lg",children:e.jsx(d,{className:"p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4",children:[e.jsx(S,{className:"h-12 w-12 animate-spin text-blue-500"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Carregando usuários..."})]})})}):e.jsxs(e.Fragment,{children:[e.jsxs(c,{className:"border-0 shadow-lg",children:[e.jsx(J,{className:"bg-gradient-to-r from-gray-50 to-blue-50 border-b",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs(W,{className:"text-xl font-bold text-gray-900 flex items-center",children:[e.jsx(f,{className:"h-5 w-5 mr-2 text-blue-600"}),"Lista de Usuários"]}),e.jsxs(Z,{className:"text-gray-600",children:[g.length," usuário",g.length!==1?"s":""," encontrado",g.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(ie,{placeholder:"Buscar por nome, email ou telefone...",value:m,onChange:s=>r(s.target.value),className:"pl-10 w-full sm:w-[300px] border-gray-200 focus:border-blue-500"})]}),e.jsxs(F,{children:[e.jsx(P,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:"border-gray-200 hover:bg-gray-50",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Filtrar"]})}),e.jsxs(B,{align:"end",className:"w-48",children:[e.jsxs(n,{onClick:()=>o(null),children:[e.jsx(f,{className:"mr-2 h-4 w-4"}),"Todos os tipos"]}),e.jsxs(n,{onClick:()=>o("client"),children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Apenas clientes"]}),e.jsxs(n,{onClick:()=>o("provider"),children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Apenas prestadores"]}),e.jsxs(n,{onClick:()=>o("admin"),children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Apenas administradores"]})]})]})]})]})}),e.jsx(d,{className:"p-0",children:g.length>0?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 p-6",children:g.map(s=>e.jsx(c,{className:"border border-gray-100 hover:shadow-md transition-shadow group",children:e.jsxs(d,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-full ${s.isActive?"bg-green-100":"bg-gray-100"}`,children:e.jsx(E,{className:`h-5 w-5 ${s.isActive?"text-green-600":"text-gray-400"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:s.name||"Sem nome"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",s.id]})]})]}),e.jsxs(F,{children:[e.jsx(P,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(le,{className:"h-4 w-4"})})}),e.jsxs(B,{align:"end",children:[e.jsxs(n,{onClick:()=>Q(s),children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Editar"})]}),s.isActive?e.jsxs(n,{className:"cursor-pointer text-red-600",onClick:()=>L(s),children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Desativar"})]}):e.jsxs(n,{className:"cursor-pointer text-green-600",onClick:()=>L(s),children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Ativar"})]}),e.jsxs(n,{className:"cursor-pointer text-red-600",onClick:()=>$(s),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Excluir"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(he,{className:"h-4 w-4 mr-2 text-gray-400"}),e.jsx("span",{className:"truncate",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(ue,{className:"h-4 w-4 mr-2 text-gray-400"}),e.jsx("span",{children:s.phone})]}),s.createdAt&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(pe,{className:"h-4 w-4 mr-2 text-gray-400"}),e.jsxs("span",{children:["Cadastrado em ",new Date(s.createdAt).toLocaleDateString("pt-BR")]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[e.jsxs(U,{className:`${K(s.userType)} border font-medium`,children:[G(s.userType),e.jsx("span",{className:"ml-1",children:s.userType==="admin"?"Administrador":s.userType==="provider"?"Prestador":"Cliente"})]}),e.jsx(U,{variant:s.isActive?"default":"secondary",className:s.isActive?"bg-green-100 text-green-800 hover:bg-green-100 border-green-300":"bg-red-100 text-red-800 hover:bg-red-100 border-red-300",children:s.isActive?"Ativo":"Inativo"}),e.jsxs(U,{variant:"outline",className:s.isVerified?"bg-blue-100 text-blue-800 hover:bg-blue-100 border-blue-300":"bg-gray-100 text-gray-800 hover:bg-gray-100 border-gray-300",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),s.isVerified?"Verificado":"Não verificado"]})]})]})},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-gray-100 p-4 rounded-full w-fit mx-auto mb-4",children:e.jsx(f,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum usuário encontrado"}),e.jsx("p",{className:"text-gray-500",children:m||x?"Tente ajustar os filtros de busca":"Não há usuários cadastrados no sistema"})]})})]}),e.jsx(_,{open:N,onOpenChange:i,children:e.jsxs(ee,{className:"backdrop-blur-sm backdrop:bg-black/20",children:[e.jsxs(se,{children:[e.jsx(re,{children:"Confirmar exclusão"}),e.jsxs(ae,{children:["Você tem certeza que deseja excluir o usuário ",e.jsx("strong",{children:(a==null?void 0:a.name)||(a==null?void 0:a.email)}),"? Esta ação não pode ser desfeita."]})]}),e.jsxs(te,{children:[e.jsx(y,{variant:"outline",onClick:()=>i(!1),children:"Cancelar"}),e.jsx(y,{variant:"destructive",onClick:()=>a&&T.mutate(a.id),disabled:T.isPending,children:T.isPending?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"}),"Excluindo..."]}):"Excluir"})]})]})})]})}function ls(){var x,o,N;const{data:t,isLoading:m}=z({queryKey:["/api/admin/users"],queryFn:async()=>{try{return await(await w("GET","/api/admin/users")).json()}catch(i){return console.error("Erro ao carregar usuários:",i),[]}}}),r=H.useMemo(()=>{if(!t)return{total:0,active:0,newThisMonth:0,verified:0};const i=t.length,a=t.filter(l=>l.isActive).length,p=t.filter(l=>l.isVerified).length,C=new Date,D=new Date(C.getFullYear(),C.getMonth(),1),h=t.filter(l=>{const b=l.createdAt;return b&&new Date(b)>=D}).length;return{total:i,active:a,verified:p,newThisMonth:h}},[t]);return m?e.jsx(k,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50",children:e.jsx("div",{className:"container mx-auto py-8 px-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 h-64",children:[e.jsx(S,{className:"h-12 w-12 animate-spin text-blue-500"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Carregando estatísticas..."})]})})})}):e.jsx(k,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50",children:e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 p-3 rounded-xl",children:e.jsx(f,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gerenciamento de Usuários"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Gerencie todos os usuários da plataforma"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsx(c,{className:"border-0 shadow-lg bg-gradient-to-br from-blue-50 to-blue-100",children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Total de Usuários"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:((x=r==null?void 0:r.total)==null?void 0:x.toLocaleString())||"0"})]}),e.jsx("div",{className:"bg-blue-500 p-3 rounded-full",children:e.jsx(f,{className:"h-6 w-6 text-white"})})]})})}),e.jsx(c,{className:"border-0 shadow-lg bg-gradient-to-br from-green-50 to-green-100",children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Usuários Ativos"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:((o=r==null?void 0:r.active)==null?void 0:o.toLocaleString())||"0"})]}),e.jsx("div",{className:"bg-green-500 p-3 rounded-full",children:e.jsx(ge,{className:"h-6 w-6 text-white"})})]})})}),e.jsx(c,{className:"border-0 shadow-lg bg-gradient-to-br from-purple-50 to-purple-100",children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-800",children:"Novos este Mês"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900",children:["+",(r==null?void 0:r.newThisMonth)||"0"]})]}),e.jsx("div",{className:"bg-purple-500 p-3 rounded-full",children:e.jsx(je,{className:"h-6 w-6 text-white"})})]})})}),e.jsx(c,{className:"border-0 shadow-lg bg-gradient-to-br from-orange-50 to-orange-100",children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-800",children:"Verificados"}),e.jsx("p",{className:"text-2xl font-bold text-orange-900",children:((N=r==null?void 0:r.verified)==null?void 0:N.toLocaleString())||"0"})]}),e.jsx("div",{className:"bg-orange-500 p-3 rounded-full",children:e.jsx(V,{className:"h-6 w-6 text-white"})})]})})})]})]}),e.jsx(fe,{})]})})})}export{ls as default};
